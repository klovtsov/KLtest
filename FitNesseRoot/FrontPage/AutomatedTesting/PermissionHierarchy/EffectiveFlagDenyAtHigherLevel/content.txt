!define psConnectOptions {-tpamAddress ${TPAMHost} -keyFile ${API_user_1} -apiUser ${API_user_1}}

!* Test description
If the user has Requestor (or another policy) and Deny at different levels then the lowest level should be effective=Y and all others s/b effective=N.
Deny level is 4 (user to collection of accounts)
Requestor level is 2 (user to collection of systems)
*!

!define CollectionName {${prefix}AccntColtn}
!define CollectionName2 {${prefix}SysColtn}
!define ApplyNewPoliciesInterval {50000}

!*> Include section
!include -c <AutomatedTesting.ScenarioLibrary
!include -c <AutomatedTesting.EmailScenarios.ScenarioLibrary
!include -c <AutomatedTesting.CliScenarios.ScenarioLibrary
!include -c ScenarioLibrary
*!

!*> Create Environment
!|script                                                                                          |
|Add system                                                                                       |
|Add account              |${ManagedAccount}|with password|${ManagedAccountPwd}||${NotFailed}     |
|Add Collection           |${CollectionName}                                                      |
|Add Collection           |${CollectionName2}                                                     |
|Add System To Collection |${SystemName}    |             |${CollectionName2}                     |
|Add Account To Collection|${SystemName}    |             |${ManagedAccount}   ||${CollectionName}|
*!

!4 Set permissions and list the effective ones.
!|script                                                                                  |
|Set policy|Requestor|on collection|${CollectionName} |for user|${CLI_user_2}             |
|Set policy|Denied   |on collection|${CollectionName2}|for user|${CLI_user_2}             |
|pause     |${ApplyNewPoliciesInterval}                                                   |
|Is policy |Requestor|on account   |${ManagedAccount} |for user|${CLI_user_2}|effective?|Y|
|Is policy |Denied   |on account   |${ManagedAccount} |for user|${CLI_user_2}|effective?|N|

!*> Clean environment
!|script                             |
|Remove account   |${ManagedAccount} |
|Remove system    |${SystemName}     |
|Delete Collection|${CollectionName} |
|Delete Collection|${CollectionName2}|
*!