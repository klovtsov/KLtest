!contents



!|scenario             |Prepare Test                                                                                                                     |
|Prepare User          |${PromotedUser1}  |with first name|${PromotedUser1}  |and last name|Smith|with type|Basic        |and email|${PromotedUser1Email}|
|Prepare CLI Web User  |${PromotedUser2}  |with first name|${PromotedUser2}  |and last name|Smith|with type|Administrator|and email|${PromotedUser2Email}|
|Prepare User          |${RegularAdmin}   |with first name|${RegularAdmin}   |and last name|Smith|with type|Admin        |and email|${RegularAdminEmail} |
|Prepare Sys-Admin User|${RegularSysAdmin}|with first name|${RegularSysAdmin}|and last name|Smith|and email|${RegularSysAdminEmail}                      |
|Create Mailboxes                                                                                                                                        |
|Create External Auth WinAD                                                                                                                              |
|Create External Auth Defender                                                                                                                           |


!|scenario            |Clear Test        |
|Remove user          |${PromotedUser1}  |
|Remove user          |${PromotedUser2}  |
|Remove user          |${RegularAdmin}   |
|Delete Sys-Admin User|${RegularSysAdmin}|
|Delete Mailboxes                        |
|Delete External Auth WinAD              |
|Delete External Auth Defender           |
|Remove Keys                             |


!|scenario                                                                            |Promote User                                                                                                                                       |
|Attempt to Login to Interface                                                        |${TPAMAdminURL}         |        |${PromotedUser1}                |      |${UserPwd}||You are not an authorized System Administrator of this system|
|Promote User to Sys-Admin                                                            |${PromotedUser1}                                                                                                                                   |
|Check and Delete Mails                                                               |${PromotedUser1Email}   |        |TPAM User Type has been modified|      |Roles Added: System Administrator                                        |
|Attempt to Login to Interface                                                        |${TPAMAdminURL}         |        |${PromotedUser1}                |      |${UserPwd}||TPAM System Administration                                   |
|Failed Attempt to Set Sys-Admin Password in TPAM interface                           |${PromotedUser1}        |        |${NewPwd}                       |      |You are not authorized to change the password of a system admin          |
|Authentication Controls of Promoted User Disabled in Admin Interface                 |${PromotedUser1}                                                                                                                                   |
|Failed Attempt to Change Promoted User Password by CLI                               |${RegularSysAdmin}      |        |${PromotedUser1}                                                                                                 |
|BFER 7929 Correct Error When Assigning Non-Existent External Auth System             |${RegularSysAdmin}      |        |${PromotedUser1}                                                                                                 |
|Failed Attempt to Change Authentication Type by CLI                                  |${RegularSysAdmin}      |        |${PromotedUser1}                                                                                                 |
|Promote User to Sys-Admin                                                            |${PromotedUser2}                                                                                                                                   |
|Check and Delete Mails                                                               |${PromotedUser2Email}   |        |TPAM User Type has been modified|      |Roles Added: System Administrator                                        |
|Attempt to Login to Interface                                                        |${TPAMURL}              |        |${PromotedUser2}                |      |${UserPwd}||The Privileged Appliance and Modules                         |
|Failed Attempt to Set Promoted User Password in Admin interface by Promoted Sys-Admin|${PromotedUser1}        |password|${NewPwd}                       |set by|${PromotedUser2}                                                         |
|Attempt to Login to Interface                                                        |${TPAMAdminURL}         |        |${PromotedUser1}                |      |${NewPwd} ||Password that is not recognized by the system                |
|Set Promoted User Password in Tpam interface by Promoted Sys-Admin                   |${PromotedUser1}        |password|${NewPwd}                       |set by|${PromotedUser2}                                                         |
|Change Sys-Admin Pwd                                                                 |${PromotedUser1}        |        |${NewPwd}                       |      |${NewPwd2}                                                               |
|Attempt to Login to Interface                                                        |${TPAMAdminURL}         |        |${PromotedUser1}                |      |${NewPwd2}||TPAM System Administration                                   |
|Failed Attempt to Update Promoted User Type by CLI                                   |${PromotedUser2}        |        |${PromotedUser1}                |      |Admin                                                                    |
|Update Promoted User Type and Email by UI                                            |${PromotedUser2}        |        |${PromotedUser1}                |      |Administrator                                                            |
|Check and Delete Mails                                                               |${PromotedUser1Email}   |        |TPAM User Type has been modified|      |Roles Added: Administrator                                               |
|Check and Delete Mails                                                               |${PromotedUser1NewEmail}|        |TPAM User Type has been modified|      |Roles Added: Administrator                                               |



!|scenario                    |Demote User                                                                                                                          |
|Demote Sys-Admin User        |${PromotedUser1}                                                                                                                     |
|Check and Delete Mails       |${PromotedUser1NewEmail}||TPAM User Type has been modified||Roles Removed: System Administrator                                      |
|Attempt to Login to Interface|${TPAMAdminURL}         ||${PromotedUser1}                ||${NewPwd2}||You are not an authorized System Administrator of this system|
|Demote Sys-Admin User        |${PromotedUser2}                                                                                                                     |
|Check and Delete Mails       |${PromotedUser2Email}   ||TPAM User Type has been modified||Roles Removed: System Administrator                                      |


!| scenario             |Check Mail|user          |          |subject          |         |body         |
|$res=                  |CheckMail |${MailServer};@user;${TPAMEMailPassword};${FromMail};@subject;@body|
|Verify_Contain_OR_alnum|$res;;@body                                                                   |


!| scenario             |Delete Mails|user                                    |
|$res=                  |ClearMailbox|${MailServer};@user;${TPAMEMailPassword}|
|Verify_Contain_OR_alnum|$res;;Messages deleted                               |

!| scenario  |Check and Delete Mails|user|        |subject||body|
|pause       |70000                                             |
|Check Mail  |@user                 |    |@subject|       |@body|
|Delete Mails|@user                                             |


!|scenario     |Create Mailboxes                              |
|Create Mailbox|${PromotedUser1Email}   ||${TPAMEMailPassword}|
|Create Mailbox|${PromotedUser1NewEmail}||${TPAMEMailPassword}|
|Create Mailbox|${PromotedUser2Email}   ||${TPAMEMailPassword}|
|Create Mailbox|${RegularAdminEmail}    ||${TPAMEMailPassword}|
|Create Mailbox|${RegularSysAdminEmail} ||${TPAMEMailPassword}|


!|scenario     |Delete Mailboxes        |
|Delete Mailbox|${PromotedUser1Email}   |
|Delete Mailbox|${PromotedUser1NewEmail}|
|Delete Mailbox|${PromotedUser2Email}   |
|Delete Mailbox|${RegularAdminEmail}    |
|Delete Mailbox|${RegularSysAdminEmail} |


!|scenario |Prepare User|userName|with first name|firstName|and last name|lastName|with type|userType|and email|email  |
|Add User  |@userName   |        |${DefaultPwd}  |         |@firstName   |        |@lastName|        |@userType||@email|
|pause     |5000                                                                                                       |
|Change Pwd|@userName   |        |${DefaultPwd}  |         |${UserPwd}                                                 |



!|scenario        |Add User|userName        |        |password        |        |firstName        |        |lastName        |        |userType       |       |email       |
|$res=            |CLI     |${CLIBatch} AddUser --UserName @userName --FirstName @firstName --LastName @lastName --Password @password --UserType @userType --Email @email|
|Verify_Contain_OR|$res;;successful                                                                                                                                      |

!| scenario       |Remove user|userName                        |
|$res=            |CLI        |${CLIBatch} DeleteUser @userName|
|Verify_Contain_OR|$res;;successful                            |

!|scenario                     |Prepare CLI Web User|userName|with first name|firstName|and last name|lastName|with type|userType|and email|email|
|Add CLI Web User              |@userName           |        |${DefaultPwd}  |         |@userType    |        |@email                            |
|Change Pwd                    |@userName           |        |${DefaultPwd}  |         |${UserPwd}                                               |
|Get Web-enabled Users CLI Keys|@userName                                                                                                        |


!|scenario                         |Prepare Sys-Admin User|userName|with first name|firstName|and last name|lastName|and email|email|
|Add Web-enabled Sys-Admin User    |@userName             |        |@firstName     |         |@lastName    |        |@email         |
|Change Sys-Admin Pwd              |@userName             |        |${DefaultPwd}  |         |${UserPwd}                            |
|Get Web-enabled Sys-Admin CLI Keys|@userName                                                                                       |


!|scenario         |Add Web-enabled Sys-Admin User|userName|             |firstName||lastName||email|
|Login             |${TPAMAdminURL}               |        |${TPAMMaster}|         |${MasterPwd}    |
|pause             |5000                                                                            |
|clickOnLink       |link=Add Sys-Admin UserID                                                       |
|pause             |5000                                                                            |
|type;             |id=UserName                   |@userName                                        |
|type;             |id=LastName                   |@lastName                                        |
|type;             |id=FirstName                  |@firstName                                       |
|type;             |id=EmailID                    |@email                                           |
|type;             |id=sPassword                  |${DefaultPwd}                                    |
|type;             |id=Confirm                    |${DefaultPwd}                                    |
|click             |id=KeyBased                                                                     |
|pause             |1000                                                                            |
|click             |id=cb_CliAccess                                                                 |
|click             |id=SubmitChanges                                                                |
|waitForTextPresent|User added successfully                                                         |
|Logout                                                                                             |


!| scenario |Get Web-enabled Sys-Admin CLI Keys           |userName                                                          |
|Login      |${TPAMAdminURL}                              |           |@userName           |           |${UserPwd}           |
|pause      |5000                                                                                                            |
|clickOnLink|link=User Details                                                                                               |
|click      |id=ResetCliAKey                                                                                                 |
|pause      |30000                                                                                                           |
|click      |id=GetCliAKey                                                                                                   |
|pause      |5000                                                                                                            |
|runBatch   |movekey;${BrowserDownloadDir}\id_dsa;${PathToKeys}@userName.ppk                                                 |
|Show Desktop                                                                                                                |
|runBatch   |AutoIt3.exe;${ProjDir}\Scripts\generate_putty_key.au3;${ProjDir}\Scripts\puttygen.exe;${PathToKeys}@userName.ppk|
|Logout                                                                                                                      |

!|scenario|Remove Keys                                           |
|runBatch |DeleteFileByMask;${PathToKeys}${RegularSysAdmin}*;fake|
|runBatch |DeleteFileByMask;${PathToKeys}${PromotedUser2}*;fake  |



!| scenario        |Change Sys-Admin Pwd|userName|         |currenPwd|  |newPwd |
|Login             |${TPAMAdminURL}     |        |@userName|         |@currenPwd|
|type;             |id=sOldPwd          |@currenPwd                             |
|type;             |id=sPassword        |@newPwd                                |
|type;             |id=sConfirm         |@newPwd                                |
|click             |id=save                                                     |
|click             |id=save                                                     |
|waitForTextPresent|Your password has been successfully changed                 |
|stop                                                                           |

!|scenario            |Delete Sys-Admin User|userName                    |
|Login                |${TPAMAdminURL}      ||${TPAMMaster}||${MasterPwd}|
|pause                |10000                                             |
|clickOnLink          |link=Manage Sys-Admin UserIDs                     |
|waitForElementPresent|id=UsrNm                                          |
|type;                |id=UsrNm             |@userName                   |
|click                |id=Listing                                        |
|click                |xpath=//td[contains(text(),'@userName')]          |
|click                |id=Delete                                         |
|getConfirmation                                                         |
|waitForTextPresent   |has been successfully deleted                     |
|Logout                                                                  |



!|scenario            |Promote User to Sys-Admin|userName                    |
|Login                |${TPAMAdminURL}          ||${TPAMMaster}||${MasterPwd}|
|clickOnLink          |link=Manage Sys-Admin UserIDs                         |
|click                |id=Promote                                            |
|type;                |id=UsrNm                 |@userName                   |
|click                |id=Listing                                            |
|click                |xpath=//td[contains(text(),'@userName')]              |
|pause                |2000                                                  |
|click                |id=Details                                            |
|pause                |5000                                                  |
|$res=                |isEnabled                |id=sPassword                |
|Verify_Contain_OR    |$res;;true                                            |
|$res=                |isEnabled                |id=Confirm                  |
|Verify_Contain_OR    |$res;;true                                            |
|$res=                |isEnabled                |id=PrimAuthType             |
|Verify_Contain_OR    |$res;;true                                            |
|select;              |id=PrimAuthType          |label=Defender              |
|pause                |1000                                                  |
|$res=                |isEnabled                |id=PrimAuthCfgID            |
|Verify_Contain_OR    |$res;;true                                            |
|select;              |id=PrimAuthCfgID         |label=${DefenderName}       |
|$res=                |isEnabled                |id=PrimAuthID               |
|Verify_Contain_OR    |$res;;true                                            |
|type;                |id=PrimAuthID            |${DefenderUser}             |
|$res=                |isEnabled                |id=ExtAuthType              |
|Verify_Contain_OR    |$res;;true                                            |
|select;              |id=ExtAuthType           |label=WinAD                 |
|pause                |1000                                                  |
|$res=                |isEnabled                |id=ExtAuthCfgID             |
|Verify_Contain_OR    |$res;;true                                            |
|select;              |id=ExtAuthCfgID          |label=${WinADExtAuthSystem} |
|$res=                |isEnabled                |id=ExtAuthID                |
|Verify_Contain_OR    |$res;;true                                            |
|type;                |id=ExtAuthID             |${WinADExtAuthID}           |
|click                |id=SubmitChanges                                      |
|waitForTextPresent   |User updated successfully                             |
|pause                |5000                                                  |
|$res=                |isEnabled                |id=sPassword                |
|Verify_Contain_OR    |$res;;false                                           |
|$res=                |isEnabled                |id=Confirm                  |
|Verify_Contain_OR    |$res;;false                                           |
|$res=                |isEnabled                |id=PrimAuthType             |
|Verify_Contain_OR    |$res;;false                                           |
|$res=                |getSelectedLabel         |id=PrimAuthType             |
|Verify_Contain_OR    |$res;;Defender                                        |
|$res=                |isEnabled                |id=PrimAuthCfgID            |
|Verify_Contain_OR    |$res;;false                                           |
|$res=                |getSelectedLabel         |id=PrimAuthCfgID            |
|Verify_Contain_OR    |$res;;${DefenderName}                                 |
|$res=                |isEnabled                |id=PrimAuthID               |
|Verify_Contain_OR    |$res;;false                                           |
|$res=                |isEnabled                |id=ExtAuthType              |
|Verify_Contain_OR    |$res;;false                                           |
|$res=                |getSelectedLabel         |id=ExtAuthType              |
|Verify_Contain_OR    |$res;;WinAD                                           |
|$res=                |isEnabled                |id=ExtAuthCfgID             |
|Verify_Contain_OR    |$res;;false                                           |
|$res=                |getSelectedLabel         |id=ExtAuthCfgID             |
|Verify_Contain_OR    |$res;;${WinADExtAuthSystem}                           |
|$res=                |isEnabled                |id=ExtAuthID                |
|Verify_Contain_OR    |$res;;false                                           |
|clickOnLink          |link=Manage Sys-Admin UserIDs                         |
|waitForElementPresent|id=UsrNm                                              |
|type;                |id=UsrNm                 |@userName                   |
|click                |id=Listing                                            |
|click                |xpath=//td[contains(text(),'@userName')]              |
|click                |id=Details                                            |
|pause                |2000                                                  |
|$res=                |isEnabled                |id=sPassword                |
|Verify_Contain_OR    |$res;;false                                           |
|$res=                |isEnabled                |id=Confirm                  |
|Verify_Contain_OR    |$res;;false                                           |
|$res=                |isEnabled                |id=PrimAuthType             |
|Verify_Contain_OR    |$res;;false                                           |
|$res=                |isEnabled                |id=PrimAuthCfgID            |
|Verify_Contain_OR    |$res;;false                                           |
|$res=                |isEnabled                |id=PrimAuthID               |
|Verify_Contain_OR    |$res;;false                                           |
|$res=                |isEnabled                |id=ExtAuthType              |
|Verify_Contain_OR    |$res;;false                                           |
|$res=                |getSelectedLabel         |id=ExtAuthType              |
|Verify_Contain_OR    |$res;;None                                            |
|$res=                |isEnabled                |id=ExtAuthCfgID             |
|Verify_Contain_OR    |$res;;false                                           |
|$res=                |getSelectedLabel         |id=ExtAuthCfgID             |
|Verify_Contain_OR    |$res;;Select a system                                 |
|$res=                |isEnabled                |id=ExtAuthID                |
|Verify_Contain_OR    |$res;;false                                           |
|Logout                                                                      |


!|scenario  |Demote Sys-Admin User|userName                    |
|Login      |${TPAMAdminURL}      ||${TPAMMaster}||${MasterPwd}|
|clickOnLink|link=Manage Sys-Admin UserIDs                     |
|type;      |id=UsrNm             |@userName                   |
|click      |id=Listing                                        |
|click      |xpath=//td[contains(text(),'@userName')]          |
|pause      |2000                                              |
|click      |id=Details                                        |
|pause      |5000                                              |
|click      |id=Demote                                         |
|getConfirmation                                               |
|pause      |10000                                             |
|Logout                                                        |


!|scenario         |Failed Attempt to Set Sys-Admin Password in TPAM interface|userName|            |password|   |result   |
|Login             |${TPAMURL}                                                |        |${TPAMAdmin}|        |${DefaultPwd}|
|pause             |5000                                                                                                   |
|clickOnLink       |link=Manage UserIDs                                                                                    |
|pause             |5000                                                                                                   |
|type;             |id=UsrNm                                                  |@userName                                   |
|pause             |1000                                                                                                   |
|click             |id=Listing                                                                                             |
|pause             |5000                                                                                                   |
|click             |xpath=//td[contains(text(),'@userName')]                                                               |
|pause             |1000                                                                                                   |
|click             |id=Details                                                                                             |
|pause             |3000                                                                                                   |
|type;             |id=sPassword                                              |@password                                   |
|type;             |id=Confirm                                                |@password                                   |
|pause             |1000                                                                                                   |
|click             |id=SubmitChanges                                                                                       |
|pause             |5000                                                                                                   |
|waitForTextPresent|@result                                                                                                |
|Logout                                                                                                                    |


!|scenario        |Authentication Controls of Promoted User Disabled in Admin Interface|userName                       |
|Login            |${TPAMAdminURL}                                                     ||${RegularSysAdmin}||${UserPwd}|
|pause            |5000                                                                                                |
|clickOnLink      |link=Manage Sys-Admin UserIDs                                                                       |
|pause            |5000                                                                                                |
|type;            |id=UsrNm                                                            |@userName                      |
|pause            |1000                                                                                                |
|click            |id=Listing                                                                                          |
|pause            |5000                                                                                                |
|click            |xpath=//td[contains(text(),'@userName')]                                                            |
|pause            |1000                                                                                                |
|click            |id=Details                                                                                          |
|pause            |3000                                                                                                |
|$res=            |isEnabled                                                           |id=sPassword                   |
|Verify_Contain_OR|$res;;false                                                                                         |
|$res=            |isEnabled                                                           |id=Confirm                     |
|Verify_Contain_OR|$res;;false                                                                                         |
|$res=            |isEnabled                                                           |id=PrimAuthType                |
|Verify_Contain_OR|$res;;false                                                                                         |
|$res=            |isEnabled                                                           |id=PrimAuthCfgID               |
|Verify_Contain_OR|$res;;false                                                                                         |
|$res=            |isEnabled                                                           |id=PrimAuthID                  |
|Verify_Contain_OR|$res;;false                                                                                         |
|$res=            |isEnabled                                                           |id=ExtAuthType                 |
|Verify_Contain_OR|$res;;false                                                                                         |
|$res=            |isEnabled                                                           |id=ExtAuthCfgID                |
|Verify_Contain_OR|$res;;false                                                                                         |
|$res=            |isEnabled                                                           |id=ExtAuthID                   |
|Verify_Contain_OR|$res;;false                                                                                         |
|Logout                                                                                                                |


!|scenario        |Failed Attempt to Set Promoted User Password in Admin interface by Promoted Sys-Admin|userName|password|newPassword|set by|byUser|
|Login            |${TPAMAdminURL}                                                                      |        |@byUser |           |${UserPwd}   |
|pause            |5000                                                                                                                             |
|clickOnLink      |link=Manage Sys-Admin UserIDs                                                                                                    |
|pause            |5000                                                                                                                             |
|type;            |id=UsrNm                                                                             |@userName                                  |
|pause            |1000                                                                                                                             |
|click            |id=Listing                                                                                                                       |
|pause            |5000                                                                                                                             |
|click            |xpath=//td[contains(text(),'@userName')]                                                                                         |
|pause            |1000                                                                                                                             |
|click            |id=Details                                                                                                                       |
|pause            |3000                                                                                                                             |
|$res=            |isEnabled                                                                            |id=sPassword                               |
|Verify_Contain_OR|$res;;false                                                                                                                      |
|$res=            |isEnabled                                                                            |id=Confirm                                 |
|Verify_Contain_OR|$res;;false                                                                                                                      |
|$res=            |isEnabled                                                                            |id=PrimAuthType                            |
|Verify_Contain_OR|$res;;false                                                                                                                      |
|$res=            |isEnabled                                                                            |id=PrimAuthCfgID                           |
|Verify_Contain_OR|$res;;false                                                                                                                      |
|$res=            |isEnabled                                                                            |id=PrimAuthID                              |
|Verify_Contain_OR|$res;;false                                                                                                                      |
|$res=            |isEnabled                                                                            |id=ExtAuthType                             |
|Verify_Contain_OR|$res;;false                                                                                                                      |
|$res=            |isEnabled                                                                            |id=ExtAuthCfgID                            |
|Verify_Contain_OR|$res;;false                                                                                                                      |
|$res=            |isEnabled                                                                            |id=ExtAuthID                               |
|Verify_Contain_OR|$res;;false                                                                                                                      |
|type;            |id=sPassword                                                                         |@newPassword                               |
|type;            |id=Confirm                                                                           |@newPassword                               |
|pause            |1000                                                                                                                             |
|click            |id=SubmitChanges                                                                                                                 |
|pause            |10000                                                                                                                            |
|Logout                                                                                                                                             |


!|scenario         |Set Promoted User Password in Tpam interface by Promoted Sys-Admin|userName|password|newPassword|set by|byUser|
|Login             |${TPAMURL}                                                        |        |@byUser |           |${UserPwd}   |
|pause             |5000                                                                                                          |
|clickOnLink       |link=Manage UserIDs                                                                                           |
|pause             |5000                                                                                                          |
|type;             |id=UsrNm                                                          |@userName                                  |
|pause             |1000                                                                                                          |
|click             |id=Listing                                                                                                    |
|pause             |5000                                                                                                          |
|click             |xpath=//td[contains(text(),'@userName')]                                                                      |
|pause             |1000                                                                                                          |
|click             |id=Details                                                                                                    |
|pause             |3000                                                                                                          |
|$res=             |isEnabled                                                         |id=sPassword                               |
|Verify_Contain_OR |$res;;true                                                                                                    |
|$res=             |isEnabled                                                         |id=Confirm                                 |
|Verify_Contain_OR |$res;;true                                                                                                    |
|$res=             |isEnabled                                                         |id=PrimAuthType                            |
|Verify_Contain_OR |$res;;true                                                                                                    |
|$res=             |isEnabled                                                         |id=PrimAuthCfgID                           |
|Verify_Contain_OR |$res;;false                                                                                                   |
|$res=             |isEnabled                                                         |id=PrimAuthID                              |
|Verify_Contain_OR |$res;;false                                                                                                   |
|$res=             |isEnabled                                                         |id=ExtAuthType                             |
|Verify_Contain_OR |$res;;true                                                                                                    |
|$res=             |isEnabled                                                         |id=ExtAuthCfgID                            |
|Verify_Contain_OR |$res;;false                                                                                                   |
|$res=             |isEnabled                                                         |id=ExtAuthID                               |
|Verify_Contain_OR |$res;;false                                                                                                   |
|type;             |id=sPassword                                                      |@newPassword                               |
|type;             |id=Confirm                                                        |@newPassword                               |
|pause             |1000                                                                                                          |
|click             |id=SubmitChanges                                                                                              |
|pause             |5000                                                                                                          |
|waitForTextPresent|The password was successfully changed for @userName                                                           |
|Logout                                                                                                                           |



!|scenario         |Attempt to Login to Interface|inteface|         |userName||password||result|
|Login             |@inteface                    |        |@userName|        |@password        |
|pause             |5000                                                                       |
|waitForTextPresent|@result                                                                    |
|stop                                                                                          |


!| scenario       |Failed Attempt to Change Promoted User Password by CLI|byUser                            |                            |forUser                           |
|$res=            |CLI                                                   |-i @byUser.ppk -C @byUser@${TPAMHost} ChangeAdminPassword --UserName @forUser --Password ${NewPwd}|
|Verify_Contain_OR|$res;;Sys-Admin can not change password of promoted user                                                                                                 |

!| scenario       |Failed Attempt to Update Promoted User Type by CLI|byUser             |             |forUser             |             |toType            |
|$res=            |CLI                                               |-i @byUser.ppk -C @byUser@${TPAMHost} UpdateUser --UserName @forUser --UserType @toType|
|Verify_Contain_OR|$res;;System Admin users can only be modified through web interface                                                                       |


!| scenario       |Failed Attempt to Change Authentication Type by CLI|byUser                                                             |                                                                    |forUser                                                                                                                              |
|$res=            |CLI                                                |-i @byUser.ppk -C @byUser@${TPAMHost} UpdateAdminUser --UserName @forUser --PrimaryAuthType WinAD --PrimaryAuthSystem ${WinADExtAuthSystem} --PrimaryAuthID ${WinADExtAuthID} --SecondaryAuth Defender --SecondaryAuthSystem ${DefenderName} --SecondaryUserID ${DefenderUser}|
|Verify_Contain_OR|$res;;User updated successfully                                                                                                                                                                                                                                                                                                   |
|Login            |${TPAMAdminURL}                                    |                                                                   |@byUser                                                             |                                                             |${UserPwd}                                                             |
|pause            |5000                                                                                                                                                                                                                                                                                                                              |
|clickOnLink      |link=Manage Sys-Admin UserIDs                                                                                                                                                                                                                                                                                                     |
|pause            |5000                                                                                                                                                                                                                                                                                                                              |
|type;            |id=UsrNm                                           |@forUser                                                                                                                                                                                                                                                                      |
|pause            |1000                                                                                                                                                                                                                                                                                                                              |
|click            |id=Listing                                                                                                                                                                                                                                                                                                                        |
|pause            |5000                                                                                                                                                                                                                                                                                                                              |
|click            |xpath=//td[contains(text(),'@forUser')]                                                                                                                                                                                                                                                                                           |
|pause            |1000                                                                                                                                                                                                                                                                                                                              |
|click            |id=Details                                                                                                                                                                                                                                                                                                                        |
|pause            |3000                                                                                                                                                                                                                                                                                                                              |
|$res=            |isEnabled                                          |id=sPassword                                                                                                                                                                                                                                                                  |
|Verify_Contain_OR|$res;;false                                                                                                                                                                                                                                                                                                                       |
|$res=            |isEnabled                                          |id=Confirm                                                                                                                                                                                                                                                                    |
|Verify_Contain_OR|$res;;false                                                                                                                                                                                                                                                                                                                       |
|$res=            |isEnabled                                          |id=PrimAuthType                                                                                                                                                                                                                                                               |
|Verify_Contain_OR|$res;;false                                                                                                                                                                                                                                                                                                                       |
|$res=            |getSelectedLabel                                   |id=PrimAuthType                                                                                                                                                                                                                                                               |
|Verify_Contain_OR|$res;;Local                                                                                                                                                                                                                                                                                                                       |
|$res=            |isEnabled                                          |id=PrimAuthCfgID                                                                                                                                                                                                                                                              |
|Verify_Contain_OR|$res;;false                                                                                                                                                                                                                                                                                                                       |
|$res=            |isEnabled                                          |id=PrimAuthID                                                                                                                                                                                                                                                                 |
|Verify_Contain_OR|$res;;false                                                                                                                                                                                                                                                                                                                       |
|$res=            |isEnabled                                          |id=ExtAuthType                                                                                                                                                                                                                                                                |
|Verify_Contain_OR|$res;;false                                                                                                                                                                                                                                                                                                                       |
|$res=            |getSelectedLabel                                   |id=ExtAuthType                                                                                                                                                                                                                                                                |
|Verify_Contain_OR|$res;;None                                                                                                                                                                                                                                                                                                                        |
|$res=            |isEnabled                                          |id=ExtAuthCfgID                                                                                                                                                                                                                                                               |
|Verify_Contain_OR|$res;;false                                                                                                                                                                                                                                                                                                                       |
|$res=            |isEnabled                                          |id=ExtAuthID                                                                                                                                                                                                                                                                  |
|Verify_Contain_OR|$res;;false                                                                                                                                                                                                                                                                                                                       |
|Logout                                                                                                                                                                                                                                                                                                                                              |


!| scenario       |BFER 7929 Correct Error When Assigning Non-Existent External Auth System|byUser                                                 |                                                 |forUser                                                 |
|$res=            |CLI                                                                     |-i @byUser.ppk -C @byUser@${TPAMHost} UpdateAdminUser --UserName @forUser --PrimaryAuthType WinAD --PrimaryAuthSystem KLFakeDC --PrimaryAuthID ${WinADExtAuthID}  |
|Verify_Contain_OR|$res;;Primary Authentication System not recognized                                                                                                                                                                                         |
|$res=            |CLI                                                                     |-i @byUser.ppk -C @byUser@${TPAMHost} UpdateAdminUser --UserName @forUser --SecondaryAuth WinAD --SecondaryAuthSystem KLFakeDC --SecondaryUserID ${WinADExtAuthID}|
|Verify_Contain_OR|$res;;Secondary Authentication System not recognized                                                                                                                                                                                       |


!|scenario         |Create External Auth WinAD                   |
|Login             |${TPAMAdminURL} ||${TPAMMaster}||${MasterPwd}|
|pause             |3000                                         |
|clickOnLink       |link=WinAD Config                            |
|click             |id=NewSystemButton                           |
|type;             |id=SystemName   |${WinADExtAuthSystem}       |
|type;             |id=ServerAddress|1.1.1.1                     |
|type;             |id=AuthenTimeout|2                           |
|click             |id=SubmitChangesButton                       |
|waitForTextPresent|New WinAD added successfully                 |
|Logout                                                          |


!|scenario         |Delete External Auth WinAD                  |
|Login             |${TPAMAdminURL}||${TPAMMaster}||${MasterPwd}|
|pause             |3000                                        |
|clickOnLink       |link=WinAD Config                           |
|select;           |id=ExtAuthCfgID|label=${WinADExtAuthSystem} |
|click             |id=DeleteSystemButton                       |
|getConfirmation                                                |
|waitForTextPresent|*successfully                               |
|Logout                                                         |


!|scenario         |Create External Auth Defender                |
|Login             |${TPAMAdminURL} ||${TPAMMaster}||${MasterPwd}|
|pause             |3000                                         |
|clickOnLink       |link=Defender Config                         |
|click             |id=NewSystemButton                           |
|type;             |id=SystemName   |${DefenderName}             |
|type;             |id=ServerAddress|2.2.2.2                     |
|type;             |id=ServerSecret |Secret                      |
|click             |id=SubmitChangesButton                       |
|waitForTextPresent|New Defender added successfully              |
|Logout                                                          |



!|scenario         |Delete External Auth Defender               |
|Login             |${TPAMAdminURL}||${TPAMMaster}||${MasterPwd}|
|pause             |3000                                        |
|clickOnLink       |link=Defender Config                        |
|select;           |id=ExtAuthCfgID|label=${DefenderName}       |
|click             |id=DeleteSystemButton                       |
|getConfirmation                                                |
|waitForTextPresent|*successfully                               |
|Logout                                                         |




!|scenario         |Add CLI Web User|UserName|            |Passwd| |Type||email|
|Login             |${TPAMURL}      |        |${TPAMAdmin}|      |${DefaultPwd}|
|pause             |5000                                                       |
|clickOnLink       |link=Add UserID                                            |
|type;             |id=UserName     |@UserName                                 |
|type;             |id=FirstName    |Vasily                                    |
|type;             |id=LastName     |Pupkin                                    |
|type;             |id=sPassword    |@Passwd                                   |
|type;             |id=Confirm      |@Passwd                                   |
|type;             |id=EmailID      |@email                                    |
|select;           |id=UType        |label=@Type                               |
|click             |id=KeyBased                                                |
|pause             |1000                                                       |
|click             |id=cb_CliAccess                                            |
|pause             |1000                                                       |
|click             |id=SubmitChanges                                           |
|waitForTextPresent|*User added successfully*                                  |
|Logout                                                                        |

!| scenario |Get Web-enabled Users CLI Keys            |userName                                                             |
|Login      |${TPAMURL}                                |            |@userName            |            |${UserPwd}           |
|pause      |5000                                                                                                            |
|clickOnLink|link=User Details                                                                                               |
|click      |id=ResetCliKey                                                                                                  |
|pause      |30000                                                                                                           |
|click      |id=GetCliKey                                                                                                    |
|pause      |8000                                                                                                            |
|runBatch   |movekey;${BrowserDownloadDir}id_dsa;${PathToKeys}@userName.ppk                                                  |
|Show Desktop                                                                                                                |
|runBatch   |AutoIt3.exe;${ProjDir}\Scripts\generate_putty_key.au3;${ProjDir}\Scripts\puttygen.exe;${PathToKeys}@userName.ppk|
|Logout                                                                                                                      |


!| scenario        |Update Promoted User Type and Email by UI|byUser|       |forUser|  |toType |
|Login             |${TPAMURL}                               |      |@byUser|       |${UserPwd}|
|pause             |3000                                                                       |
|clickOnLink       |link=Manage UserIDs                                                        |
|pause             |3000                                                                       |
|type;             |id=UsrNm                                 |@forUser                         |
|pause             |1000                                                                       |
|click             |id=Listing                                                                 |
|pause             |5000                                                                       |
|click             |xpath=//td[contains(text(),'@forUser')]                                    |
|pause             |1000                                                                       |
|click             |id=Details                                                                 |
|pause             |3000                                                                       |
|select;           |id=UType                                 |label=@toType                    |
|type;             |id=EmailID                               |${PromotedUser1NewEmail}         |
|pause             |1000                                                                       |
|click             |id=SubmitChanges                                                           |
|pause             |5000                                                                       |
|waitForTextPresent|User updated successfully                                                  |
|Logout                                                                                        |

