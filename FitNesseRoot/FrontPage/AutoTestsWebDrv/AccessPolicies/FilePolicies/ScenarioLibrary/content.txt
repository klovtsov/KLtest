!| scenario|Prepare Environment|
|Set Permissions               |

!| scenario|Clear Environment|
|Remove Permissions          |


!| scenario                            |Set Permissions                                                              |
|Set Group Permissions File Level      |${GroupFileRequestors}      ||\"${FileRequestorPolicy}\"                     |
|Set Group Permissions File Level      |${GroupFileApprovers}       ||\"${FileApproverPolicy}\"                      |
|Set Group Permissions File Level      |${GroupFileIsas}            ||\"${FileIsaPolicy}\"                           |
|Set Group Permissions File Level      |${GroupFilePacs}            ||\"${FilePacPolicy}\"                           |
|Set Group Permissions System Level    |${GroupSystemRequestors}    ||\"${FileRequestorPolicy}\"                     |
|Set Group Permissions System Level    |${GroupSystemApprovers}     ||\"${FileApproverPolicy}\"                      |
|Set Group Permissions System Level    |${GroupSystemIsas}          ||\"${FileIsaPolicy}\"                           |
|Set Group Permissions System Level    |${GroupSystemPacs}          ||\"${FilePacPolicy}\"                           |
|Set Group Permissions Collection Level|${GroupCollectionRequestors}||\"${FileRequestorPolicy}\"||${FileCollection}  |
|Set Group Permissions Collection Level|${GroupCollectionApprovers} ||\"${FileApproverPolicy}\" ||${FileCollection}  |
|Set Group Permissions Collection Level|${GroupCollectionIsas}      ||\"${FileIsaPolicy}\"      ||${FileCollection}  |
|Set Group Permissions Collection Level|${GroupCollectionPacs}      ||\"${FilePacPolicy}\"      ||${FileCollection}  |
|Set User Permissions File Level       |${UserFileRequestor}        ||\"${FileRequestorPolicy}\"                     |
|Set User Permissions File Level       |${UserFileApprover}         ||\"${FileApproverPolicy}\"                      |
|Set User Permissions File Level       |${UserFileIsa}              ||\"${FileIsaPolicy}\"                           |
|Set User Permissions File Level       |${UserFilePac}              ||\"${FilePacPolicy}\"                           |
|Set User Permissions System Level     |${UserSystemRequestor}      ||\"${FileRequestorPolicy}\"                     |
|Set User Permissions System Level     |${UserSystemApprover}       ||\"${FileApproverPolicy}\"                      |
|Set User Permissions System Level     |${UserSystemIsa}            ||\"${FileIsaPolicy}\"                           |
|Set User Permissions System Level     |${UserSystemPac}            ||\"${FilePacPolicy}\"                           |
|Set User Permissions Collection Level |${UserCollectionRequestor}  ||\"${FileRequestorPolicy}\"||${SystemCollection}|
|Set User Permissions Collection Level |${UserCollectionApprover}   ||\"${FileApproverPolicy}\" ||${SystemCollection}|
|Set User Permissions Collection Level |${UserCollectionIsa}        ||\"${FileIsaPolicy}\"      ||${SystemCollection}|
|Set User Permissions Collection Level |${UserCollectionPac}        ||\"${FilePacPolicy}\"      ||${SystemCollection}|
|Set User Permissions On Fake File     |${UserWithoutPermissions}   ||\"${FileRequestorPolicy}\"                     |
|Set User Permissions On Fake File     |${UserCollectionRequestor}  ||\"${FileRequestorPolicy}\"                     |






!| scenario                            |Remove Permissions                                                           |
|Remove Group Permissions On File      |${GroupFileRequestors}      ||\"${FileRequestorPolicy}\"                     |
|Remove Group Permissions On File      |${GroupFileApprovers}       ||\"${FileApproverPolicy}\"                      |
|Remove Group Permissions On File      |${GroupFileIsas}            ||\"${FileIsaPolicy}\"                           |
|Remove Group Permissions On File      |${GroupFilePacs}            ||\"${FilePacPolicy}\"                           |
|Remove Group Permissions On System    |${GroupSystemRequestors}    ||\"${FileRequestorPolicy}\"                     |
|Remove Group Permissions On System    |${GroupSystemApprovers}     ||\"${FileApproverPolicy}\"                      |
|Remove Group Permissions On System    |${GroupSystemIsas}          ||\"${FileIsaPolicy}\"                           |
|Remove Group Permissions On System    |${GroupSystemPacs}          ||\"${FilePacPolicy}\"                           |
|Remove Group Permissions On Collection|${GroupCollectionRequestors}||\"${FileRequestorPolicy}\"||${FileCollection}  |
|Remove Group Permissions On Collection|${GroupCollectionApprovers} ||\"${FileApproverPolicy}\" ||${FileCollection}  |
|Remove Group Permissions On Collection|${GroupCollectionIsas}      ||\"${FileIsaPolicy}\"      ||${FileCollection}  |
|Remove Group Permissions On Collection|${GroupCollectionPacs}      ||\"${FilePacPolicy}\"      ||${FileCollection}  |
|Remove User Permissions On File       |${UserFileRequestor}        ||\"${FileRequestorPolicy}\"                     |
|Remove User Permissions On File       |${UserFileApprover}         ||\"${FileApproverPolicy}\"                      |
|Remove User Permissions On File       |${UserFileIsa}              ||\"${FileIsaPolicy}\"                           |
|Remove User Permissions On File       |${UserFilePac}              ||\"${FilePacPolicy}\"                           |
|Remove User Permissions On System     |${UserSystemRequestor}      ||\"${FileRequestorPolicy}\"                     |
|Remove User Permissions On System     |${UserSystemApprover}       ||\"${FileApproverPolicy}\"                      |
|Remove User Permissions On System     |${UserSystemIsa}            ||\"${FileIsaPolicy}\"                           |
|Remove User Permissions On System     |${UserSystemPac}            ||\"${FilePacPolicy}\"                           |
|Remove User Permissions On Collection |${UserCollectionRequestor}  ||\"${FileRequestorPolicy}\"||${SystemCollection}|
|Remove User Permissions On Collection |${UserCollectionApprover}   ||\"${FileApproverPolicy}\" ||${SystemCollection}|
|Remove User Permissions On Collection |${UserCollectionIsa}        ||\"${FileIsaPolicy}\"      ||${SystemCollection}|
|Remove User Permissions On Collection |${UserCollectionPac}        ||\"${FilePacPolicy}\"      ||${SystemCollection}|
|Remove User Permissions On Fake File  |${UserWithoutPermissions}   ||\"${FileRequestorPolicy}\"                     |
|Remove User Permissions On Fake File  |${UserCollectionRequestor}  ||\"${FileRequestorPolicy}\"                     |







!|scenario          |File Access Approved|Requestor|            |Approver      |
|Login              |${TPAMURL}          |         |${TPAMAdmin}||${DefaultPwd}|
|$Requestor=        |getEval             |var s = "@Requestor";return s;       |
|$Approver=         |getEval             |var s = "@Approver";return s;        |
|Logout                                                                        |
|Request File       |${SystemName}       |         |${FileName} ||$Requestor   |
|Approve File       |$Approver                                                 |
|pause              |15000                                                     |
|Retreive File      |$Requestor                                                |
|Cancel File Request|$Requestor                                                |


!|scenario          |File Access Privileged|privUser                     |
|Login              |${TPAMURL}            | |${TPAMAdmin}||${DefaultPwd}|
|$Requestor=        |getEval               |var s = "@privUser";return s;|
|Logout                                                                  |
|Request File       |${SystemName}         | |${FileName} ||$Requestor   |
|pause              |15000                                               |
|Retreive File      |$Requestor                                          |
|Cancel File Request|$Requestor                                          |


!|scenario            |File Access ISA      |isaUser                                         |
|Login                |${TPAMURL}           |       |@isaUser       |       |${UserPwd}      |
|pause                |10000                                                                 |
|clickOnLink          |link=Manage Files                                                     |
|type;                |id=FileNm            |${FileName}                                     |
|click                |id=Listing                                                            |
|click                |xpath=//td[contains(text(),'${FileName}')]                            |
|click                |id=CurrentFile                                                        |
|type;                |id=ReleaseReasonText |ReleaseReasonText                               |
|pause                |15000                                                                 |
|click                |id=RetrieveCurrent                                                    |
|pause                |15000                                                                 |
|Check Downloaded File|${BrowserDownloadDir}|       |${FileName}                             |
|click                |id=Details                                                            |
|$UniqueDesc=         |getEval              |var d = new Date();var s = d.getTime();return s;|
|type;                |id=FileDesc          |new description $UniqueDesc                     |
|click                |id=SubmitChanges                                                      |
|waitForTextPresent   |File updated successfully                                             |
|Logout                                                                                      |


!|scenario                                   |File Access Denied|deniedUser|           |restrictedObject|
|Login                                       |${TPAMURL}        |          |@deniedUser|   |${UserPwd}  |
|pause                                       |10000                                                     |
|clickOnLink                                 |link=Add File Request                                     |
|type;                                       |id=FileNm         |${FileName}                            |
|click                                       |id=Files                                                  |
|pause                                       |5000                                                      |
|$Where=                                     |getText           |xpath=//table[@id='filesTable']        |
|Verify_Contain_OR                           |$Where;;${FileName}                                       |
|Logout                                                                                                 |
|Set User Permissions @restrictedObject Level|@deniedUser       |          |\"${FileDeniedPolicy}\"     |
|Login                                       |${TPAMURL}        |          |@deniedUser|   |${UserPwd}  |
|pause                                       |10000                                                     |
|clickOnLink                                 |link=Add File Request                                     |
|type;                                       |id=FileNm         |${FileName}                            |
|click                                       |id=Files                                                  |
|pause                                       |5000                                                      |
|$Where=                                     |getText           |xpath=//table[@id='filesTable']        |
|Verify_Contain_NOT                          |$Where;;${FileName}                                       |
|Remove User Permissions On @restrictedObject|@deniedUser       |          |\"${FileDeniedPolicy}\"     |
|Logout                                                                                                 |


!|scenario                                   |File Access Not Denied|deniedUser|           |restrictedObject|
|Login                                       |${TPAMURL}            |          |@deniedUser|   |${UserPwd}  |
|pause                                       |10000                                                         |
|clickOnLink                                 |link=Add File Request                                         |
|type;                                       |id=FileNm             |${FileName}                            |
|click                                       |id=Files                                                      |
|pause                                       |5000                                                          |
|$Where=                                     |getText               |xpath=//table[@id='filesTable']        |
|Verify_Contain_OR                           |$Where;;${FileName}                                           |
|Logout                                                                                                     |
|Set User Permissions @restrictedObject Level|@deniedUser           |          |\"${FileDeniedPolicy}\"     |
|Login                                       |${TPAMURL}            |          |@deniedUser|   |${UserPwd}  |
|pause                                       |10000                                                         |
|clickOnLink                                 |link=Add File Request                                         |
|type;                                       |id=FileNm             |${FileName}                            |
|click                                       |id=Files                                                      |
|pause                                       |5000                                                          |
|$Where=                                     |getText               |xpath=//table[@id='filesTable']        |
|Verify_Contain_OR                           |$Where;;${FileName}                                           |
|Remove User Permissions On @restrictedObject|@deniedUser           |          |\"${FileDeniedPolicy}\"     |
|Logout                                                                                                     |




!|scenario                            |File Access Denied on Collection Level|deniedUser|                       |collectionName  |
|Login                                |${TPAMURL}                            |          |@deniedUser            ||${UserPwd}     |
|pause                                |10000                                                                                     |
|clickOnLink                          |link=Add File Request                                                                     |
|type;                                |id=FileNm                             |${FileName}                                        |
|click                                |id=Files                                                                                  |
|pause                                |5000                                                                                      |
|$Where=                              |getText                               |xpath=//table[@id='filesTable']                    |
|Verify_Contain_OR                    |$Where;;${FileName}                                                                       |
|Logout                                                                                                                          |
|Set User Permissions Collection Level|@deniedUser                           |          |\"${FileDeniedPolicy}\"||@collectionName|
|Login                                |${TPAMURL}                            |          |@deniedUser            ||${UserPwd}     |
|pause                                |10000                                                                                     |
|clickOnLink                          |link=Add File Request                                                                     |
|type;                                |id=FileNm                             |${FileName}                                        |
|click                                |id=Files                                                                                  |
|pause                                |5000                                                                                      |
|$Where=                              |getText                               |xpath=//table[@id='filesTable']                    |
|Verify_Contain_NOT                   |$Where;;${FileName}                                                                       |
|Logout                                                                                                                          |
|Remove User Permissions On Collection|@deniedUser                           |          |\"${FileDeniedPolicy}\"||@collectionName|



!|scenario                            |File Access Not Denied on Collection Level|deniedUser|                       |collectionName  |
|Login                                |${TPAMURL}                                |          |@deniedUser            ||${UserPwd}     |
|pause                                |10000                                                                                         |
|clickOnLink                          |link=Add File Request                                                                         |
|type;                                |id=FileNm                                 |${FileName}                                        |
|click                                |id=Files                                                                                      |
|pause                                |5000                                                                                          |
|$Where=                              |getText                                   |xpath=//table[@id='filesTable']                    |
|Verify_Contain_OR                    |$Where;;${FileName}                                                                           |
|Logout                                                                                                                              |
|Set User Permissions Collection Level|@deniedUser                               |          |\"${FileDeniedPolicy}\"||@collectionName|
|Login                                |${TPAMURL}                                |          |@deniedUser            ||${UserPwd}     |
|pause                                |10000                                                                                         |
|clickOnLink                          |link=Add File Request                                                                         |
|type;                                |id=FileNm                                 |${FileName}                                        |
|click                                |id=Files                                                                                      |
|pause                                |5000                                                                                          |
|$Where=                              |getText                                   |xpath=//table[@id='filesTable']                    |
|Verify_Contain_OR                    |$Where;;${FileName}                                                                           |
|Logout                                                                                                                              |
|Remove User Permissions On Collection|@deniedUser                               |          |\"${FileDeniedPolicy}\"||@collectionName|



!|scenario                                |File Access Without Permissions|deniedUser|            |allowedObject|
|Login                                    |${TPAMURL}                     |          |@deniedUser | |${UserPwd} |
|pause                                    |10000                                                                |
|clickOnLink                              |link=Add File Request                                                |
|type;                                    |id=FileNm                      |${FileName}                          |
|click                                    |id=Files                                                             |
|pause                                    |5000                                                                 |
|$Where=                                  |getText                        |xpath=//table[@id='filesTable']      |
|Verify_Contain_NOT                       |$Where;;${FileName}                                                  |
|Logout                                                                                                         |
|Set User Permissions @allowedObject Level|@deniedUser                    |          |\"${FileRequestorPolicy}\"|
|pause                                    |${ApplyNewPoliciesInterval}                                          |
|Login                                    |${TPAMURL}                     |          |@deniedUser | |${UserPwd} |
|pause                                    |10000                                                                |
|clickOnLink                              |link=Add File Request                                                |
|type;                                    |id=FileNm                      |${FileName}                          |
|click                                    |id=Files                                                             |
|pause                                    |5000                                                                 |
|$Where=                                  |getText                        |xpath=//table[@id='filesTable']      |
|Verify_Contain_OR                        |$Where;;${FileName}                                                  |
|Logout                                                                                                         |
|Remove User Permissions On @allowedObject|@deniedUser                    |          |\"${FileRequestorPolicy}\"|
|pause                                    |${ApplyNewPoliciesInterval}                                          |





!| scenario           |Retreive File        |userName              |
|Login                |${TPAMURL}           ||@userName||${UserPwd}|
|pause                |5000                                        |
|click                |id=CurrentRequests                          |
|waitForElementPresent|link=$RequestID                             |
|clickOnLink          |link=$RequestID                             |
|pause                |15000                                       |
|click                |id=RetrieveButton                           |
|pause                |30000                                       |
|Check Downloaded File|${BrowserDownloadDir}||${FileName}          |
|Logout                                                            |

!| scenario|Check Downloaded File|filePath||fileName|
|runBatch  |CheckAndDeleteFile;@filePath;@fileName  |



!| scenario        |Cancel File Request|Requestor              |
|Login             |${TPAMURL}         ||@Requestor||${UserPwd}|
|pause             |5000                                       |
|click             |id=CurrentRequests                         |
|click             |link=File(${FileName})                     |
|click             |xpath=//td[contains(text(),'${FileName}')] |
|click             |id=Details                                 |
|pause             |10000                                      |
|type;             |id=ResponseComment |cancel                 |
|click             |id=SubmitChanges                           |
|waitForTextPresent|*The response *was submitted successfully* |
|Logout                                                        |




!|scenario  |Current File                                     |
|Login      |${TPAMURL}          ||${TPAMAdmin}||${DefaultPwd}|
|pause      |10000                                            |
|clickOnLink|link=Manage Files                                |
|type;      |id=FileNm           |${FileName}                 |
|click      |id=Listing                                       |
|click      |xpath=//td[contains(text(),'${FileName}')]       |
|click      |id=CurrentFile                                   |
|type;      |id=ReleaseReasonText|ReleaseReasonText           |
|pause      |15000                                            |
|click      |id=RetrieveCurrent                               |
|pause      |35000                                            |
|Logout                                                       |


!| scenario        |Request File    |SystemName                         |                                   |FileName                        |                        |Requestor                        |
|Login             |${TPAMURL}      |                                   |@Requestor                         |                                |${UserPwd}                                                |
|pause             |10000                                                                                                                                                                               |
|clickOnLink       |link=Add File Request                                                                                                                                                               |
|type;             |id=SystemNm     |@SystemName                                                                                                                                                        |
|type;             |id=FileNm       |@FileName                                                                                                                                                          |
|click             |id=Files                                                                                                                                                                            |
|click             |xpath=//td[contains(text(),'@FileName')]                                                                                                                                            |
|click             |id=Details                                                                                                                                                                          |
|pause             |15000                                                                                                                                                                               |
|type;             |id=RequestReason|file request reason                                                                                                                                                |
|click             |id=SubmitChanges                                                                                                                                                                    |
|waitForTextPresent|*Request*has been submitted.*                                                                                                                                                       |
|$res=             |getText         |xpath=//div[@id='ResultsDiv']                                                                                                                                      |
|$RequestID=       |getEval         |var rstr = "Request number ";var i1 = "$res".indexOf(rstr);var i2 = "$res".substring(i1 + rstr.length);var i3 = i2.indexOf(" ");i4 = i2.substring (0,i3);return i4;|
|Logout                                                                                                                                                                                                 |

!| scenario        |Approve File       |Approver              |
|Login             |${TPAMURL}         ||@Approver||${UserPwd}|
|pause             |10000                                     |
|clickOnLink       |link=File Requests Pending Approval       |
|click             |xpath=//td[contains(text(),'${FileName}')]|
|click             |id=Details                                |
|pause             |15000                                     |
|type;             |id=ResponseComment |ok to approve         |
|click             |id=ApproveReq                             |
|waitForTextPresent|*The response *was submitted successfully*|
|Logout                                                       |




