!|scenario         |Open            |URL||uName||uPassword|
|open              |@URL                                  |
|windowFocus                                              |
|windowMaximize                                           |
|waitForTextPresent|User Name                             |
|click             |id=loginUserName                      |
|type;             |id=loginUserName|@uName               |
|click             |id=loginPassword                      |
|type;             |id=loginPassword|@uPassword           |
|typeKeys;         |id=loginPassword|@uPassword           |
|pause             |3000                                  |
|click             |id=btnLogin                           |
|pause             |7000                                  |

!|scenario        |Login               |URL            |               |userName          |       |uPwd       |
|stop                                                                                                         |
|pause            |5000                                                                                       |
|start            |Slim Selenium Driver|${seleniumHost}|${seleniumPort}|${seleniumBrowser}|https://${TPAMHost}|
|setTimeoutSeconds|${seleniumTimeout}                                                                         |
|pause            |5000                                                                                       |
|Open             |@URL                |               |@userName      |                  |@uPwd              |

!|scenario|SSH                                |Args                                |
|ssh      |${SystemAddress};;${FunctAcct};;${FunctAcctPwd};;${SystemPlatform}\@Args|

!|scenario   |Logout           |
|click       |css=div.icon-user|
|clickAndWait|link=Logout      |
|click       |id=B1            |

!|scenario   |Logout Paradmin|
|click       |link=ParAdmin  |
|clickAndWait|link=Logout    |
|click       |id=B1          |


#!| scenario           |Check Mail                                              |
#|open                 |http://www.gmail.com                                    |
#|windowFocus                                                                   |
#|windowMaximize                                                                |
#|waitForElementPresent|id=Email                                                |
#|type;                |id=Email                           |${RequestorEMail}   |
#|type;                |id=Passwd                          |${RequestorEMailPwd}|
#|clickAndWait         |id=signIn                                               |
#|waitForElementPresent|canvas_frame                                            |
#|selectFrame          |canvas_frame                                            |
#|waitForElementPresent|//span[contains(text(), 'equest')]                     |
#|verifyText           |//span[contains(text(), 'equest')]| |equest;;submitted|
#|click                |css=input.T-Jo-auh                |                    |
#|click                |css=input.ar9 T-I-J3 J-J5-Ji|                          |
#|pause                |5000                                                    |
#|verifyText           |//td[contains(text(),'No new')]    | |No new mail       |

!|scenario|Create Mailbox                    |mailbox                   |                   |password                   |
|runBatch |CreateMailbox;${MailServer};${MailServerAdmin};${MailServerAdminPassword};@mailbox;${PathToMailbox};@password|

!|scenario|Delete Mailbox                                       |mailbox                                      |
|runBatch |DeleteMailbox;${MailServer};${MailServerAdmin};${MailServerAdminPassword};@mailbox;${PathToMailbox}|

!| scenario             |Check Mail|host ||user||passwd||from||subject||mailbody|
|$res=                  |CheckMail |@host;@user;@passwd;@from;@subject;@mailbody|
|Verify_Contain_OR_alnum|$res;;${Requestor}                                     |




#!| scenario        |Change Pwd  |userName|         |currenPwd|  |newPwd |
#|Login             |${TPAMURL}  |        |@userName|         |@currenPwd|
#|pause             |15000                                               |
#|type;             |id=sOldPwd  |@currenPwd                             |
#|type;             |id=sPassword|@newPwd                                |
#|type;             |id=sConfirm |@newPwd                                |
#|pause             |2000                                                |
#|click             |id=save                                             |
#|click             |id=save                                             |
#|waitForTextPresent|Your password has been successfully changed         |


!| scenario       |Change Pwd     |userName        |        |currentPwd        |        |newPwd        |
|$res=            |GroovyWebDriver|ChangeUserPasswordAdvanced;${TPAMHost};@userName;@currentPwd;@newPwd|
|Verify_Contain_OR|$res;;success                                                                       |
#|Verify_Contain_NOT|$res;;Error changing password                                                       |



!| scenario        |Request Pwd                               |
|Login             |${TPAMURL}      ||${Requestor}||${UserPwd}|
|pause             |10000                                     |
|clickAndWait      |link=Add Password Request                 |
|type;             |id=SystemNm     |${SystemName}            |
|type;             |id=AccountNm    |${ManagedAccount}        |
|click             |id=Accounts     |                         |
|click             |//input[@type='checkbox']                 |
|click             |id=Details                                |
|type;             |id=RequestReason|password request reason  |
|pause             |1000                                      |
|click             |id=SubmitChanges                          |
|waitForTextPresent|*RequestID:*has been submitted.*          |
|Logout                                                       |

!| scenario           |Approve Pwd                                                                                                      |
|Login                |${TPAMURL}                      |              |${Approver}              |              |${UserPwd}              |
|pause                |10000                                                                                                            |
|click                |id=Approvals                                                                                                     |
|waitForElementPresent|//td[contains(text(),'${SystemName}')]/../td/a[contains(text(),'${ManagedAccount}')]                             |
|click                |//td[contains(text(),'${SystemName}')]/../td/a[contains(text(),'${ManagedAccount}')]                             |
|pause                |2000                                                                                                             |
|waitForElementPresent|//table[@id='MainListingTable']//td[contains(text(),'${SystemName}')]/../td[contains(text(),'${ManagedAccount}')]|
|mouseDown            |//table[@id='MainListingTable']//td[contains(text(),'${SystemName}')]/../td[contains(text(),'${ManagedAccount}')]|
|click                |//table[@id='MainListingTable']//td[contains(text(),'${SystemName}')]/../td[contains(text(),'${ManagedAccount}')]|
|click                |id=Details                                                                                                       |
|type;                |id=ResponseComment              |ok to approve                                                                   |
|pause                |1000                                                                                                             |
|click                |id=ApproveReq                                                                                                    |
|waitForTextPresent   |*The response* was submitted successfully*                                                                       |
|Logout                                                                                                                                 |

!| scenario             |Get Login                                                                                                        |
|Login                  |${TPAMURL}                     |               |${Requestor}               |             |${UserPwd}             |
|pause                  |10000                                                                                                            |
|click                  |id=CurrentRequests             |                                                                                 |
|waitForElementPresent  |//td[contains(text(),'${SystemName}')]/../td/a[contains(text(),'${ManagedAccount}')]                             |
|click                  |//td[contains(text(),'${SystemName}')]/../td/a[contains(text(),'${ManagedAccount}')]                             |
|pause                  |2000                                                                                                             |
|waitForElementPresent  |//table[@id='MainListingTable']//td[contains(text(),'${SystemName}')]/../td[contains(text(),'${ManagedAccount}')]|
|mouseDown              |//table[@id='MainListingTable']//td[contains(text(),'${SystemName}')]/../td[contains(text(),'${ManagedAccount}')]|
|click                  |//table[@id='MainListingTable']//td[contains(text(),'${SystemName}')]/../td[contains(text(),'${ManagedAccount}')]|
|click                  |id=Password                                                                                                      |
|pause                  |5000                                                                                                             |
|waitForElementPresent  |//div[@class='displayPassword']                                                                                  |
|$passwordstr=          |getText                        |//div[@class='displayPassword']                                                  |
|$GeneratedPwd=         |get_password                   |$passwordstr                                                                     |
|Login Account to System|$GeneratedPwd                                                                                                    |

!|scenario    |Create Account on System                                                                                           |
|accountAction|${SystemPlatform};;create;;${SystemAddress};;${FunctAcct};;${FunctAcctPwd};;${ManagedAccount};;${ManagedAccountPwd}|

!|scenario    |Change Account Password on System                                |NewPwd                                |
|accountAction|${SystemPlatform};;password;;${SystemAddress};;${FunctAcct};;${FunctAcctPwd};;${ManagedAccount};;@NewPwd|

!|scenario    |Login Account to System                    |ManPwd                    |
|accountAction|${SystemPlatform};;login;;${SystemAddress};;${ManagedAccount};;@ManPwd|

!|scenario    |Delete Account on System                                                                     |
|accountAction|${SystemPlatform};;delete;;${SystemAddress};;${FunctAcct};;${FunctAcctPwd};;${ManagedAccount}|


!|scenario            |Add User    |UserName||Passwd||EMail|
|pause                |5000                                |
|clickAndWait         |link=Add UserID                     |
|pause                |5000                                |
|waitForElementPresent|id=UserName                         |
|type;                |id=UserName |@UserName              |
|type;                |id=FirstName|Vasily                 |
|type;                |id=LastName |Pupkin                 |
|type;                |id=EmailID  |@EMail                 |
|type;                |id=sPassword|@Passwd                |
|type;                |id=Confirm  |@Passwd                |
|click                |id=SubmitChanges                    |
|waitForTextPresent   |*User added successfully*           |

!|scenario            |Set User Permissions   |userName                |
|Choose User          |@userName                                       |
|click                |id=Permissions                                  |
|type;                |id=apaFilterSystemName |${SystemName}           |
|type;                |id=apaFilterAccountName|${ManagedAccount}       |
|click                |id=Results                                      |
|waitForElementPresent|//td[contains(text(),'Not Assigned')]           |
|mouseDown            |//td[contains(text(),'Not Assigned')]           |
|click                |//td[contains(text(),'Not Assigned')]           |
|select;              |id=AccessPolicyID      |label=Approver-Requestor|
|click                |id=divBtnSaveRow                                |
|pause                |1000                                            |
|click                |id=SubmitChanges                                |
|waitForTextPresent   |*Access Policy Assignment was successful*       |

!|scenario            |Add system                               |
|pause                |5000                                     |
|waitForElementPresent|link=Add System                          |
|clickAndWait         |link=Add System                          |
|waitForElementPresent|id=SystemName                            |
|type;                |id=SystemName    |${SystemName}          |
|type;                |id=NetworkAddress|${SystemAddress}       |
|select;              |id=PlatformID    |label=${SystemPlatform}|

!|scenario            |Set Connection Tab                     |
|waitForElementPresent|id=Connection     |                    |
|click                |id=Connection     |                    |
|type;                |id=PARFuncAcct    |${FunctAcct}        |
|type;                |id=pword          |${FunctAcctPwd}     |
|type;                |id=ConfPword      |${FunctAcctPwd}     |
|type;                |id=Timeout        |${SystemTimeout}    |
|click                |id=bt_Save        |                    |
|waitForTextPresent   |System changes for * saved successfully|
|Choose Account       |${FunctAcct}                           |
|Set description      |${FunctAcctDescription}                |



!|scenario            |verifyText|locator||testResult|
|$Where=              |getText   |@locator           |
|Verify_Contain_OR_exp|$Where;;@testResult           |

!|scenario         |Test system                 |testResult  |
|Choose System                                               |
|click             |id=bt_Test                               |
|waitForTextPresent|*from the test of system*                |
|verifyText        |//div[@id='ResultDetailDiv']||@testResult|

!|scenario         |Check Password              |testResult  |
|click             |id=CheckPassButton                       |
|waitForTextPresent|*Results from the*                       |
|verifyText        |//div[@id='ResultDetailDiv']||@testResult|


!|scenario         |Reset Password              |testResult  |
|click             |id=ResetPassButton                       |
|waitForTextPresent|*Results from the*                       |
|verifyText        |//div[@id='ResultDetailDiv']||@testResult|

!|scenario            |Check Status                                   |testResult|for reason  |testReason |
|Choose Account       |${ManagedAccount}                                                                  |
|waitForElementPresent|id=Logs                                                                            |
|click                |id=Logs                                                                            |
|waitForElementPresent|id=rb_LogsDtAll                                                                    |
|click                |id=rb_LogsDtAll                                                                    |
|waitForElementPresent|id=ChangeLog                                                                       |
|click                |id=ChangeLog                                                                       |
|waitForElementPresent|//table[@id='changeLogTable']/tbody/tr[@id='0']                                    |
|verifyText           |//table[@id='changeLogTable']/tbody/tr[@id='0']|          |@testReason.*@testResult|
#|click             |id=StatusButton                                                                                               |
#|waitForTextPresent|*Current Status*                                                                                              |
#|verifyText        |//div[@id='ResultDetailDiv']|          |Result: @testResult, Change Date: .{15,19}, Change Reason: @testReason|

!|scenario         |Schedule Reset Password|testResult                                                                                                                                     |
|click             |id=Details                                                                                                                                                             |
|click             |id=Management                                                                                                                                                          |
|$Hours=           |getEval                |var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+1);var s = d.getUTCHours();if ((s + "").length == 1) s = "0" + s;else d.getUTCHours();    |
|$Minutes=         |getEval                |var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+1);var s = d.getUTCMinutes();if ((s + "").length == 1) s = "0" + s;else d.getUTCMinutes();|
|$Months=          |getEval                |var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+1);var s = d.getUTCMonth()+1;if ((s + "").length == 1) s = "0" + s;else d.getUTCMonth()+1;|
|$Days=            |getEval                |var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+1);var s = d.getUTCDate();if ((s + "").length == 1) s = "0" + s;else d.getUTCDate();      |
|$Years=           |getEval                |var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+1);d.getUTCFullYear();                                                                    |
|type;             |id=Hr                  |$Hours                                                                                                                                         |
|typeKeys;         |id=Hr                  |$Hours                                                                                                                                         |
|type;             |id=Min                 |$Minutes                                                                                                                                       |
|type;             |id=Mon                 |$Months                                                                                                                                        |
|type;             |id=DayNumber           |$Days                                                                                                                                          |
|type;             |id=YearNumber          |$Years                                                                                                                                         |
|click             |id=Information         |                                                                                                                                               |
|type;             |id=RelNotifyEmail      |just a test                                                                                                                                    |
|type;             |id=RelNotifyEmail      |                                                                                                                                               |
|pause             |1000                                                                                                                                                                   |
|click             |id=SubmitChangesButton |                                                                                                                                               |
|waitForTextPresent|*Changes saved successfully for*                                                                                                                                       |
|pause             |${SchedulePasswordResetTimeout}                                                                                                                                        |
|Check Status      |@testResult            |for reason                                                              |Scheduled                                                             |


!|scenario            |Add account                           |accountName|with password|accPwd|
|clickAndWait         |link=Add Account                      |                                |
|type;                |id=SystemNm                           |${SystemName}                   |
|click                |id=System                             |                                |
|waitForElementPresent|//td[contains(text(),'${SystemName}')]|                                |
|mouseDown            |//td[contains(text(),'${SystemName}')]|                                |
|click                |//td[contains(text(),'${SystemName}')]|                                |
|Set password         |@accountName                          |           |@accPwd             |
|Set description      |${ManagedAccountDescription}          |                                |

!|scenario            |Choose Account                                          |accountName  |
|pause                |5000                                                                  |
|waitForElementPresent|link=Manage Accounts                                    |             |
|click                |link=Manage Accounts                                    |             |
|pause                |6000                                                                  |
|waitForElementPresent|id=SystemNm                                             |             |
|type;                |id=SystemNm                                             |${SystemName}|
|pause                |1000                                                                  |
|click                |id=Listing                                              |             |
|pause                |2000                                                                  |
|waitForElementPresent|//table[@id='AccountListing']//td[text()='@accountName']|             |
|mouseDown            |//table[@id='AccountListing']//td[text()='@accountName']|             |
|click                |//table[@id='AccountListing']//td[text()='@accountName']|             |

!|scenario         |Set password           |accountName||accPwd|
|click             |id=Details             |                   |
|type;             |id=AccountName         |@accountName       |
|type;             |id=sPswd               |@accPwd            |
|type;             |id=sConfPswd           |@accPwd            |
|click             |id=SubmitChangesButton |                   |
|waitForTextPresent|Changes saved successfully for @accountName|

!|scenario         |Set description       |accountDescription |
|click             |id=Details            |                   |
|type;             |id=AcctDesc           |@accountDescription|
|pause             |1000                                      |
|click             |id=SubmitChangesButton|                   |
|waitForTextPresent|Changes saved successfully for            |


!|scenario         |Remove account                |accountName              |
|Choose Account    |@accountName                                            |
|click             |id=DeleteButton               |                         |
|getConfirmation                                                            |
|waitForTextPresent|${SystemName}/@accountName has been successfully deleted|

#!|scenario         |Remove User      |userName     |
#|Choose User       |@userName                      |
#|click             |id=Delete                      |
#|getConfirmation                                   |
#|waitForTextPresent|* has been successfully deleted|


!| scenario        |Remove User    |UserName                                                   |
|$res=             |GroovyWebDriver|deleteUser;${TPAMHost};${TPAMAdmin};${DefaultPwd};@UserName|
|Verify_Contain_NOT|$res;;Exception                                                            |


!|scenario            |Choose User       |userName       |
|clickAndWait         |link=Manage UserIDs               |
|waitForElementPresent|id=UsrNm                          |
|type;                |id=UsrNm          |@userName      |
|click                |id=Listing                        |
|waitForElementPresent|//td[contains(text(),'@userName')]|
|mouseDown            |//td[contains(text(),'@userName')]|
|click                |//td[contains(text(),'@userName')]|


!|scenario            |Choose system                                       |
|clickAndWait         |link=Manage Systems                                 |
|pause                |5000                                                |
|waitForElementPresent|id=SystemNm                                         |
|type;                |id=SystemNm                           |${SystemName}|
|click                |id=Listing                                          |
|waitForElementPresent|//td[contains(text(),'${SystemName}')]              |
|mouseDown            |//td[contains(text(),'${SystemName}')]|             |
|click                |//td[contains(text(),'${SystemName}')]|             |


!|scenario         |Remove system       |sysName   |
|Choose system     |@sysName                       |
|click             |id=Details          |          |
|type;             |id=NetworkAddress   |@sysName  |
|click             |id=bt_Save          |          |
|pause             |1000                           |
|click             |id=bt_Clear         |          |
|waitForTextPresent|*The results from the clearing*|
|click             |id=bt_Del           |          |
|getConfirmation                                   |
|waitForTextPresent|has been successfully deleted  |
|Logout                                            |


!|scenario            |Set Affinity                             |
|Choose system        |${SystemName}                            |
|click                |id=Affinity                              |
|waitForElementPresent|id=rbPARAffinitySelected                 |
|click                |id=rbPARAffinitySelected                 |
|type;                |//table[@id='tblPARDPAAffinity']//input|1|
|click                |id=bt_Save                               |
|waitForTextPresent   |System changes for * saved successfully  |

!|scenario     |Create Users                                       |
|Add User      |${Requestor}     ||${DefaultPwd}||${RequestorEMail}|
|Add User      |${Approver}      ||${DefaultPwd}||${ApproverEMail} |
|Create Mailbox|${RequestorEMail}||${RequestorEMailPwd}            |
|Create Mailbox|${ApproverEMail} ||${ApproverEMailPwd}             |
|Change Pwd    |${Requestor}     ||${DefaultPwd}||${UserPwd}       |
|Change Pwd    |${Approver}      ||${DefaultPwd}||${UserPwd}       |

!|scenario     |Remove Users     |
|Remove User   |${Requestor}     |
|Remove User   |${Approver}      |
|Delete Mailbox|${RequestorEMail}|
|Delete Mailbox|${ApproverEMail} |


!|scenario     |Account Not there               |
|Add account   |AccNotThere|with password|master|
|Reset Password|${ResetPasswordFailed}          |
|Check Password|${CheckPasswordFailed}          |

!|scenario|System Unreachable|
#|Choose System     |${SystemName}                                      |
#|click             |id=Details                                         |
#|type;             |id=NetworkAddress             |1.2.3.4             |
#|click             |id=bt_Save                                         |
#|waitForTextPresent|System changes for ${SystemName} saved successfully|
#|Test System       |${TestSystemFailed}                                |
#|Choose Account    |${ManagedAccount}                                  |
#|Reset Password    |${ResetPasswordFailed}                             |
#|Check Password    |${CheckPasswordFailed}                             |


!| scenario    |Managed System                           |
|Create Account on System                                |
|Open          |${TPAMURL}  ||${TPAMAdmin}||${DefaultPwd}|
|Add system                                              |
|Set Connection Tab                                      |
|Test System   |${TestSystemSuccessful}                  |
|Choose Account|${FunctAcct}                             |
|Set password  |${FunctAcct}||${FunctAcctWrongPwd}       |
|Test System   |${TestSystemFailed}                      |
|Choose Account|${FunctAcct}                             |
|Check Password|${CheckPasswordFailed}                   |




!| scenario                       |Managed Account                                     |
|Add account                      |${ManagedAccount}|with password|${ManagedAccountPwd}|
|Reset Password                   |${ResetPasswordFailed}                              |
|Schedule Reset Password          |Failed                                              |
|Change Account Password on System|${ManagedAccountPwdNew}                             |
|Choose Account                   |${FunctAcct}                                        |
|Set password                     |${FunctAcct}     |             |${FunctAcctPwd}     |
|pause                            |${RestoreFunctAcctPasswordTimeout}                  |
|Choose Account                   |${ManagedAccount}                                   |
|Check Password                   |${CheckPasswordNotMatch}                            |
|pause                            |${RestoreFunctAcctPasswordTimeout}                  |
|Check Status                     |Success          |for reason   |Mismatch            |
|Reset Password                   |${ResetPasswordSuccessful}                          |
|Schedule Reset Password          |Success                                             |

!| scenario          |Request Password and Login             |
|Login               |${TPAMURL}||${TPAMAdmin}||${DefaultPwd}|
|Set User Permissions|${Requestor}                           |
|Set User Permissions|${Approver}                            |
|pause               |${ApplyNewPoliciesInterval}            |
|Logout                                                      |
|Request Pwd                                                 |
|Approve Pwd                                                 |
|Get Login                                                   |
|Login               |${TPAMURL}||${TPAMAdmin}||${DefaultPwd}|

!| scenario              |Delete All       |
|Remove account          |${ManagedAccount}|
|Remove system           |${SystemName}    |
|Delete Account on System|${ManagedAccount}|

!| scenario       |Check And Delete File on Dispatcher|directory         |        |file        |
|$res=            |GroovyWebDriver                    |checkAndDeleteLocalFile;@directory;@file|
|Verify_Contain_OR|$res;;Finished                                                              |

!|scenario            |Show Desktop|
|RunBatchGetOutputFull|showdesktop |

