!|scenario|Account Discovery                      |
|Open     |${TPAMURL}||${TPAMAdmin}||${DefaultPwd}|
|Create Environment                               |
|New Account Action                               |
|Delete Environment                               |

!|scenario       |Create Template                                                        |
|Add system                                                                              |
|Set Connection Tab                                                                      |
|Set FuncAccEMail|${FuncAccEMail}                                                        |
|Add account     |${AutoDiscoveryAccount1}|with password|${AutoDiscoveryAccountPassword1}|
|Add account     |${AutoDiscoveryAccount2}|with password|${AutoDiscoveryAccountPassword1}|
|Choose System   |${SystemName}                                                          |
|Set Template                                                                            |

!|scenario                    |Create Account Discovery Profile                                                                                                                                      |
|click                        |link=Profile Management                                                                                                                                               |
|pause                        |5000                                                                                                                                                                  |
|waitForElementPresent        |id=NewButton    |                                                                                                                                                     |
|click                        |id=NewButton                                                                                                                                                          |
|pause                        |5000                                                                                                                                                                  |
|type;                        |id=ProfileName  |${ProfileName}                                                                                                                                       |
|type;                        |id=Description  |Description                                                                                                                                          |
|Set Delete Account properties|Notify via Email||${DeleteAccountDiscoveryEmail1},:System:,:Functional:                                                                                               |
|Add Detail                   |0               ||Notify via Email||${TemplateName}/${AutoDiscoveryAccount1}||${NewAccountDiscoveryEmail1},:System:,:Functional:||||||${AutoDiscoveryAccount1}|||||||||
|click                        |id=SaveButton                                                                                                                                                         |
|waitForTextPresent           |The profile saved successfully                                                                                                                                        |

!|scenario                         |New Account Action                                                                                     |
|Remove account                    |${AutoDiscoveryAccount1}                                                                               |
|Set AccDiscovery profile to System|${ProfileName}          ||${SystemName}                                                                |
|Run AccDiscovery                                                                                                                          |
|Check Process Selected            |${SystemName}                                                                                          |
|Check results                     |${AutoDiscoveryAccount1}||${SystemName}                                                                |
|Choose Account                    |${AutoDiscoveryAccount2}                                                                               |
|click                             |id=Details                                                                                             |
|$res=                             |isChecked               |id=pwdMgmtNone                                                                |
|Verify_Contain_OR                 |$res;;true                                                                                             |
|Logout                                                                                                                                    |
|pause                             |600000                                                                                                 |
|Check Mail                        |${MailServer}           ||${NewAccountDiscoveryEmail1}   ||password||${FromMail}||${AADNAN}||${AADNANb}|
|Check Mail                        |${MailServer}           ||${SystemEMail}                 ||password||${FromMail}||${AADNAN}||${AADNANb}|
|Check Mail                        |${MailServer}           ||${FuncAccEMail}                ||password||${FromMail}||${AADNAN}||${AADNANb}|
|Check Mail                        |${MailServer}           ||${DeleteAccountDiscoveryEmail1}||password||${FromMail}||${AADDAN}||${AADDANb}|
|Check Mail                        |${MailServer}           ||${SystemEMail}                 ||password||${FromMail}||${AADDAN}||${AADDANb}|
|Check Mail                        |${MailServer}           ||${FuncAccEMail}                ||password||${FromMail}||${AADDAN}||${AADDANb}|
|Login                             |${TPAMURL}              ||${TPAMAdmin}                   ||${DefaultPwd}                               |


!|scenario                         |Delete Environment                                  |
|Delete Mails                                                                           |
|Delete Mailbox                    |${NewAccountDiscoveryEmail1}                        |
|Delete Mailbox                    |${DeleteAccountDiscoveryEmail1}                     |
|Delete Mailbox                    |${SystemEMail}                                      |
|Delete Mailbox                    |${FuncAccEMail}                                     |
|Set AccDiscovery profile to System|No Account Discovery Profile selected||${SystemName}|
|Remove system                     |${SystemName}                                       |
|Delete Account Discovery Profile  |${ProfileName}                                      |
|Remove system                     |${TemplateName}                                     |
|Delete Account on System          |${ManagedAccount1}                                  |

!| scenario        |Check Process Selected |SystemName                                                                             |
|$res=             |GroovyWebDriver        |CheckProcessSelectedActionsButtonDisabled;${browser};${FrontPageContent};${SystemName} |
|Verify_Contain_NOT|$res;;something went wrong                                                                                     |
|Verify_Contain_OR |$res;;Account processed successfully.*Auto Management turned OFF.*btnProcessDiscoveryActions button is disabled|

