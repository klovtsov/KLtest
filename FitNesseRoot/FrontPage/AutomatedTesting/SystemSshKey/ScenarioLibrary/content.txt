!|scenario        |Add System with key                                                                                                                                                                                                                                                       |
|$res=            |CLI|${CLIBatch} AddSystem --SystemName ${SystemName} --NetworkAddress ${SystemAddress} --PlatformName \"${SystemPlatform}\" --FunctionalAccount ${FunctAcct} --FuncAcctCred DSS --Timeout ${SystemTimeout} --Description \"${SystemDescription}\" --PlatSpecificValue sudo|
|Verify_Contain_OR|$res;;successful                                                                                                                                                                                                                                                          |

!|scenario                       |Add System with specific key                                                                                                                                                                                                                                                   |
|$res=                           |CLI|${CLIBatch} AddSystem --SystemName ${SystemName} --NetworkAddress ${SystemAddress} --PlatformName \"${SystemPlatform}\" --FunctionalAccount ${FunctAcct} --FuncAcctCred SPECIFIC --Timeout ${SystemTimeout} --Description \"${SystemDescription}\" --PlatSpecificValue sudo|
|Verify_Contain_OR               |$res;;successful                                                                                                                                                                                                                                                               |
|Set ISA permission on system for|${CLI_user_1}                                                                                                                                                                                                                                                                  |

!|scenario    |Create Account on System                             |account                             |
|accountAction|${SystemPlatform};;create;;${SystemAddress};;${rootAcct};;${rootAcctPwd};;@account;;Secret|

!|scenario    |Delete Account on System                         |account                         |
|accountAction|${SystemPlatform};;delete;;${SystemAddress};;${rootAcct};;${rootAcctPwd};;@account|

!|scenario|Copy key to system                               |secureflag                              |
|runBatch |SshKey.bat;${SystemAddress};${rootAcct};${rootAcctPwd};${FunctAcct};${KeyFile};@secureflag|

!|scenario|Copy account key to system                             |secureflag                             |
|runBatch |SshKey.bat;${SystemAddress};${rootAcct};${rootAcctPwd};${ManagedAccount};${KeyFile};@secureflag|

!|scenario               |Remove All   |
|Remove system           |${SystemName}|
|Delete Account on System|${FunctAcct} |

!|scenario|Retrieve Standard Key                 |keyFormat                 |
|CLItoFile|${sysCLIBatch} SSHKey --StandardKey id_dsa --KeyFormat @keyFormat|
|runBatch |CheckOutputFile;"${keyFileOrigin}";${ProjDir}\cliout.tmp         |
|runBatch |movekey;${ProjDir}\cliout.tmp;${KeyFile}                         |

!|scenario|Retrieve System Specific Key               |keyFormat               |
|CLItoFile|${CLIBatch} SSHKey --SystemName ${SystemName} --KeyFormat @keyFormat|
|runBatch |CheckOutputFile;"${keyFileOrigin}";${ProjDir}\cliout.tmp            |
|runBatch |movekey;${ProjDir}\cliout.tmp;${KeyFile}                            |

!|scenario|Regenerate System Specific Key                      |keyFormat                     |
|CLItoFile|${CLIBatch} SSHKey --SystemName ${SystemName} --KeyFormat @keyFormat --Regenerate Y|
|runBatch |CheckOutputFile;"${keyFileOrigin}";${ProjDir}\cliout.tmp                           |
|runBatch |movekey;${ProjDir}\cliout.tmp;${KeyFile}                                           |

!|scenario        |Retrieve Standard Key by Net User|keyFormat                                                                                                          |
|$res=            |RunBatchGetOutput                |SshKeyTester.exe;${PathToKeys}\${API_user_1};${API_user_1};${TPAMHost};${CommandTimeout};Standard;id_dsa;@keyFormat|
|Verify_Contain_OR|$res;;Key was retrieved successfully.                                                                                                                |

!|scenario        |Retrieve System Specific Key by Net User|keyFormat                                                                                                          |
|$res=            |RunBatchGetOutput                       |SshKeyTester.exe;${PathToKeys}\${API_user_1};${API_user_1};${TPAMHost};${CommandTimeout};${SystemName};N;@keyFormat|
|Verify_Contain_OR|$res;;Key was retrieved successfully.                                                                                                                       |

!|scenario        |Retrieve Account Specific Key by Dot Net User                                                                                                            |
|$res=            |RunBatchGetOutput|SshKeyTester.exe;${PathToKeys}\${API_user_1};${API_user_1};${TPAMHost};${CommandTimeout};${SystemName};${ManagedAccount};N;${keyFormat}|
|Verify_Contain_OR|$res;;Key was retrieved successfully.                                                                                                                    |

!|scenario|Retrieve Standard Key by Perl User                         |keyFormat                         |
|runBatch |sshkeyPerl.bat;Standard;${PathToKeys}${API_user_1};${API_user_1};${TPAMHost};id_dsa;@keyFormat|
|runBatch |CheckOutputFile;"${keyFileOrigin}";${ProjDir}\PerlOut.tmp                                     |
|runBatch |movekey;${ProjDir}\PerlOut.tmp;${KeyFile}                                                     |

!|scenario|Retrieve System Specific Key by Perl User                    |keyFormat                   |
|runBatch |sshkeyPerl.bat;System;${PathToKeys}${API_user_1};${API_user_1};${TPAMHost};${SystemName};N|
|runBatch |CheckOutputFile;"${keyFileOrigin}";${ProjDir}\PerlOut.tmp                                 |
|runBatch |movekey;${ProjDir}\PerlOut.tmp;${KeyFile}                                                 |
	
!|scenario|Retrieve Account Specific Key by Perl Api                                  |                                 |
|runBatch |sshkeyPerl.bat;Account;${PathToKeys}${API_user_1};${API_user_1};${TPAMHost};${SystemName};${ManagedAccount};N|
|runBatch |CheckOutputFile;"${keyFileOrigin}";${ProjDir}\PerlOut.tmp                                                    |
|runBatch |movekey;${ProjDir}\PerlOut.tmp;${KeyFile}                                                                    |

!|scenario        |Try to Retrieve Key from|system         |        |result        |
|$res=            |CLI                     |${CLIBatch} SSHKey --SystemName @system|
|Verify_Contain_OR|$res;;@result                                                   |

!|scenario        |Set ISA permission on system for|user                                                                                                         |
|$res=            |CLI                             |${CLIBatch} SetAccessPolicy --AccessPolicyName "ISA" --Action ADD --SystemName ${SystemName} --UserName @user|
|Verify_Contain_OR|$res;;successful                                                                                                                              |

!|scenario        |Set ISA permission on account for|user                                                                                                                                         |
|$res=            |CLI                              |${CLIBatch} SetAccessPolicy --AccessPolicyName "ISA" --Action ADD --SystemName ${SystemName} --AccountName ${ManagedAccount} --UserName @user|
|Verify_Contain_OR|$res;;successful                                                                                                                                                               |

!|scenario                       |Add System with specific 2048 bit key  |
|Add System with key                                                     |
|Set ISA permission on system for|${CLI_user_1}                          |
|Open                            |${TPAMURL}||${TPAMAdmin}||${DefaultPwd}|
|pause                           |5000                                   |
|Choose System                                                           |
|click                           |id=Details                             |
|waitForElementPresent           |id=Connection                          |
|click                           |id=Connection                          |
|waitForElementPresent           |id=rb_Specific                         |
|click                           |id=rb_Specific                         |
|pause                           |500                                    |
|click                           |id=btGeneratePair0                     |
|waitForTextPresent              |Successfully generated new key pair    |
|click                           |id=bt_Save                             |
|waitForTextPresent              |System changes for * saved successfully|


!|scenario                       |Add System with specific 1024 bit key  |
|Add System with key                                                     |
|Set ISA permission on system for|${CLI_user_1}                          |
|Open                            |${TPAMURL}||${TPAMAdmin}||${DefaultPwd}|
|pause                           |5000                                   |
|Choose System                                                           |
|click                           |id=Details                             |
|waitForElementPresent           |id=Connection                          |
|click                           |id=Connection                          |
|waitForElementPresent           |id=rb_Specific                         |
|click                           |id=rb_Specific                         |
|pause                           |500                                    |
|click                           |id=btGeneratePair1                     |
|waitForTextPresent              |Successfully generated new key pair    |
|click                           |id=bt_Save                             |
|waitForTextPresent              |System changes for * saved successfully|

!|scenario                       |Add System with specific key api|
|Add System with specific key                                     |
|Set ISA permission on system for|${API_user_1}                   |

!|scenario                       |Add System with specific 1024 bit key api|
|Add System with specific 1024 bit key                                     |
|Set ISA permission on system for|${API_user_1}                            |

!|scenario           |Set Requestor permission on account for|user|
|Set User Permissions|@user                                       |

!|scenario         |Set Account to use Specific Key|accnt                 |is key 1024 bit                 |is1024                |                |
|$res =            |GroovyWebDriver                |setSpecificKeyForPsmAccount;${TPAMHost};${TPAMAdmin};${DefaultPwd};${SystemName};@accnt;@is1024|
|Verify_Contain_NOT|$res;;something went wrong                                                                                                     |


!|scenario                       |Add system and PSM account with specific key                                                   |
|Add System with key                                                                                                             |
|Set ISA permission on system for|${CLI_user_1}                                                                                  |
|$res=                           |CLI              |${CLIBatch} AddAccount --System ${SystemName} --AccountName ${ManagedAccount}|
|Verify_Contain_OR               |$res;;successfully                                                                             |
|Set User Permissions            |${CLI_user_1}                                                                                  |
|Set User Permissions            |${TPAMAdmin}                                                                                   |
|Set Account to use Specific Key |${ManagedAccount}|is key 1024 bit                              |N                              |

!|scenario                       |Add system and PSM account with specific 1024 bit key                                          |
|Add System with key                                                                                                             |
|Set ISA permission on system for|${CLI_user_1}                                                                                  |
|$res=                           |CLI              |${CLIBatch} AddAccount --System ${SystemName} --AccountName ${ManagedAccount}|
|Verify_Contain_OR               |$res;;successfully                                                                             |
|Set User Permissions            |${CLI_user_1}                                                                                  |
|Set User Permissions            |${TPAMAdmin}                                                                                   |
|Set Account to use Specific Key |${ManagedAccount}|is key 1024 bit                              |Y                              |

!|scenario|Retrieve Account Specific Key                                                |
|CLItoFile|${CLIBatch} SSHKey --SystemName ${SystemName} --AccountName ${ManagedAccount}|
|runBatch |CheckOutputFile;"ssh-dss";${ProjDir}\cliout.tmp                              |
|runBatch |movekey;${ProjDir}\cliout.tmp;${KeyFile}                                     |

!|scenario|Regenerate Account Specific Key                                                             |
|CLItoFile|${CLIBatch} SSHKey --SystemName ${SystemName} --AccountName ${ManagedAccount} --Regenerate Y|
|runBatch |CheckOutputFile;"ssh-dss";${ProjDir}\cliout.tmp                                             |
|runBatch |movekey;${ProjDir}\cliout.tmp;${KeyFile}                                                    |

!|scenario        |Check key acceptance                                                                                |
|$res=            |RunBatchGetOutput|SshKeyCheckLogin.bat;${SystemAddress};${rootAcct};${rootAcctPwd};${ManagedAccount}|
|Verify_Contain_OR|$res;;1                                                                                             |

!|scenario        |Check key was refused                                                                               |
|$res=            |RunBatchGetOutput|SshKeyCheckLogin.bat;${SystemAddress};${rootAcct};${rootAcctPwd};${ManagedAccount}|
|Verify_Contain_OR|$res;;0                                                                                             |

!|scenario   |Select session window                                                  |
|selectWindow|Quest Software PSM Session (${SystemName}/${ManagedAccount}/$RequestID)|
|windowFocus                                                                         |

!|scenario                 |Open session  and Check Logon|
|Open automatic ssh session|${successLogon}              |

!|scenario                 |Try to open session  and Check Logon failure|
|Open automatic ssh session|${failedLogon}                              |

!|scenario         |Add Web-disabled Sys-Admin User |userName                      |
|Login             |${TPAMAdminURL}                 | |${TPAMMaster} ||${MasterPwd}|
|pause             |5000                                                           |
|clickAndWait      |link=Add Sys-Admin UserID                                      |
|pause             |5000                                                           |
|type;             |id=UserName                     |@userName                     |
|pause             |1000                                                           |
|type;             |id=LastName                     |L                             |
|pause             |1000                                                           |
|type;             |id=FirstName                    |K                             |
|pause             |1000                                                           |
|click             |id=cb_WebAccess                                                |
|pause             |1000                                                           |
|click             |id=KeyBased                                                    |
|pause             |1000                                                           |
|pause             |1000                                                           |
|click             |id=cb_CliAccess                                                |
|pause             |1000                                                           |
|click             |id=SubmitChanges                                               |
|waitForTextPresent|User added successfully                                        |
|pause             |1000                                                           |
|click             |id=GetCliaKey                                                  |
|pause             |5000                                                           |
|runBatch          |movekey;${BrowserDownloadDir}\id_dsa;${PathToKeys}@userName.ppk|
|Generate Plink Key|@userName                                                      |

!|Scenario         |Open automatic ssh session|expectedImage                                 |                                |
|$res =            |GroovyWebDriver           |openSshSession;${TPAMHost};${TPAMAdmin};${DefaultPwd};$RequestID;@expectedImage|
|Verify_Contain_NOT|$res;;something went wrong                                                                                |
|Verify_Contain_OR |$res;;CLICK on                                                                                            |

!|Scenario         |Regenerate Account Specific Key by UI|keyLength                                                                                                           |
|$res =            |GroovyWebDriver                      |regenerateSpecificKeyForPsmAccount;${TPAMHost};${TPAMAdmin};${DefaultPwd};${SystemName};${ManagedAccount};@keyLength|
|Verify_Contain_NOT|$res;;something went wrong                                                                                                                                |
