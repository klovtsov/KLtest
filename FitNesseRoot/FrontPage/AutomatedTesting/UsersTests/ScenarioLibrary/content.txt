!|scenario            |Add CLI User                    |userName                      |
|clickAndWait         |link=Add UserID                                                |
|pause                |5000                                                           |
|waitForElementPresent|id=UserName                                                    |
|type;                |id=UserName                     |@userName                     |
|type;                |id=FirstName                    |L                             |
|type;                |id=LastName                     |K                             |
|select;              |id=UType                        |label=Basic                   |
|click                |id=cb_WebAccess                                                |
|click                |id=KeyBased                                                    |
|click                |id=cb_CliAccess                                                |
|click                |id=SubmitChanges                                               |
|waitForTextPresent   |*User added successfully*                                      |
|Choose User          |@userName                                                      |
|click                |id=KeyBased                                                    |
|click                |id=GenCliKey                                                   |
|pause                |10000                                                          |
|click                |id=GetCliKey                                                   |
|pause                |5000                                                           |
|runBatch             |movekey;${BrowserDownloadDir}\id_dsa;${PathToKeys}@userName.ppk|
|Generate Plink Key   |@userName                                                      |

!|scenario            |Add account                           |accountName|with password|accPwd|
|clickAndWait         |link=Add Account                      |                                |
|type;                |id=SystemNm                           |${SystemName}                   |
|click                |id=System                             |                                |
|waitForElementPresent|//td[contains(text(),'${SystemName}')]|                                |
|mouseDown            |//td[contains(text(),'${SystemName}')]|                                |
|click                |//td[contains(text(),'${SystemName}')]|                                |
|click                |id=Details                            |                                |
|type;                |id=AccountName                        |@accountName                    |
|type;                |id=sPswd                              |@accPwd                         |
|type;                |id=sConfPswd                          |@accPwd                         |
|click                |id=SubmitChangesButton                |                                |
|waitForTextPresent   |Changes saved successfully for @accountName                            |

!|scenario|Remove Keys                                |
|runBatch |DeleteFileByMask;${PathToKeys}${prfx}*;fake|

!| scenario       |Remove user|userName                        |
|$res=            |CLI        |${CLIBatch} DeleteUser @userName|
|Verify_Contain_OR|$res;;successful                            |

!| scenario       |Add account CLI                                                                                                 |
|$res=            |CLI|${CLIBatchISA} AddAccount --System ${SystemName} --AccountName ${accountCLI} --Password ${ManagedAccountPwd}|
|Verify_Contain_OR|$res;;successful                                                                                                |

!| scenario       |Add Group Member|user                  |                 |group                 |
|$res=            |CLI             |${CLIBatch} AddGroupMember --UserName @user  --GroupName @group|
|Verify_Contain_OR|$res;;successful                                                                |

!| scenario      |Prepare Environment for IsaUsers                      |
|Open            |${TPAMURL}      ||${TPAMAdmin}    ||${DefaultPwd}     |
|pause           |15000                                                 |
|Add CLI User    |${ISACLI_user_1}                                      |
|Add User        |${ISAWEB_user_1}||${UserPassword} ||mail@mail.mail  | |
|Add System                                                             |
|Add Group Member|${ISACLI_user_1}||\"Global ISA Group\"                |
|Add Group Member|${ISAWEB_user_1}||\"Global ISA Group\"                |
|Change Pwd      |${ISAWEB_user_1}||${UserPassword} ||${UserPasswordNew}|
|Login           |${TPAMURL}      ||${ISAWEB_user_1}||${UserPasswordNew}|

#|Add Group Member|${ISACLI_user_1}||\"Global ISA Group\"                |
#|Add Group Member|${ISAWEB_user_1}||\"Global ISA Group\"                |

!| scenario |Create Accounts                                 |
|Add account|${accountWEB}|with password|${ManagedAccountPwd}|
|Add account CLI                                             |

!| scenario   |Clear Environment for IsaUsers|
|Remove system|${SystemName}                 |
|Remove user  |${ISACLI_user_1}              |
|Remove user  |${ISAWEB_user_1}              |
|Remove Keys                                 |



!| scenario       |Unlock User                                                             |
|$res=            |CLI            |${CLIBatch} UnlockUser --UserName ${UserName}           |
|Verify_Contain_OR|$res;;${UserName} has been unlocked successfully! Cleared 5 failed login|

!| scenario       |Update User                                                                                       |
|$res=            |CLI|${CLIBatch} UpdateUser --UserName ${UserName} --FirstName Vasily --LastName Pupkin --Disable Y|
|Verify_Contain_OR|$res;;successful                                                                                  |

!|scenario        |List Users                                      |
|$res=            |CLI|${CLIBatch} ListUsers --username ${UserName}|
|Verify_Contain_OR|$res;;${UserName}                               |

!| scenario|Prepare Environment for Change User Password      |
|Open      |${TPAMURL} ||${TPAMAdmin}   ||${DefaultPwd}       |
|Add User  |${UserName}||${UserPassword}||mail@mail.mail   |  |
|Logout Paradmin                                              |
|Change Pwd|${UserName}||${UserPassword}||${UserPasswordNewUI}|

!| scenario|Prepare Environment for Unlock User|
|Login     |tpam/main.asp ||${UserName}||123456|
|Login     |tpam/main.asp ||${UserName}||234567|
|Login     |tpam/main.asp ||${UserName}||345678|
|Login     |tpam/main.asp ||${UserName}||456789|
|Login     |tpam/main.asp ||${UserName}||567890|

!| scenario        |Change User Password                                                                             |
|$res=             |CLI          |${CLIBatch} ChangeUserPassword --UserName ${UserName} --Password ${UserPasswordNew}|
|Verify_Contain_OR |$res;;successful                                                                                 |
|Login             |tpam/main.asp|             |${UserName}             |             |${UserPasswordNew}            |
|pause             |5000                                                                                             |
|waitForTextPresent|Change Password                                                                                  |

!| scenario       |Delete User                                      |
|$res=            |CLI|${CLIBatch} DeleteUser --UserName ${UserName}|
|Verify_Contain_OR|$res;;successful                                 |

!| scenario|Clear Environment|
|Delete User                 |


!|scenario            |Add User With Space In Name|UserName||Passwd||EMail|
|clickAndWait         |link=Add UserID                                    |
|pause                |5000                                               |
|waitForElementPresent|id=UserName                                        |
|type;                |id=UserName                |@UserName              |
|type;                |id=FirstName               |Buba                   |
|type;                |id=LastName                |Kastorsky              |
|type;                |id=EmailID                 |@EMail                 |
|type;                |id=sPassword               |@Passwd                |
|type;                |id=Confirm                 |@Passwd                |
|click                |id=SubmitChanges                                   |
|waitForTextPresent   |*Invalid space in UserName*                        |


!|scenario            |Choose Sys-Admin User  |userName  |
|clickAndWait         |link=Manage Sys-Admin UserIDs     |
|waitForElementPresent|id=UsrNm                          |
|type;                |id=UsrNm               |@userName |
|click                |id=Listing                        |
|waitForElementPresent|//td[contains(text(),'@userName')]|
|mouseDown            |//td[contains(text(),'@userName')]|
|click                |//td[contains(text(),'@userName')]|

!|scenario          |Test Restricted IP Users               |
|Login              |${TPAMURL}||${TPAMAdmin}||${DefaultPwd}|
|Test TPAM User     |${RestrictedIPUserName}                |
|Test Sys-Admin User|${RestrictedIPSysAdminName}            |



!|scenario                      |Test TPAM User|userName               |
|pause                          |5000                                  |
|Add CLI User                   |@userName                             |
|Check User Connection          |@userName     ||Valid commands are    |
|Set Restricted IPs             |@userName     ||${InvalidIPList}      |
|Check User Connection          |@userName     ||Server refused our key|
|Toggle from CLI to API and Back|@userName                             |
|Check User Connection          |@userName     ||Server refused our key|
|Set Restricted IPs             |@userName     ||${ValidIPList}        |
|Check User Connection          |@userName     ||Valid commands are    |
|Toggle from CLI to API and Back|@userName                             |
|Check User Connection          |@userName     ||Valid commands are    |
|Remove user                    |@userName                             |
|Remove Keys                                                           |



!|scenario                      |Test Sys-Admin User|userName               |
|pause                          |5000                                       |
|Add Web-disabled Sys-Admin User|@userName                                  |
|Check User Connection          |@userName          ||Valid commands are    |
|Set Sys-Admin Restricted IPs   |@userName          ||${InvalidIPList}      |
|Check User Connection          |@userName          ||Server refused our key|
|Set Sys-Admin Restricted IPs   |@userName          ||${ValidIPList}        |
|Check User Connection          |@userName          ||Valid commands are    |
|Delete Sys-Admin User          |@userName                                  |
|Remove Keys                                                                |


!|scenario        |Check User Connection|userName         |        |result        |
|$res=            |CLI                  |-i @userName.ppk -C @userName@${TPAMHost}|
|Verify_Contain_OR|$res;;@result                                                  |



!|scenario         |Set Restricted IPs|userName||ipList|
|Choose User       |@userName                          |
|click             |id=Details                         |
|pause             |1000                               |
|click             |id=KeyBased                        |
|pause             |1000                               |
|type;             |id=RestrictedIP   |@ipList         |
|pause             |1000                               |
|click             |id=SubmitChanges                   |
|waitForTextPresent|User updated successfully          |


!|scenario            |Set Sys-Admin Restricted IPs|userName||ipList|
|Choose Sys-Admin User|@userName                                    |
|click                |id=Details                                   |
|pause                |1000                                         |
|click                |id=KeyBased                                  |
|pause                |1000                                         |
|type;                |id=RestrictedIP             |@ipList         |
|pause                |1000                                         |
|click                |id=SubmitChanges                             |
|waitForTextPresent   |User updated successfully                    |


!|scenario         |Toggle from CLI to API and Back|userName|
|Choose User       |@userName                               |
|click             |id=Details                              |
|pause             |1000                                    |
|click             |id=KeyBased                             |
|pause             |1000                                    |
|click             |id=cb_CliAccess                         |
|click             |id=cb_ApiAccess                         |
|pause             |1000                                    |
|click             |id=SubmitChanges                        |
|waitForTextPresent|User updated successfully               |
|pause             |5000                                    |
|click             |id=cb_CliAccess                         |
|click             |id=cb_ApiAccess                         |
|pause             |1000                                    |
|click             |id=SubmitChanges                        |
|waitForTextPresent|User updated successfully               |

!|scenario        |Add User|username                                |with Thumbprint                                |thumbPrint                                |
|$res=            |CLI     |${CLIBatch} AddUser --UserName @username --LastName Doe --FirstName John --PrimaryAuthType Certificate --CertThumbprint @thumbPrint|
|Verify_Contain_OR|$res;;User added successfully                                                                                                               |

!|scenario        |Add User by CLI|username                                                                |
|$res=            |CLI            |${CLIBatch} AddUser --UserName @username --LastName Doe --FirstName John|
|Verify_Contain_OR|$res;;User added successfully                                                           |

!|scenario        |Update User|username                      |to use Thumbprint                      |thumbPrint                     |
|$res=            |CLI        |${CLIBatch} UpdateUser --UserName @username --PrimaryAuthType Certificate --CertThumbprint @thumbPrint|
|Verify_Contain_OR|$res;;User updated successfully                                                                                   |



!|scenario         |Add Web-disabled Sys-Admin User |userName                      |
|Login             |${TPAMAdminURL}                 | |${TPAMMaster} ||${MasterPwd}|
|pause             |5000                                                           |
|clickAndWait      |link=Add Sys-Admin UserID                                      |
|pause             |5000                                                           |
|type;             |id=UserName                     |@userName                     |
|pause             |1000                                                           |
|type;             |id=LastName                     |L                             |
|pause             |1000                                                           |
|type;             |id=FirstName                    |K                             |
|pause             |1000                                                           |
|click             |id=cb_WebAccess                                                |
|pause             |1000                                                           |
|click             |id=KeyBased                                                    |
|pause             |1000                                                           |
|pause             |1000                                                           |
|click             |id=cb_CliAccess                                                |
|pause             |1000                                                           |
|click             |id=SubmitChanges                                               |
|waitForTextPresent|User added successfully                                        |
|pause             |1000                                                           |
|click             |id=GetCliaKey                                                  |
|pause             |5000                                                           |
|runBatch          |movekey;${BrowserDownloadDir}\id_dsa;${PathToKeys}@userName.ppk|
|Generate Plink Key|@userName                                                      |


!|scenario        |Add Web Cli user|UserName                                  |                                  |
|$res=            |GroovyWebDriver |addWebCliUser;${FrontPageContent};@UserName;Password1;Administrator;test;test|
|Verify_Contain_OR|$res;;User added successfully                                                                 |

!|scenario         |Add Passphrase And Download Key|UserName         |        |Password        |        |Passphrase        |
|$res=             |GroovyWebDriver                |AddPassphraseAndDownloadKey;@UserName;@Password;${TPAMHost};@Passphrase|
|Verify_Contain_OR |$res;;created successfully                                                                             |
|Verify_Contain_NOT|$res;;Catched: something went wrong                                                                    |

!|scenario        |Run Cli command with Passphrase|Passphrase   |   |UserName   |   |TPAMHost   |   |CLIcommand   |  |Result  |
|$res=            |RunBatchGetOutput              |runCLIcommandWithPassphrase.bat;@Passphrase;@UserName;@TPAMHost;@CLIcommand|
|Verify_Contain_OR|$res;;@Result                                                                                              |


!|scenario        |Add Cache User |UserName                                                                    |
|$res=            |GroovyWebDriver|addUser;firefox;${FrontPageContent};@UserName;Password1;Cache User;test;test|
|Verify_Contain_OR|$res;;User added successfully                                                               |
