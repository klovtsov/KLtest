!| scenario       |Cancel Session Request sc                                                          |
|$res=            |CLI|${CLIBatch} CancelSessionRequest --RequestID $RequestIDs --Comment "Comment123"|
|Verify_Contain_OR|$res;;successful                                                                   |

!|scenario        |List Canceled Session Request                                                                                               |
|$res=            |CLI|${CLIBatch} ListSessionRequest --status all --RequestorName * --accountname ${ManagedAccount} --systemname ${SystemName}|
|Verify_Contain_OR|$res;;$RequestIDs.*Denied                                                                                                   |

!|scenario        |List PSM Accounts                                                                                                                                                                                                                                             |
|$res=            |CLI|${CLIBatch} ListPSMAccounts --Platform ${SystemPlatform} --systemname ${SystemName} --NetworkAddress * --SystemAutoFlag Y --SystemPSMFlag Y --AccountName ${ManagedAccount} --DualControlFlag N --AccountLockFlag N --AccountAutoFlag Y --AccountPSMFlag Y|
|Verify_Contain_OR|$res;;${ManagedAccount}                                                                                                                                                                                                                                       |

!|scenario        |List Acc for Session Request                                                                         |
|$res=            |CLI|${CLIBatch} ListAcctsForSessionRequest --accountname ${ManagedAccount} --systemname ${SystemName}|
|Verify_Contain_OR|$res;;${ManagedAccount}                                                                              |

!| scenario       |Update PSM Details|accountName                                                                                     |on system                                                                                    |systemName                                                                                    |
|$res=            |CLI               |${CLIBatch} UpdateEGPAccount --System @systemName --Account @accountName  --ProxyType \"RDP - Automatic Login Using Password\" --ColorDepth 16 --DefaultSessionDuration 120 --EnableFlag Y --MaxSessionCount 10 --MinApprovers 0 --RecordingRequiredFlag Y --ReviewCount 1 --ReviewerType Any|
|Verify_Contain_OR|$res;;successful                                                                                                                                                                                                                                                                                                |

!|scenario        |Set User Permissions|userName                                             |                                             |Policy                                             |
|$res=            |CLI                 |${CLIBatch} SetAccessPolicy --AccessPolicyName \"@Policy\" --Action ADD --SystemName ${SystemName} --AccountName ${ManagedAccount} --UserName @userName|
|Verify_Contain_OR|$res;;successful                                                                                                                                                            |

!|scenario        |Revoke User Permissions|userName                                              |                                             |Policy                                             |
|$res=            |CLI                    |${CLIBatch} SetAccessPolicy --AccessPolicyName \"@Policy\" --Action DROP --SystemName ${SystemName} --AccountName ${ManagedAccount} --UserName @userName|
|Verify_Contain_OR|$res;;successful                                                                                                                                                                |

!| scenario       |Request Session                                                                                                                                  |
|$res=            |CLI          |${CLIBatch} AddSessionRequest --SystemName ${SystemName} --AccountName ${ManagedAccount} --RequestNotes test --forusername PARAdmin|
|Verify_Contain_OR|$res;;submitted                                                                                                                                  |
|$RequestIDs=     |get_RequestID|$res                                                                                                                               |

!| scenario       |Approve Session                                                            |
|$res=            |CLI|${CLIBatch2} ApproveSessionRequest --RequestID $RequestIDs --Comment OK|
|Verify_Contain_OR|$res;;submitted                                                            |

!|scenario           |List Session Request prepare                                                                                                                                         |
|Set User Permissions|PARAdmin         |                                                                   |PSM Approver-Requestor                                                         |
|Set User Permissions|${CLI_user_1}    |                                                                   |PSM Approver-Requestor                                                         |
|Set User Permissions|${CLI_user_2}    |                                                                   |PSM Approver-Requestor                                                         |
|pause               |${ApplyNewPoliciesInterval}                                                                                                                                          |
|$Months=            |getEval          |var d = new Date();t=d.getUTCMonth()+1;return t;                                                                                                   |
|$Days=              |getEval          |var d = new Date();t=d.getUTCDate();return t;                                                                                                      |
|$Years=             |getEval          |var d = new Date();t=d.getUTCFullYear();return t;                                                                                                  |
|$Hours=             |getEval          |var d = new Date();t=d.getUTCHours();return t;                                                                                                     |
|$Minutesp=          |getEval          |var d = new Date();var h = d.getUTCHours();var m = d.getUTCMinutes()+9;if (m > 59) {h = h + 1;m = m - 60;d = h+":0"+m} else {d = h+":"+m};return d;|
|$Minutesm=          |getEval          |var d = new Date();var h = d.getUTCHours();var m = d.getUTCMinutes()-9;if (m < 0) {h = h - 1;m = m + 60;d = h+":"+m} else {d = h+":"+m};return d;  |
|Update PSM Details  |${ManagedAccount}|on system                                                          |${SystemName}                                                                  |
|Request Session                                                                                                                                                                           |

!|scenario        |List Session Request                                                                                                                                                                                                    |
|$res=            |CLI|${CLIBatch} ListSessionRequest --status all --RequestorName * --accountname ${ManagedAccount} --systemname ${SystemName} --startdate \"$Months/$Days/$Years $Minutesm\" --enddate \"$Months/$Days/$Years $Minutesp\"|
|Verify_Contain_OR|$res;;${ManagedAccount}                                                                                                                                                                                                 |

#--startdate \"$Months/$Days/$Years $Minutesm\" --enddate \"$Months/$Days/$Years $Minutesp\"

!|scenario        |List Session Request Details                                                                                                                                                                                                   |
|$res=            |CLI|${CLIBatch} ListSessionRequestDetails --status all --RequestorName * --accountname ${ManagedAccount} --systemname ${SystemName} --startdate \"$Months/$Days/$Years $Minutesm\" --enddate \"$Months/$Days/$Years $Minutesp\"|
|Verify_Contain_OR|$res;;${ManagedAccount}                                                                                                                                                                                                        |


!|scenario           |List Request prepare                                                                                                                                   |
|Set User Permissions|${CLI_user_1}|                                                           |Approver-Requestor                                                           |
|Set User Permissions|${CLI_user_2}|                                                           |Approver-Requestor                                                           |
|pause               |${ApplyNewPoliciesInterval}                                                                                                                            |
|$Months=            |getEval      |var d = new Date();d.getUTCMonth()+1;                                                                                                    |
|$Days=              |getEval      |var d = new Date();d.getUTCDate();                                                                                                       |
|$Years=             |getEval      |var d = new Date();d.getUTCFullYear();                                                                                                   |
|$Hours=             |getEval      |var d = new Date();d.getUTCHours();                                                                                                      |
|$Minutesp=          |getEval      |var d = new Date();var h = d.getUTCHours();var m = d.getUTCMinutes()+6;if (m > 59) {h = h + 1;m = m - 60;d = h+":0"+m} else {d = h+":"+m}|
|$Minutesm=          |getEval      |var d = new Date();var h = d.getUTCHours();var m = d.getUTCMinutes()-6;if (m < 0) {h = h - 1;m = m + 60;d = h+":"+m} else {d = h+":"+m}  |
|Request Pwd                                                                                                                                                                 |

!|scenario        |List Request                                                                                                                                                                                                                 |
|$res=            |CLI|${CLIBatch} ListRequest --status all --RequestorName "User=Myself" --accountname ${ManagedAccount} --systemname ${SystemName} --startdate \"$Months/$Days/$Years $Minutesm\" --enddate \"$Months/$Days/$Years $Minutesp\"|
|Verify_Contain_OR|$res;;${ManagedAccount}                                                                                                                                                                                                      |

#--startdate \"$Months/$Days/$Years $Minutesm\" --enddate \"$Months/$Days/$Years $Minutesp\"

!|scenario        |List Request Details                                                                                                                                                                                                                |
|$res=            |CLI|${CLIBatch} ListRequestDetails --status all --RequestorName "User=Myself" --accountname ${ManagedAccount} --systemname ${SystemName} --startdate \"$Months/$Days/$Years $Minutesm\" --enddate \"$Months/$Days/$Years $Minutesp\"|
|Verify_Contain_OR|$res;;${ManagedAccount}                                                                                                                                                                                                             |


!|scenario        |Add AD system                                                                                                                                                                                                                                                                                        |
|$res=            |CLI|${CLIBatch}        AddSystem --SystemName ${AdSystemName} --NetworkAddress ${AdSystemAddress} --PlatformName \"${AdSystemPlatform}\" --DomainName ${DomainName} --NetBiosName ${NETBIOSDomainName} --FunctionalAccount ${AdFunctAcct} --FuncAcctCred ${AdFunctAcctPwd} --Timeout ${SystemTimeout}|
|Verify_Contain_OR|$res;;successful                                                                                                                                                                                                                                                                                     |

!| scenario       |Add ad account|acc                                  |with password                                  |pwd                                 |                                 |testRes                                 |
|$res=            |CLI           |${CLIBatch} AddAccount --System ${AdSystemName} --AccountName @acc --Password \"@pwd\" --Description \"${ManagedAccountDescription}\" --ChangeServiceFlag Y --ChangeTaskFlag Y --RestartServiceFlag Y|
|Verify_Contain_OR|$res;;successfully                                                                                                                                                                                                  |

!| scenario       |Update Dependent Systems                                                                                              |
|$res=            |CLI|${CLIBatch} UpdateDependentSystems --System ${AdSystemName} --AccountName ${ManagedAccount} --Assign ${SystemName}|
|Verify_Contain_OR|$res;;successful                                                                                                      |

!|scenario        |List Collection|CollectionName                    |                    |SystemName                   |
|$res=            |CLI            |${CLIBatch} ListCollections --collectionname @CollectionName --SystemName @SystemName|
|Verify_Contain_OR|$res;;@CollectionName                                                                                |

!|scenario        |List Collection Membership|CollectionName                                                       |
|$res=            |CLI                       |${CLIBatch} ListCollectionMembership --collectionname @CollectionName|
|Verify_Contain_OR|$res;;${ManagedAccount}                                                                         |


|scenario             |List Groups |
|List Groups Groupname|${GroupName}|
|List Groups Username |${UserName} |
#|List Groups Groupid  |${Groupid}     |


|scenario         |List Groups Groupname                              |
|$res=            |CLI|${CLIBatch} Listgroups --groupname ${GroupName}|
|Verify_Contain_OR|$res;;${GroupName}                                 |

|scenario         |List Groups Username                             |
|$res=            |CLI|${CLIBatch} Listgroups --Username ${UserName}|
|Verify_Contain_OR|$res;;${GroupName}                               |

|scenario                        |List Group Membership|
|List Groups Membership Groupname|${GroupName}         |
|List Groups Membership Username |${UserName}          |
#|List Groups Groupid  |${Groupid}     |

|scenario         |List Groups Membership Groupname                            |
|$res=            |CLI|${CLIBatch} Listgroupmembership --groupname ${GroupName}|
|Verify_Contain_OR|$res;;${UserName}                                           |

|scenario         |List Groups Membership Username                           |
|$res=            |CLI|${CLIBatch} Listgroupmembership --Username ${UserName}|
|Verify_Contain_OR|$res;;${GroupName}.*${GroupName2}                         |

!|scenario        |List Systems                                                                                                                                                        |
|$res=            |CLI|${CLIBatch} ListSystems --networkaddress ${SystemAddress} --collectionname ${CollectionName} --SystemName ${SystemName} --Autoflag Y -Platform ${SystemPlatform}|
|Verify_Contain_OR|$res;;${SystemName}                                                                                                                                                 |

!|scenario        |Add Userl                                                                                                                                     |
|$res=            |CLI|${CLIBatch} AddUser --username ${UserName2} --lastname lastname --firstname firstname --email ${emailaddress} --usertype Admin --DISABLE Y|
|Verify_Contain_OR|$res;;successfully                                                                                                                            |
#|$res=            |CLI|${CLIBatch} AddUser --username ${UserName2} --lastname lastname --firstname firstname --email ${emailaddress} --usertype Admin --DISABLE Y --secondaryauth LDAP --secondaryauthsystem ${SystemName} --secondaryuserid fake|

!|scenario        |List Users                                                                                                                                                                               |
|$res=            |CLI|${CLIBatch} ListUsers --username ${UserName2} --emailaddress ${emailaddress} --groupname ${GroupName} --userinterface WEB --usertype Admin --status DISABLED --secondaryauthtype NONE|
|Verify_Contain_OR|$res;;${UserName2}                                                                                                                                                                       |

!|scenario        |List Users by filter|fltr  |contains  |expected |
|$res=            |CLI                 |${CLIBatch} ListUsers @fltr|
|Verify_Contain_OR|$res;;@expected     |                           |

!|scenario         |List Users by filter|fltr|does not contain|unexpctd|
|$res=             |CLI                 |${CLIBatch} ListUsers @fltr   |
|Verify_Contain_NOT|$res;;@unexpctd     |                              |

!|scenario        |List Collections by name|CollectName  |and additional filter  |fltr |contains |expected |
|$res=            |CLI                     |${CLIBatch} ListCollections --collectionname @CollectName @fltr|
|Verify_Contain_OR|$res;;@expected         |                                                               |

!|scenario         |List Collections by name|CollectName|and additional filter|fltr|does not contain|unexpctd|
|$res=             |CLI                     |${CLIBatch} ListCollections --collectionname @CollectName @fltr |
|Verify_Contain_NOT|$res;;@unexpctd         |                                                                |



!|scenario     |Dependent Systems prepare                                         |
|Add AD system                                                                    |
|Add ad account|${ManagedAccount}|with password|${ManagedAccountPwd}||successfully|
|Update Dependent Systems                                                         |

!|scenario        |List Dependent Systems                                                                                                                                     |
|$res=            |CLI|${CLIBatch} ListDependentSystems --systemname ${AdSystemName} --accountname ${ManagedAccount} --DependentStatus Dependent --DependentName ${SystemName}|
|Verify_Contain_OR|$res;;${SystemName}                                                                                                                                        |

!|scenario        |List Assigned Policy prepare                                                                                                                                     |
|$res=            |CLI|${CLIBatch} SetAccessPolicy --AccessPolicyName Approver-Requestor --Action ADD --AccountName ${ManagedAccount} --SystemName ${SystemName} --UserName parAdmin|
|Verify_Contain_OR|$res;;successful                                                                                                                                                 |
|$res=            |CLI|${CLIBatch} SetAccessPolicy --AccessPolicyName Approver-Requestor --Action ADD --CollectionName ${CollectionName} --UserName parAdmin                        |
|Verify_Contain_OR|$res;;successful                                                                                                                                                 |
|$res=            |CLI|${CLIBatch} SetAccessPolicy --AccessPolicyName ISA --Action ADD --SystemName ${SystemName} --GroupName ${GroupName}                                          |
|Verify_Contain_OR|$res;;successful                                                                                                                                                 |
|$res=            |CLI|${CLIBatch} SetAccessPolicy --AccessPolicyName ISA --Action ADD --SystemName ${SystemName} --UserName ${CLI_user_1}                                          |
|Verify_Contain_OR|$res;;successful                                                                                                                                                 |
|$res=            |CLI|${CLIBatch} SetAccessPolicy --AccessPolicyName ISA --Action ADD --CollectionName ${CollectionName} --UserName ${CLI_user_1}                                  |
|Verify_Contain_OR|$res;;successful                                                                                                                                                 |
|$res=            |CLI|${CLIBatch} SetAccessPolicy --AccessPolicyName ISA --Action ADD --SystemName ${SystemName} --FileName ${FileName} --UserName ${CLI_user_1}                   |
|Verify_Contain_OR|$res;;successful                                                                                                                                                 |
|pause            |${ApplyNewPoliciesInterval}                                                                                                                                      |




#--AccountName ${ManagedAccount}

!|scenario        |List Assigned Policy cleanup                                                                                                                                      |
|$res=            |CLI|${CLIBatch} SetAccessPolicy --AccessPolicyName Approver-Requestor --Action Drop --AccountName ${ManagedAccount} --SystemName ${SystemName} --UserName parAdmin|
|Verify_Contain_OR|$res;;successful                                                                                                                                                  |
|$res=            |CLI|${CLIBatch} SetAccessPolicy --AccessPolicyName Approver-Requestor --Action Drop --CollectionName ${CollectionName} --UserName parAdmin                        |
|Verify_Contain_OR|$res;;successful                                                                                                                                                  |
|$res=            |CLI|${CLIBatch} SetAccessPolicy --AccessPolicyName ISA --Action Drop --SystemName ${SystemName} --UserName ${CLI_user_1}                                          |
|Verify_Contain_OR|$res;;successful                                                                                                                                                  |
|$res=            |CLI|${CLIBatch} SetAccessPolicy --AccessPolicyName ISA --Action Drop --CollectionName ${CollectionName} --UserName ${CLI_user_1}                                  |
|Verify_Contain_OR|$res;;successful                                                                                                                                                  |
|$res=            |CLI|${CLIBatch} SetAccessPolicy --AccessPolicyName ISA --Action Drop --FileName ${FileName} --SystemName ${SystemName} --UserName ${CLI_user_1}                   |
|Verify_Contain_OR|$res;;successful                                                                                                                                                  |
|$res=            |CLI|${CLIBatch} SetAccessPolicy --AccessPolicyName ISA --Action Drop --SystemName ${SystemName} --GroupName ${GroupName}                                          |
|Verify_Contain_OR|$res;;successful                                                                                                                                                  |


!|scenario        |List Assigned Policy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|$res=            |CLI                                                                                                                                                                                                                                                                |${CLIBatch} ListAssignedPolicies --AccessPolicyName "Approver-Requestor" --AccountName ${ManagedAccount} --systemname ${SystemName} --PermissionName APR;REQ;REV --PermissionType File;Pwd;Sess -UserName ParAdmin                                                                                                                                                                                                                                                                                     |
|Verify_Contain_OR|$res;;ParAdmin.*${SystemName}.*${ManagedAccount}.*Approver-Requestor.*User-Account                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|$res=            |CLI                                                                                                                                                                                                                                                                |${CLIBatch} ListAssignedPolicies --AccessPolicyName "Approver-Requestor" --CollectionName ${CollectionName} --PermissionName APR;REQ;REV --PermissionType File;Pwd;Sess -UserName ParAdmin --ExpandCollectionFlag Y                                                                                                                                                                                                                                                                                    |
|Verify_Contain_OR|$res;;ParAdmin.*${SystemName}.*${CollectionName}.*Approver-Requestor.*User-Collection.*${SystemName}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|$res=            |CLI                                                                                                                                                                                                                                                                |${CLIBatch} ListAssignedPolicies --AccessPolicyName "ISA" --SystemName ${SystemName} --PermissionName ISA;APR;REV --PermissionType Pwd;File;Sess --ExpandGroupFlag Y                                                                                                                                                                                                                                                                                                                                   |
|Verify_Contain_OR|$res;;${GroupName}.*${SystemName}.*ISA.*Group-System.*Listusername                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|$res=            |CLI                                                                                                                                                                                                                                                                |${CLIBatch} ListAssignedPolicies --AccessPolicyName "ISA" --FileName ${FileName} --PermissionName ISA;APR;REV --PermissionType Pwd;File;Sess                                                                                                                                                                                                                                                                                                                                                           |
|Verify_Contain_OR|$res;;${CLI_user_1}.*${FileName}.*ISA.*User-File.*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|$res=            |CLI                                                                                                                                                                                                                                                                |${CLIBatch} ListAssignedPolicies --AccessPolicyName "Approver-Requestor" --AccountName ${ManagedAccount} --systemname ${SystemName} --PermissionName APR;REQ;REV --PermissionType File;Pwd;Sess -UserName ParAdmin --expandpolicyflag Y                                                                                                                                                                                                                                                                |
|Verify_Contain_OR|$res;;.*ParAdmin.*Listcollectionname1.*Approver.*Requestor.*User.*Collection.*Sess.*APR.*Yes.*Listcollectionname1.*Approver.*Requestor.*User.*Collection.*Sess.*REQ.*Yes.*Listcollectionname1.*Approver.*Requestor.*User.*Collection.*Sess.*REV.*Yes.*Listsystemname1.*Listmaccount1.*Approver.*Requestor.*User.*Account.*Pwd.*APR.*Yes.*Listsystemname1.*Listmaccount1.*Approver.*Requestor.*User.*Account.*Pwd.*REQ.*Yes.*Listsystemname1.*Listmaccount1.*Approver.*Requestor.*User.*Account.*Pwd.*REV.*Yes.*Listsystemname1.*Listmaccount1.*Approver.*Requestor.*User.*Account.*Sess.*APR.*Yes.*Listsystemname1.*Listmaccount1.*Approver.*Requestor.*User.*Account.*Sess.*REQ.*Yes.*Listsystemname1.*Listmaccount1.*Approver.*Requestor.*User.*Account.*Sess.*REV.*Yes.*|
|$res=            |CLI                                                                                                                                                                                                                                                                |${CLIBatch} ListAssignedPolicies --AccessPolicyName "Approver-Requestor" --AccountName ${ManagedAccount} --systemname ${SystemName} --PermissionName APR;REQ;REV --PermissionType File;Pwd;Sess -UserName ParAdmin --expandpolicyflag Y                                                                                                                                                                                                                                                                |

!| scenario|Cancel Session Request|
|Request Session                  |
|Cancel Session Request sc        |
|List Canceled Session Request    |

#|Approve Session                  |

!|scenario                |Prepare Environment                                                     |
|Open                     |${TPAMURL}       |             |${TPAMAdmin}        ||${DefaultPwd}     |
|Create File              |${FilePath}      |             |${FileName}                             |
|Add System               |${SystemName}                                                           |
|Add File                                                                                          |
|Add Group                |${GroupName}                                                            |
|Add Group                |${GroupName2}                                                           |
|Add User                 |${UserName}      |             |Admin4PAR           ||UserMail | |Admin |
|Add Userl                                                                                         |
|Add User To Group        |${UserName}      |             |${GroupName}                            |
|Add User To Group        |${UserName}      |             |${GroupName2}                           |
|Add User To Group        |${UserName2}     |             |${GroupName}                            |
|Add account              |${ManagedAccount}|with password|${ManagedAccountPwd}||successfully      |
|Add Collection           |${CollectionName}                                                       |
|Add Collection           |${CollectionName2}                                                      |
|Add System To Collection |${SystemName}    |             |${CollectionName}                       |
|Add Account To Collection|${SystemName}    |             |${ManagedAccount}   ||${CollectionName2}|
|Dependent Systems prepare                                                                         |
|List Request prepare                                                                              |
|List Session Request prepare                                                                      |
|List Assigned Policy prepare                                                                      |


!|scenario                    |Clear Environment                      |
|List Assigned Policy cleanup                                         |
|Remove File                  |${FileName}                            |
|Delete File                  |${FilePath}    ||${FileName}           |
|Approve Pwd                                                          |
|Revoke User Permissions      |${CLI_user_1}  ||Approver-Requestor    |
|Revoke User Permissions      |${CLI_user_2}  ||Approver-Requestor    |
|Revoke User Permissions      |${CLI_user_1}  ||PSM Approver-Requestor|
|Revoke User Permissions      |${CLI_user_2}  ||PSM Approver-Requestor|
|Revoke User Permissions      |PARAdmin       ||PSM Approver-Requestor|
|Remove System from Collection|${SystemName}  ||${CollectionName}     |
|Delete Collection            |${CollectionName}                      |
|Delete Collection            |${CollectionName2}                     |
|Delete Group                 |${GroupName}                           |
|Delete Group                 |${GroupName2}                          |
|Remove User                  |${UserName}                            |
|Remove User                  |${UserName2}                           |
|Remove system                |${AdSystemName}|                       |
|Remove System                |${SystemName}                          |

#### Alexander Buyanov added these scenarios for 5472 test #####
!|scenario        |Add Permissions|policyname                    |on account                    |account                   |for user                   |userName                   |
|$res=            |CLI            |${CLIBatch} SetAccessPolicy --AccessPolicyName "@policyname" --Action ADD --SystemName ${SystemName} --AccountName @account --UserName @userName|
|Verify_Contain_OR|$res;;successful                                                                                                                                                |

!|scenario        |Remove Permissions|policyname                    |on account                    |account                    |for user                   |userName                   |
|$res=            |CLI               |${CLIBatch} SetAccessPolicy --AccessPolicyName "@policyname" --Action DROP --SystemName ${SystemName} --AccountName @account --UserName @userName|
|Verify_Contain_OR|$res;;successful                                                                                                                                                    |

!|scenario        |Add Permissions|policyname                |on                |system               |for user               |userName               |
|$res=            |CLI            |${CLIBatch} SetAccessPolicy --AccessPolicyName "@policyname" --Action ADD --SystemName @system --UserName @userName|
|Verify_Contain_OR|$res;;successful                                                                                                                   |

!|scenario|Check System do not doubles                             |
|$res=    |CLI |${CLIBatch2} ListSystems --SystemName ${SystemName}|
|check    |echo|$res        |=~/${SystemName}/                     |
|check not|echo|$res        |=~/(${SystemName}[\s\S]*){2,}/        |

!|scenario            |List users without groupmembership|nameFilter|contains    |expected|and does not contain|unexp|
|Open                 |${TPAMURL}                        |          |${TPAMAdmin}|        |${DefaultPwd}             |
|clickOnLink          |link=List UserIDs                                                                             |
|waitForElementPresent|id=UsrNm                                                                                      |
|type;                |id=UsrNm                          |@nameFilter                                                |
|type;                |id=GroupNm                        |!                                                          |
|click                |id=Listing                                                                                    |
|waitForElementPresent|id=UserListingReport                                                                          |
|$lstng=              |getText                           |xpath=//table[@id='UserListingReport']                     |
|Verify_Contain_OR    |$lstng;;@expected                                                                             |
|Verify_Contain_NOT   |$lstng;;@unexp                                                                                |
|Logout Paradmin                                                                                                     |

!|scenario            |List Collections with name|nameFilter|system membership|systemFilter|account membership|accntFilter|file membership|fileFilter|contains|expected|and does not contain|unexpected|
|Open                 |${TPAMURL}                |          |${TPAMAdmin}     |            |${DefaultPwd}                                                                                              |
|clickOnLink          |link=List Collections                                                                                                                                                           |
|waitForElementPresent|id=CollectionNm                                                                                                                                                                 |
|type;                |id=CollectionNm           |@nameFilter                                                                                                                                          |
|type;                |id=SystemNm               |@systemFilter                                                                                                                                        |
|type;                |id=AccountNm              |@accntFilter                                                                                                                                         |
|type;                |id=FileNm                 |@fileFilter                                                                                                                                          |
|click                |id=Listing                                                                                                                                                                      |
|waitForElementPresent|id=CollectionListingReport                                                                                                                                                      |
|$lstng=              |getText                   |xpath=//table[@id='CollectionListingReport']                                                                                                         |
|Verify_Contain_OR    |$lstng;;@expected                                                                                                                                                               |
|Verify_Contain_NOT   |$lstng;;@unexp                                                                                                                                                                  |
|Logout Paradmin                                                                                                                                                                                       |

!|scenario        |Prepare account   |accntName                             |with requestor                            |reqstrName                                                                   |
|$res=            |CLI               |${CLIBatch} AddAccount --SystemName ${SystemName} --AccountName @accntName --Password ${ManagedAccountPwd}  --Description \"Test account\" --MinimumApprovers 0|
|Verify_Contain_OR|$res;;successful                                                                                                                                                                  |
|Add Permissions  |\"PPM Requestor\" |on account                            |@accntName                                |for user                            |@reqstrName                             |
|Add Permissions  |Approver-Requestor|on account                            |@accntName                                |for user                            |${CLI_user_1}                           |

!|scenario            |Release password  |accntName                            |by                                      |reqstrName                                                       |
|$res=                |CLI               |${CLIBatch} AddPwdRequest --SystemName ${SystemName} --AccountName @accntName --ForUserName @reqstrName --ReleaseDuration 15 --RequestNotes test|
|$RequestID=          |get_RequestID     |$res                                                                                                                                            |
|Change Pwd           |@reqstrName       |                                     |${DefaultPwd}                           |                           |${UserPwd}                           |
|Login                |${TPAMURL}        |                                     |@reqstrName                             |                           |${UserPwd}                           |
|click                |id=CurrentRequests|                                                                                                                                                |
|click                |xpath=//td[contains(text(),'${SystemName}')]/../td/a[contains(text(),'${ManagedAccount}')]                                                                         |
|click                |xpath=//table[@id='MainListingTable']//td[contains(text(),'${SystemName}')]/../td[contains(text(),'${ManagedAccount}')]                                            |
|click                |id=Password                                                                                                                                                        |
|waitForElementPresent|xpath=//div[@class='displayPassword']                                                                                                                              |
|Logout                                                                                                                                                                                   |

!|scenario            |Password Rlease activity report for|userNameFiltr|contains    |expected|and does not contain|unexpctd|
|Open                 |${TPAMURL}                         |             |${TPAMAdmin}|        |${DefaultPwd}                |
|clickOnLink          |link=Password Release Activity                                                                       |
|waitForElementPresent|id=UserNm                                                                                            |
|type;                |id=UserNm                          |@userNameFiltr                                                   |
|type;                |id=GroupNm                         |!                                                                |
|click                |id=Report                                                                                            |
|waitForElementPresent|id=reportTable                                                                                       |
|$lstng=              |getText                            |xpath=//table[@id='reportTable']                                 |
|Verify_Contain_OR    |$lstng;;@expected                                                                                    |
|Verify_Contain_NOT   |$lstng;;@unexpctd                                                                                    |
|Logout Paradmin                                                                                                            |
