!contents


!|scenario                     |Prepare Test                                                                                                             |
|Login                         |${TPAMURL}               |          |${TPAMAdmin}     |         |${DefaultPwd}                                           |
|Add System                    |${SystemName}            |          |${SystemAddress} |         |${SystemPlatform}|        |${FunctAcct}||${FunctAcctPwd}|
|Prepare Account               |${ManagedAccount}        |          |${SystemName}    |         |${SystemAddress}                                        |
|Prepare Requestor             |${Requestor}                                                                                                             |
|Login                         |${TPAMURL}               |          |${TPAMAdmin}     |         |${DefaultPwd}                                           |
|Create Command                |${CommandName}           |          |${CommandText}   |         |${WorkingDir}                                           |
|Prepare Access Policy With PCM|${PCMRequestorPolicyName}|          |${CommandName}                                                                      |
|Prepare Access Policy With PCM|${PCMApproverPolicyName} |          |${CommandName}                                                                      |
|Assign Policy                 |${PCMRequestorPolicyName}|To Account|${ManagedAccount}|On System|${SystemName}    |And User|${Requestor}                 |
|Assign Policy                 |${PCMRequestorPolicyName}|To Account|${ManagedAccount}|On System|${SystemName}    |And User|${CLI_user_1}                |
|Assign Policy                 |${PCMApproverPolicyName} |To Account|${ManagedAccount}|On System|${SystemName}    |And User|${CLI_user_2}                |
|Logout                                                                                                                                                  |
|Create Notification Mailbox                                                                                                                             |
#|Set Affinity       |


!|scenario               |Clear Objects                                                                                        |
|Login                   |${TPAMURL}               |          |${TPAMAdmin}     |         |${DefaultPwd}                       |
|Unassign Policy         |${PCMRequestorPolicyName}|To Account|${ManagedAccount}|On System|${SystemName}|And User|${CLI_user_1}|
|Rollback Access Policy  |${PCMRequestorPolicyName}                                                                            |
|Rollback Access Policy  |${PCMApproverPolicyName}                                                                             |
|Delete Command          |${CommandName}                                                                                       |
|pause                   |5000                                                                                                 |
|Remove system           |${SystemName}                                                                                        |
|Delete Account on System|${ManagedAccount}        |on system |${SystemAddress}                                                |
|Remove User             |${Requestor}                                                                                         |
|Delete Notification Mailbox                                                                                                   |


!|scenario            |Prepare Access Policy With PCM      |policyName||commandName|
|pause                |1000                                                        |
|clickAndWait         |link=Access Policies                                        |
|type;                |id=filtPolicyName                   |@policyName            |
|click                |id=Listing                                                  |
|waitForElementPresent|//td[contains(text(),'@policyName')]|                       |
|mouseDown            |//td[contains(text(),'@policyName')]|                       |
|click                |//td[contains(text(),'@policyName')]|                       |
|click                |id=Details                                                  |
|pause                |1000                                                        |
|click                |id=cbxAPDtlTypePassword                                     |
|click                |id=cbxAPDtlTypeCmd                                          |
|pause                |1000                                                        |
|select;              |id=CmdID                            |label=@commandName     |
|pause                |1000                                                        |
|click                |id=SubmitChangesButton                                      |
|waitForTextPresent   |Access Policy saved successfully                            |




!|scenario            |XXXXDelete Command                   |commandName|
|waitForElementPresent|link=Command Management                          |
|clickAndWait         |link=Command Management                          |
|waitForElementPresent|//td[contains(text(),'@commandName')]|           |
|mouseDown            |//td[contains(text(),'@commandName')]|           |
|click                |//td[contains(text(),'@commandName')]|           |
|click                |id=DeleteButton                                  |
|pause                |3000                                             |
|getConfirmation                                                        |
|waitForTextPresent   |successfully                                     |


!|scenario        |Delete Command |commandName                           |
|$res=            |GroovyWebDriver|DeleteCommand;${TPAMHost};@commandName|
|Verify_Contain_OR|$res;;Command deleted                                 |




!|scenario            |Rollback Access Policy              |policyName |
|pause                |1000                                            |
|clickAndWait         |link=Access Policies                            |
|type;                |id=filtPolicyName                   |@policyName|
|click                |id=Listing                                      |
|waitForElementPresent|//td[contains(text(),'@policyName')]|           |
|mouseDown            |//td[contains(text(),'@policyName')]|           |
|click                |//td[contains(text(),'@policyName')]|           |
|click                |id=Details                                      |
|waitForElementPresent|id=UseDefaultsFl                                |
|click                |id=cbxAPDtlTypePassword                         |
|click                |id=cbxAPDtlTypeCmd                              |
|click                |id=SubmitChangesButton                          |
|waitForTextPresent   |Access Policy saved successfully                |


!|scenario        |Assign Policy|policyName           |To Account           |accountName           |On System           |systemName           |And User           |userName          |
|$res=            |CLI          |${CLIBatch} SetAccessPolicy --AccessPolicyName \"@policyName\" --Action ADD --SystemName @systemName --AccountName @accountName --UserName @userName|
|Verify_Contain_OR|$res;;successful                                                                                                                                                  |


!|scenario        |Unassign Policy|policyName           |To Account           |accountName           |On System           |systemName           |And User           |userName           |
|$res=            |CLI            |${CLIBatch} SetAccessPolicy --AccessPolicyName \"@policyName\" --Action DROP --SystemName @systemName --AccountName @accountName --UserName @userName|
|Verify_Contain_OR|$res;;successful                                                                                                                                                     |



!|scenario     |Create Notification Mailbox                       |
|Create Mailbox|${NotificationEmail}||${NotificationEmailPassword}|

!|scenario     |Delete Notification Mailbox|
|Delete Mailbox|${NotificationEmail}       |



!|scenario               |Prepare Account|accountName  |                    |systemName||systemAddress|
|Add PSM Account         |@accountName   |on system    |@systemName                                   |
|pause                   |1000                                                                        |
|Create Account on System|@accountName   |with password|${ManagedAccountPwd}|on system |@systemAddress|
|pause                   |1000                                                                        |


#!| scenario       |Add System|systemName                     |                    |systemAddress                    |                    |systemPlatform                    |                    |functAcct                    |                    |functionalAccountPassword                    |
#|$res=            |CLI       |${CLIBatch} AddSystem --SystemName @systemName --NetworkAddress @systemAddress --PlatformName \"@systemPlatform\" --FunctionalAccount @functAcct --FuncAcctCred @functionalAccountPassword --Timeout ${SystemTimeout} --MaxReleaseDuration 120 --ReleaseChangeFlag N|
#|Verify_Contain_OR|$res;;successful                                                                                                                                                                                                                                                  |


!|scenario            |Add system       |systemName||systemAddress||systemPlatform||functAcct||functionalAccountPassword|
|pause                |10000                                                                                            |
|clickAndWait         |link=Add System                                                                                  |
|waitForElementPresent|id=SystemName                                                                                    |
|type;                |id=SystemName    |@systemName                                                                    |
|type;                |id=NetworkAddress|@systemAddress                                                                 |
|select;              |id=PlatformID    |label=@systemPlatform                                                          |
|pause                |1000                                                                                             |
|click                |id=Connection    |                                                                               |
|type;                |id=PARFuncAcct   |@functAcct                                                                     |
|type;                |id=pword         |@functionalAccountPassword                                                     |
|type;                |id=ConfPword     |@functionalAccountPassword                                                     |
|click                |id=bt_Save       |                                                                               |
|waitForTextPresent   |System changes for * saved successfully                                                          |




!| scenario       |Remove system|sysName                          |
|$res=            |CLI          |${CLIBatch} DeleteSystem @sysName|
|Verify_Contain_OR|$res;;successful                               |


!|scenario            |Hard-Delete System                  |systemName |
|clickAndWait         |link=Deleted Systems                            |
|type;                |id=SystemNm                         |@systemName|
|click                |id=Listing                          |           |
|waitForElementPresent|//td[contains(text(),'@systemName')]|           |
|mouseDown            |//td[contains(text(),'@systemName')]|           |
|click                |//td[contains(text(),'@systemName')]|           |
|click                |id=HardDeleteButton                 |           |
|getConfirmation                                                       |
|waitForTextPresent   |has been successfully deleted                   |
|pause                |1000                                            |


#!| scenario       |Add Account|accountName                                                         |on system                                                        |systemName                                                        |
#|$res=            |CLI        |${CLIBatch} AddAccount --SystemName @systemName --AccountName @accountName --Password ${ManagedAccountPwd}  --Description \"@accountName description\" --MinimumApprovers 0 --MaxReleaseDuration 120|
#|Verify_Contain_OR|$res;;successful                                                                                                                                                                                                     |



!|scenario            |Add PSM Account                     |accountName       |on system      |systemName      |
|clickAndWait         |link=Add Account                    |                                                   |
|type;                |id=SystemNm                         |@systemName                                        |
|click                |id=System                           |                                                   |
|waitForElementPresent|//td[contains(text(),'@systemName')]|                                                   |
|mouseDown            |//td[contains(text(),'@systemName')]|                                                   |
|click                |//td[contains(text(),'@systemName')]|                                                   |
|click                |id=Details                          |                                                   |
|type;                |id=AccountName                      |@accountName                                       |
|type;                |id=sPswd                            |${ManagedAccountPwd}                               |
|type;                |id=sConfPswd                        |${ManagedAccountPwd}                               |
|click                |id=SubmitChangesButton              |                                                   |
|waitForTextPresent   |Changes saved successfully for @accountName                                             |
|click                |id=PSMDetails                                                                           |
|waitForElementPresent|id=cb_EnableFl                                                                          |
|click                |id=cb_EnableFl                                                                          |
|select;              |id=ProxyType                        |label=${ProxyType} - Automatic Login Using Password|
|type;                |id=EgpMinApprovers                  |1                                                  |
|select;              |id=EgpDurationQtrHrs                |label=15                                           |
|select;              |id=EgpDurationHrs                   |label=0                                            |
|select;              |id=EgpDurationDays                  |label=0                                            |
|click                |id=SubmitChangesButton              |                                                   |
|waitForTextPresent   |PSM Details saved successfully                                                          |



!| scenario       |Update PSM Details|accountName                                                             |on system                                                            |systemName                                                            |
|$res=            |CLI               |${CLIBatch} UpdateEGPAccount --System @systemName --Account @accountName  --ProxyType \"SSH - Automatic Login Using Password\" --DefaultSessionDuration 120 --EnableFlag Y --MinApprovers 0 --RecordingRequiredFlag N|
|Verify_Contain_OR|$res;;successful                                                                                                                                                                                                                        |



!|scenario    |Create Account on System   |accountName   |with password  |pwd  |on system  |systemAddress  |
|accountAction|${SystemPlatform};;create;;@systemAddress;;${FunctAcct};;${FunctAcctPwd};;@accountName;;@pwd|

!|scenario    |Delete Account on System       |accountName       |on system      |systemAddress      |
|accountAction|${SystemPlatform};;delete;;@systemAddress;;${FunctAcct};;${FunctAcctPwd};;@accountName|



!|scenario |Prepare Requestor|UserName                  |
|Add User  |@UserName        ||${DefaultPwd}            |
|pause     |20000                                       |
|Change Pwd|@UserName        ||${DefaultPwd}||${UserPwd}|
#|Add User To Group|@UserName        ||\"Global PSM Requestor Group\"|



!|scenario        |Add User|UserName                             |                            |Password                            |
|$res=            |CLI     |${CLIBatch} AddUser --UserName @UserName --FirstName Testfirst --LastName Testlast --Password @Password|
|Verify_Contain_OR|$res;;successful                                                                                                |

!| scenario       |Remove User|userName                        |
|$res=            |CLI        |${CLIBatch} DeleteUser @userName|
|Verify_Contain_OR|$res;;successful                            |


!|scenario        |Add User To Group|UserName          |         |GroupName         |
|$res=            |CLI              |${CLIBatch} AddGroupMember @UserName,@GroupName|
|Verify_Contain_OR|$res;;successful                                                 |

!|scenario        |Remove User From Group|UserName          |          |GroupName         |
|$res=            |CLI                   |${CLIBatch} DropGroupMember @UserName,@GroupName|
|Verify_Contain_OR|$res;;successful                                                       |


!| scenario       |Remove System|sysName                          |
|$res=            |CLI          |${CLIBatch} DeleteSystem @sysName|
|Verify_Contain_OR|$res;;successful                               |

!| scenario       |Remove User|userName                        |
|$res=            |CLI        |${CLIBatch} DeleteUser @userName|
|Verify_Contain_OR|$res;;successful                            |


!|scenario   |Check Notification  |subject|        |message  |
|Check Mail  |${NotificationEmail}|       |@subject||@message|
|Delete Mails|${NotificationEmail}                           |


!|scenario        |Cancel Session Request                                                    |
|$res=            |CLI|${CLIBatch} CancelSessionRequest --RequestID $RequestID --Comment test|
|Verify_Contain_OR|$res;;successfully;;Terminat;;                                            |


!| scenario             |Check Mail|user            |           |subject           |           |body           |
|$res=                  |CheckMail |${MailServer};@user;${NotificationEmailPassword};${FromMail};@subject;@body|
|Verify_Contain_OR_alnum|$res;;@body                                                                           |



!| scenario             |Delete Mails|user                                            |
|$res=                  |ClearMailbox|${MailServer};@user;${NotificationEmailPassword}|
|Verify_Contain_OR_alnum|$res;;Messages deleted                                       |


!| scenario        |Request Session |systemName|         |accountName| |userName|
|Logout                                                                         |
|Login             |${TPAMURL}      |          |@userName|           |${UserPwd}|
|pause             |20000                                                       |
|clickAndWait      |link=Add Session Request                                    |
|type;             |id=SystemNm     |@systemName                                |
|type;             |id=AccountNm    |@accountName                               |
|click             |id=Accounts     |                                           |
|click             |//input[@type='checkbox']                                   |
|click             |id=Details                                                  |
|type;             |id=RequestReason|session request reason                     |
|typeKeys;         |id=RequestReason|a                                          |
|click             |id=SubmitChanges                                            |
|waitForTextPresent|successfully                                                |
|$res=             |getText         |//div[@id='ResultsScrollDiv']              |


!|scenario            |Set Affinity                                                                                    |
|Get DPA Name                                                                                                          |
|Login                |${TPAMURL}                                                         ||${TPAMAdmin}||${DefaultPwd}|
|pause                |20000                                                                                           |
|Choose system        |${SystemName}                                                                                   |
|click                |id=Affinity                                                                                     |
|waitForElementPresent|id=rbEGPAffinitySelected                                                                        |
|click                |id=rbEGPAffinitySelected                                                                        |
|type;                |//table[@id='tblEGPDPAAffinity']//td[text()='$DPAName']/../td/input|1                           |
|waitForElementPresent|id=rbPARAffinitySelected                                                                        |
|click                |id=rbPARAffinitySelected                                                                        |
|type;                |//table[@id='tblPARDPAAffinity']//input                            |1                           |
|click                |id=bt_Save                                                                                      |
|waitForTextPresent   |System changes for * saved successfully                                                         |


!|scenario            |Choose system                                       |
|clickAndWait         |link=Manage Systems                                 |
|pause                |5000                                                |
|waitForElementPresent|id=SystemNm                                         |
|type;                |id=SystemNm                           |${SystemName}|
|click                |id=Listing                                          |
|waitForElementPresent|//td[contains(text(),'${SystemName}')]              |
|mouseDown            |//td[contains(text(),'${SystemName}')]|             |
|click                |//td[contains(text(),'${SystemName}')]|             |



!|scenario            |Get DPA Name                                                    |
|Login                |${TPAMURL}|       |${TPAMAdmin}      |      |${DefaultPwd}      |
|pause                |6000                                                            |
|clickAndWait         |link=DPAs                                                       |
|pause                |3000                                                            |
|waitForElementPresent|//table[@id='serversTable']//td[text()='Up']                    |
|$DPAName=            |getText   |//table[@id='serversTable']//td[text()='Up']/../td[1]|
|Verify_Contain_OR    |$DPAName;;DPA                                                   |

