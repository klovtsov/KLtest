!* Test Description
When you create a template you can choose check or do not check "Retain Collection Membership in the template" checkbox.
In first case the template will have the sane Collection Membership defined on system. 
*!

!define CollectionName {${prefix}VXtmpl}
!define collDescription {"Test collection"}

!define newSystemAddress {10.30.45.65}

!include -c <AutomatedTesting.AccountDiscovery.ScenarioLibrary
!include -c <AutomatedTesting.PowerShellNetApiScenarios.ScenarioLibrary
!include -c <PropagateOptionsFromTemplate.ScenarioLibrary

!*> Prepare
!|script                                                                                                                                                  |
|Add system    |${SystemName}|with address |${SystemAddress}|platform|${SystemPlatform}|managed by|${FunctAcct}|additional parameters|-description "Asert"|
|Add Collection|${CollectionName}                                                                                                                         |
|Add System    |${SystemName}|to collection|${CollectionName}                                                                                             |
*!

!2 ""Retain Collection Membership in the template" is checked.

!4 Create system, make template from system and create system from template
!|script                                                                                                                                                                                               |
|Make System Template|${TemplateName} |from           |${SystemName}                                                         |with account|${FunctAcct}|retain permissions|false|retain membership|true|
|Try to Add system   |${newSystemName}|with parameters|-systemAddress ${newSystemAddress} -templateSystemName ${TemplateName}|with result |System changes for ${newSystemName} saved successfully      |
|pause               |${ApplyNewPoliciesInterval}                                                                                                                                                      |

!4 Check collection membership for a new system.
!|script                                                                                                                    |
|List Collection Membership by filter|-collection ${CollectionName}|and result contains|${CollectionName}\s+${newSystemName}|

!4 Delete template and system that has been created from template
!|script                                              |
|Delete System|${newSystemName}                       |
|Open         |${TPAMURL}||${TPAMAdmin}||${DefaultPwd}|
|Remove system|${TemplateName}                        |


!2 ""Retain Collection Membership in the template" is unchecked.
!4 Create system, make template from system and create system from template
!|script                                                                                                                                                                                                |
|Make System Template|${TemplateName} |from           |${SystemName}                                                         |with account|${FunctAcct}|retain permissions|false|retain membership|false|
|Try to Add system   |${newSystemName}|with parameters|-systemAddress ${newSystemAddress} -templateSystemName ${TemplateName}|with result |System changes for ${newSystemName} saved successfully       |
|pause               |${ApplyNewPoliciesInterval}                                                                                                                                                       |

!4 Check collection membership for a new system.
!|script                                                                                                        |
|List Collection Membership by filter|-collection ${CollectionName}|and result does not contain|${newSystemName}|

!2 Clean up
!|script                            |
|Delete Collection|${CollectionName}|

