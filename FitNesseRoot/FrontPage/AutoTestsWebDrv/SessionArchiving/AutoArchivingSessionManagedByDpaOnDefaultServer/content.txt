!include -c <AutoTestsWebDrv.PsmSmokeTest.ScenarioLibrary
!include -c ScenarioLibrary

!* Prepare Environment (Given)
!|script                                                            |
|Make archive server as default|${ArchiveServerName}                |
|Set DPA to use archive server |default      |use for replay|y      |
|Set PSM Affinity              |${SystemName}|Local Server  |2|DPA|1|
*!

!* Make request and open session (When)
!|script                   |
|Request Session           |
|Open automatic ssh session|
|Cancel psm request        |
*!

!* Check session archive (Then)
!|script                                                                                                                               |
|Check Session Log for|$RequestID|ArchiveServer|${ArchiveServerName}     |Server Path     |./${ArchiveFolder}    |Duration    |0:00    |
|Get File Name from Archive Server Log                                                                                                 |
|Check DPA log for    |DPA       |contains     |RequestID: $RequestID automatically archived to ${ArchiveServerName}:./${ArchiveFolder}|
|Check files on server                                                                                                                 |
*!

!* Clean Up
!|script                                               |
|Set DPA to don't archive sessions                     |
|Make archive server as nondefault|${ArchiveServerName}|
*!
