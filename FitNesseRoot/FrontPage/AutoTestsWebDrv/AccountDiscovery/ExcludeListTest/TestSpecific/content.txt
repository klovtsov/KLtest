!define ProfileName {${prefix}ELTAccDiscProfile5}

!|scenario       |Create Template                                                        |
|Add system                                                                              |
|Set Connection Tab                                                                      |
|Set FuncAccEMail|${FuncAccEMail}                                                        |
|Add account     |${AutoDiscoveryAccount2}|with password|${AutoDiscoveryAccountPassword1}|
|Choose System   |${SystemName}                                                          |
|Set Template                                                                            |


!|scenario|Account Discovery                      |
|Open     |${TPAMURL}||${TPAMAdmin}||${DefaultPwd}|
|Create Environment                               |
|New Account Action                               |
|Delete Environment                               |


!|scenario               |Create Environment      |
|Create Account on System|${matchacc}             |
|Create Account on System|${ManagedAccount1}      |
|Create Account on System|${AutoDiscoveryAccount3}|
|Create Template                                  |
|Create Account Discovery Profile                 |

!|scenario                    |Create Account Discovery Profile                                                                                                                                                                    |
|clickOnLink                  |link=Profile Management                                                                                                                                                                             |
|select;                      |id=ProfileType  |label=Account Discovery                                                                                                                                                            |
|waitForElementPresent        |id=NewButton    |                                                                                                                                                                                   |
|click                        |id=NewButton                                                                                                                                                                                        |
|type;                        |id=ProfileName  |${ProfileName}                                                                                                                                                                     |
|type;                        |id=Description  |Description                                                                                                                                                                        |
|Set Delete Account properties|Notify via Email||${DeleteAccountDiscoveryEmail1},:System:,:Functional:                                                                                                                             |
|Add Detail                   |0               ||Notify via Email||${TemplateName}/${AutoDiscoveryAccount2}||${NewAccountDiscoveryEmail1},:System:,:Functional:||||||${AutoDiscoveryAccount1},${AutoDiscoveryAccount3},root|||||||||
|click                        |id=SaveButton                                                                                                                                                                                       |
|waitForTextPresent           |The profile saved successfully                                                                                                                                                                      |

!|scenario                         |New Account Action                                                      |
|Remove account                    |${AutoDiscoveryAccount2}                                                |
|Set AccDiscovery profile to System|${ProfileName}             |               |${SystemName}               |
|pause                             |5000                                                                    |
|type;                             |id=AutoDiscoveryExcludeList|${matchacc}                                 |
|pause                             |5000                                                                    |
|click                             |id=bt_Save                                                              |
|waitForTextPresent                |System changes for * saved successfully                                 |
|pause                             |5000                                                                    |
|Run AccDiscovery                                                                                           |
|click                             |className=ActionExclude                                                 |
|pause                             |10000                                                                   |
|click                             |id=btnProcessDiscoveryActions                                           |
|pause                             |10000                                                                   |
|getConfirmation                                                                                            |
|waitForTextPresent                |Account processed successfully                                          |
|click                             |id=Profile                                                              |
|click                             |id=DiscoveredAccounts                                                   |
|pause                             |10000                                                                   |
|click                             |className=ActionExclude                                                 |
|pause                             |10000                                                                   |
|click                             |id=btnProcessDiscoveryActions                                           |
|pause                             |10000                                                                   |
|getConfirmation                                                                                            |
|waitForTextPresent                |Account processed successfully                                          |
|click                             |id=Profile                                                              |
|Run AccDiscovery                                                                                           |
|$res=                             |getText                    |xpath=//table[@id='DiscoveryStagingListing']|
|Verify_Contain_NOT                |$res;;${AutoDiscoveryAccount1}                                          |
|$res=                             |getText                    |xpath=//table[@id='DiscoveryStagingListing']|
|Verify_Contain_NOT                |$res;;${AutoDiscoveryAccount3}                                          |
|$res=                             |getText                    |xpath=//table[@id='DiscoveryStagingListing']|
|Verify_Contain_OR                 |$res;;root                                                              |

!|scenario                         |Delete Environment                                  |
|Set AccDiscovery profile to System|No Account Discovery Profile selected||${SystemName}|
|Remove system                     |${SystemName}                                       |
|Delete Account Discovery Profile  |${ProfileName}                                      |
|Remove system                     |${TemplateName}                                     |
|Delete Account on System          |${ManagedAccount1}                                  |
|Delete Account on System          |${AutoDiscoveryAccount3}                            |
|Delete Account on System          |${matchacc}                                         |



!|scenario|Add Detail                  |Index||NewAccountAction||TemplateAccount||EmailAddresses||UID||SID||Name||Group||Role||Task||Service|
|click    |id=btnAddRow                                                                                                                     |
|select;  |className=autoNewAction     |label=@NewAccountAction                                                                             |
|select;  |className=autoAcctTemplate  |label=@TemplateAccount                                                                              |
|type;    |className=autoEmailAddresses|@EmailAddresses                                                                                     |
|type;    |className=autoUIDFilter     |@UID                                                                                                |
|type;    |className=autoNameFilter    |@Name                                                                                               |
|type;    |className=autoGroupFilter   |@Group                                                                                              |

