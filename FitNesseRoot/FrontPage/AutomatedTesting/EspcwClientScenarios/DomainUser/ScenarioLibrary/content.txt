!|scenario|Create Domain Account|
|Create Account on System       |

!|scenario  |Add Domain Controller                                                                                                                                                                                                                               |
|CLI        |${CLIBatch} AddSystem --SystemName ${SystemName} --NetworkAddress ${SystemAddress} --PlatformName \"${SystemPlatform}\" --DomainName ${DomainName} --NetBiosName ${NETBIOSDomainName} --FunctionalAccount ${ParFunctAcct} --Timeout ${SystemTimeout}|
|Test System|${TestSystemSuccessful}                                                                                                                                                                                                                             |

!|scenario        |Add Domain Member                                                                                                                                                                               |
|$res=            |CLI|${CLIBatch} AddSystem --SystemName ${DMSystemName} --NetworkAddress ${DMSystemAddress} --PlatformName \"${DMSystemPlatform}\" --FunctionalAccount ${ParFunctAcct} --Timeout ${SystemTimeout}|
|Verify_Contain_OR|$res;;successful                                                                                                                                                                                |

!|scenario        |Assign|System                       |as dependent from                       |Account                       |
|$res=            |CLI   |${CLIBatch} UpdateDependentSystems --SystemName ${SystemName} --AccountName @Account --Assign @System|
|Verify_Contain_OR|$res;;successful                                                                                            |

!|scenario        |Unassign|System                        |as dependent from                        |Account                       |
|$res=            |CLI     |${CLIBatch} UpdateDependentSystems --SystemName ${SystemName} --AccountName @Account --Unassign @System|
|Verify_Contain_OR|$res;;successful                                                                                                |

!|scenario|Uncheck Checkbox                  |checkboxname                  |for user                  |user                  |
|runBatch |ChangeSPCWSetting.bat;${FunctAcct};"${FunctAcctPwd}";${DMSystemAddress};@checkboxname;N;${ClientSettingsPath};@user|

!|scenario|Check Checkbox                   |checkboxname                   |for user                  |user                  |
|runBatch |ChangeSPCWSetting.bat;${FunctAcct};"${FunctAcctPwd}";${DMSystemAddress};@checkboxname;Y;${ClientSettingsPath};@user|

!|scenario|Uncheck Checkbox on DC                      |checkboxname                     |for user                     |user                     |
|runBatch |ChangeSPCWSetting.bat;${NETBIOSDomainName}\${FunctAcct};"${FunctAcctPwd}";${SystemAddress};@checkboxname;N;${ClientSettingsPath};@user|

!|scenario|Check Checkbox on DC                      |checkboxname                      |for user                      |user                     |
|runBatch |ChangeSPCWSetting.bat;${NETBIOSDomainName}\${FunctAcct};"${FunctAcctPwd}";${SystemAddress};@checkboxname;Y;${ClientSettingsPath};@user|

!|scenario                        |Attempt to change password                         |
|Check Checkbox on DC             |useoldpass       |for user|DEFAULT                 |
|Change Account Password on System|${ManagedAccountPwdNew}                            |
|Check Password                   |${ManagedAccount}|        |${CheckPasswordNotMatch}|
|pause                            |5000                                               |
|Uncheck Checkbox on DC           |useoldpass       |for user|DEFAULT                 |

!|scenario        |ClearClientLogFile on                                          |System                                          |
|RunBatchGetOutput|eSPCWtestexes\DeleteLogFile.bat;@System;${ClientInstallationDrive};${FunctAcct};${FunctAcctPwd};${ClientLogPath}|

!|scenario        |ClientLogFileContains|Message                                   |on                                  |System                                  |
|$res=            |RunBatchGetOutput    |eSPCWtestexes\CheckLogFile.bat;@System;${ClientInstallationDrive};${FunctAcct};${FunctAcctPwd};${ClientLogPath};@Message|
|Verify_Contain_OR|$res;;ExitCode 0                                                                                                                              |

!|scenario        |ClientLogFileDoesnotContains|Message                          |on                          |System                         |                         |
|$res=            |RunBatchGetOutput           |eSPCWtestexes\CheckLogFile.bat;@System;${ClientInstallationDrive};${FunctAcct};${FunctAcctPwd};${ClientLogPath};@Message|
|Verify_Contain_OR|$res;;ExitCode 1                                                                                                                                     |

!|scenario         |Set Dependent System Affinity|affinity                                                                          |
|$res=             |GroovyWebDriver              |manageDpaAffinity;${TPAMHost};${TPAMAdmin};${DefaultPwd};${DMSystemName};@affinity|
|Verify_Contain_NOT|$res;;something went wrong;;trouble to find element                                                             |
|Verify_Contain_OR |$res;;Successfully                                                                                              |

!|scenario        |Check dependent password change                                                                                       |
|$res=            |GroovyWebDriver|managePasswords;${TPAMHost};${TPAMAdmin};${DefaultPwd};DependentChangeLog;${SystemName};${ManagedAccount};${DMSystemName}|
|Verify_Contain_OR|$res;;Success                                                                                                         |
