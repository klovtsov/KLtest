!| scenario                            |Prepare Environment                                         |
|Add File To Collection                |${SystemName}               ||${FileName}  | |${Collection} |
|Add User To Group                     |${GlobalGroupApprover}      ||\"Global PPM Approver Group\" |
|Add User To Group                     |${GlobalGroupRequestor}     ||\"Global PPM Requestor Group\"|
|Set Group Permissions File Level      |${GroupFileRequestors}      ||\"PPM Requestor\"             |
|Set Group Permissions File Level      |${GroupFileApprovers}       ||\"${FileApproverPolicy}\"     |
|Set Group Permissions Collection Level|${GroupCollectionRequestors}||\"PPM Requestor\"             |
|Set Group Permissions Collection Level|${GroupCollectionApprovers} ||\"${FileApproverPolicy}\"     |
|Set Group Permissions System Level    |${GroupSystemRequestors}    ||\"PPM Requestor\"             |
|Set Group Permissions System Level    |${GroupSystemApprovers}     ||\"${FileApproverPolicy}\"     |
|Set User Permissions File Level       |${UserFileRequestor}        ||\"PPM Requestor\"             |
|Set User Permissions File Level       |${UserFileApprover}         ||\"${FileApproverPolicy}\"     |
|Set User Permissions File Level       |${TPAMAdmin}                ||\"ISA\"                       |
|Set User Permissions Collection Level |${UserCollectionRequestor}  ||\"PPM Requestor\"             |
|Set User Permissions Collection Level |${UserCollectionApprover}   ||\"${FileApproverPolicy}\"     |
|Set User Permissions System Level     |${UserSystemRequestor}      ||\"PPM Requestor\"             |
|Set User Permissions System Level     |${UserSystemApprover}       ||\"${FileApproverPolicy}\"     |
|pause               |${ApplyNewPoliciesInterval} |


!|scenario                             |Clear Environment                                           |
|Remove Group Permissions On File      |${GroupFileRequestors}      ||\"PPM Requestor\"             |
|Remove Group Permissions On File      |${GroupFileApprovers}       ||\"${FileApproverPolicy}\"     |
|Remove Group Permissions On Collection|${GroupCollectionRequestors}||\"PPM Requestor\"             |
|Remove Group Permissions On Collection|${GroupCollectionApprovers} ||\"${FileApproverPolicy}\"     |
|Remove Group Permissions On System    |${GroupSystemRequestors}    ||\"PPM Requestor\"             |
|Remove Group Permissions On System    |${GroupSystemApprovers}     ||\"${FileApproverPolicy}\"     |
|Remove User Permissions On File       |${UserFileRequestor}        ||\"PPM Requestor\"             |
|Remove User Permissions On File       |${UserFileApprover}         ||\"${FileApproverPolicy}\"     |
|Remove User Permissions On File       |${TPAMAdmin}                ||\"ISA\"                       |
|Remove User Permissions On Collection |${UserCollectionRequestor}  ||\"PPM Requestor\"             |
|Remove User Permissions On Collection |${UserCollectionApprover}   ||\"${FileApproverPolicy}\"     |
|Remove User Permissions On System     |${UserSystemRequestor}      ||\"PPM Requestor\"             |
|Remove User Permissions On System     |${UserSystemApprover}       ||\"${FileApproverPolicy}\"     |
|Remove User From Group                |${GlobalGroupApprover}      ||\"Global PPM Approver Group\" |
|Remove User From Group                |${GlobalGroupRequestor}     ||\"Global PPM Requestor Group\"|
|Remove File From Collection           |${SystemName}               ||${FileName}  | |${Collection} |

!|scenario                  |File Notifications           |Requestor|           |Approver   |
|$Requestor=                |getEval                      |"@Requestor"                     |
|$Approver=                 |getEval                      |"@Approver"                      |
|Request File               |${SystemName}                |         |${FileName}||$Requestor|
|Approve File               |$Approver                                                      |
|pause                      |360000                                                         |
|Check Mail                 |$Requestor@${TPAMEMailDomain}|         |${FRRN}    ||A request ( #$RequestID) to release the contents of file ${FileName} on System ${SystemName} was submitted by $Requestor|
|Check Mail                 |$Requestor@${TPAMEMailDomain}|         |${FRRRN}   ||Request #$RequestID to release the contents of file ${FileName} on System ${SystemName} has been Approved by $Approver|
|Delete Mails               |$Requestor@${TPAMEMailDomain}                                  |
|Check Mail                 |${SystemEscalationEMail}     |         |${FRRN}    ||A request ( #$RequestID) to release the contents of file ${FileName} on System ${SystemName} was submitted by $Requestor|
|Delete Mails               |${SystemEscalationEMail}                                       |
|Check Approvers Mailboxes  |${FRRN}                      |         |A request ( #$RequestID) to release the contents of file ${FileName} on System ${SystemName} was submitted by $Requestor|
|Check Approvers Mailboxes  |${FRRRN}                     |         |Request #$RequestID to release the contents of file ${FileName} on System ${SystemName} has been Approved by $Approver|
|Clear Approvers Mailboxes                                                                  |
|Check All Mailboxes No Mail|${FRRN}                      |         |$RequestID             |
|Check All Mailboxes No Mail|${FRRRN}                     |         |$RequestID             |
|Cancel File Request        |$Requestor                                                     |



!|scenario                  |File Request(overdue)                                                     |
|Request File               |${SystemName}                          ||${FileName}||${UserFileRequestor}|
|pause                      |600000                                                                    |
|Check Mail                 |${SystemEscalationEMail}               ||${FRRN}    ||${FRRNb}            |
|Delete Mails               |${SystemEscalationEMail}                                                  |
|Check Mail                 |${UserFileRequestor}@${TPAMEMailDomain}||${FRRN}    ||${FRRNb}            |
|Delete Mails               |${UserFileRequestor}@${TPAMEMailDomain}                                   |
|Check Approvers Mailboxes  |${FRRN}                                ||${FRRNb}                         |
|Clear Approvers Mailboxes                                                                             |
|Check All Mailboxes No Mail|${FRRN}                                ||${FRRNb}                         |
|Cancel File Request        |${UserFileRequestor}                                                      |



!| scenario           |Cancel File Request|Requestor              |
|Login                |${TPAMURL}         ||@Requestor||${UserPwd}|
|pause                |5000                                       |
|click                |id=CurrentRequests                         |
|waitForElementPresent|link=File(${FileName})                     |
|clickAndWait         |link=File(${FileName})                     |
|waitForElementPresent|//td[contains(text(),'${FileName}')]       |
|mouseDown            |//td[contains(text(),'${FileName}')]       |
|click                |//td[contains(text(),'${FileName}')]       |
|click                |id=Details                                 |
|pause                |10000                                      |
|type;                |id=ResponseComment |cancel                 |
|typeKeys;            |id=ResponseComment |aaa                    |
|click                |id=SubmitChanges                           |
|waitForTextPresent   |*The response *was submitted successfully* |
#|Logout                                                         |


############## Manage File #####################

!|scenario   |Check All Approvers Mails                                          |
|Check Mail  |${UserSystemApprover}@${TPAMEMailDomain}     ||${FRRN} ||$RequestID|
|Check Mail  |${UserSystemApprover}@${TPAMEMailDomain}     ||${FRRRN}||$RequestID|
|Check Mail  |${UserFileApprover}@${TPAMEMailDomain}       ||${FRRN} ||$RequestID|
|Check Mail  |${UserFileApprover}@${TPAMEMailDomain}       ||${FRRRN}||$RequestID|
|Check Mail  |${UserCollectionApprover}@${TPAMEMailDomain} ||${FRRN} ||$RequestID|
|Check Mail  |${UserCollectionApprover}@${TPAMEMailDomain} ||${FRRRN}||$RequestID|
|Check Mail  |${GroupSystemApprover}@${TPAMEMailDomain}    ||${FRRN} ||$RequestID|
|Check Mail  |${GroupSystemApprover}@${TPAMEMailDomain}    ||${FRRRN}||$RequestID|
|Check Mail  |${GlobalGroupApprover}@${TPAMEMailDomain}    ||${FRRN} ||$RequestID|
|Check Mail  |${GlobalGroupApprover}@${TPAMEMailDomain}    ||${FRRRN}||$RequestID|
|Check Mail  |${GroupCollectionApprover}@${TPAMEMailDomain}||${FRRN} ||$RequestID|
|Check Mail  |${GroupCollectionApprover}@${TPAMEMailDomain}||${FRRRN}||$RequestID|
|Check Mail  |${GroupFileApprover}@${TPAMEMailDomain}      ||${FRRN} ||$RequestID|
|Check Mail  |${GroupFileApprover}@${TPAMEMailDomain}      ||${FRRRN}||$RequestID|
|Delete Mails|${UserFileApprover}@${TPAMEMailDomain}                             |
|Delete Mails|${UserSystemApprover}@${TPAMEMailDomain}                           |
|Delete Mails|${UserCollectionApprover}@${TPAMEMailDomain}                       |
|Delete Mails|${GroupSystemApprover}@${TPAMEMailDomain}                          |
|Delete Mails|${GlobalGroupApprover}@${TPAMEMailDomain}                          |
|Delete Mails|${GroupCollectionApprover}@${TPAMEMailDomain}                      |
|Delete Mails|${GroupFileApprover}@${TPAMEMailDomain}                            |

!|scenario                  |Manage File and Check Results|Requestor|           |Approver   |
|Request File               |${SystemName}                |         |${FileName}||@Requestor|
|Approve File               |@Approver                                                      |
|pause                      |120000                                                         |
|Check Mail                 |@Requestor@${TPAMEMailDomain}|         |${FRRN}    ||A request ( #$RequestID) to release the contents of file ${FileName} on System ${SystemName} was submitted by @Requestor  |
|Check Mail                 |@Requestor@${TPAMEMailDomain}|         |${FRRRN}   ||Request #$RequestID to release the contents of file ${FileName} on System ${SystemName} has been Approved by @Approver |
|Delete Mails               |@Requestor@${TPAMEMailDomain}|         |${TPAMEMailPassword}   |
|Check Approvers Mailboxes  |${FRRN}                      |         |A request ( #$RequestID) to release the contents of file ${FileName} on System ${SystemName} was submitted by @Requestor               |
|Check Approvers Mailboxes  |${FRRRN}                     |         |Request #$RequestID to release the contents of file ${FileName} on System ${SystemName} has been Approved by @Approver              |
|Clear Approvers Mailboxes                                                                  |
|Check All Mailboxes No Mail|${FRRN}                      |         |${FRRNb}               |
|Check All Mailboxes No Mail|${FRRRN}                     |         |${FRRRNb}              |
|Cancel File Request        |@Requestor                                                     |

!|scenario                  |Manage Current File                  |
|Current File                                                     |
|pause                      |200000                               |
|Check Mail                 |${FileEmailAddr}||${SPFRN}||The contents of ${FileName} on ${SystemName} was retrieved without dual control by ${TPAMAdmin}|
|Delete Mails               |${FileEmailAddr}                     |
|Check All Mailboxes No Mail|${SPFRN}        ||${SPFRNb}          |

!|scenario                    |Manage File                              |
|Manage File and Check Results|${UserFileRequestor}||${UserFileApprover}|
|Manage Current File                                                    |


!|scenario            |Current File                                     |
|Login                |${TPAMURL}          ||${TPAMAdmin}||${DefaultPwd}|
|pause                |20000                                            |
|clickAndWait         |link=Manage Files                                |
|waitForElementPresent|id=FileNm                                        |
|type;                |id=FileNm           |${FileName}                 |
|click                |id=Listing                                       |
|waitForElementPresent|//td[contains(text(),'${FileName}')]             |
|mouseDown            |//td[contains(text(),'${FileName}')]             |
|click                |//td[contains(text(),'${FileName}')]             |
|click                |id=CurrentFile                                   |
|waitForElementPresent|id=ReleaseReasonText                             |
|type;                |id=ReleaseReasonText|ReleaseReasonText           |
|typeKeys;            |id=ReleaseReasonText|ReleaseReasonText           |
|pause                |15000                                            |
|click                |id=RetrieveCurrent                               |
|pause                |35000                                            |
|Logout                                                                 |
|pause                |35000                                            |

!|scenario        |Set User Permissions File Level|userName                                         |                                         |userPermission                                        |
|$res=            |CLI                            |${CLIBatch} SetAccessPolicy --AccessPolicyName @userPermission --Action ADD --SystemName ${SystemName} --FileName ${FileName} --UserName @userName|
|Verify_Contain_OR|$res;;successful                                                                                                                                                                  |

!|scenario        |Remove User Permissions On File|userName                                         |                                         |userPermission                                         |
|$res=            |CLI                            |${CLIBatch} SetAccessPolicy --AccessPolicyName @userPermission --Action DROP --SystemName ${SystemName} --FileName ${FileName} --UserName @userName|
|Verify_Contain_OR|$res;;successful                                                                                                                                                                   |

!|scenario        |Set Group Permissions File Level|GroupName                                         |                                         |userPermission                                         |
|$res=            |CLI                             |${CLIBatch} SetAccessPolicy --AccessPolicyName @userPermission --Action ADD --SystemName ${SystemName} --FileName ${FileName} --GroupName @GroupName|
|Verify_Contain_OR|$res;;successful                                                                                                                                                                     |

!|scenario        |Remove Group Permissions On File|GroupName                                          |                                         |userPermission                                         |
|$res=            |CLI                             |${CLIBatch} SetAccessPolicy --AccessPolicyName @userPermission --Action DROP --SystemName ${SystemName} --FileName ${FileName} --GroupName @GroupName|
|Verify_Contain_OR|$res;;successful                                                                                                                                                                      |

!| scenario           |Request File    |SystemName                       |                                 |FileName                      |                      |Requestor                      |
|Login                |${TPAMURL}      |                                 |@Requestor                       |                              |${UserPwd}                                            |
|pause                |10000                                                                                                                                                                     |
|clickAndWait         |link=Add File Request                                                                                                                                                     |
|type;                |id=SystemNm     |@SystemName                                                                                                                                              |
|type;                |id=FileNm       |@FileName                                                                                                                                                |
|click                |id=Files                                                                                                                                                                  |
|waitForElementPresent|//td[contains(text(),'@FileName')]                                                                                                                                        |
|mouseDown            |//td[contains(text(),'@FileName')]                                                                                                                                        |
|click                |//td[contains(text(),'@FileName')]                                                                                                                                        |
|click                |id=Details                                                                                                                                                                |
|pause                |15000                                                                                                                                                                     |
|type;                |id=RequestReason|file request reason                                                                                                                                      |
|typeKeys;            |id=RequestReason|aaa                                                                                                                                                      |
|click                |id=SubmitChanges                                                                                                                                                          |
|waitForTextPresent   |*Request*has been submitted.*                                                                                                                                             |
|$res=                |getText         |//div[@id='ResultsDiv']                                                                                                                                  |
|$RequestID=          |getEval         |var rstr = "Request number ";var i1 = "$res".indexOf(rstr);var i2 = "$res".substring(i1 + rstr.length);var i3 = i2.indexOf(" ");i4 = i2.substring (0,i3);|
|Logout                                                                                                                                                                                          |

!| scenario           |Approve File       |Approver              |
|Login                |${TPAMURL}         ||@Approver||${UserPwd}|
|pause                |10000                                     |
|clickAndWait         |link=File Requests Pending Approval       |
|waitForElementPresent|//td[contains(text(),'${FileName}')]      |
|mouseDown            |//td[contains(text(),'${FileName}')]      |
|click                |//td[contains(text(),'${FileName}')]      |
|click                |id=Details                                |
|pause                |15000                                     |
|type;                |id=ResponseComment |ok to approve         |
|typeKeys;            |id=ResponseComment |aaa                   |
|click                |id=ApproveReq                             |
|waitForTextPresent   |*The response *was submitted successfully*|
#|Logout                                                         |


!|scenario        |Add File To Collection|SystemName               |               |FileName               |               |CollectionName              |
|$res=            |CLI                   |${CLIBatch} AddCollectionMember --FileName=@FileName --SystemName=@SystemName --CollectionName=@CollectionName|
|Verify_Contain_OR|$res;;successful                                                                                                                     |


!|scenario        |Remove File From Collection|SystemName               |               |FileName               |               |CollectionName               |
|$res=            |CLI                        |${CLIBatch} DropCollectionMember --FileName=@FileName --SystemName=@SystemName --CollectionName=@CollectionName|
|Verify_Contain_OR|$res;;successful                                                                                                                           |


!|scenario            |Add account                           |accountName|with password|accPwd|
|clickAndWait         |link=Add Account                      |                                |
|type;                |id=SystemNm                           |${SystemName}                   |
|click                |id=System                             |                                |
|waitForElementPresent|//td[contains(text(),'${SystemName}')]|                                |
|mouseDown            |//td[contains(text(),'${SystemName}')]|                                |
|click                |//td[contains(text(),'${SystemName}')]|                                |
|Set password         |@accountName                          |           |@accPwd             |
|Set description      |${ManagedAccountDescription}          |                                |
|Set reviews                                                                                  |
|Set PSM Details For Account                                                                  |

!|scenario            |Choose Account                                          |accountName  |
|clickAndWait         |link=Manage Accounts                                    |             |
|waitForElementPresent|id=SystemNm                                             |             |
|type;                |id=SystemNm                                             |${SystemName}|
|click                |id=Listing                                              |             |
|waitForElementPresent|//table[@id='AccountListing']//td[text()='@accountName']|             |
|mouseDown            |//table[@id='AccountListing']//td[text()='@accountName']|             |
|click                |//table[@id='AccountListing']//td[text()='@accountName']|             |

!|scenario         |Set password           |accountName||accPwd|
|click             |id=Details             |                   |
|type;             |id=AccountName         |@accountName       |
|type;             |id=sPswd               |@accPwd            |
|type;             |id=sConfPswd           |@accPwd            |
|type;             |id=MinApprovers        |${ApproversCount}  |
|type;             |id=RelNotifyEmail      |${AccountEMail}    |
|click             |id=SubmitChangesButton |                   |
|waitForTextPresent|Changes saved successfully for @accountName|


!| scenario|Check Approvers Mailboxes      |subject|        |body  |
|Check Mail|${UserFileApproverEMail}       |       |@subject||@body|
|Check Mail|${UserSystemApproverEMail}     |       |@subject||@body|
|Check Mail|${UserCollectionApproverEMail} |       |@subject||@body|
|Check Mail|${GroupFileApproverEMail}      |       |@subject||@body|
|Check Mail|${GroupSystemApproverEMail}    |       |@subject||@body|
|Check Mail|${GroupCollectionApproverEMail}|       |@subject||@body|
|Check Mail|${GlobalGroupApproverEMail}    |       |@subject||@body|

!| scenario  |Clear Approvers Mailboxes      |
|Delete Mails|${UserFileApproverEMail}       |
|Delete Mails|${UserSystemApproverEMail}     |
|Delete Mails|${UserCollectionApproverEMail} |
|Delete Mails|${GroupFileApproverEMail}      |
|Delete Mails|${GroupSystemApproverEMail     |
|Delete Mails|${GroupCollectionApproverEMail}|
|Delete Mails|${GlobalGroupApproverEMail}    |

