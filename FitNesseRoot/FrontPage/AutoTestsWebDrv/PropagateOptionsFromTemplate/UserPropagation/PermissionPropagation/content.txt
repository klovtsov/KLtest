!define SystemName {${prefix}TS}
!define AccntName {${prefix}Manaco}
!define PolicyOnSystem {Approver}
!define PolicyOnAccnt {Requestor}
!include -c <AutoTestsWebDrv.PowerShellNetApiScenarios.ScenarioLibrary
!include -c <PropagateOptionsFromTemplate.ScenarioLibrary

!4 Create example system with account, user and set user permissions
!|script                                                                                                                                          |
|Add system     |${SystemName}    |with address|4.3.2.1      |platform    |Linux        |managed by|master|additional parameters|-description test|
|Add account    |${AccntName}     |on system   |${SystemName}|with options|-description tak                                                       |
|Add User       |${TestUserName}                                                                                                                  |
|Set Permissions|${PolicyOnSystem}|on system   |${SystemName}|for user    |${TestUserName}                                                        |
|Set Permissions|${PolicyOnAccnt} |on  account |${AccntName} |from        |${SystemName}|for user  |${TestUserName}                               |
|pause          |${ApplyNewPoliciesInterval}                                                                                                      |

!3 "Retain Permissions in the template" is checked.
!4 Create user template.
!|script                                                                                                         |
|Make User Template|${TemplateName}|from         |${TestUserName}|retain permissions|true|retain membership|false|
|Create User       |${newUserName} |from template|${TemplateName}                                                |
|pause             |${ApplyNewPoliciesInterval}                                                                  |

!4 Check new user properties
!|script                                                                                                               |
|List Policies by filter|-systemName ${SystemName} -userName ${newUserName}|contains|${newUserName}\s+${PolicyOnSystem}|
|List Policies by filter|-accountName ${AccntName} -userName ${newUserName}|contains|${newUserName}\s+${PolicyOnAccnt} |

!4 Delete new user and template.
!|script                             |
|Delete User         |${newUserName} |
|Delete User Template|${TemplateName}|

!3 "Retain Permissions in the template" is unchecked.
!4 Create user template.
!|script                                                                                                          |
|Make User Template|${TemplateName}|from         |${TestUserName}|retain permissions|false|retain membership|false|
|Create User       |${newUserName} |from template|${TemplateName}                                                 |
|pause             |${ApplyNewPoliciesInterval}                                                                   |

!4 Check new user properties
!|script                                                                                                       |
|List Policies by filter|-systemName ${SystemName} -userName ${newUserName}|does not contains|${PolicyOnSystem}|
|List Policies by filter|-accountName ${AccntName} -userName ${newUserName}|does not contains|${PolicyOnAccnt} |

!4 Delete system
!|script                    |
|Delete System|${SystemName}|
