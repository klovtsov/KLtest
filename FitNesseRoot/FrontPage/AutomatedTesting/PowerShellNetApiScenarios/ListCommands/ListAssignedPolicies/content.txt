!define CollectionName {${prefix}ABXV}
!define AnotherAccount {AliBaba}
!define testGroup {${prefix}listGroup}
!define collDescription {Collection for a list checking}
!define groupDescription {Group for a list checking}
!include -c <PowerShellNetApiScenarios.ScenarioLibrary

!3 Account system permissions
!|script                                                                                                                              |
|Add System                                                                                                                           |
|Add account            |${ManagedAccount}                                     |with password|${ManagedAccountPwdNew}                 |
|Set Permissions        |"PPM Requestor"                                       |on  account  |${ManagedAccount}|for user|${API_user_1}|
|Set Permissions        |"PPM Approver"                                        |on system    |${SystemName}    |for user|${API_user_2}|
|pause                  |${ApplyNewPoliciesInterval}                                                                                  |
|List Policies by filter|-accountName ${ManagedAccount} -userName ${API_user_1}|contains     |${API_user_1}.*PPM Requestor            |
|List Policies by filter|-AccessPolicyName "PPM Approver"                      |contains     |${API_user_2}.*${SystemName}            |
!3 Collections and groups

!|script                                                                                                                                                                          |
|Add Collection         |${CollectionName}                                                                                                                                        |
|Add account            |${AnotherAccount}                                                                |with password|${ManagedAccountPwdNew}                                  |
|Add Account            |${AnotherAccount}                                                                |from system  |${SystemName}       |to collection   |${CollectionName}  |
|Add Group              |${testGroup}                                                                                                                                             |
|Add Member             |${API_user_2}                                                                    |to group     |${testGroup}                                             |
|Set Permissions        |Requestor                                                                        |on collection|${CollectionName}   |for group       |${testGroup}       |
|pause                  |${ApplyNewPoliciesInterval}                                                                                                                              |
|List Policies by filter|-CollectionName ${CollectionName} -groupName ${testGroup}                        |contains     |${testGroup}.*Requestor.*                                |
|List Policies by filter|-CollectionName ${CollectionName} -groupName ${testGroup} -ExpandCollectionFlag 1|contains     |${testGroup}.*Requestor.*${SystemName}.*${AnotherAccount}|
|List Policies by filter|-CollectionName ${CollectionName} -ExpandGroupFlag 1                             |contains     |${API_user_2}.*${testGroup}.*Requestor                   |

!*> Clean Up
!|script                            |
|Delete Group     |${testGroup}     |
|Delete System    |${SystemName}    |
|Delete Collection|${CollectionName}|
*!