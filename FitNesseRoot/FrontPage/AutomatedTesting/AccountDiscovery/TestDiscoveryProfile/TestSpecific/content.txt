!|scenario|Account Discovery                      |
|Open     |${TPAMURL}||${TPAMAdmin}||${DefaultPwd}|
|Create Environment                               |
|Test Discovery Profile                           |
|Delete Environment                               |

!|scenario                         |Test Discovery Profile                                                                                                                                                                           |
|Set AccDiscovery profile to System|${ProfileName}                                      |                                                               |${SystemName}                                                               |
|$res=                             |GroovyWebDriver                                     |TestDiscovery;${TPAMHost};${TPAMAdmin};${DefaultPwd};${SystemName}                                                                          |
|Verify_Contain_OR                 |$res;;Ignored.*AATESTA1.*Account already exists on managed system                                                                                                                                |
|Verify_Contain_OR                 |$res;;Add.*AaTESTa2.*${prefix}_WindowsTemplate.*AATESTA1.*Both.*Notify.*Create.*${prefix}NewAccDisc.*tpam.spb.qsft.*${prefix}AccDiscSystem.*tpam.spb.qsft.*${prefix}AccDiscFuncAcc.*tpam.spb.qsft|
|Verify_Contain_OR                 |$res;;Add.*AaTESTa3.*${prefix}_WindowsTemplate.*AATESTA1.*Both.*Notify.*Create.*${prefix}NewAccDisc.*tpam.spb.qsft.*${prefix}AccDiscSystem.*tpam.spb.qsft.*${prefix}AccDiscFuncAcc.*tpam.spb.qsft|
|Verify_Contain_OR                 |$res;;Add.*AaTESTa4.*${prefix}_WindowsTemplate.*AATESTA1.*Both.*Notify.*Create.*${prefix}NewAccDisc.*tpam.spb.qsft.*${prefix}AccDiscSystem.*tpam.spb.qsft.*${prefix}AccDiscFuncAcc.*tpam.spb.qsft|
|Verify_Contain_OR                 |$res;;Add.*AaTiiTa5.*${prefix}_WindowsTemplate.*AATESTA1.*Both.*Notify.*Create.*${prefix}NewAccDisc.*tpam.spb.qsft.*${prefix}AccDiscSystem.*tpam.spb.qsft.*${prefix}AccDiscFuncAcc.*tpam.spb.qsft|
|Verify_Contain_OR                 |$res;;Ignored.*Admin2.*Account already exists on managed system                                                                                                                                  |
|Verify_Contain_OR                 |$res;;Ignored.*Guest.*Account is locked out or disabled.*Finished.                                                                                                                               |


!|scenario                       |Create Environment                                                                                                                              |
|Create Account on System        |${AutoDiscoveryAccount3}                                                                                                                        |
|pause                           |20000                                                                                                                                           |
|$uid=                           |RunBatchGetOutput       |getuid.bat;${AutoDiscoveryAccount3};${SystemAddress};${FunctAcct};${FunctAcctPwd};win                                  |
|Create Account on System        |${ServiceAccount}                                                                                                                               |
|Create Account on System        |${TaskAccount}                                                                                                                                  |
|Create Service which is run by  |.\${ServiceAccount}     |and run under password is|${ManagedAccountPwd}      |on                       |${SystemAddress}                        |
|Create Scheduled Task           |${TaskName}             |which is run under       |${HostName}\${TaskAccount}|and run under password is|${ManagedAccountPwd}|on|${SystemAddress}|
|Create Account on System        |${ManagedAccount1}                                                                                                                              |
|Create Group w Account on System|${AutoDiscoveryAccount2}|                         |${AutoDiscoveryGroup2}                                                                       |
|Create Template                                                                                                                                                                  |
|Create Account Discovery Profile                                                                                                                                                 |

!|scenario                         |Delete Environment                                             |
|Set AccDiscovery profile to System|No Account Discovery Profile selected|  |${SystemName}         |
|Remove system                     |${SystemName}                                                  |
|Delete Account Discovery Profile  |${ProfileName}                                                 |
|Remove system                     |${TemplateName}                                                |
|Delete Group w Account on System  |${AutoDiscoveryAccount2}             |  |${AutoDiscoveryGroup2}|
|Delete Scheduled Task             |${TaskName}                          |on|${SystemAddress}      |
|pause                             |60000                                                          |
|Delete Account on System          |${TaskAccount}                                                 |
|Delete Account on System          |${AutoDiscoveryAccount3}                                       |
|Delete Service on                 |${SystemAddress}                                               |
|pause                             |60000                                                          |
|Delete Account on System          |${ServiceAccount}                                              |
|Delete Account on System          |${ManagedAccount1}                                             |
