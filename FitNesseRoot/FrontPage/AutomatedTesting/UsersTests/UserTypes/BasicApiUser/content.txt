!*> Includes
!include -c <AutomatedTesting.UsersTests.ScenarioLibrary
!include -c <AutomatedTesting.UsersTests.UserTypes.ScenarioLibrary
*!


!*> Prepare
!|script                                                                                                                                                                    |
|Open                 |${TPAMURL}     ||${TPAMAdmin}                                                                                                         ||${DefaultPwd}|
|Add API User         |${BasicApiUser}||Basic                                                                                                                               |
|Add System           |${CLIBatch}    ||--SystemName ${SystemName2} --PlatformName ${PlatformName} --NetworkAddress ${NetworkAddress}                        ||successfully |
|Add Account          |${CLIBatch}    ||--SystemName ${SystemName2} --AccountName ${AccountName}2                                                            ||successfully |
|Add Group            |${CLIBatch}    ||--GroupName ${GroupName}2                                                                                            ||successfully |
|Add Collection       |${CLIBatch}    ||--CollectionName ${CollectionName}                                                                                   ||successfully |
|Add Collection member|${CLIBatch}    ||--CollectionName ${CollectionName} --SystemName ${SystemName2}                                                       ||successfully |
|Add User             |${CLIBatch}    ||--UserName ${UserName}2 --LastName test --FirstName test                                                             ||successfully |
|Update PSM Account   |${CLIBatch}    ||--System ${SystemName2} --Account ${AccountName}2 --EnableFlag Y --ProxyType \"RDP - Automatic Login Using Password\"||successfully |
#|Add Grp member       |${CLIBatch}     ||--GroupName ${GroupName}2 --UserName ${UserName}                                                                     ||successfully |


*!
!|script                                                                                                                                                                                                                                                                                                 |
|Add System via api                    |SystemName=${SystemName};PlatformName=${PlatformName};NetworkAddress=${NetworkAddress}                        ||${BasicApiUser}||You must have PPM or PSM ISA permission on a system or non-empty collection to perform this operation                           |
|Add Account via api                   |SystemName=${SystemName2};AccountName=${AccountName}                                                          ||${BasicApiUser}||You are not authorized to perform this operation.                                                                               |
|Add User via api                      |UserName=${UserName};FirstName=Keyser;LastName=Sozo                                                           ||${BasicApiUser}||${BasicApiUser} is not authorized to modify users.                                                                              |
|Add Group via api                     |GroupName=${GroupName}                                                                                        ||${BasicApiUser}||${BasicApiUser} is not authorized to save groups.                                                                               |
|Add Grp member via api                |GroupName=${GroupName}2;GroupMember=${BasicUserName}                                                          ||${BasicApiUser}||is not authorized to update group membership                                                                                    |
|Add Collection via api                |CollectionName=${CollectionName}2                                                                             ||${BasicApiUser}||${BasicApiUser} is not authorized save collections.                                                                             |
|Add Collection member via api         |CollectionName=${CollectionName};SystemName=${SystemName2}                                                    ||${BasicApiUser}||You do not have the necessary permissions to modify Collection assignments for System:                                          |
|Add Collection member via api         |CollectionName=${CollectionName};SystemName=${SystemName2};AccountName=${AccountName}2                        ||${BasicApiUser}||You do not have the necessary permissions to modify Collection assignments for System: ${SystemName2}.*Account: ${AccountName}2.|
|Add PwdRequest via api                |SystemName=${SystemName2};AccountName=${AccountName}2;UserName=${BasicApiUser}                                ||${BasicApiUser}||You do not have permissions to create a Password Request for this account .*${SystemName2}.*${AccountName}2                     |
|Add SyncPass via api                  |SyncPassName=${SyncPassName};Password=Password1                                                               ||${BasicApiUser}||${BasicApiUser} is not authorized.                                                                                              |
|List Systems via api                  |                                                                                                              ||${BasicApiUser}||No Systems to list                                                                                                              |
|List Accounts via api                 |                                                                                                              ||${BasicApiUser}||No Accounts to list                                                                                                             |
|List Users via api                    |                                                                                                              ||${BasicApiUser}||${BasicApiUser} is not authorized to list users.                                                                                |
|List Groups via api                   |                                                                                                              ||${BasicApiUser}||${BasicApiUser} is not authorized to list Groups                                                                                |
|List Group Membership via api         |                                                                                                              ||${BasicApiUser}||${BasicApiUser} is not authorized to group membership.                                                                          |
|List Dependent Systems via api        |SystemName=Fake;AccountName=Fake                                                                              ||${BasicApiUser}||${BasicApiUser} is not currently authorized                                                                                     |
|List Synchronized Passwords via api   |                                                                                                              ||${BasicApiUser}||${BasicApiUser} is not authorized.                                                                                              |
|List Reason Codes via api             |                                                                                                              ||${BasicApiUser}||${PersistentReasonCodeName}                                                                                                     |
|Delete Account via api                |SystemName=${SystemName2};AccountName=${AccountName}2                                                         ||${BasicApiUser}||You are not authorized to perform this operation                                                                                |
|Drop Collection via api               |CollectionName=${CollectionName}                                                                              ||${BasicApiUser}||${BasicApiUser} is not authorized save collections.                                                                             |
|Drop Collection Member via api        |CollectionName=${CollectionName};CollectionMember=${SystemName2}                                              ||${BasicApiUser}||You do not have the necessary permissions to modify Collection assignments for System: ${SystemName2}.                          |
|Drop Group via api                    |GroupName=${GroupName}2                                                                                       ||${BasicApiUser}||${BasicApiUser} is not authorized to save groups.                                                                               |
|Drop Group Member via api             |GroupName=${GroupName}2;GroupMember=${UserName}                                                               ||${BasicApiUser}||is not authorized to update group membership                                                                                    |
|Delete User via api                   |UserName=${UserName}2                                                                                         ||${BasicApiUser}||is not authorized                                                                                                               |
|Update Account via api                |SystemName=${SystemName2};AccountName=${AccountName}2;Description=test                                        ||${BasicApiUser}||You are not authorized to perform this operation.                                                                               |
|Update System via api                 |SystemName=${SystemName2};Description=test                                                                    ||${BasicApiUser}||You are not authorized to perform this operation                                                                                |
|Update Dependent Systems via api      |SystemName=Fake;ADAccountName=Fake;ADSystemName=Fake                                                          ||${BasicApiUser}||${BasicApiUser} is not currently authorized                                                                                     |
|Update SyncPass via api               |SyncPassName=${SyncPassName};Password=Password2                                                               ||${BasicApiUser}||${BasicApiUser} is not authorized.                                                                                              |
|Update User via api                   |UserName=${UserName}2;Description=test                                                                        ||${BasicApiUser}||${BasicApiUser} is not authorized to modify users.                                                                              |
|Change User Password via api          |UserName=${UserName}2;Password=Password1                                                                      ||${BasicApiUser}||is not authorized                                                                                                               |
|Force Reset via api                   |SystemName=${SystemName2};AccountName=${AccountName}2                                                         ||${BasicApiUser}||Failure                                                                                                                         |
|Set Access Policy via api             |SystemName=${SystemName2};AccountName=${AccountName}2;Action=ADD;AccessPolicyName=ISA;UserName=${BasicApiUser}||${BasicApiUser}||You do not have sufficient permissions on the owning Account to change Access Policy assignments                                |
|Sync Pass Force Reset via api         |SyncPassName=${SyncPassName};SyncPass=SyncPass                                                                ||${BasicApiUser}||${BasicApiUser} is not authorized.                                                                                              |
|Test System via api                   |SystemName=${SystemName2}                                                                                     ||${BasicApiUser}||You are not authorized to perform this operation                                                                                |
|Unlock User via api                   |UserName=Fake                                                                                                 ||${BasicApiUser}||${BasicApiUser} is not authorized to unlock users.                                                                              |
|Report Activity via api               |                                                                                                              ||${BasicApiUser}||${BasicApiUser}                                                                                                                 |
|Retrieve via api                      |SystemName=${SystemName2};AccountName=${AccountName}2                                                         ||${BasicApiUser}||You are not authorized to perform this operation                                                                                |
|Add Session Request via api           |SystemName=${SystemName2};AccountName=${AccountName}2;UserName=${BasicApiUser}                                ||${BasicApiUser}||Web Interface access is required in order to create a Session Request for user ${BasicApiUser}                                  |
|List Accts For Session Request via api|                                                                                                              ||${BasicApiUser}||No Accounts to list                                                                                                             |
|List PSM Accounts via api             |                                                                                                              ||${BasicApiUser}||No PSM Accounts to list                                                                                                         |
|Update PSM Account via api            |SystemName=${SystemName2};AccountName=${AccountName}2;SessionStartNotifyEmail=mail@mail.mail                  ||${BasicApiUser}||You are not authorized to perform this operation                                                                                |
|List Collections via api              |                                                                                                              ||${BasicApiUser}||No Collections to list                                                                                                          |
|Delete System via api                 |SystemName=${SystemName2}                                                                                     ||${BasicApiUser}||${BasicApiUser} is not authorized to delete systems.                                                                            |
|Check Password via api                |SystemName=${SystemName2};AccountName=${AccountName}2                                                         ||${BasicApiUser}||Failure                                                                                                                         |
|List Collection Membership via api    |CollectionName=${CollectionName}                                                                              ||${BasicApiUser}||No Collection Memberships to list                                                                                               |

#|List Collection Membership via api    |                                                                                                               ||${BasicApiUser}||No Collection Memberships to list                                                                                               |
#|Set Access Policy             |${CLIBatch}                                                                                                   ||--SystemName ${SystemName2} --AccountName ${AccountName}2 --Action ADD --AccessPolicyNam Approver-Requestor --UserNam ${BasicUserName}||pprover-Requestor assigned to.*${BasicUserName}.*successfully                                                                   |
#|List Accts For Pwd Request    |                                                                                                              ||No Accounts to list                                                                                                                              |
 		



!*> Clenup
!|script                                                                      |
|Remove user    |${BasicApiUser}                                              |
|Remove Keys    |${BasicApiUser}*                                             |
|Delete System  |${CLIBatch}||--SystemName ${SystemName2}       ||successfully|
|Drop Group     |${CLIBatch}||--GroupName ${GroupName}2         ||successfully|
|Drop Collection|${CLIBatch}||--CollectionName ${CollectionName}||successfully|
|Delete User    |${CLIBatch}||--UserName ${UserName}2           ||successfully|

*!