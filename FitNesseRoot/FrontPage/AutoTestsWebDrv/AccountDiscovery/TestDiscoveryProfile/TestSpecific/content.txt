!|scenario|Account Discovery                      |
|Open     |${TPAMURL}||${TPAMAdmin}||${DefaultPwd}|
|Create Environment                               |
|Test Discovery Profile                           |
|Delete Environment                               |

!|scenario                         |Test Discovery Profile                                                                                                                                                                                                           |
|Set AccDiscovery profile to System|${ProfileName}                                                 |                                                                          |${SystemName}                                                                         |
|$res=                             |GroovyWebDriver                                                |TestDiscovery;${TPAMHost};${TPAMAdmin};${DefaultPwd};${SystemName}                                                                                               |
|Verify_Contain_OR                 |$res;;Ignored.*${AutoDiscoveryAccount1}.*Account already exists on managed system                                                                                                                                                |
|Verify_Contain_OR                 |$res;;Add.*${AutoDiscoveryAccount2}.*${prefix}_WindowsTemplate.*${AutoDiscoveryAccount1}.*Both.*Notify.*Create.*${prefix}NewAccDisc.*tpam.spb.qsft.*${prefix}AccDiscSystem.*tpam.spb.qsft.*${prefix}AccDiscFuncAcc.*tpam.spb.qsft|
|Verify_Contain_OR                 |$res;;Add.*${ServiceAccount}.*${prefix}_WindowsTemplate.*${AutoDiscoveryAccount1}.*Both.*Notify.*Create.*${prefix}NewAccDisc.*tpam.spb.qsft.*${prefix}AccDiscSystem.*tpam.spb.qsft.*${prefix}AccDiscFuncAcc.*tpam.spb.qsft       |
|Verify_Contain_OR                 |$res;;Add.*${TaskAccount}.*${prefix}_WindowsTemplate.*${AutoDiscoveryAccount1}.*Both.*Notify.*Create.*${prefix}NewAccDisc.*tpam.spb.qsft.*${prefix}AccDiscSystem.*tpam.spb.qsft.*${prefix}AccDiscFuncAcc.*tpam.spb.qsft          |
|Verify_Contain_OR                 |$res;;Add.*${AutoDiscoveryAccount3}.*${prefix}_WindowsTemplate.*${AutoDiscoveryAccount1}.*Both.*Notify.*Create.*${prefix}NewAccDisc.*tpam.spb.qsft.*${prefix}AccDiscSystem.*tpam.spb.qsft.*${prefix}AccDiscFuncAcc.*tpam.spb.qsft|
|Verify_Contain_OR                 |$res;;Ignored.*${FunctAcct}.*Account already exists on managed system                                                                                                                                                            |
|Verify_Contain_OR                 |$res;;Ignored.*Guest.*Account is disabled.*Finished.                                                                                                                                                                             |


!|scenario                       |Create Environment                                                                                                                              |
|Create Account on System        |${AutoDiscoveryAccount3}                                                                                                                        |
|pause                           |20000                                                                                                                                           |
|$uid=                           |RunBatchGetOutput       |getuid.bat;${AutoDiscoveryAccount3};${SystemAddress};${FunctAcct};${FunctAcctPwd};win                                  |
|Create Account on System        |${ServiceAccount}                                                                                                                               |
|Create Account on System        |${TaskAccount}                                                                                                                                  |
|Create Service which is run by  |.\${ServiceAccount}     |and run under password is|${ManagedAccountPwd}      |on                       |${SystemAddress}                        |
|Create Scheduled Task           |${TaskName}             |which is run under       |${HostName}\${TaskAccount}|and run under password is|${ManagedAccountPwd}|on|${SystemAddress}|
|Create Account on System        |${ManagedAccount1}                                                                                                                              |
|Create Group w Account on System|${AutoDiscoveryAccount2}|                         |${AutoDiscoveryGroup2}                                                                       |
|Create Template                                                                                                                                                                  |
|Create Account Discovery Profile                                                                                                                                                 |

!|scenario                         |Delete Environment                                             |
|Set AccDiscovery profile to System|No Account Discovery Profile selected|  |${SystemName}         |
|Remove system                     |${SystemName}                                                  |
|Delete Account Discovery Profile  |${ProfileName}                                                 |
|Remove system                     |${TemplateName}                                                |
|Delete Group w Account on System  |${AutoDiscoveryAccount2}             |  |${AutoDiscoveryGroup2}|
|Delete Scheduled Task             |${TaskName}                          |on|${SystemAddress}      |
|pause                             |60000                                                          |
|Delete Account on System          |${TaskAccount}                                                 |
|Delete Account on System          |${AutoDiscoveryAccount3}                                       |
|Delete Service on                 |${SystemAddress}                                               |
|pause                             |60000                                                          |
|Delete Account on System          |${ServiceAccount}                                              |
|Delete Account on System          |${ManagedAccount1}                                             |

!|scenario|Add Detail                  |Index||NewAccountAction||TemplateAccount||EmailAddresses||UID||SID||Name||Group||Role||Task||Service|
|click    |id=btnAddRow                                                                                                                     |
|select;  |className=autoNewAction     |label=@NewAccountAction                                                                             |
|select;  |className=autoAcctTemplate  |label=@TemplateAccount                                                                              |
|type;    |className=autoEmailAddresses|@EmailAddresses                                                                                     |
|type;    |className=autoSIDFilter     |@SID                                                                                                |
|type;    |className=autoNameFilter    |@Name                                                                                               |
|type;    |className=autoGroupFilter   |@Group                                                                                              |
