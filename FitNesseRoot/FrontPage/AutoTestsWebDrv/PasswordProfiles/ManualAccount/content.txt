!*> Variables
!define ChangeProfile1FailureDoNothing {${prefix}ChangeProfile1FailureDoNothing}
!define ChangeProfile2FailureDisable {${prefix}ChangeProfile2FailureDisable}
!define ChangeProfile3FailureLock {${prefix}ChangeProfile3FailureLock}
!define ChangeProfile4TestPort {${prefix}ChangeProfile4TestPort}
!define ChangeProfile5DoNotChange {${prefix}ChangeProfile5DoNotChange}

!define SystemEMail {${prefix}SystemEMail@${TPAMEMailDomain}}
!define AccountEMail {${prefix}AccountEMail@${TPAMEMailDomain}}
!define EMailPwd {passw0rd}

!define ChangeTimeout {4}
!define TestPortTimeout {4}

!define NotExist {${prefix}Notexist}

!define MailSubject {Manually Managed Account Password Requires Change}
!define MailBody {The manually managed password}
#The manually managed password for on is scheduled to change. Please use the TPAM system to review and respond to this request. This email will repeat every 1440 minutes until TPAM has been notified of the reset.
*!

!include -c <AutoTestsWebDrv.SetUp

''System''
!include -c <AutoTestsWebDrv.PlatformsTesting.WindowsLocalHost
''Libraries''
!define SystemName {${prefix}ManualAccPP}
!include -c <AutoTestsWebDrv.ScenarioLibrary
!include -c <AutoTestsWebDrv.UsersTests.UserTypes.ScenarioLibrary
!include -c <PasswordProfiles.ScenarioLibrary


!*> Prepare
!|script                                                                                                                                                                                                                                                                                                                                                                                    |
|Open                                             |${TPAMURL}                       ||${TPAMAdmin}                                                                                                                                                                                                                                                                           ||${DefaultPwd}|
|Create Password Change Profile                   |${ChangeProfile1FailureDoNothing}||Do Nothing                                                                                                                                                                                                                                                                                            |
|Create Password Change Profile                   |${ChangeProfile2FailureDisable}  ||Disable change schedule                                                                                                                                                                                                                                                                               |
|Create Password Change Profile                   |${ChangeProfile3FailureLock}     ||Lock                                                                                                                                                                                                                                                                                                  |
|Create Password Change Profile With Test Port    |${ChangeProfile4TestPort}                                                                                                                                                                                                                                                                                                                |
|Create Password Change Profile With Do Not Change|${ChangeProfile5DoNotChange}                                                                                                                                                                                                                                                                                                             |
|Create Mailbox                                   |${SystemEMail}                   ||${EMailPwd}                                                                                                                                                                                                                                                                                           |
|Create Mailbox                                   |${AccountEMail}                  ||${EMailPwd}                                                                                                                                                                                                                                                                                           |
|Add System                                       |${CLIBatch}                      ||--SystemName ${SystemName} --PlatformName ${SystemPlatform} --NetworkAddress ${SystemAddress} --FunctionalAccount ${FunctAcct} --FuncAcctCred \"${FunctAcctPwd}\" --PasswordCheckProfile ${PersistentPasswordCheckProfile1} --PasswordChangeProfile ${PersistentPasswordChangeProfile1}||successfully |
|Create Account on System                                                                                                                                                                                                                                                                                                                                                                   |
|stop                                                                                                                                                                                                                                                                                                                                                                                       |
*!

!2 Scheduled Reset

''Change schedule disable''
!define ManagedAccount {${prefix}ManAccDis}

!|script                                                                                                                                                                                                                                                                    |
|Open                     |${TPAMURL}       ||${TPAMAdmin}                                                                                                                                                                                                   ||${DefaultPwd}|
|Add Account              |${CLIBatch}      ||--SystemName ${SystemName} --AccountName ${ManagedAccount} --Password "WrongPWD" --PasswordChangeProfile ${ChangeProfile2FailureDisable} --PasswordCheckProfile ${PersistentPasswordCheckProfile1} --AutoFlag M||successfully |
|pause                    |100000                                                                                                                                                                                                                                           |
|Management tab           |${ManagedAccount}                                                                                                                                                                                                                                |
|Verify Manual Password Message                                                                                                                                                                                                                                             |
|Check Change Log         |${ManagedAccount}||Scheduled Change Failed.*Cannot send notification email.                                                                                                                                                                      |
|Change schedule disabled |${ManagedAccount}||true                                                                                                                                                                                                                          |
|Check Account Lock Status|${ManagedAccount}||false                                                                                                                                                                                                                         |
|Update Account           |${CLIBatch}      ||--SystemName ${SystemName} --AccountName ${ManagedAccount} --PasswordChangeProfile "!NULL" --AutoFlag N                                                                                                        ||successfully |
|Delete Account           |${CLIBatch}      ||--SystemName ${SystemName}  --AccountName ${ManagedAccount}                                                                                                                                                    ||successfully |
|stop                                                                                                                                                                                                                                                                       |

''Lock''
!define ManagedAccount {${prefix}ManAccLock}

!|script                                                                                                                                                                                                                                                                 |
|Open                     |${TPAMURL}       ||${TPAMAdmin}                                                                                                                                                                                                ||${DefaultPwd}|
|Add Account              |${CLIBatch}      ||--SystemName ${SystemName} --AccountName ${ManagedAccount} --Password "WrongPWD" --PasswordChangeProfile ${ChangeProfile3FailureLock} --PasswordCheckProfile ${PersistentPasswordCheckProfile1} --AutoFlag M||successfully |
|pause                    |100000                                                                                                                                                                                                                                        |
|Check Change Log         |${ManagedAccount}||Scheduled Change Failed.*Cannot send notification email.                                                                                                                                                                   |
|Check Account Lock Status|${ManagedAccount}||true                                                                                                                                                                                                                       |
|Change schedule disabled |${ManagedAccount}||false                                                                                                                                                                                                                      |
|Update Account           |${CLIBatch}      ||--SystemName ${SystemName} --AccountName ${ManagedAccount} --PasswordChangeProfile "!NULL" --AutoFlag N                                                                                                     ||successfully |
|Delete Account           |${CLIBatch}      ||--SystemName ${SystemName}  --AccountName ${ManagedAccount}                                                                                                                                                 ||successfully |
|stop                                                                                                                                                                                                                                                                    |

''Do Nothing''
!define ManagedAccount {${prefix}ManAccDoN}

!|script                                                                                                                                                                                                                                                                      |
|Open                     |${TPAMURL}       ||${TPAMAdmin}                                                                                                                                                                                                     ||${DefaultPwd}|
|Add Account              |${CLIBatch}      ||--SystemName ${SystemName} --AccountName ${ManagedAccount} --Password "WrongPWD" --PasswordChangeProfile ${ChangeProfile1FailureDoNothing} --PasswordCheckProfile ${PersistentPasswordCheckProfile1} --AutoFlag M||successfully |
|pause                    |100000                                                                                                                                                                                                                                             |
|Check Change Log         |${ManagedAccount}||Scheduled Change Failed.*Cannot send notification email.                                                                                                                                                                        |
|Change schedule disabled |${ManagedAccount}||false                                                                                                                                                                                                                           |
|Check Account Lock Status|${ManagedAccount}||false                                                                                                                                                                                                                           |
|Update Account           |${CLIBatch}      ||--SystemName ${SystemName} --AccountName ${ManagedAccount} --PasswordChangeProfile "!NULL" --AutoFlag N                                                                                                          ||successfully |
|Delete Account           |${CLIBatch}      ||--SystemName ${SystemName}  --AccountName ${ManagedAccount}                                                                                                                                                      ||successfully |
|stop                                                                                                                                                                                                                                                                         |


''Do Not Change Password While Release Is Active ''
!define ManagedAccount {${prefix}ManAccAct}

!|script                                                                                                                                                                                 |
|Open             |${TPAMURL}       ||${TPAMAdmin}                                                                                                                        ||${DefaultPwd}|
|Add Account      |${CLIBatch}      ||--SystemName ${SystemName} --AccountName ${ManagedAccount} --Password "WrongPWD" -MinimumApprovers 0 --AutoFlag M                   ||successfully |
|Check Change Log |${ManagedAccount}||New Account Success                                                                                                                                |
|Set Access Policy|${CLIBatch}      ||--SystemName ${SystemName} --AccountName ${ManagedAccount} --Action ADD --AccessPolicyNam Approver-Requestor --UserNam ${CLI_user_1}||successfully |
|Add PwdRequest   |${CLIBatch}      ||--SystemName ${SystemName} --AccountName ${ManagedAccount} --RequestNotes test                                                      ||submitted    |
|Retrieve         |${CLIBatch}      ||--RequestID $RequestID                                                                                                              ||WrongPWD     |
|Update Account   |${CLIBatch}      ||--SystemName ${SystemName} --AccountName ${ManagedAccount} --PasswordChangeProfile ${ChangeProfile5DoNotChange}                     ||successfully |
|pause            |240000                                                                                                                                                                |
|Check Change Log |${ManagedAccount}||New Account Success                                                                                                                                |
|Cancel           |${CLIBatch}      ||--RequestID $RequestID --Comment Cancel Request                                                                                     ||successfully |
|pause            |60000                                                                                                                                                                 |
|Check Change Log |${ManagedAccount}||Post Release Reset Failed .*Cannot send notification email.                                                                                        |
|Update Account   |${CLIBatch}      ||--SystemName ${SystemName} --AccountName ${ManagedAccount} --PasswordChangeProfile "!NULL" --AutoFlag N                             ||successfully |
|Delete Account   |${CLIBatch}      ||--SystemName ${SystemName}  --AccountName ${ManagedAccount}                                                                         ||successfully |
|stop                                                                                                                                                                                    |

''Successful password Change''
!define ManagedAccount {${prefix}ManAccSuc}
!include -c <PasswordProfiles.ScenarioLibrary

!|script                                                                                                                                                                                                                                                                                                                                               |
|Open               |${TPAMURL}       ||${TPAMAdmin}                                                                                                                                                                                                                                            ||${DefaultPwd}                                        |
|Update System      |${CLIBatch}      ||--SystemName ${SystemName} --PrimaryEmail ${SystemEMail}                                                                                                                                                                                                ||successfully                                         |
|Add Account        |${CLIBatch}      ||--SystemName ${SystemName} --AccountName ${ManagedAccount} --Password \"${ManagedAccountPwd}\" --PasswordChangeProfile ${ChangeProfile1FailureDoNothing} } --PasswordCheckProfile \"Check and Reset\"  --AutoFlag M --ReleaseNotifyEmail ${AccountEMail}||successfully                                         |
|pause              |120000                                                                                                                                                                                                                                                                                                                            |
|Check Change Log   |${ManagedAccount}||Scheduled Change Success Sent Manual Password notification email                                                                                                                                                                                                                                               |
|No Scheduled Password Checks                                                                                                                                                                                                                                                                                                                          |
|Manual Account Mail|${MailServer}    ||${SystemEMail}                                                                                                                                                                                                                                          ||${EMailPwd}||${FromMail}||${MailSubject}||${MailBody}|
|Manual Account Mail|${MailServer}    ||${AccountEMail}                                                                                                                                                                                                                                         ||${EMailPwd}||${FromMail}||${MailSubject}||${MailBody}|
|Update Account     |${CLIBatch}      ||--SystemName ${SystemName} --AccountName ${ManagedAccount} --PasswordChangeProfile ${PersistentPasswordChangeProfile1}                                                                                                                                  ||successfully                                         |
|Delete Account     |${CLIBatch}      ||--SystemName ${SystemName}  --AccountName ${ManagedAccount}                                                                                                                                                                                             ||successfully                                         |

#!2 Forced Reset
#
#''Failure - Lock''
#
#!|script                                                                                                                                                                                                                                                                                                                                                                                    |
#|Open                             |${TPAMURL}   ||${TPAMAdmin}                                                                                                                                                                                                                              ||${DefaultPwd}                                                                                 |
#|Add Account                      |${CLIBatch}  ||--SystemName ${SystemName} --AccountName ${NotExist} --Password "WrongPWD" --AutoFlag M --PasswordChangeProfile ${ChangeProfile3FailureLock} --PasswordCheckProfile ${PersistentPasswordCheckProfile1||successfully                                                                                  |
#|Force Reset                      |${CLIBatch}  ||--SystemName ${SystemName} --AccountName ${NotExist}                                                                                                                                                                                      ||Unable to change the password for ${NotExist}                                                 |
#|Check Change Log                 |${NotExist}  ||Forced Reset Failed                                                                                                                                                                                                                                                                                                                       |
#|pause                            |100000                                                                                                                                                                                                                                                                                                                                                   |
#|Management tab                   |${NotExist}                                                                                                                                                                                                                                                                                                                                              |
#|Check Consecutive Change Failures|2                                                                                                                                                                                                                                                                                                                                                        |
#|Check Account Lock Status        |${NotExist}  ||true                                                                                                                                                                                                                                                                                                                                      |
#|Change schedule disabled         |${NotExist}  ||false                                                                                                                                                                                                                                                                                                                                     |
#|Update Account                   |${CLIBatch}  ||--SystemName ${SystemName} --AccountName ${NotExist} --PasswordChangeProfile "!NULL" --AutoFlag N                                                                                                                                         ||successfully                                                                                  |
#|Delete Account                   |${CLIBatch}  ||--SystemName ${SystemName}  --AccountName ${NotExist}                                                                                                                                                                                     ||successfully                                                                                  |
#|Delete Mails                     |${SystemEMail}                                                                                                                                                                                                                                                                                                                                           |
#|stop                                                                                                                                                                                                                                                                                                                                                                                       |


!*> Cleanup
!|script                                                                      |
|Delete System          |${CLIBatch}||--SystemName ${SystemName}||successfully|
|Delete Account on System                                                     |
|Delete Password Profile|Change     ||${ChangeProfile1FailureDoNothing}       |
|Delete Password Profile|Change     ||${ChangeProfile2FailureDisable}         |
|Delete Password Profile|Change     ||${ChangeProfile3FailureLock}            |
|Delete Password Profile|Change     ||${ChangeProfile4TestPort}               |
|Delete Password Profile|Change     ||${ChangeProfile5DoNotChange}            |
|Delete Mailbox         |${SystemEMail}                                       |
|Delete Mailbox         |${AccountEMail}                                      |
|Hard-Delete System     |${SystemName}                                        |
|stop                                                                         |
*!
