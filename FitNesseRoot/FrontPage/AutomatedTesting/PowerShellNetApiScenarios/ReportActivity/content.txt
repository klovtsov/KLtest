!define ManagedAccount {${prefix}psReportAccnt}
!include -c <AutomatedTesting.ScenarioLibrary
!include -c <PowerShellNetApiScenarios.ScenarioLibrary

!*> Do some Activity (Create system, account, request and approve pwd). Get current time also 
!|script                                                                                                                                                                          |
|$Month=        |getEval          |var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+1);var s = d.getUTCMonth()+1;if ((s + "").length == 1) s = "0" + s;else d.getUTCMonth()+1;|
|$Day=          |getEval          |var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+1);var s = d.getUTCDate();if ((s + "").length == 1) s = "0" + s;else d.getUTCDate();      |
|$Year=         |getEval          |var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+1);d.getUTCFullYear();                                                                    |
|Add System                                                                                                                                                                       |
|Add account    |${ManagedAccount}|with password                       |${ManagedAccountPwdNew}                                                                                   |
|Set Permissions|"PPM Requestor"  |on  account                         |${ManagedAccount}                      |for user                      |${API_user_1}                      |
|Set Permissions|"PPM Approver"   |on  account                         |${ManagedAccount}                      |for user                      |${API_user_2}                      |
|pause          |${ApplyNewPoliciesInterval}                                                                                                                                      |
|Request Pwd by |${API_user_1}                                                                                                                                                    |
|Approve Pwd by |${API_user_2}                                                                                                                                                    |
|Delete Account |${ManagedAccount}                                                                                                                                                |
|Delete System  |${SystemName}                                                                                                                                                    |
*!

!|script                                                                                                                                      |
|Report Activity for user|${API_user_1}|operation|Add            |objectType|System  |from|$Year,$Month,$Day|and result contains|${SystemName}|
|Report Activity for user|${API_user_1}|operation|"Request Release"|objectType|Password|from|$Year,$Month,$Day|and result contains|Requestor    |
|Report Activity for user|${API_user_2}|operation|Approved       |objectType|Password|from|$Year,$Month,$Day|and result contains|Approver     |

