!*> Variables list

!define ChangeProfileName {${prefix}ChangeProfileNStest}
!define CheckProfileName {${prefix}CheckProfileNStest}

!define AccountName {${prefix}AccountNStest}

!define SystemName {${prefix}SystemNStest}
!define SystemName1 {${prefix}SystemNStest1}
!define SystemName2 {${prefix}SystemNStest2}
!define SystemName3 {${prefix}SystemNStest3}
!define SystemName4 {${prefix}SystemNStest4}
!define SystemName5 {${prefix}SystemNStest5}

!define ProfileCertPassword {P@s$w0rd}

!define NotificationServiceTestDir {${ProjDir}\Scripts\NotificationServiceTest}


''Messages''
!define CheckResult {Failed.*Host Unreachable.*Failed.*Host Unreachable}
!define ChangeResult {Scheduled Change.*Failed.*Scheduled Change.*Failed}
!define Notification {Added 2 entries to profile notification queue}
*!

!*> Include
''System''
!include -c <AutoTestsWebDrv.PlatformsTesting.WindowsLocalHost
!define SystemName {${prefix}SystemNStest}
''Libraries''
!include -c <AutoTestsWebDrv.PasswordProfiles.ScenarioLibrary
!include -c <AutoTestsWebDrv.UsersTests.UserTypes.ScenarioLibrary
!include -c <AutoTestsWebDrv.NotificationService.ScenarioLibrary
*!


!*> Prepare

!|script                                                                                                                                                                                                                                                                                                                                                                                           |
|Open                                     |${TPAMURL} ||${TPAMAdmin}                                                                                                                                                                                                                                                                                                                ||${DefaultPwd}|
|Create Password Profile With Allow Notufy|Check      ||${CheckProfileName}                                                                                                                                                                                                                                                                                                                        |
|Create Password Profile With Allow Notufy|Change     ||${ChangeProfileName}                                                                                                                                                                                                                                                                                                                       |
|Add System                               |${CLIBatch}||--SystemName ${SystemName1} --PlatformName ${SystemPlatform} --NetworkAddress ${SystemAddress} --FunctionalAccount ${FunctAcct} --FuncAcctCred \"${FunctAcctPwd}\"  --PasswordCheckProfile ${CheckProfileName} --PasswordChangeProfile ${ChangeProfileName} --ProfileCertType G --ProfileCertPassword ${ProfileCertPassword}||successfully |
|Add Account                              |${CLIBatch}||--SystemName ${SystemName1} --AccountName ${AccountName} --Password password                                                                                                                                                                                                                                                ||successfully |
|Add System                               |${CLIBatch}||--SystemName ${SystemName2} --PlatformName ${SystemPlatform} --NetworkAddress ${SystemAddress} --FunctionalAccount ${FunctAcct} --FuncAcctCred \"${FunctAcctPwd}\"  --PasswordCheckProfile ${CheckProfileName} --PasswordChangeProfile ${ChangeProfileName} --ProfileCertType G --ProfileCertPassword ${ProfileCertPassword}||successfully |
|Add Account                              |${CLIBatch}||--SystemName ${SystemName2} --AccountName ${AccountName} --Password password                                                                                                                                                                                                                                                ||successfully |
|Add System                               |${CLIBatch}||--SystemName ${SystemName3} --PlatformName ${SystemPlatform} --NetworkAddress ${SystemAddress} --FunctionalAccount ${FunctAcct} --FuncAcctCred \"${FunctAcctPwd}\"  --PasswordCheckProfile ${CheckProfileName} --PasswordChangeProfile ${ChangeProfileName} --ProfileCertType G --ProfileCertPassword ${ProfileCertPassword}||successfully |
|Add Account                              |${CLIBatch}||--SystemName ${SystemName3} --AccountName ${AccountName} --Password password                                                                                                                                                                                                                                                ||successfully |
|Add System                               |${CLIBatch}||--SystemName ${SystemName4} --PlatformName ${SystemPlatform} --NetworkAddress ${SystemAddress} --FunctionalAccount ${FunctAcct} --FuncAcctCred \"${FunctAcctPwd}\"  --PasswordCheckProfile ${CheckProfileName} --PasswordChangeProfile ${ChangeProfileName} --ProfileCertType G --ProfileCertPassword ${ProfileCertPassword}||successfully |
|Add Account                              |${CLIBatch}||--SystemName ${SystemName4} --AccountName ${AccountName} --Password password                                                                                                                                                                                                                                                ||successfully |
|Add System                               |${CLIBatch}||--SystemName ${SystemName5} --PlatformName ${SystemPlatform} --NetworkAddress ${SystemAddress} --FunctionalAccount ${FunctAcct} --FuncAcctCred \"${FunctAcctPwd}\"  --PasswordCheckProfile ${CheckProfileName} --PasswordChangeProfile ${ChangeProfileName} --ProfileCertType G --ProfileCertPassword ${ProfileCertPassword}||successfully |
|Add Account                              |${CLIBatch}||--SystemName ${SystemName5} --AccountName ${AccountName} --Password password                                                                                                                                                                                                                                                ||successfully |
|pause                                    |120000                                                                                                                                                                                                                                                                                                                                                  |


*!

!|script                            |
|Download Certificate|${SystemName1}|
|Download Certificate|${SystemName2}|
|Download Certificate|${SystemName3}|
|Download Certificate|${SystemName4}|
|Download Certificate|${SystemName5}|
|pause               |4000          |
|Move Certs                         |
|Ping                               |
|pause               |300000        |
|Check Activity Report              |
|Check Logs                         |


!*> Cleanup

!|script                                                                                                                                                                                                                          |
|Update System          |${CLIBatch}||--SystemName ${SystemName1} --PasswordCheckProfile ${PersistentPasswordCheckProfile1} --PasswordChangeProfile ${PersistentPasswordChangeProfile1}                             ||successfully|
|Update Account         |${CLIBatch}||--SystemName ${SystemName1} --AccountName ${AccountName} --PasswordCheckProfile ${PersistentPasswordCheckProfile1} --PasswordChangeProfile ${PersistentPasswordChangeProfile1}||successfully|
|Update System          |${CLIBatch}||--SystemName ${SystemName2} --PasswordCheckProfile ${PersistentPasswordCheckProfile1} --PasswordChangeProfile ${PersistentPasswordChangeProfile1}                             ||successfully|
|Update Account         |${CLIBatch}||--SystemName ${SystemName2} --AccountName ${AccountName} --PasswordCheckProfile ${PersistentPasswordCheckProfile1} --PasswordChangeProfile ${PersistentPasswordChangeProfile1}||successfully|
|Update System          |${CLIBatch}||--SystemName ${SystemName3} --PasswordCheckProfile ${PersistentPasswordCheckProfile1} --PasswordChangeProfile ${PersistentPasswordChangeProfile1}                             ||successfully|
|Update Account         |${CLIBatch}||--SystemName ${SystemName3} --AccountName ${AccountName} --PasswordCheckProfile ${PersistentPasswordCheckProfile1} --PasswordChangeProfile ${PersistentPasswordChangeProfile1}||successfully|
|Update System          |${CLIBatch}||--SystemName ${SystemName4} --PasswordCheckProfile ${PersistentPasswordCheckProfile1} --PasswordChangeProfile ${PersistentPasswordChangeProfile1}                             ||successfully|
|Update Account         |${CLIBatch}||--SystemName ${SystemName4} --AccountName ${AccountName} --PasswordCheckProfile ${PersistentPasswordCheckProfile1} --PasswordChangeProfile ${PersistentPasswordChangeProfile1}||successfully|
|Update System          |${CLIBatch}||--SystemName ${SystemName5} --PasswordCheckProfile ${PersistentPasswordCheckProfile1} --PasswordChangeProfile ${PersistentPasswordChangeProfile1}                             ||successfully|
|Update Account         |${CLIBatch}||--SystemName ${SystemName5} --AccountName ${AccountName} --PasswordCheckProfile ${PersistentPasswordCheckProfile1} --PasswordChangeProfile ${PersistentPasswordChangeProfile1}||successfully|
|Delete Password Profile|Check      ||${CheckProfileName}                                                                                                                                                                         |
|Delete Password Profile|Change     ||${ChangeProfileName}                                                                                                                                                                        |
|Delete System          |${CLIBatch}||--SystemName ${SystemName1}                                                                                                                                                   ||successfully|
|Delete System          |${CLIBatch}||--SystemName ${SystemName2}                                                                                                                                                   ||successfully|
|Delete System          |${CLIBatch}||--SystemName ${SystemName3}                                                                                                                                                   ||successfully|
|Delete System          |${CLIBatch}||--SystemName ${SystemName4}                                                                                                                                                   ||successfully|
|Delete System          |${CLIBatch}||--SystemName ${SystemName5}                                                                                                                                                   ||successfully|
|runBatch               |DeleteFileByMask;${NotificationServiceTestDir}\${SystemName}*;fake                                                                                                                                       |
|stop                                                                                                                                                                                                                             |

*!