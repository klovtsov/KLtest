!define CollectionName {${prefix}ABXV}
!define CollectionName2 {${prefix}VXBV}
!define AnotherAccount {AliBaba}
!define collDescription {Collection for a list checking}
!define DPAPriority {12}
!define FileName {${UserPrefix}TstFile}
!define FilePath {c:\}
!define FileEmailAddr {${UserPrefix}FileEmailAddr0@tpam.spb.qsft}

!include -c <AutoTestsWebDrv.FailoverScenarios.ScenarioLibrary
!include -c <AutoTestsWebDrv.EmailScenarios.ScenarioLibrary
!include -c <PowerShellNetApiScenarios.ScenarioLibrary

!3 Prepare Environment
!|script                                                                                      |
|Add System                                                                                   |
|Add account   |${ManagedAccount}|with password|${ManagedAccountPwdNew}                       |
|Add Collection|${CollectionName}                                                             |
|Add Collection|${CollectionName2}                                                            |
|Add System    |${SystemName}    |to collection|${CollectionName}                             |
|Add Account   |${ManagedAccount}|from system  |${SystemName}|to collection|${CollectionName2}|
|Create File   |${FilePath}      |             |${FileName}                                   |
|Add File                                                                                     |
|Add File      |${FileName}      |from         |${SystemName}|to collection|${CollectionName2}|


!3 List Collection
!|script                                                                                                                      |
|List Collection by filter           |-collection ${CollectionName2}|and result contains|${CollectionName2}                   |
|List Collection by filter           |-system ${SystemName}         |and result contains|${CollectionName}                    |
|List Collection by filter           |-accountName ${ManagedAccount}                             |and result contains|${CollectionName2}                   |
|List Collection by filter           |-fileName ${FileName}                                      |and result contains|${CollectionName2}                   |
|List Collection Membership by filter|-collection ${CollectionName2}|and result contains|${CollectionName2}.*${ManagedAccount}|
|List Collection Membership by filter|-system ${SystemName}         |and result contains|${CollectionName}.*${SystemName}     |
|List Collection Membership by filter|-accountName ${ManagedAccount}                             |and result contains|${CollectionName2}.*${ManagedAccount}|
|List Collection Membership by filter|-fileName ${FileName} -propsToList  collectionName,fileName|and result contains|${CollectionName2}.*${FileName}      |
|Drop System                         |${SystemName}                                              |from collection    |${CollectionName}                    |

!3 Modify Collection and list again
!|script                                                                                                                                       |
|Add account                         |${AnotherAccount}             |with password              |${ManagedAccountPwdNew}                       |
|Add Account                         |${AnotherAccount}             |from system                |${SystemName}|to collection|${CollectionName2}|
|Add Account                         |${AnotherAccount}                        |from system                |${SystemName}|to collection|${CollectionName} |
|List Collection Membership by filter|-collection ${CollectionName2}|and result contains        |${CollectionName2}.*${AnotherAccount}         |
|List Collection by filter           |-accountName ${AnotherAccount}           |and result contains        |${CollectionName2}                            |
|List Collection by filter           |-accountName ${AnotherAccount} -maxRows 1|and result does not contain|${CollectionName2}                            |
|Drop Account                        |${ManagedAccount}             |from collection            |${CollectionName2}                            |
|List Collection Membership by filter|-collection ${CollectionName2}|and result does not contain|${ManagedAccount}                             |


!3 Clean Up
!|script                             |
|Delete File      |${FilePath}||${FileName}|
|Delete Collection|${CollectionName} |
|Delete Collection|${CollectionName2}|
|Delete System    |${SystemName}     |


!3 New in 915: PSMDPAAffinity parameter
!|script                                                                                                                                                                              |
|Get DPA Name and IP Address                                                                                                                                                          |
|Add Collection           |${CollectionName}                                                            |with parameters    |-PSMDPAAffinity $TPAMDPA/${DPAPriority} -description ahha|
|List Collection by filter|-collectionName ${CollectionName} --propsToList collectionName,PSMDPAAffinity|and result contains|${CollectionName}\s+$TPAMDPA/${DPAPriority}              |
|Delete Collection        |${CollectionName}                                                                                                                                          |
