!| scenario    |Managed System                           |
|Create Account on System                                |
|Open          |${TPAMURL}  ||${TPAMAdmin}||${DefaultPwd}|
|Add system                                              |
|Test System   |${TestSystemSuccessful}                  |
|Set password  |${FunctAcct}||${FunctAcctWrongPwd}       |
|Test System   |${TestSystemFailed}                      |
|Check Password|${FunctAcct}||${CheckPasswordFailed}     |

!| scenario                       |Managed Account                                                                                                                                        |
|Add PPM account                  |${ManagedAccount}|with password|${ManagedAccountPwd}|and profiles|${PersistentPasswordCheckProfile1}||${PersistentPasswordChangeProfile1}||${NotFailed}|
|Reset Password                   |${ManagedAccount}|             |${ResetPasswordFailed}                                                                                                 |
|Change Account Password on System|${ManagedAccountPwdNew}                                                                                                                                |
|pause                            |${ChangeManagedAccountPasswordTimeout}                                                                                                                 |
|Set password                     |${FunctAcct}     |             |${FunctAcctPwd}                                                                                                        |
|pause                            |${RestoreFunctAcctPasswordTimeout}                                                                                                                     |
|Check Password                   |${ManagedAccount}|             |${CheckPasswordNotMatch}                                                                                               |
|pause                            |${RestoreFunctAcctPasswordTimeout}                                                                                                                     |
|Reset Password                   |${ManagedAccount}|             |${ResetPasswordSuccessful}                                                                                             |

!| scenario       |Add system                                                                                                                         |
|$res=            |PerlAPI     |${APIBatch} addSystem ${SystemName} ${SystemAddress} "${SystemPlatform}" ${FunctAcct} ${FunctAcctPwd} ${SystemTimeout}|
|Verify_Contain_OR|$res;;successful                                                                                                                   |
|Set description  |${FunctAcct}|                                               |${FunctAcctDescription}                                               |


!| scenario       |Add account|acc                       |with password                        |pwd                        |                       |testRes                      |
|$Months=         |getEval    |var d = new Date();d.setMinutes(d.getMinutes()+1); d.setDate(d.getDate()+1);var s = d.getMonth()+1;if ((s + "").length == 1) s = "0" + s;return s;|
|$Days=           |getEval    |var d = new Date();d.setMinutes(d.getMinutes()+1); d.setDate(d.getDate()+1);var s = d.getDate(); if ((s + "").length == 1) s = "0" + s;return s;  |
|$Years=          |getEval    |var d = new Date();d.setMinutes(d.getMinutes()+1); d.setDate(d.getDate()+1);return d.getFullYear();                                               |
|$res=            |PerlAPI    |${APIBatch} addAccount ${SystemName} @acc @pwd $Months/$Days/$Years                                                                               |
|Verify_Contain_OR|$res;;@testRes                                                                                                                                                |
|Set description  |@acc       |                          |${ManagedAccountDescription}                                                                                           |

!| scenario       |Add PPM account|acc |with password |pwd |and profiles |checkProfile | |changeProfile ||testRes|
|$res=            |PerlAPI        |${APIBatch} addPpmAccount ${SystemName} @acc @pwd @checkProfile @changeProfile|
|Verify_Contain_OR|$res;;@testRes                                                                                |
|Set description  |@acc           |    |${ManagedAccountDescription}                                             |


|scenario         |Set description|acc              |              |descr              |
|$res=            |PerlAPI        |${APIBatch} setDescription ${SystemName} @acc @descr|
|Verify_Contain_OR|$res;;success                                                       |

!| scenario       |Test System|testRes                             |
|$res=            |PerlAPI    |${APIBatch} testSystem ${SystemName}|
|Verify_Contain_OR|$res;;@testRes                                  |

!| scenario       |Set Password|acc             |             |passwd             |
|$res=            |PerlAPI     |${APIBatch} setPassword ${SystemName} @acc @passwd|
|Verify_Contain_OR|$res;;${NotFailed}                                             |

!| scenario       |Reset Password|acc           |           |testRes          |
|$res=            |PerlAPI       |${APIBatch} resetPassword ${SystemName} @acc|
|Verify_Contain_OR|$res;;@testRes                                             |

!| scenario       |Check Password|acc           |           |testRes          |
|$res=            |PerlAPI       |${APIBatch} checkPassword ${SystemName} @acc|
|Verify_Contain_OR|$res;;@testRes                                             |


!| scenario|Remove account             |accName             |
|PerlAPI   |${APIBatch} deleteAccount ${SystemName} @accName|


!| scenario       |Remove system|sysName                          |
|$res=            |PerlAPI      |${APIBatch} deleteSystem @sysName|
|Verify_Contain_OR|$res;;successful                               |

!|scenario     |Account Not there                               |
|Add account   |AccNotThere|with password|master | |${NotFailed}|
|Reset Password|AccNotThere|             |${ResetPasswordFailed}|
|Check Password|AccNotThere|             |${CheckPasswordFailed}|

!|scenario        |System Unreachable                                              |
|$res=            |PerlAPI          |${APIBatch} updateSystem ${SystemName} 1.2.3.4|
|Verify_Contain_OR|$res;;${NotFailed}                                              |
|Test System      |${TestSystemFailed}                                             |
|Reset Password   |${ManagedAccount}|            |${ResetPasswordFailed}           |
|Check Password   |${ManagedAccount}|            |${CheckPasswordFailed}           |


!| scenario          |Request Password and Login |
|Set User Permissions|${API_user_1}              |
|Set User Permissions|${API_user_2}              |
|pause               |${ApplyNewPoliciesInterval}|
|Request Pwd                                     |
|Approve Pwd                                     |
|Get Login                                       |
#|Set User Permissions|${Requestor}              |

!|scenario        |Set User Permissions|userName                                                                                      |
|$res=            |PerlAPI             |${APIBatch} setAccessPolicy "Approver-Requestor" ADD ${SystemName} ${ManagedAccount} @userName|
|Verify_Contain_OR|$res;;successful                                                                                                   |

!|scenario        |Revoke User Permissions|userName                                                                                       |
|$res=            |PerlAPI                |${APIBatch} setAccessPolicy "Approver-Requestor" DROP ${SystemName} ${ManagedAccount} @userName|
|Verify_Contain_OR|$res;;successful                                                                                                       |



!| scenario       |Request Pwd                                                                               |
|$res=            |PerlAPI      |${APIBatch} addPwdRequest ${SystemName} ${ManagedAccount} ${API_user_1} test|
|Verify_Contain_OR|$res;;submitted                                                                           |
|$RequestID=      |get_RequestID|$res                                                                        |

!| scenario       |Approve Pwd                               |
|$res=            |PerlAPI|${APIBatch2} approve $RequestID OK|
|Verify_Contain_OR|$res;;submitted                           |

!| scenario             |Get Login                              |
|$GeneratedPwd=         |PerlAPI|${APIBatch} retrieve $RequestID|
|Login Account to System|$GeneratedPwd                          |
#|$GeneratedPwd=         |PerlAPI|${APIBatch} retrieve ${SystemName} ${ManagedAccount}|

!| scenario              |Delete All       |
|Revoke User Permissions |${API_user_1}    |
|Revoke User Permissions |${API_user_2}    |
|Remove account          |${ManagedAccount}|
|Remove system           |${SystemName}    |
|Delete Account on System|${ManagedAccount}|

