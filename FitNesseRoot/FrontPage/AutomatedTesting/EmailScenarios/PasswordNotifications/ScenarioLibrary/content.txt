!|scenario                            |Prepare Environment                                                     |
|Open                                 |${TPAMURL}                ||${TPAMAdmin}                 ||${DefaultPwd}|
|Login                                |${TPAMURL}                ||${TPAMAdmin}                 ||${DefaultPwd}|
|Add Account To Collection            |${SystemName}             ||${ManagedAccount}            ||${Collection}|
|Add User To Group                    |${CLI_user_1}             ||\"Global PPM Requestor Group\"              |
|Add User To Group                    |${GlobalGroupApprover}    ||\"Global PPM Approver Group\"               |
|Add User To Group                    |${GlobalGroupRequestor}   ||\"Global PPM Requestor Group\"              |
|Add User To Group                    |${GlobalGroupReviewer}    ||\"Global PPM Reviewer Group\"               |
|Set User Permissions Account Level   |${UserAccountRequestor}   ||\"PPM Requestor\"                           |
|Set User Permissions Account Level   |${UserAccountApprover}    ||\"${PasswordApproverPolicy}\"               |
|Set User Permissions System Level    |${UserSystemReviewer}     ||\"PPM Reviewer\"                            |
|Set User Permissions System Level    |${UserSystemApprover}     ||\"${PasswordApproverPolicy}\"               |
|Set User Permissions Account Level   |${UserAccountReviewer}    ||\"PPM Reviewer\"                            |
|Set Group Permissions Account Level  |${GroupAccountReviewers}  ||\"PPM Reviewer\"                            |
|Set Group Permissions Account Level  |${GroupAccountApprovers}  ||\"${PasswordApproverPolicy}\"               |
|Set Group Permissions Account Level  |${GroupAccountRequestors} ||\"PPM Requestor\"                           |
|Set User Permissions Collection Level|${UserCollectionReviewer} ||\"PPM Reviewer\"             ||${Collection}|
|Set User Permissions Collection Level|${UserCollectionApprover} ||\"${PasswordApproverPolicy}\"||${Collection}|
|Set User Permissions Collection Level|${UserCollectionRequestor}||\"PPM Requestor\"            ||${Collection}|
|pause                                |${ApplyNewPoliciesInterval}                                             |



!|scenario                            |Clear Environment                                                       |
|Remove User From Group               |${GlobalGroupApprover}    ||\"Global PPM Approver Group\"               |
|Remove User From Group               |${GlobalGroupRequestor}   ||\"Global PPM Requestor Group\"              |
|Remove User From Group               |${GlobalGroupReviewer}    ||\"Global PPM Reviewer Group\"               |
|Remove User From Group               |${CLI_user_1}             ||\"Global PPM Requestor Group\"              |
|Remove User Permissions On Account   |${UserAccountRequestor}   ||\"PPM Requestor\"                           |
|Remove User Permissions On Account   |${UserAccountApprover}    ||\"${PasswordApproverPolicy}\"               |
|Remove User Permissions On System    |${UserSystemReviewer}     ||\"PPM Reviewer\"                            |
|Remove User Permissions On System    |${UserSystemApprover}     ||\"${PasswordApproverPolicy}\"               |
|Remove User Permissions On Account   |${UserAccountReviewer}    ||\"PPM Reviewer\"                            |
|Remove Group Permissions On Account  |${GroupAccountReviewers}  ||\"PPM Reviewer\"                            |
|Remove Group Permissions On Account  |${GroupAccountApprovers}  ||\"${PasswordApproverPolicy}\"               |
|Remove Group Permissions On Account  |${GroupAccountRequestors} ||\"PPM Requestor\"                           |
|Remove User Permissions On Collection|${UserCollectionReviewer} ||\"PPM Reviewer\"             ||${Collection}|
|Remove User Permissions On Collection|${UserCollectionApprover} ||\"${PasswordApproverPolicy}\"||${Collection}|
|Remove User Permissions On Collection|${UserCollectionRequestor}||\"PPM Requestor\"            ||${Collection}|
|Remove Account From Collection       |${SystemName}             ||${ManagedAccount}            ||${Collection}|



!| scenario       |Add account|acc                                    |with password                                    |pwd                                    |with email                                    |notifyEmail                                    |
|$Months=         |getEval    |var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+1); d.setUTCDate(d.getUTCDate()+1);var s = d.getUTCMonth()+1;if ((s + "").length == 1) s = "0" + s;else d.getUTCMonth()+1;                                                 |
|$Days=           |getEval    |var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+1); d.setUTCDate(d.getUTCDate()+1);var s = d.getUTCDate(); if ((s + "").length == 1) s = "0" + s;else d.getUTCDate();                                                      |
|$Years=          |getEval    |var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+1); d.setUTCDate(d.getUTCDate()+1); d.getUTCFullYear();                                                                                                                    |
|$res=            |CLI        |${CLIBatch} AddAccount --System ${SystemName} --AccountName @acc --Password \"@pwd\" --Description \"${ManagedAccountDescription}\" --NextChangeDate $Months/$Days/$Years --MinimumApprovers 1 --ReleaseNotifyEmail @notifyEmail|
|Verify_Contain_OR|$res;;successful                                                                                                                                                                                                                            |


!|scenario        |Set Approvers Number|accountName                             |                             |approversNumber                             |
|$res=            |CLI                 |${CLIBatch} UpdateAccount --SystemName ${SystemName} --AccountName @accountName --MinimumApprovers @approversNumber|
|Verify_Contain_OR|$res;;successful                                                                                                                        |

!|scenario        |Set Reviewers Number|accountName                                  |                                  |reviewersNumber                                 |
|$res=            |CLI                 |${CLIBatch} UpdateAccount --SystemName ${SystemName} --AccountName @accountName --ReviewCount @reviewersNumber --ReviewerType Any|
|Verify_Contain_OR|$res;;successful                                                                                                                                      |


!|scenario        |Set Reset Flag|flag                                                                                                                |
|$res=            |CLI           |${CLIBatch} UpdateAccount --SystemName ${SystemName} --AccountName ${ManagedAccount} --CheckFlag Y --ResetFlag @flag|
|Verify_Contain_OR|$res;;successful                                                                                                                   |



!| scenario        |Request Pwd      |accountName                                                                                                                                          |
|pause             |60000                                                                                                                                                                  |
|Login             |${TPAMURL}       |                             |${UserAccountRequestor}                            |                            |${UserPwd}                            |
|pause             |20000                                                                                                                                                                  |
|clickAndWait      |link=Add Password Request                                                                                                                                              |
|type;             |id=SystemNm      |${SystemName}                                                                                                                                        |
|type;             |id=AccountNm     |@accountName                                                                                                                                         |
|click             |id=Accounts      |                                                                                                                                                     |
|click             |//input[@type='checkbox']                                                                                                                                              |
|click             |id=Details                                                                                                                                                             |
|select;           |id=DurationHrs   |label=0                                                                                                                                              |
|select;           |id=DurationQtrHrs|label=15                                                                                                                                             |
|type;             |id=RequestReason |password request reason                                                                                                                              |
|typeKeys;         |id=RequestReason |a                                                                                                                                                    |
|click             |id=SubmitChanges                                                                                                                                                       |
|waitForTextPresent|*RequestID:*has been submitted.*                                                                                                                                       |
|$res=             |getText          |//div[@id='ResultsDiv']                                                                                                                              |
|$RequestID=       |getEval          |var rstr = "RequestID: ";var i1 = "$res".indexOf(rstr);var i2 = "$res".substring(i1 + rstr.length);var i3 = i2.indexOf(" ");i4 = i2.substring (0,i3);|
|Logout                                                                                                                                                                                    |

!| scenario           |Approve Pwd                                           |
|pause                |60000                                                 |
|Login                |${TPAMURL}        ||${UserAccountApprover}||${UserPwd}|
|pause                |20000                                                 |
|click                |id=Approvals                                          |
|waitForElementPresent|link=Pwd(${ManagedAccount})                           |
|clickAndWait         |link=Pwd(${ManagedAccount})                           |
|waitForElementPresent|//td[contains(text(),'${ManagedAccount}')]            |
|mouseDown            |//td[contains(text(),'${ManagedAccount}')]            |
|click                |//td[contains(text(),'${ManagedAccount}')]            |
|click                |id=Details                                            |
|type;                |id=ResponseComment|ok to approve                      |
|typeKeys;            |id=ResponseComment|a                                  |
|click                |id=ApproveReq                                         |
|waitForTextPresent   |*The response* was submitted successfully*            |
|Logout                                                                      |

!| scenario           |Cancel Request                                          |
|pause                |60000                                                   |
|Login                |${TPAMURL}         ||${UserAccountRequestor}||${UserPwd}|
|pause                |20000                                                   |
|click                |id=CurrentRequests |                                    |
|waitForElementPresent|//table[@id='requestsTable']//tr[contains(@id,'P')]/td/a|
|clickAndWait         |//table[@id='requestsTable']//tr[contains(@id,'P')]/td/a|
|waitForElementPresent|id=Details                                              |
|type;                |id=ResponseComment |Decline                             |
|typeKeys;            |id=ResponseComment |a                                   |
|click                |id=SubmitChanges                                        |
|waitForTextPresent   |*The response* was submitted successfully*              |

!| scenario           |Get Login                                               |
|pause                |60000                                                   |
|Login                |${TPAMURL}         ||${UserAccountRequestor}||${UserPwd}|
|pause                |20000                                                   |
|click                |id=CurrentRequests |                                    |
|waitForElementPresent|//table[@id='requestsTable']//tr[contains(@id,'P')]/td/a|
|clickAndWait         |//table[@id='requestsTable']//tr[contains(@id,'P')]/td/a|
|waitForElementPresent|id=Password                                             |
|click                |id=Password                                             |
|pause                |5000                                                    |



!|scenario            |Add Auditor |UserName||Passwd||EMail|
|clickAndWait         |link=Add UserID                     |
|waitForElementPresent|id=UserName                         |
|type;                |id=UserName |@UserName              |
|type;                |id=FirstName|Vasily                 |
|type;                |id=LastName |Pupkin                 |
|type;                |id=EmailID  |@EMail                 |
|select;              |id=UType    |label=Auditor          |
|type;                |id=sPassword|@Passwd                |
|type;                |id=Confirm  |@Passwd                |
|click                |id=SubmitChanges                    |
|waitForTextPresent   |*User added successfully*           |


!|scenario        |Set Manual Management                                                                                |
|$res=            |CLI|${CLIBatch} UpdateAccount --SystemName ${SystemName} --AccountName ${ManagedAccount} --AutoFlag M|
|Verify_Contain_OR|$res;;successful                                                                                     |


!|scenario        |Set Auto Management                                                                                  |
|$res=            |CLI|${CLIBatch} UpdateAccount --SystemName ${SystemName} --AccountName ${ManagedAccount} --AutoFlag Y|
|Verify_Contain_OR|$res;;successful                                                                                     |


!|scenario        |Add sync password|SyncPwdName                                                                                                  |
|$res=            |CLI              |${CLIBatch} AddSyncPass --SyncPassName @SyncPwdName --Password esbd41R --ReleaseNotifyEmail ${SyncPwdContact}|
|Verify_Contain_OR|$res;;successful                                                                                                               |


!|scenario        |Add Sync Password Subscribers|SyncPwdName              |              |SystemName              |              |AccountName             |
|$res=            |CLI                          |${CLIBatch} AddSyncPwdSub --SyncPassName @SyncPwdName --SystemName @SystemName --AccountName @AccountName|
|Verify_Contain_OR|$res;;successful                                                                                                                       |

!|scenario        |Delete sync password|SyncPwdName                                           |
|$res=            |CLI                 |${CLIBatch} DeleteSyncPass --SyncPassName @SyncPwdName|
|Verify_Contain_OR|$res;;successful                                                           |



#!|scenario            |Schedule Reset Password                                                                                                                                      |
#|waitForElementPresent|id=Details                                                                                                                                                   |
#|click                |id=Details                                                                                                                                                   |
#|waitForElementPresent|id=Management                                                                                                                                                |
#|click                |id=Management                                                                                                                                                |
#|$Hours=              |getEval      |var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+3);var s = d.getUTCHours();if ((s + "").length == 1) s = "0" + s;else d.getUTCHours();    |
#|$Minutes=            |getEval      |var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+3);var s = d.getUTCMinutes();if ((s + "").length == 1) s = "0" + s;else d.getUTCMinutes();|
#|$Months=             |getEval      |var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+3);var s = d.getUTCMonth()+1;if ((s + "").length == 1) s = "0" + s;else d.getUTCMonth()+1;|
#|$Days=               |getEval      |var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+3);var s = d.getUTCDate();if ((s + "").length == 1) s = "0" + s;else d.getUTCDate();      |
#|$Years=              |getEval      |var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+3);d.getUTCFullYear();                                                                    |
#|type;                |id=Hr        |$Hours                                                                                                                                         |
#|typeKeys;            |id=Hr        |$Hours                                                                                                                                         |
#|type;                |id=Min       |$Minutes                                                                                                                                       |
#|type;                |id=Mon       |$Months                                                                                                                                        |
#|type;                |id=DayNumber |$Days                                                                                                                                          |
#|type;                |id=YearNumber|$Years                                                                                                                                         |
#|waitForTextPresent   |*Changes saved successfully for*                                                                                                                             |



!|scenario        |Schedule Reset Password                                                                                                                                        |
|$Hours=          |getEval|var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+3);var s = d.getUTCHours();if ((s + "").length == 1) s = "0" + s;else d.getUTCHours();            |
|$Minutes=        |getEval|var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+3);var s = d.getUTCMinutes();if ((s + "").length == 1) s = "0" + s;else d.getUTCMinutes();        |
|$Months=         |getEval|var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+3);var s = d.getUTCMonth()+1;if ((s + "").length == 1) s = "0" + s;else d.getUTCMonth()+1;        |
|$Days=           |getEval|var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+3);var s = d.getUTCDate();if ((s + "").length == 1) s = "0" + s;else d.getUTCDate();              |
|$Years=          |getEval|var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+3);d.getUTCFullYear();                                                                            |
|$res=            |CLI    |${CLIBatch} UpdateAccount --SystemName ${SystemName} --AccountName ${ManagedAccount} --NextChangeDate $Months/$Days/$Years --ChangeTime $Hours:$Minutes|
|Verify_Contain_OR|$res;;successful                                                                                                                                               |



!|scenario                  |Password Change Failure                                                                     |
|Login                      |${TPAMURL}                          ||${TPAMAdmin}                        ||${DefaultPwd}   |
|pause                      |20000                                                                                       |
|Update System IP           |1.2.3.4                                                                                     |
|Choose Account             |${ManagedAccount}                                                                           |
|Reset Password             |${ResetPasswordFailed}                                                                      |
|pause                      |120000                                                                                      |
|Check Mail                 |${SystemEMail}                      ||Password Update Failure Notification||An error occured|
|Delete Mails               |${SystemEMail}                      |                                                       |
|Check All Mailboxes No Mail|Password Update Failure Notification||An error occured                                      |
|Update System IP           |${SystemAddress}                                                                            |
#|Check Mail        |${SystemEMail}   ||${FromMail}||Password Update Failure Notification||An error occured||while attempting to change the password for ${ManagedAccount} on ${SystemName}. The reason for the attempted change was a Forced Reset|


!|scenario                  |Password Check Failure                                                                                    |
|Login                      |${TPAMURL}                         ||${TPAMAdmin}                       ||${DefaultPwd}         |         |
|pause                      |20000                                                                                                     |
|Choose Account             |${ManagedAccount}                                                                                         |
|click                      |id=Details                                                                                                |
|type;                      |id=sPswd                           |esbdf41R                                                              |
|type;                      |id=sConfPswd                       |esbdf41R                                                              |
|click                      |id=SubmitChangesButton                                                                                    |
|waitForTextPresent         |Changes saved successfully for ${ManagedAccount}                                                          |
|Set Reset Flag             |N                                                                                                         |
|Check Password             |${CheckPasswordFailed}                                                                                    |
|pause                      |120000                                                                                                    |
|Check Mail                 |${SystemEMail}                     ||Password Check Failure Notification||A password mismatch was detected|
|Delete Mails               |${SystemEMail}                                                                                            |
|Check All Mailboxes No Mail|Password Check Failure Notification||A password mismatch was detected                                     |
|Set Reset Flag             |Y                                                                                                         |



!|scenario                  |Password Release Request And Responce                                                      |
|Login                      |${TPAMURL}                           ||${TPAMAdmin}                         ||${DefaultPwd}|
|pause                      |20000                                                                                      |
|Set Approvers Number       |${ManagedAccount}                    ||${ApproversCount}                                   |
|Set Reviewers Number       |${ManagedAccount}                    ||1                                                   |
|Logout                                                                                                                 |
|Request Pwd                |${ManagedAccount}                                                                          |
|pause                      |200000                                                                                     |
|Check Mail                 |${UserAccountRequestorEMail}         ||Release Request Notification         ||$RequestID   |
|Check Approvers Mailboxes  |Release Request Notification         ||$RequestID                                          |
|Approve Pwd                                                                                                            |
|Cancel Request                                                                                                         |
|pause                      |200000                                                                                     |
|Check Mail                 |${SystemEscalationEMail}             ||Release Request Notification         ||$RequestID   |
|Delete Mails               |${SystemEscalationEMail}                                                                   |
|Check Mail                 |${UserAccountRequestorEMail}         ||Release Request Response notification||$RequestID   |
|Check Approvers Mailboxes  |Release Request Response notification||$RequestID                                          |
|Delete Mails               |${UserAccountRequestorEMail}                                                               |
|Clear Approvers Mailboxes                                                                                              |
|Check All Mailboxes No Mail|Release Request Notification         ||$RequestID                                          |
|Check All Mailboxes No Mail|Release Request Response notification||$RequestID                                          |


!|scenario                  |Password Release Request Overdue                                         |
|Login                      |${TPAMURL}                  ||${TPAMAdmin}                ||${DefaultPwd}|
|Choose System                                                                                        |
|click                      |id=Details                  |                                            |
|type;                      |id=EscalationTime           |1                                           |
|type;                      |id=EscalationEmail          |${SystemEscalationEMail}                    |
|click                      |id=bt_Save                  |                                            |
|Set Approvers Number       |${ManagedAccount}           ||${ApproversCount}                          |
|Set Reviewers Number       |${ManagedAccount}           ||1                                          |
|Logout                                                                                               |
|Request Pwd                |${ManagedAccount}                                                        |
|Login                      |${TPAMURL}                  ||${TPAMAdmin}                ||${DefaultPwd}|
|pause                      |240000                                                                   |
|Check Mail                 |${SystemEscalationEMail}    ||Release Request Notification||$RequestID   |
|Delete Mails               |${SystemEscalationEMail}                                                 |
|Delete Mails               |${UserAccountRequestorEMail}                                             |
|Clear Approvers Mailboxes                                                                            |
|Check All Mailboxes No Mail|Release Request Notification||$RequestID                                 |



!|scenario                  |Password Release Review Request                                              |
|Login                      |${TPAMURL}                                      ||${TPAMAdmin}||${DefaultPwd}|
|Set Approvers Number       |${ManagedAccount}                               ||0                          |
|Set Reviewers Number       |${ManagedAccount}                               ||1                          |
|Request Pwd                |${ManagedAccount}                                                            |
|Get Login                                                                                                |
|Cancel Request                                                                                           |
|pause                      |200000                                                                       |
|Check Reviewers Mailboxes  |Password Release Review Requirement Notification||$RequestID                 |
|Clear Reviewers Mailboxes                                                                                |
|Check All Mailboxes No Mail|Password Release Review Requirement Notification||$RequestID                 |
|Delete Mails               |${AccountEMail}                                                              |
|Review Password Release    |${UserAccountReviewer}                          ||$RequestID                 |

!|scenario            |Review Password Release|reviewerName|             |requestID  |
|Login                |${TPAMURL}             |            |@reviewerName||${UserPwd}|
|pause                |20000                                                         |
|click                |id=PendingReviews                                             |
|waitForElementPresent|link=@requestID                                               |
|clickAndWait         |link=@requestID                                               |
|pause                |1000                                                          |
|waitForElementPresent|id=NewReviewComment                                           |
|type;                |id=NewReviewComment    |reviewed                              |
|pause                |1000                                                          |
|click                |id=CompleteReviewButton                                       |
|waitForTextPresent   |Successfully                                                  |
|Logout                                                                              |



!|scenario                  |Privileged Password Release                                                                                                                                                                                    |
|Login                      |${TPAMURL}                                     ||${TPAMAdmin}                                   ||${DefaultPwd}                                                                                                |
|Set Approvers Number       |${ManagedAccount}                              ||0                                                                                                                                                             |
|Set Reviewers Number       |${ManagedAccount}                              ||0                                                                                                                                                             |
|Request Pwd                |${ManagedAccount}                                                                                                                                                                                              |
|Get Login                                                                                                                                                                                                                                  |
|pause                      |200000                                                                                                                                                                                                         |
|Cancel Request                                                                                                                                                                                                                             |
|Check Mail                 |${AccountEMail}                                ||Special Privilege Password Release Notification||password for ${ManagedAccount} on ${SystemName} was retrieved without dual control by ${UserAccountRequestor}|
|Delete Mails               |${AccountEMail}                                                                                                                                                                                                |
|Check All Mailboxes No Mail|Special Privilege Password Release Notification||password for ${ManagedAccount} on ${SystemName} was retrieved without dual control by ${UserAccountRequestor}                                                 |



!|scenario                    |Privileged Password Release for Synchronized Password                                                                                                                                                                                    |
|Add account                  |${SyncPwdSubscriber}                           |with password|${ManagedAccountPwd}                           |with email|${SyncPwdSubscriberEMail}                                                                                       |
|Set Approvers Number         |${SyncPwdSubscriber}                           |             |0                                                                                                                                                                          |
|Set Reviewers Number         |${SyncPwdSubscriber}                           |             |0                                                                                                                                                                          |
|$res=                        |CLI                                            |${CLIBatch} SetAccessPolicy --AccessPolicyName \"PPM Requestor\" --Action ADD --SystemName ${SystemName} --AccountName ${SyncPwdSubscriber} --UserName ${UserAccountRequestor}           |
|Verify_Contain_OR            |$res;;successful                                                                                                                                                                                                                         |
|Add sync password            |${UserPrefix}TestSyncPwd                                                                                                                                                                                                                 |
|Add Sync Password Subscribers|${UserPrefix}TestSyncPwd                       |             |${SystemName}                                  |          |${SyncPwdSubscriber}                                                                                            |
|Request Pwd                  |${SyncPwdSubscriber}                                                                                                                                                                                                                     |
|Get Login                                                                                                                                                                                                                                                              |
|pause                        |180000                                                                                                                                                                                                                                   |
|Check Mail                   |${SyncPwdContact}                              |             |Special Privilege Password Release Notification|          |password for ${SyncPwdSubscriber} on ${SystemName} was retrieved without dual control by ${UserAccountRequestor}|
|Check Mail                   |${SyncPwdSubscriberEMail}                      |             |Special Privilege Password Release Notification|          |password for ${SyncPwdSubscriber} on ${SystemName} was retrieved without dual control by ${UserAccountRequestor}|
|Delete Mails                 |${SyncPwdContact}                                                                                                                                                                                                                        |
|Delete Mails                 |${SyncPwdSubscriberEMail}                                                                                                                                                                                                                |
|Check All Mailboxes No Mail  |Special Privilege Password Release Notification|             |password for ${SyncPwdSubscriber} on ${SystemName} was retrieved without dual control by ${UserAccountRequestor}                                                           |
|Remove account               |${SyncPwdSubscriber}                           |             |${SystemName}                                                                                                                                                              |
|Delete sync password         |${UserPrefix}TestSyncPwd                                                                                                                                                                                                                 |



!|scenario                  |Scheduled Manual Password                                                                                                                                                                        |
|Set Manual Management                                                                                                                                                                                                        |
|pause                      |10000                                                                                                                                                                                            |
|Schedule Reset Password                                                                                                                                                                                                      |
|pause                      |600000                                                                                                                                                                                           |
|Check Mail                 |${SystemEMail}                                   ||Manually Managed Account Password Requires Change||The manually managed password for ${ManagedAccount} on ${SystemName} is scheduled to change|
|Delete Mails               |${SystemEMail}                                                                                                                                                                                   |
|Check Mail                 |${AccountEMail}                                  ||Manually Managed Account Password Requires Change||The manually managed password for ${ManagedAccount} on ${SystemName} is scheduled to change|
|Delete Mails               |${AccountEMail}                                                                                                                                                                                  |
|Check All Mailboxes No Mail|Manually Managed Account Password Requires Change||The manually managed password for ${ManagedAccount} on ${SystemName} is scheduled to change                                                   |
|Set Auto Management                                                                                                                                                                                                          |


!|scenario                         |Password Request Without Ticket                                                                                                                                                                                                           |
|$res=                             |CLI                        |${CLIBatch} UpdateAccount --System ${SystemName} --Account ${ManagedAccount} --RequireTicketForRequest Y --TicketSystemName !Any --TicketEmailNotify ${TicketNotifyEMail} --ReleaseNotifyEMail ${AccountEMail}|
|Verify_Contain_OR                 |$res;;successful                                                                                                                                                                                                                          |
|Set User Permissions Account Level|${CLI_user_1}              |                                      |ISA                                                                                                                                                                    |
|pause                             |${ApplyNewPoliciesInterval}                                                                                                                                                                                                               |
|$res=                             |CLI                        |${CLIBatch} Retrieve --SystemName ${SystemName} --AccountName ${ManagedAccount} --ReasonText test                                                                                                             |
|pause                             |200000                                                                                                                                                                                                                                    |
|Check Mail                        |${TicketNotifyEMail}       |                                      |bypassing ticket validation                                      |                                      |without Ticket Validation                                     |
|Delete Mails                      |${TicketNotifyEMail}                                                                                                                                                                                                                      |
|Check All Mailboxes No Mail       |bypassing ticket validation|                                      |without Ticket Validation                                                                                                                                              |
|$res=                             |CLI                        |${CLIBatch} UpdateAccount --System ${SystemName} --Account ${ManagedAccount} --RequireTicketForRequest N                                                                                                      |
|Verify_Contain_OR                 |$res;;successful                                                                                                                                                                                                                          |


!|scenario            |Retrieve Password|requestorName              |
|Login                |${TPAMURL}       ||@requestorName||${UserPwd}|
|pause                |20000                                        |
|click                |id=CurrentRequests                           |
|waitForElementPresent|link=$RequestID                              |
|clickAndWait         |link=$RequestID                              |
|waitForElementPresent|id=Password                                  |
|click                |id=Password                                  |
|pause                |30000                                        |



!|scenario                        |Non-managed Account Password Release Expiration                                                                                                                                                   |
|Set User Permissions System Level|${UserAccountRequestor}            |                     |\"PPM Requestor\"                                                                                                                       |
|$res=                            |CLI                                |${CLIBatch} UpdateSystem --SystemName ${SystemName} --AllowFuncReqFlag Y                                                                                      |
|$res=                            |CLI                                |${CLIBatch} UpdateAccount --System ${SystemName} --Account ${FunctAcct} --MinimumApprovers 0                                                                  |
|$res=                            |CLI                                |${CLIBatch} AddPwdRequest --SystemName ${SystemName} --AccountName ${FunctAcct} --ForUserName ${UserAccountRequestor} --ReleaseDuration 15 --RequestNotes test|
|$RequestID=                      |get_RequestID                      |$res                                                                                                                                                          |
|Login                            |${TPAMURL}                         |                     |${UserAccountRequestor}                                 |                     |${UserPwd}                                               |
|click                            |id=CurrentRequests                                                                                                                                                                                |
|waitForElementPresent            |link=$RequestID                                                                                                                                                                                   |
|clickAndWait                     |link=$RequestID                                                                                                                                                                                   |
|waitForElementPresent            |id=Password                                                                                                                                                                                       |
|click                            |id=Password                                                                                                                                                                                       |
|pause                            |10000                                                                                                                                                                                             |
|click                            |id=Details                                                                                                                                                                                        |
|waitForElementPresent            |id=ResponseComment                                                                                                                                                                                |
|type;                            |id=ResponseComment                 |can                                                                                                                                                           |
|typeKeys;                        |id=ResponseComment                 |cel                                                                                                                                                           |
|click                            |id=SubmitChanges                                                                                                                                                                                  |
|waitForTextPresent               |The response* was submitted successfully*                                                                                                                                                         |
|pause                            |150000                                                                                                                                                                                            |
|Check Mail                       |${SystemEMail}                     |                     |password release request expiration                     |                     |The password for non-managed account                     |
|Delete Mails                     |${SystemEMail}                                                                                                                                                                                    |
|Check All Mailboxes No Mail      |password release request expiration|                     |The password for non-managed account                                                                                                    |
|Remove User Permissions On System|${UserAccountRequestor}            |                     |\"PPM Requestor\"                                                                                                                       |
#|Logout                                                                                                                                                                                                                              |


!| scenario|Check Approvers Mailboxes     |subject|        |body  |
|Check Mail|${UserAccountApproverEMail}   |       |@subject||@body|
|Check Mail|${UserSystemApproverEMail}    |       |@subject||@body|
|Check Mail|${UserCollectionApproverEMail}|       |@subject||@body|
|Check Mail|${GroupAccountApproverEMail}  |       |@subject||@body|
|Check Mail|${GlobalGroupApproverEMail}   |       |@subject||@body|

!| scenario  |Clear Approvers Mailboxes     |
|Delete Mails|${UserAccountApproverEMail}   |
|Delete Mails|${UserSystemApproverEMail}    |
|Delete Mails|${UserCollectionApproverEMail}|
|Delete Mails|${GroupAccountApproverEMail}  |
|Delete Mails|${GlobalGroupApproverEMail}   |



!| scenario|Check Reviewers Mailboxes     |subject|        |body  |
|Check Mail|${UserAccountReviewerEMail}   |       |@subject||@body|
|Check Mail|${UserSystemReviewerEMail}    |       |@subject||@body|
|Check Mail|${UserCollectionReviewerEMail}|       |@subject||@body|
|Check Mail|${GroupAccountReviewerEMail}  |       |@subject||@body|
|Check Mail|${GlobalGroupReviewerEMail}   |       |@subject||@body|
|Check Mail|${GlobalGroupApproverEMail}   |       |@subject||@body|
|Check Mail|${AuditorEMail}               |       |@subject||@body|
|Check Mail|${ReviewerEscalationEMail}    |       |@subject||@body|


!| scenario  |Clear Reviewers Mailboxes     |
|Delete Mails|${UserAccountReviewerEMail}   |
|Delete Mails|${UserSystemReviewerEMail}    |
|Delete Mails|${UserCollectionReviewerEMail}|
|Delete Mails|${GroupAccountReviewerEMail}  |
|Delete Mails|${GlobalGroupReviewerEMail}   |
|Delete Mails|${GlobalGroupApproverEMail}   |
|Delete Mails|${AuditorEMail}               |
|Delete Mails|${ReviewerEscalationEMail}    |



