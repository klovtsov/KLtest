!*> Some notes
The ticket system settings should be pushed to all Auto and Manual managed accounts.
*!

!define FileName {${prefix}Origin}
!define FilePath {c:\}
!define FileEmailAddr {${prefix}FileEmailAddr0@tpam.spb.qsft}
!define FileDesc {${prefix}FileDesc} 
!define tctSysEmail {biliter@mail.ru}
!define ticketSystemName {${prefix}Bileter}

!*> Including section
!include -c <AutoTestsWebDrv.ScenarioLibrary
!include -c <AutoTestsWebDrv.TicketSystemScenarios.ScenarioLibrary
!include -c <AutoTestsWebDrv.TicketSystemScenarios.Test04ManualTicketSystem.ScenarioLibrary
!include -c <AutoTestsWebDrv.EmailScenarios.ScenarioLibrary
!include -c <AutoTestsWebDrv.PowerShellNetApiScenarios.ScenarioLibrary
!include -c ScenarioLibrary
*!

!4 Prepare test
!|script                                                                                    |
|Create Manual Ticket System|${ticketSystemName}                                            |
|Add Account                |${ManagedAccount}2|on|${SystemName}|with password|${DefaultPwd}|
|Create File                |${FilePath}       |  |${FileName}                              |
|Add File                                                                                   |

!4 Set Ticket system settings and push from system 
!|script                                                                                                                                                                                                                                                                                                                           |
|Update System                 |${SystemName}                                                                                                                                        |                   |-TicketSystemName ${ticketSystemName} -TicketEmailNotify ${tctSysEmail} -RequireTicketForRequest Y -RequireTicketForPSM Y|
|Push Ticket Defaults                                                                                                                                                                                                                                                                                                              |
|List Accounts by filter       |-systemName ${SystemName} -accountName ${ManagedAccount} -propsToList ticketSystemName,requireTicketForRequest,requireTicketForPSM,ticketEmailNotify |contains           |${ticketSystemName}\s+Y\s+Y\s+${tctSysEmail}                                                                             |
|List Accounts by filter       |-systemName ${SystemName} -accountName ${ManagedAccount}2 -propsToList ticketSystemName,requireTicketForRequest,requireTicketForPSM,ticketEmailNotify|contains           |${ticketSystemName}\s+Y\s+Y\s+${tctSysEmail}                                                                             |
|Check Ticket settings for File|${FileName}                                                                                                                                          |require for Release|true    |require for ISA    |false    |Ticket system    |${ticketSystemName}    |notify email    |${tctSysEmail}    |    |

!|script                                                                                                                                                                                                                                                        |
|Update System                 |${SystemName}                                                                                                                    |                   |-RequireTicketForAPI Y -RequireTicketForCLI Y -RequireTicketForISA Y      |
|Push Ticket Defaults                                                                                                                                                                                                                                           |
|List Accounts by filter       |-systemName ${SystemName} -accountName ${ManagedAccount} -propsToList requireTicketForISA,requireTicketForCLI,requireTicketForAPI|contains           |Y\s+Y\s+Y                                                                 |
|Check Ticket settings for File|${FileName}                                                                                                                      |require for Release|true|require for ISA|true|Ticket system|${ticketSystemName}|notify email|||

!*> Return default values
!|script                                                                                                                                                     |
|Update System       |${SystemName}    ||-TicketSystemName !Any -TicketEmailNotify !Null -RequireTicketForAPI N -RequireTicketForCLI N -RequireTicketForISA N -RequireTicketForRequest N|
|Update Account      |${ManagedAccount}||-TicketSystemName !Any -TicketEmailNotify !Null -RequireTicketForAPI N -RequireTicketForCLI N -RequireTicketForISA N -RequireTicketForRequest N|
|Delete Account      |${ManagedAccount}2                                                                                                                     |
|Delete File         |${FilePath}      ||${FileName}                                                                                                         |
|Delete Ticket System|${ticketSystemName}                                                                                                                    |
*!
