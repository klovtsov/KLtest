!********> Test Description
**************!

!*> Includes
!include -c <AutoTestsWebDrv.UsersTests.UserTypes.ScenarioLibrary
*!

!note Managed System settings
!include -c <AutoTestsWebDrv.PlatformsTesting.WindowsLocalhost

!define content {${ATPath}\PlatformsTesting\WindowsLocalHost\content.txt}
!define TPAMaddresses {10.30.44.206,10.30.44.209}
#!note Main TPAM
#!define TPAMaddress2 {${TPAMHost}}


!define TpamCLIIDUserName {${prefix}TpamCLIID}
!define CLIUserName {${prefix}CLIUserName}
!define PathToKey {${PathToKeys}\}
!define AccountName {${prefix}account}
!define AccountPwd {Pass1}
#!define Admin {${prefix}testAdmin}
#!define AdminPwd {Password2}

!define OSType {Win}
!define ProxyType {RDP}
!define TestPsmLog {${prefix}_drvpsmlog.txt}
!define Browser {FireFox}
!define Image {Fake}


#!define CLI_user_1 {${prefix}test_user_cli}
#!define CLIBatch {-i ${CLI_user_1}.ppk -C ${CLI_user_1}@${TPAMaddress2}}


!*> Includes

!include -c <AutoTestsWebDrv.PsmSmokeTest.ScenarioLibrary
!include -c <AutoTestsWebDrv.PsmSmokeTest.GroovyDriver.ScenarioLibrary 
!include -c <AutoTestsWebDrv.UsersTests.UserTypes.ScenarioLibrary
!include -c <AutoTestsWebDrv.TpamCliId.ScenarioLibrary
*!


#!*> 
Prepare
!|script                                                                                                                                                                                                                                                              |
|Add System       |${CLIBatch}||--SystemName ${SystemName} --PlatformName ${SystemPlatform} --NetworkAddress ${SystemAddress} --FunctionalAccoun ${FunctAcct} --FuncAcctCred \"${FunctAcctPwd}\"                                                         ||successfull|
|Add Account      |${CLIBatch}||--SystemName ${SystemName} --AccountName ${AccountName}                                                                                                                                                                  ||successfull|
|CreateEnv                                                                                                                                                                                                                                                            |
|UpdatePSMAccount |${CLIBatch}||--System ${SystemName} --Account ${AccountName} --MinApprovers 0 --EnableFlag Y --proxytype \"RDP - Automatic Login Using Password\" --PasswordMethod \"Remote TPAM CLI\" --TPAMCLIUserName TpamNameForCli/${CLIUserName}||successfull|
|Set Access Policy|${CLIBatch}||--Action Add --UserName ${TPAMAdmin} --SystemName ${SystemName} --AccessPolicyName Requestor                                                                                                                             ||successfull|
|Set Access Policy|${CLIBatch}||--Action Add --UserName ${CLI_user_1} --SystemName ${SystemName} --AccessPolicyName Requestor                                                                                                                            ||successfull|
|Create Account on System                                                                                                                                                                                                                                             |
|Create logon script                                                                                                                                                                                                                                                  |
|pause            |60000                                                                                                                                                                                                                                              |

#|Add Session Request|${CLIBatch}||AddSessionRequest --SystemName ${SystemName} --AccountName ${AccountName} --ForUserName ${TPAMAdmin} --RequestNotes test                                                                                                 ||successfull|
#*!


#|AddUser         |${CLIBatch}||--UserName ${Admin} --FitstName fname --LastName lname --UserType Admin --Password Password1                                                                                                                             ||successfull|
#|Change Pwd      |${Admin}   ||Password1                                                                                                                                                                                                                ||${AdminPwd}|


!|script                                                                                                                                                                     |
|$res=            |CLI                  |${CLIBatch} AddSessionRequest --SystemName ${SystemName} --AccountName ${AccountName} --ForUserName ${TPAMAdmin} --RequestNotes test|
|Verify_Contain_OR|$res;;submitted                                                                                                                                           |
|$RequestID=      |get_session_RequestID|$res                                                                                                                                |
|Connect          |${TPAMAdmin}         |               |${DefaultPwd}               |               |${AccountName}               |               |$RequestID               |
|pause            |60000                                                                                                                                                     |
|Check logon script                                                                                                                                                          |


!|script                                                           |
|Delete logon script                                               |
|Delete System|${CLIBatch}||--SystemName ${SystemName}||successfull|
|DeleteEnv                                                         |
|Delete Account on System                                          |

