!contents


!|scenario      |Prepare Test                                      |
|Login          |${TPAMURL}           ||${TPAMAdmin}||${DefaultPwd}|
|Add Groups and Collections                                        |
|Add System                                                        |
|Add Fake User  |${FakeUserName}1                                  |
|Add Fake User  |${FakeUserName}2                                  |
|Add Fake System|${FakeSystemName}1                                |
|Add Fake System|${FakeSystemName}2                                |
|Create OUs                                                        |
|Create Mailbox |${AutoDiscoveryEMail}||${TPAMEMailPassword}       |
|Create Templates                                                  |
|Create Users in Directory                                         |
|Create Systems in Directory                                       |



#!| scenario       |Add system                                                                                                                                                                                                                                           |
#|$res=            |CLI|${CLIBatch} AddSystem --SystemName ${SystemName} --NetworkAddress ${SystemAddress} --PlatformName \"${SystemPlatform}\" --FunctionalAccount ${FunctAcct} --FuncAcctCred \"${FunctAcctPwd}\" --Timeout ${SystemTimeout} --DomainName ${DomainName}|
#|Verify_Contain_OR|$res;;successful                                                                                                                                                                                                                                     |

!|scenario            |Add system                               |
|pause                |5000                                     |
|clickOnLink          |link=Add System                          |
|waitForElementPresent|id=SystemName                            |
|type;                |id=SystemName    |${SystemName}          |
|type;                |id=NetworkAddress|${SystemAddress}       |
|select;              |id=PlatformID    |label=${SystemPlatform}|
|click                |id=Connection    |                       |
|type;                |id=PARFuncAcct   |${FunctAcct}           |
|type;                |id=PARFuncAcctDN |${FunctAcctDN}         |
|type;                |id=pword         |${FunctAcctPwd}        |
|type;                |id=ConfPword     |${FunctAcctPwd}        |
|type;                |id=DomainName    |${DomainName}          |
|click                |id=bt_Save       |                       |
|waitForTextPresent   |System changes for * saved successfully  |



!|scenario|Create OUs                                                                                                |
|runBatch |LDAPAction;createou;${SystemAddress};ou=${UserContainerName1},${BaseName};${FunctAcctDN};${FunctAcctPwd}  |
|runBatch |LDAPAction;createou;${SystemAddress};ou=${UserContainerName2},${BaseName};${FunctAcctDN};${FunctAcctPwd}  |
|runBatch |LDAPAction;createou;${SystemAddress};ou=${UserContainerName3},${BaseName};${FunctAcctDN};${FunctAcctPwd}  |
|runBatch |LDAPAction;createou;${SystemAddress};ou=${SystemContainerName1},${BaseName};${FunctAcctDN};${FunctAcctPwd}|
|runBatch |LDAPAction;createou;${SystemAddress};ou=${SystemContainerName2},${BaseName};${FunctAcctDN};${FunctAcctPwd}|

!|scenario               |Create Users in Directory                       |
|Create User in Directory|${UserContainerName1}||${DiscoveredUserName}1   |
|Create User in Directory|${UserContainerName1}||${DiscoveredUserName}3   |
|Create User in Directory|${UserContainerName1}||${FakeUserName}1         |
|Create User in Directory|${UserContainerName1}||${NotDiscoveredUserName}1|
|Create User in Directory|${UserContainerName2}||${DiscoveredUserName}2   |
|Create User in Directory|${UserContainerName2}||${RestrictedUserName}    |
|Create User in Directory|${UserContainerName2}||${NotDiscoveredUserName}2|

!|scenario                 |Create Systems in Directory                         |
|Create System in Directory|${SystemContainerName1}||${DiscoveredSystemName}1   |
|Create System in Directory|${SystemContainerName1}||${DiscoveredSystemName}3   |
|Create System in Directory|${SystemContainerName1}||${NotDiscoveredSystemName}1|
|Create System in Directory|${SystemContainerName2}||${DiscoveredSystemName}2   |
|Create System in Directory|${SystemContainerName2}||${NotDiscoveredSystemName}2|
|Create System in Directory|${SystemContainerName2}||${FakeSystemName}1         |

!|scenario|Create User in Directory                     |ouName                     |                    |userName                    |
|runBatch |LDAPAction;createuser;${SystemAddress};ou=@ouName,${BaseName};${FunctAcctDN};${FunctAcctPwd};@userName;${ManagedAccountPwd}|

!|scenario|Create System in Directory                |ouName                |                |systemName               |
|runBatch |LDAPAction;createcomputer;${SystemAddress};ou=@ouName,${BaseName};${FunctAcctDN};${FunctAcctPwd};@systemName|


!|scenario|Delete OUs                                                                                                |
|runBatch |LDAPAction;deleteou;${SystemAddress};ou=${UserContainerName1},${BaseName};${FunctAcctDN};${FunctAcctPwd}  |
|runBatch |LDAPAction;deleteou;${SystemAddress};ou=${UserContainerName2},${BaseName};${FunctAcctDN};${FunctAcctPwd}  |
|runBatch |LDAPAction;deleteou;${SystemAddress};ou=${UserContainerName3},${BaseName};${FunctAcctDN};${FunctAcctPwd}  |
|runBatch |LDAPAction;deleteou;${SystemAddress};ou=${SystemContainerName1},${BaseName};${FunctAcctDN};${FunctAcctPwd}|
|runBatch |LDAPAction;deleteou;${SystemAddress};ou=${SystemContainerName2},${BaseName};${FunctAcctDN};${FunctAcctPwd}|


!|scenario               |Delete Users in Directory                       |
|Delete User in Directory|${UserContainerName1}||${NotDiscoveredUserName}1|
|Delete User in Directory|${UserContainerName1}||${FakeUserName}1         |
|Delete User in Directory|${UserContainerName1}||${FakeUserName}2         |
|Delete User in Directory|${UserContainerName1}||${DiscoveredUserName}2   |
|Delete User in Directory|${UserContainerName2}||${NotDiscoveredUserName}2|
|Delete User in Directory|${UserContainerName2}||${RestrictedUserName}    |

!|scenario                 |Delete Systems in Directory                         |
|Delete System in Directory|${SystemContainerName1}||${DiscoveredSystemName}2   |
|Delete System in Directory|${SystemContainerName1}||${NotDiscoveredSystemName}1|
|Delete System in Directory|${SystemContainerName2}||${NotDiscoveredSystemName}2|
|Delete System in Directory|${SystemContainerName2}||${FakeSystemName}1         |
|Delete System in Directory|${SystemContainerName2}||${FakeSystemName}2         |


!|scenario|Delete User in Directory                |ouName               |               |userName               |
|runBatch |LDAPAction;deleteuser;${SystemAddress};ou=@ouName,${BaseName};${FunctAcctDN};${FunctAcctPwd};@userName|

!|scenario|Delete System in Directory                |ouName                |                |systemName               |
|runBatch |LDAPAction;deletecomputer;${SystemAddress};ou=@ouName,${BaseName};${FunctAcctDN};${FunctAcctPwd};@systemName|



!|scenario                    |Auto Discovery                                                                                                                                     |
|Create LDAP User Mapping                                                                                                                                                         |
|Run Discovery                                                                                                                                                                    |
|Create LDAP System Mapping                                                                                                                                                       |
|Run Discovery                                                                                                                                                                    |
|pause                        |180000                                                                                                                                             |
|Users Discovered                                                                                                                                                                 |
|Users Not Discovered                                                                                                                                                             |
|Systems Discovered                                                                                                                                                               |
|Systems Not Discovered                                                                                                                                                           |
|Errors Reported About Skipping Objects                                                                                                                                           |
|Check BFER 6708                                                                                                                                                                  |
|Check No Mail                |${AutoDiscoveryEMail}                 ||TPAM LDAP Integration for Collection ${CollectionName}||Updated TPAM system                                |
|Delete Mails                 |${AutoDiscoveryEMail}                                                                                                                              |
|Delete User in Directory     |${UserContainerName1}                 ||${DiscoveredUserName}1                                                                                     |
|Delete System in Directory   |${SystemContainerName1}               ||${DiscoveredSystemName}1                                                                                   |
|Create User in Directory     |${UserContainerName1}                 ||${DiscoveredUserName}2                                                                                     |
|Create System in Directory   |${SystemContainerName1}               ||${DiscoveredSystemName}2                                                                                   |
|Select LDAP Mapping for      |${GroupName}                                                                                                                                       |
|Run Discovery                                                                                                                                                                    |
|Select LDAP Mapping for      |${CollectionName}                                                                                                                                  |
|Run Discovery                                                                                                                                                                    |
|pause                        |180000                                                                                                                                             |
|Errors Reported About Skipping Objects With Existing Mapping                                                                                                                     |
|Errors Reported About Deleting Objects                                                                                                                                           |
|Delete Mails                 |${AutoDiscoveryEMail}                                                                                                                              |
|Select LDAP Mapping for      |${GroupName}                                                                                                                                       |
|Set User Collision Strategy  |Create Unique                         ||Create Unique TPAM User                               ||Report as Error        ||Disable User in TPAM      |
|Delete User in Directory     |${UserContainerName1}                 ||${DiscoveredUserName}3                                                                                     |
|Run Discovery                                                                                                                                                                    |
|Select LDAP Mapping for      |${CollectionName}                                                                                                                                  |
|Set System Collision Strategy|Create Unique TPAM System             ||Report as Error                                       ||Soft Delete System regardless of other mappings    |
|Delete System in Directory   |${SystemContainerName1}               ||${DiscoveredSystemName}3                                                                                   |
|Run Discovery                                                                                                                                                                    |
|pause                        |180000                                                                                                                                             |
|Create Unique Name For Restricted User Name                                                                                                                                      |
|Create Unique User If User Exists Without Mapping                                                                                                                                |
|Create Unique System If System Exists Without Mapping                                                                                                                            |
|User Disabled By Collision Strategy                                                                                                                                              |
|System Deleted By Collision Strategy                                                                                                                                             |
|Select LDAP Mapping for      |${GroupName}                                                                                                                                       |
|Set User Collision Strategy  |Create Unique                         ||Report as Error                                       ||Create Unique TPAM User||Disable User in TPAM      |
|Run Discovery                                                                                                                                                                    |
|Select LDAP Mapping for      |${CollectionName}                                                                                                                                  |
|Set System Collision Strategy|Report as Error                       ||Create Unique TPAM System                             ||Soft Delete System regardless of other mappings    |
|Run Discovery                                                                                                                                                                    |
|pause                        |180000                                                                                                                                             |
|Create Unique User If User Exists With Mapping                                                                                                                                   |
|Create Unique System If System Exists With Mapping                                                                                                                               |
|Check No Mail                |${AutoDiscoveryEMail}                 ||TPAM LDAP Integration for Collection ${CollectionName}||Error reported per Collision Strategy              |
|Check No Mail                |${AutoDiscoveryEMail}                 ||TPAM LDAP Integration for Group ${GroupName}          ||Error reported per Collision Strategy              |
|Delete Mails                 |${AutoDiscoveryEMail}                                                                                                                              |
|Select LDAP Mapping for      |${GroupName}                                                                                                                                       |
|Set User Collision Strategy  |Create Unique                         ||Map to Existing                                       ||Create Unique TPAM User||Leave User, remove mapping|
|Delete User in Directory     |${UserContainerName2}                 ||${DiscoveredUserName}2                                                                                     |
|Create User in Directory     |${UserContainerName1}                 ||${FakeUserName}2                                                                                           |
|Run Discovery                                                                                                                                                                    |
|Select LDAP Mapping for      |${CollectionName}                                                                                                                                  |
|Set System Collision Strategy|Map to Existing                       ||Create Unique TPAM System                             ||Leave System, remove mapping                       |
|Delete System in Directory   |${SystemContainerName2}               ||${DiscoveredSystemName}2                                                                                   |
|Create System in Directory   |${SystemContainerName2}               ||${FakeSystemName}2                                                                                         |
|Run Discovery                                                                                                                                                                    |
|pause                        |180000                                                                                                                                             |
|Map Discovered User To Existing One                                                                                                                                              |
|Map Discovered System To Existing One                                                                                                                                            |
|Leave User Deleted From Source And Remove Mapping                                                                                                                                |
|Leave System Deleted From Source And Remove Mapping                                                                                                                              |
|Delete Mails                 |${AutoDiscoveryEMail}                                                                                                                              |
|BFER 7168 Map Previously Deleted User Name To Existing One                                                                                                                       |
|Select LDAP Mapping for      |${GroupName}                                                                                                                                       |
|Add Mapping Row              |ou=${UserContainerName1},${BaseName}  ||${UserFilter3}                                        ||${UserTemplateName1} [Administrator]               |
|Run Discovery                                                                                                                                                                    |
|Select LDAP Mapping for      |${CollectionName}                                                                                                                                  |
|Add Mapping Row              |ou=${SystemContainerName1},${BaseName}||${SystemFilter3}                                      ||${SystemTemplateName1} [Windows]                   |
|Run Discovery                                                                                                                                                                    |
|pause                        |180000                                                                                                                                             |
|Previously Not Discovered Objects Added By New Filter Row                                                                                                                        |
|Delete Mails                 |${AutoDiscoveryEMail}                                                                                                                              |



!|scenario             |Users Discovered                                                                                                       |
|Check User            |${DiscoveredUserName}1||Ivan                                        ||Ivanov||${DiscoveredUserName}1@${TPAMEMailDomain}|
|Check User            |${DiscoveredUserName}2||Ivan                                        ||Ivanov||${DiscoveredUserName}2@${TPAMEMailDomain}|
|Check Group Membership|${GroupName}          ||${DiscoveredUserName}1                                                                         |
|Check Group Membership|${GroupName}          ||${DiscoveredUserName}2                                                                         |
|Check Group Membership|${GroupName}          ||${DiscoveredUserName}3                                                                         |
|Check Mail            |${AutoDiscoveryEMail} ||TPAM LDAP Integration for Group ${GroupName}||Adding user ${DiscoveredUserName}1               |
|Check Mail            |${AutoDiscoveryEMail} ||TPAM LDAP Integration for Group ${GroupName}||Adding user ${DiscoveredUserName}2               |
|Check Mail            |${AutoDiscoveryEMail} ||TPAM LDAP Integration for Group ${GroupName}||Adding user ${DiscoveredUserName}3               |


!|scenario    |Users Not Discovered     |
|Check No User|${NotDiscoveredUserName}1|
|Check No User|${NotDiscoveredUserName}2|

!|scenario                  |Systems Discovered                                                                                                      |
|Check System               |${DiscoveredSystemName}1||unspecified_in_Directory                                                                      |
|Check System               |${DiscoveredSystemName}2||unspecified_in_Directory                                                                      |
|Check Collection Membership|${CollectionName}       ||${DiscoveredSystemName}1                                                                      |
|Check Collection Membership|${CollectionName}       ||${DiscoveredSystemName}2                                                                      |
|Check Collection Membership|${CollectionName}       ||${DiscoveredSystemName}3                                                                      |
|Check Mail                 |${AutoDiscoveryEMail}   ||TPAM LDAP Integration for Collection ${CollectionName}||Adding system ${DiscoveredSystemName}1|
|Check Mail                 |${AutoDiscoveryEMail}   ||TPAM LDAP Integration for Collection ${CollectionName}||Adding system ${DiscoveredSystemName}2|
|Check Mail                 |${AutoDiscoveryEMail}   ||TPAM LDAP Integration for Collection ${CollectionName}||Adding system ${DiscoveredSystemName}3|


!|scenario      |Systems Not Discovered     |
|Check No System|${NotDiscoveredSystemName}1|
|Check No System|${NotDiscoveredSystemName}2|

!|scenario                  |Previously Not Discovered Objects Added By New Filter Row                                                                                |
|Check User                 |${NotDiscoveredUserName}1  ||Ivan                                                  ||Ivanov||${NotDiscoveredUserName}1@${TPAMEMailDomain}|
|Check Group Membership     |${GroupName}               ||${NotDiscoveredUserName}1                                                                                   |
|Check Mail                 |${AutoDiscoveryEMail}      ||TPAM LDAP Integration for Group ${GroupName}          ||Adding user ${NotDiscoveredUserName}1               |
|Check No User              |${NotDiscoveredUserName}2                                                                                                                |
|Check System               |${NotDiscoveredSystemName}1||unspecified_in_Directory                                                                                    |
|Check Collection Membership|${CollectionName}          ||${NotDiscoveredSystemName}1                                                                                 |
|Check Mail                 |${AutoDiscoveryEMail}      ||TPAM LDAP Integration for Collection ${CollectionName}||Adding system ${NotDiscoveredSystemName}1           |
|Check No System            |${NotDiscoveredSystemName}2                                                                                                              |


!|scenario      |Errors Reported About Skipping Objects                                                                                                                         |
|Check Mail     |${AutoDiscoveryEMail}||TPAM LDAP Integration for Group ${GroupName}          ||Skipping userID ${RestrictedUserName} because it is a reserved username in TPAM.|
|Check Mail     |${AutoDiscoveryEMail}||TPAM LDAP Integration for Group ${GroupName}          ||Skipping userID ${FakeUserName}1                                                |
|Check Mail     |${AutoDiscoveryEMail}||TPAM LDAP Integration for Collection ${CollectionName}||Skipping system ${FakeSystemName}1 because this system already exists in TPAM.  |
|Check No User  |${RestrictedUserName}_1                                                                                                                                        |
|Check No User  |${FakeUserName}1_1                                                                                                                                             |
|Check No System|${FakeSystemName}1_1                                                                                                                                           |

!|scenario   |Errors Reported About Deleting Objects                                                                                                                                                                                                 |
|Check Mail  |${AutoDiscoveryEMail}   ||TPAM LDAP Integration for Group ${GroupName}          ||Error reported per Collision Strategy. ${DiscoveredUserName}1 removed from Directory Mapping for Group ${GroupName}. Mapping not removed             |
|Check Mail  |${AutoDiscoveryEMail}   ||TPAM LDAP Integration for Collection ${CollectionName}||Error reported per Collision Strategy. ${DiscoveredSystemName}1 removed from Directory Mapping for Collection ${CollectionName}. Mapping not removed.|
|Check User  |${DiscoveredUserName}1  ||Ivan                                                  ||Ivanov                                  |                                 |${DiscoveredUserName}1@${TPAMEMailDomain}                                 |
|Check System|${DiscoveredSystemName}1||unspecified_in_Directory                                                                                                                                                                                     |



!|scenario      |Errors Reported About Skipping Objects With Existing Mapping                                                                                                                                    |
|Check Mail     |${AutoDiscoveryEMail}||TPAM LDAP Integration for Group ${GroupName}          ||Skipping userID ${DiscoveredUserName}2 because there is an existing userid in TPAM with a different DN mapping   |
|Check Mail     |${AutoDiscoveryEMail}||TPAM LDAP Integration for Collection ${CollectionName}||Skipping system ${DiscoveredSystemName}2 because there is an existing system in TPAM with a different DN mapping.|
|Check No User  |${DiscoveredUserName}2_1                                                                                                                                                                        |
|Check No System|${DiscoveredSystemName}2_1                                                                                                                                                                      |


!|scenario             |Create Unique Name For Restricted User Name                                                                            |
|Check User            |${RestrictedUserName}_1||Ivan                                        ||Ivanov||${RestrictedUserName}@${TPAMEMailDomain}|
|Check Group Membership|${GroupName}           ||${RestrictedUserName}_1                                                                       |
|Check Mail            |${AutoDiscoveryEMail}  ||TPAM LDAP Integration for Group ${GroupName}||Adding user ${RestrictedUserName}_1             |


!|scenario             |Create Unique User If User Exists Without Mapping                                                               |
|Check User            |${FakeUserName}1_1   ||Ivan                                        ||Ivanov||${FakeUserName}1@${TPAMEMailDomain}|
|Check Group Membership|${GroupName}         ||${FakeUserName}1_1                                                                       |
|Check Mail            |${AutoDiscoveryEMail}||TPAM LDAP Integration for Group ${GroupName}||Adding user ${FakeUserName}1_1             |


!|scenario                  |Create Unique System If System Exists Without Mapping                                                            |
|Check System               |${FakeSystemName}1_1 ||unspecified_in_Directory                                                                  |
|Check Collection Membership|${CollectionName}    ||${FakeSystemName}1_1                                                                      |
|Check Mail                 |${AutoDiscoveryEMail}||TPAM LDAP Integration for Collection ${CollectionName}||Adding system ${FakeSystemName}1_1|

!|scenario             |Create Unique User If User Exists With Mapping                                                                           |
|Check User            |${DiscoveredUserName}2_1||Ivan                                        ||Ivanov||${DiscoveredUserName}2@${TPAMEMailDomain}|
|Check Group Membership|${GroupName}            ||${DiscoveredUserName}2_1                                                                       |
|Check Mail            |${AutoDiscoveryEMail}   ||TPAM LDAP Integration for Group ${GroupName}||Adding user ${DiscoveredUserName}2_1             |

!|scenario                  |Create Unique System If System Exists With Mapping                                                                          |
|Check System               |${DiscoveredSystemName}2_1||unspecified_in_Directory                                                                        |
|Check Collection Membership|${CollectionName}         ||${DiscoveredSystemName}2_1                                                                      |
|Check Mail                 |${AutoDiscoveryEMail}     ||TPAM LDAP Integration for Collection ${CollectionName}||Adding system ${DiscoveredSystemName}2_1|

!|scenario             |Map Discovered User To Existing One                                                                                                                                                   |
|Check Mail            |${AutoDiscoveryEMail}||TPAM LDAP Integration for Group ${GroupName}||Adding DN mapping for TPAM username ${FakeUserName}2 to uid=${FakeUserName}2,ou=${UserContainerName1},${BaseName}|
|Check Mail            |${AutoDiscoveryEMail}||TPAM LDAP Integration for Group ${GroupName}||Updated TPAM user ${FakeUserName}2 with changes from Directory unique userID                                     |
|Check Mail            |${AutoDiscoveryEMail}||TPAM LDAP Integration for Group ${GroupName}||Adding TPAM user ${FakeUserName}2(Directory UserName:${FakeUserName}2) to group ${GroupName}                     |
|Check Mapped User     |${FakeUserName}2     ||Ivan                                        ||Ivanov             |             |${FakeUserName}2@${TPAMEMailDomain}             |            |Basic            |
|Check Group Membership|${GroupName}         ||${FakeUserName}2                                                                                                                                               |

!|scenario               |BFER 7168 Map Previously Deleted User Name To Existing One                                                                                                                                                       |
|Create User in Directory|${UserContainerName3}               ||${DiscoveredUserName}2                                                                                                                                                     |
|Select LDAP Mapping for |${GroupName}                                                                                                                                                                                                     |
|Add Mapping Row         |ou=${UserContainerName3},${BaseName}||(!(cn=fffffffffff))                         ||${UserTemplateName2} [Administrator]                                                                                         |
|Run Discovery                                                                                                                                                                                                                             |
|pause                   |180000                                                                                                                                                                                                           |
|Check Mail              |${AutoDiscoveryEMail}               ||TPAM LDAP Integration for Group ${GroupName}||Adding DN mapping for TPAM username ${DiscoveredUserName}2 to uid=${DiscoveredUserName}2,ou=${UserContainerName3},${BaseName}|
|Check Mail              |${AutoDiscoveryEMail}               ||TPAM LDAP Integration for Group ${GroupName}||Adding TPAM user ${DiscoveredUserName}2(Directory UserName:${DiscoveredUserName}2) to group ${GroupName}                     |
|Check Mapped User       |${DiscoveredUserName}2              ||Ivan                                        ||Ivanov             |            |${DiscoveredUserName}2@${TPAMEMailDomain}            |            |Administrator            |
|Check Group Membership  |${GroupName}                        ||${DiscoveredUserName}2                                                                                                                                                     |
|Delete User in Directory|${UserContainerName3}               ||${DiscoveredUserName}2                                                                                                                                                     |


!|scenario                  |Map Discovered System To Existing One                                                                                                                                                         |
|Check Mail                 |${AutoDiscoveryEMail}||TPAM LDAP Integration for Collection ${CollectionName}||Adding DN mapping for system ${FakeSystemName}2 to cn=${FakeSystemName}2,ou=${SystemContainerName2},${BaseName}|
|Check Mail                 |${AutoDiscoveryEMail}||TPAM LDAP Integration for Collection ${CollectionName}||Updated TPAM system ${FakeSystemName}2 with changes from Directory object                                      |
|Check Mail                 |${AutoDiscoveryEMail}||TPAM LDAP Integration for Collection ${CollectionName}||Adding system ${FakeSystemName}2 to collection ${CollectionName}                                               |
|Check Mail                 |${AutoDiscoveryEMail}||TPAM LDAP Integration for Collection ${CollectionName}||${FakeSystemName}2                                                                                             |
|Check Mapped System        |${FakeSystemName}2   ||unspecified_in_Directory                                                                                                                                               |
|Check Collection Membership|${CollectionName}    ||${FakeSystemName}2                                                                                                                                                     |

!|scenario                |Leave User Deleted From Source And Remove Mapping                                                                                 |
|Check Mail               |${AutoDiscoveryEMail} ||TPAM LDAP Integration for Group ${GroupName}||Removing user ${DiscoveredUserName}2 from group ${GroupName}|
|Check User               |${DiscoveredUserName}2||Ivan                                        ||Ivanov    |    |${DiscoveredUserName}2@${TPAMEMailDomain}   |
|Check No Group Membership|${GroupName}          ||${DiscoveredUserName}2                                                                                    |


!|scenario                     |Leave System Deleted From Source And Remove Mapping                                                                                                         |
|Check Mail                    |${AutoDiscoveryEMail}   ||TPAM LDAP Integration for Collection ${CollectionName}||Removing system ${DiscoveredSystemName}2 from collection ${CollectionName}|
|Check System                  |${DiscoveredSystemName}2||unspecified_in_Directory                                                                                                          |
|Check No Collection Membership|${CollectionName}       ||${DiscoveredSystemName}2                                                                                                          |


!|scenario                |User Disabled By Collision Strategy                                                                                                                                                                                     |
|Check User Disabled      |${DiscoveredUserName}3                                                                                                                                                                                                  |
|Check User Disabled      |${DiscoveredUserName}1                                                                                                                                                                                                  |
|Check No Group Membership|${GroupName}         ||${DiscoveredUserName}3                                                                                                                                                                           |
|Check Mail               |${AutoDiscoveryEMail}||TPAM LDAP Integration for Group ${GroupName}||Removing user ${DiscoveredUserName}3 from group ${GroupName}                                                                                       |
|Check Mail               |${AutoDiscoveryEMail}||TPAM LDAP Integration for Group ${GroupName}||Disabling user ${DiscoveredUserName}3 because it no longer belongs to any Directory group and the deletion strategy for this mapping is to disable.|
|Check Mail               |${AutoDiscoveryEMail}||TPAM LDAP Integration for Group ${GroupName}||Disabling user ${DiscoveredUserName}1 because it no longer belongs to any Directory group and the deletion strategy for this mapping is to disable.|


!|scenario                     |System Deleted By Collision Strategy                                                                                                                     |
|Check No System               |${DiscoveredSystemName}3                                                                                                                                 |
|Check No Collection Membership|${CollectionName}    ||${DiscoveredSystemName}3                                                                                                          |
|Check Mail                    |${AutoDiscoveryEMail}||TPAM LDAP Integration for Collection ${CollectionName}||Removing system ${DiscoveredSystemName}3 from collection ${CollectionName}|
|Check Mail                    |${AutoDiscoveryEMail}||TPAM LDAP Integration for Collection ${CollectionName}||${DiscoveredSystemName}3 has been successfully deleted                    |


!|scenario             |Create Templates                                  |
|Create User Template  |${UserTemplateName1}  ||${TemplateGroupName1}     |
|Create User Template  |${UserTemplateName2}  ||${TemplateGroupName2}     |
|Create System Template|${SystemTemplateName1}||${TemplateCollectionName1}|
|Create System Template|${SystemTemplateName2}||${TemplateCollectionName2}|

!|scenario             |Delete Templates      |
|Delete User Template  |${UserTemplateName1}  |
|Delete User Template  |${UserTemplateName2}  |
|Delete System Template|${SystemTemplateName1}|
|Delete System Template|${SystemTemplateName2}|



!|scenario            |Create User Template|templateName   |   |groupName   |
|clickOnLink          |link=Add User Template                               |
|pause                |5000                                                 |
|waitForElementPresent|id=UserName                                          |
|type;                |id=UserName         |@templateName                   |
|type;                |id=FirstName        |John                            |
|type;                |id=LastName         |Doe                             |
|type;                |id=Phone            |777-777-777                     |
|type;                |id=Pager            |888-888-888                     |
|type;                |id=EmailID          |@templateName@${TPAMEMailDomain}|
|type;                |id=Comment          |@templateName description       |
|select;              |id=UType            |label=Administrator             |
|click                |id=cbxMobile                                         |
|type;                |id=sPassword        |grain41R                        |
|type;                |id=Confirm          |grain41R                        |
|click                |id=KeyBased                                          |
|waitForElementPresent|id=cb_CliAccess                                      |
|click                |id=cb_CliAccess                                      |
|click                |id=Time                                              |
|waitForElementPresent|id=rbAllow                                           |
|click                |id=rbAllow                                           |
|click                |id=SubmitChanges                                     |
|waitForTextPresent   |User added successfully                              |
|Add User To Group    |@templateName       |               |@groupName      |

!|scenario               |Create System Template    |templateName     |    |collectionName    |
|clickOnLink             |link=Add System Template                                            |
|pause                   |5000                                                                |
|type;                   |id=SystemName             |@templateName                            |
|type;                   |id=NetworkAddress         |1.1.1.1                                  |
|select;                 |id=PlatformID             |label=Windows                            |
|select;                 |id=MaxDurationDays        |label=3                                  |
|type;                   |id=PrimaryEmail           |@templateName@${TPAMEMailDomain}         |
|type;                   |id=Comment                |@templateName description                |
|type;                   |id=EscalationTime         |30                                       |
|type;                   |id=EscalationEmail        |Escalation@${TPAMEMailDomain}            |
|click                   |id=Connection                                                       |
|waitForElementPresent   |id=cb_AllowFuncReqFl                                                |
|type;                   |id=PARFuncAcct            |funk                                     |
|type;                   |id=pword                  |grain41R                                 |
|type;                   |id=ConfPword              |grain41R                                 |
|click                   |id=cb_AllowFuncReqFl                                                |
|click                   |id=Management                                                       |
|select;                 |id=PasswordCheckProfileID |label=${PersistentPasswordCheckProfile1} |
|select;                 |id=PasswordChangeProfileID|label=${PersistentPasswordChangeProfile1}|
|select;                 |id=DurationHrs            |label=3                                  |
|select;                 |id=DurationQtrHrs         |label=30                                 |
|click                   |id=cb_AllowISADuration                                              |
|click                   |id=TicketSystem                                                     |
|click                   |id=RequireTixForRequest                                          |
|click                   |id=RequireTixForCLI                                              |
|type;                   |id=TixEmailNotify         |TicketNotify@${TPAMEMailDomain}          |
|click                   |id=bt_Save                                                          |
|waitForTextPresent      |System changes for @templateName saved successfully                 |
|Add System To Collection|@templateName             |                 |@collectionName        |

!|scenario     |Add Groups and Collections|
|Add Group     |${TemplateGroupName1}     |
|Add Group     |${TemplateGroupName2}     |
|Add Collection|${TemplateCollectionName1}|
|Add Collection|${TemplateCollectionName2}|

!|scenario        |Delete Groups and Collections|
|Delete Group     |${TemplateGroupName1}        |
|Delete Group     |${TemplateGroupName2}        |
|Delete Group     |${GroupName}                 |
|Delete Collection|${TemplateCollectionName1}   |
|Delete Collection|${TemplateCollectionName2}   |
|Delete Collection|${CollectionName}            |


!|scenario                  |Create LDAP User Mapping                                                                   |
|clickOnLink                |link=LDAP Directory                                                                        |
|pause                      |3000                                                                                       |
|click                      |id=AddUsersButton                                                                          |
|pause                      |1000                                                                                       |
|select;                    |id=SystemID                         |label=${SystemName}                                   |
|type;                      |id=PARGroupName                     |${GroupName}                                          |
|Add Mapping Row            |ou=${UserContainerName1},${BaseName}||${UserFilter1} ||${UserTemplateName1} [Administrator]|
|Add Mapping Row            |ou=${UserContainerName2},${BaseName}||${UserFilter2} ||${UserTemplateName2} [Administrator]|
|Set Auto Update Minutes    |15                                                                                         |
|select;                    |id=NotifyType                       |label=All                                             |
|type;                      |id=NotifyEmail                      |${AutoDiscoveryEMail}                                 |
|Set User Collision Strategy|Report as Error                     ||Report as Error||Report as Error  | |Report as Error |
|click                      |id=SaveButton                                                                              |
|waitForTextPresent         |New Auto Discovery mapping saved successfully                                              |
|waitForTextPresent         |User Distinguished Name Filter * saved successfully                                        |
|pause                      |10000                                                                                      |


!|scenario                    |Create LDAP System Mapping                                                                |
|pause                        |3000                                                                                      |
|click                        |id=AddComputersButton                                                                     |
|pause                        |1000                                                                                      |
|select;                      |id=SystemID                           |label=${SystemName}                                |
|type;                        |id=PARCollectionName                  |${CollectionName}                                  |
|Add Mapping Row              |ou=${SystemContainerName1},${BaseName}||${SystemFilter1}||${SystemTemplateName1} [Windows]|
|Add Mapping Row              |ou=${SystemContainerName2},${BaseName}||${SystemFilter2}||${SystemTemplateName2} [Windows]|
|Set Auto Update Minutes      |15                                                                                        |
|select;                      |id=NotifyType                         |label=All                                          |
|type;                        |id=NotifyEmail                        |${AutoDiscoveryEMail}                              |
|Set System Collision Strategy|Report as Error                       ||Report as Error ||Report as Error                 |
|click                        |id=SaveButton                                                                             |
|waitForTextPresent           |New Auto Discovery mapping saved successfully                                             |
|waitForTextPresent           |Computer Distinguished Name Filter * saved successfully                                   |
|pause                        |10000                                                                                     |



!|scenario              |Delete LDAP Mapping for|container|
|Select LDAP Mapping for|@container                       |
|click                  |id=DeleteButton                  |
|getConfirmation                                          |
|pause                  |10000                            |

!|scenario              |Clear Objects              |
|Delete Users in Directory                          |
|Delete Systems in Directory                        |
|Delete OUs                                         |
|Delete LDAP Mapping for|${CollectionName}          |
|Delete LDAP Mapping for|${GroupName}               |
|Remove User            |${FakeUserName}1           |
|Remove User            |${FakeUserName}2           |
|Remove User            |${RestrictedUserName}_1    |
|Remove User            |${FakeUserName}1_1         |
|Remove User            |${NotDiscoveredUserName}1  |
|Remove User            |${DiscoveredUserName}1     |
|Remove User            |${DiscoveredUserName}2     |
|Remove User            |${DiscoveredUserName}2_1   |
|Remove User            |${DiscoveredUserName}3     |
|Remove System          |${SystemName}              |
|Remove System          |${FakeSystemName}1         |
|Remove System          |${FakeSystemName}2         |
|Remove System          |${FakeSystemName}1_1       |
|Remove System          |${NotDiscoveredSystemName}1|
|Remove System          |${DiscoveredSystemName}2   |
|Remove System          |${DiscoveredSystemName}2_1 |
|Delete Groups and Collections                      |
|Delete Templates                                   |
|Delete Mailbox         |${AutoDiscoveryEMail}      |
|Logout                                             |

!|scenario            |Check User      |userName||firstName||lastName||eMail|
|clickOnLink          |link=Manage UserIDs                                  |
|waitForElementPresent|id=UsrNm                                             |
|type;                |id=UsrNm        |@userName                           |
|click                |id=Listing                                           |
|click                |xpath=//td[contains(text(),'@userName')]             |
|click                |id=Details      |                                    |
|waitForElementPresent|id=cbxMobile                                         |
|pause                |5000                                                 |
|$res=                |isChecked       |id=Disabled                         |
|Verify_Contain_OR    |$res;;false                                          |
|$res=                |getValue        |xpath=//input[@id='LastName']       |
|Verify_Contain_OR    |$res;;@lastName                                      |
|$res=                |getValue        |xpath=//input[@id='FirstName']      |
|Verify_Contain_OR    |$res;;@firstName                                     |
|$res=                |getValue        |xpath=//input[@id='Phone']          |
|Verify_Contain_OR    |$res;;777-777-777                                    |
|$res=                |getValue        |xpath=//input[@id='Pager']          |
|Verify_Contain_OR    |$res;;888-888-888                                    |
|$res=                |getValue        |xpath=//input[@id='EmailID']        |
|Verify_Contain_OR    |$res;;@eMail                                         |
|$res=                |getValue        |xpath=//textarea[@id='Comment']     |
|Verify_Contain_OR    |$res;;some words from AD                             |
|$res=                |getSelectedLabel|id=UType                            |
|Verify_Contain_OR    |$res;;Administrator                                  |
|$res=                |isChecked       |id=cb_WebAccess                     |
|Verify_Contain_OR    |$res;;true                                           |
|$res=                |isChecked       |id=cbxMobile                        |
|Verify_Contain_OR    |$res;;true                                           |
|$res=                |getSelectedLabel|id=PrimAuthType                     |
|Verify_Contain_OR    |$res;;Local                                          |
|$res=                |getSelectedLabel|id=ExtAuthType                      |
|Verify_Contain_OR    |$res;;None                                           |
|click                |id=KeyBased     |                                    |
|waitForElementPresent|id=cb_CliAccess                                      |
|$res=                |isChecked       |id=cb_CliAccess                     |
|Verify_Contain_OR    |$res;;true                                           |
|$res=                |isChecked       |id=cb_ApiAccess                     |
|Verify_Contain_OR    |$res;;false                                          |
|click                |id=Time         |                                    |
|waitForElementPresent|id=rbAllow                                           |
|$res=                |isChecked       |id=rbAllow                          |
|Verify_Contain_OR    |$res;;true                                           |
|$res=                |isChecked       |id=cbxLogonDay1                     |
|Verify_Contain_OR    |$res;;true                                           |
|$res=                |isChecked       |id=cbxLogonDay2                     |
|Verify_Contain_OR    |$res;;true                                           |
|$res=                |isChecked       |id=cbxLogonDay3                     |
|Verify_Contain_OR    |$res;;true                                           |
|$res=                |isChecked       |id=cbxLogonDay4                     |
|Verify_Contain_OR    |$res;;true                                           |
|$res=                |isChecked       |id=cbxLogonDay5                     |
|Verify_Contain_OR    |$res;;true                                           |
|$res=                |isChecked       |id=cbxLogonDay6                     |
|Verify_Contain_OR    |$res;;true                                           |
|$res=                |isChecked       |id=cbxLogonDay7                     |
|Verify_Contain_OR    |$res;;true                                           |

!|scenario            |Check Mapped User|userName||firstName||lastName||eMail||userType|
|clickOnLink          |link=Manage UserIDs                                             |
|waitForElementPresent|id=UsrNm                                                        |
|type;                |id=UsrNm         |@userName                                     |
|click                |id=Listing                                                      |
|click                |xpath=//td[contains(text(),'@userName')]                        |
|click                |id=Details       |                                              |
|waitForElementPresent|id=cbxMobile                                                    |
|pause                |5000                                                            |
|$res=                |isChecked        |id=Disabled                                   |
|Verify_Contain_OR    |$res;;false                                                     |
|$res=                |getValue         |xpath=//input[@id='LastName']                 |
|Verify_Contain_OR    |$res;;@lastName                                                 |
|$res=                |getValue         |xpath=//input[@id='FirstName']                |
|Verify_Contain_OR    |$res;;@firstName                                                |
|$res=                |getValue         |xpath=//input[@id='Phone']                    |
|Verify_Contain_OR    |$res;;777-777-777                                               |
|$res=                |getValue         |xpath=//input[@id='Pager']                    |
|Verify_Contain_OR    |$res;;888-888-888                                               |
|$res=                |getValue         |xpath=//input[@id='EmailID']                  |
|Verify_Contain_OR    |$res;;@eMail                                                    |
|$res=                |getValue         |xpath=//textarea[@id='Comment']               |
|Verify_Contain_OR    |$res;;some words from AD                                        |
|$res=                |getSelectedLabel |id=UType                                      |
|Verify_Contain_OR    |$res;;@userType                                                 |

!|scenario            |Check Mapped System|systemName    |   |systemAddress   |
|clickOnLink          |link=Manage Systems                                    |
|type;                |id=SystemNm        |@systemName                        |
|click                |id=Listing                                             |
|click                |xpath=//td[contains(text(),'@systemName')]             |
|click                |id=Details                                             |
|waitForElementPresent|xpath=//input[@id='NetworkAddress']                    |
|$res=                |getValue           |xpath=//input[@id='NetworkAddress']|
|Verify_Contain_OR    |$res;;@systemAddress                                   |
|$res=                |getSelectedLabel   |id=PlatformID                      |
|Verify_Contain_OR    |$res;;Windows                                          |
|$res=                |getSelectedLabel   |id=PwdRuleID                       |
|Verify_Contain_OR    |$res;;Default Password Rule                            |
|$res=                |getSelectedLabel   |id=MaxDurationDays                 |
|Verify_Contain_OR    |$res;;7                                                |
|$res=                |getSelectedLabel   |id=MaxDurationHrs                  |
|Verify_Contain_OR    |$res;;0                                                |
|$res=                |getSelectedLabel   |id=MaxDurationQtrHrs               |
|Verify_Contain_OR    |$res;;0                                                |
|$res=                |isChecked          |id=cb_SystemAutoFl                 |
|Verify_Contain_OR    |$res;;true                                             |
|$res=                |isChecked          |id=cb_EgpOnlyFl                    |
|Verify_Contain_OR    |$res;;false                                            |

!|scenario                  |BFER 6708 System Inherited Template Collection Membership|collectionName||systemName|
|Check Collection Membership|@collectionName                                          |              |@systemName|

!|scenario             |BFER 6708 User Inherited Template Group Membership|groupName||userName|
|Check Group Membership|@groupName                                        |         |@userName|

!|scenario                                                |Check BFER 6708                                     |
|BFER 6708 User Inherited Template Group Membership       |${TemplateGroupName1}     ||${DiscoveredUserName}1  |
|BFER 6708 User Inherited Template Group Membership       |${TemplateGroupName2}     ||${DiscoveredUserName}2  |
|BFER 6708 System Inherited Template Collection Membership|${TemplateCollectionName1}||${DiscoveredSystemName}1|
|BFER 6708 System Inherited Template Collection Membership|${TemplateCollectionName2}||${DiscoveredSystemName}2|

!|scenario            |Check User Disabled     |userName       |
|clickOnLink          |link=Manage UserIDs                     |
|waitForElementPresent|id=UsrNm                                |
|type;                |id=UsrNm                |@userName      |
|click                |id=Listing                              |
|click                |xpath=//td[contains(text(),'@userName')]|
|click                |id=Details              |               |
|waitForElementPresent|id=cbxMobile                            |
|pause                |5000                                    |
|$res=                |isChecked               |id=Disabled    |
|Verify_Contain_OR    |$res;;true                              |
