!include -c <AutomatedTesting.ScenarioLibrary
!include -c <AutomatedTesting.CliScenarios.ScenarioLibrary
!include -c <AutomatedTesting.EspcwClientScenarios.LocalUser.ScenarioLibrary
!include -c <AutomatedTesting.EspcwClientScenarios.LocalUser.ExecuteCommandBefore.TestSpecific
!include -c <AutomatedTesting.EspcwClientScenarios.LocalUser.ExecuteCommandIfPasswordChangeFailed.TestSpecific
!include -c <AutomatedTesting.EspcwClientScenarios.LocalUserSpecified.ExecuteCommandIfPasswordChangeFailed.TestSpecific

!define FileName {failed}

!|script                                                                                                                                                          |
|Create bat file on system|${FileName}     |on             |${SystemAddress}                                                                                      |
|Check Checkbox           |failenabled     |for user       |${ManagedAccount}                                                                                     |
|Set Fail Command         |cmd.exe         |with parameters|/c c:\test\${FileName}.bat|cmd path|C:\windows\system32|for user|${ManagedAccount}|on|${SystemAddress}|
|Uncheck Checkbox         |failenabled     |for user       |DEFAULT                                                                                               |
|Attempt to change password                                                                                                                                       |
|Check Log File           |${FileName}.log |with result    |File exists               |on      |${SystemAddress}                                                  |
|Delete files on          |${SystemAddress}|                                                                                                                      |
|Create bat file on system|${FileName}     |on             |${SystemAddress}                                                                                      |
|Uncheck Checkbox         |failenabled     |for user       |${ManagedAccount}                                                                                     |
|Check Checkbox           |failenabled     |for user       |DEFAULT                                                                                               |
|Set Fail Command         |cmd.exe         |with parameters|/c c:\test\${FileName}.bat|cmd path|C:\windows\system32|for user|DEFAULT          |on|${SystemAddress}|
|Attempt to change password                                                                                                                                       |
|Check Log File           |${FileName}.log |with result    |File does not exist       |on      |${SystemAddress}                                                  |
|Uncheck Checkbox         |failenabled     |for user       |DEFAULT                                                                                               |
|Delete files on          |${SystemAddress}                                                                                                                       |
