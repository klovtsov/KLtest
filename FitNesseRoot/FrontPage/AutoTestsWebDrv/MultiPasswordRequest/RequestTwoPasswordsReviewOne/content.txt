!include -c <AutoTestsWebDrv.ReviewScenarios.ScenarioLibrary
!include -c <AutoTestsWebDrv.PowerShellNetApiScenarios.ScenarioLibrary
!include -c ScenarioLibrary
!3 Preparing stage
!*> Create systems, accounts and set permissions
!|script                                                                                                                                                                                         |
|Add system     |${FirstSystemName} |with address|${FirstSystemAddress}|platform    |${FirstSystemPlatform}|managed by|${FirstFunctAcct}|additional parameters|-functAcctPwd ${FirstFunctAcctPwd}|
|Add system     |${SecSystemName}   |with address|${SecSystemAddress}  |platform    |${SecSystemPlatform}  |managed by|${SecFunctAcct}  |additional parameters|-functAcctPwd ${SecFunctAcctPwd}  |
|Add account    |${FirstManagedAcct}|on system   |${FirstSystemName}   |with options|-MinimumApprovers 1 -ReleaseDuration 15 -ReviewerType Any -ReviewCount 1 -Password ${FirstManagedAcctPwd}   |
|Add Account    |${SecManagedAcct}  |on system   |${SecSystemName}     |with options|-MinimumApprovers 1 -ReleaseDuration 15 -ReviewerType Any -ReviewCount 1 -Password ${SecManagedAcctPwd}     |
|Set Permissions|"PPM Requestor"    |on system   |${FirstSystemName}   |for user    |${Requestor}                                                                                                |
|Set Permissions|"PPM Requestor"    |on system   |${SecSystemName}     |for user    |${Requestor}                                                                                                |
|Set Permissions|"PPM Approver"     |on system   |${FirstSystemName}   |for user    |${Approver}                                                                                                 |
|Set Permissions|"PPM Approver"     |on system   |${SecSystemName}     |for user    |${Approver}                                                                                                 |
|Set Permissions|"PPM Reviewer"     |on system   |${FirstSystemName}   |for user    |${Reviewer}                                                                                                 |
|Set Permissions|"PPM Reviewer"     |on system   |${SecSystemName}     |for user    |${Reviewer}                                                                                                 |
*!
!*> Create, approve and release  multi-account request
!|script                                                                                                             |
|Create request for accounts by|${Requestor}       |using filter|${prefix}*                                          |
|Get Next Request ID                                                                                                 |
|Approve multi-request by      |${Approver}                                                                          |
|Release password for          |${FirstManagedAcct}|by          |${Requestor}|and compare with|${FirstManagedAcctPwd}|
|Release password for          |${SecManagedAcct}  |by          |${Requestor}|and compare with|${SecManagedAcctPwd}  |
|Cancel multi-request by       |${Requestor}                                                                         |
*!
!3 Review requests
!note "Review started" column appeared in 2.5.915. If Reviewer has commented request but didn't complete it, Status will be Pending and "Review started" will have value Y.
!|script                                                                                            |
|Check Password Review Status     |${Reviewer}        |           |$RequestID        |  |Pending,N  |
|Check Password Review Status     |${Reviewer}        |           |$FollowingReq     |  |Pending,N  |
|Submit Comment only for          |${FirstManagedAcct}|from system|${FirstSystemName}|by|${Reviewer}|
|Check Password Review Status     |${Reviewer}        |           |$RequestID        |  |Pending,Y  |
|Check Password Review Status     |${Reviewer}        |           |$FollowingReq     |  |Pending,N  |
|Complete Review only for         |${FirstManagedAcct}|from system|${FirstSystemName}|by|${Reviewer}|
|Check Password Review Status     |${Reviewer}        |           |$RequestID        |  |Complete   |
|Check Password Review Status     |${Reviewer}        |           |$FollowingReq     |  |Pending,N  |
|Complete Review for multi request|${Reviewer}        |           |$FollowingReq                    |
!3 Remove All
!|script                         |
|Delete System|${FirstSystemName}|
|Delete System|${SecSystemName}  |
