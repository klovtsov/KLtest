!|scenario            |Set Account is Locked                           |
|Choose Account       |${ManagedAccount}                               |
|click                |id=Details                                      |
|waitForElementPresent|id=cb_AcctLockFl                                |
|click                |id=cb_AcctLockFl                                |
|pause                |500                                             |
|click                |id=SubmitChangesButton                          |
|waitForTextPresent   |Changes saved successfully for ${ManagedAccount}|

!|scenario|Set Account is Unlocked|
|Set Account is Locked            |

!| scenario       |Retrieve Pwd with result|result                                     |
|$res=            |CLI                     |${CLIBatch} Retrieve --RequestID $RequestID|
|Verify_Contain_OR|$res;;@result                                                       |


!| scenario|Schedule Password Change                                                                                                                               |
|$Hours=   |getEval|var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+3);var s = d.getUTCHours();if ((s + "").length == 1) s = "0" + s;else d.getUTCHours();    |
|$Minutes= |getEval|var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+3);var s = d.getUTCMinutes();if ((s + "").length == 1) s = "0" + s;else d.getUTCMinutes();|
|$Months=  |getEval|var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+3);var s = d.getUTCMonth()+1;if ((s + "").length == 1) s = "0" + s;else d.getUTCMonth()+1;|
|$Days=    |getEval|var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+3);var s = d.getUTCDate();if ((s + "").length == 1) s = "0" + s;else d.getUTCDate();      |
|$Years=   |getEval|var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+3);d.getUTCFullYear();                                                                    |
|CLI       |${CLIBatch} UpdateAccount --SystemName ${SystemName} --AccountName ${ManagedAccount} --ChangeTime $Hours:$Minutes --NextChangeDate $Months/$Days/$Years|

!| scenario           |Set Password Management to None                 |
|Open                 |${TPAMURL}  |  |${TPAMAdmin}  |  |${DefaultPwd} |
|Choose Account       |${ManagedAccount}                               |
|click                |id=Details                                      |
|waitForElementPresent|id=cb_AcctLockFl                                |
|click                |id=pwdMgmtNone                                  |
|pause                |1500                                            |
|click                |id=SubmitChangesButton                          |
|waitForTextPresent   |Changes saved successfully for ${ManagedAccount}|
#|Logout           |

!| scenario           |Set Password Management to Automatic            |
|Choose Account       |${ManagedAccount}                               |
|click                |id=Details                                      |
|waitForElementPresent|id=cb_AcctLockFl                                |
|click                |id=pwdMgmtAuto                                  |
|pause                |500                                             |
|click                |id=SubmitChangesButton                          |
|waitForTextPresent   |Changes saved successfully for ${ManagedAccount}|
#|Logout                                                                |
#|Open                             |${TPAMURL}       ||${TPAMAdmin}||${DefaultPwd}|

!|scenario            |Check status of last Scheduled Change                                          |testResult  |
|Choose Account       |${ManagedAccount}                                                                           |
|waitForElementPresent|id=Logs                                                                                     |
|click                |id=Logs                                                                                     |
|waitForElementPresent|id=rb_LogsDtAll                                                                             |
|click                |id=rb_LogsDtAll                                                                             |
|waitForElementPresent|id=ChangeLog                                                                                |
|click                |id=ChangeLog                                                                                |
|waitForElementPresent|//table[@id='changeLogTable']/tbody/tr[@id='0']                                             |
|verifyText           |//table[@id='changeLogTable']/tbody/tr[td = 'Scheduled Change'][position() = 1]||@testResult|

!|scenario            |Check Require Multi-Group checkbox and select groups                 |
|Choose Account       |${ManagedAccount}                                                    |
|click                |id=Details                                                           |
|waitForElementPresent|id=MinApprovers                                                      |
|type;                |id=MinApprovers                    |2                                |
|pause                |500                                                                  |
|click                |id=cbxPwdMultiApprovers                                              |
|addSelection;        |id=PwdMultiApproverGroups          |label=${firstGroupName}          |
|click                |//select[@id='PwdMultiApproverGroups']/option[.='${firstGroupName}'] |
|addSelection;        |id=PwdMultiApproverGroups          |label=${secondGroupName}         |
|click                |//select[@id='PwdMultiApproverGroups']/option[.='${secondGroupName}']|
|pause                |500                                                                  |
|click                |id=SubmitChangesButton                                               |
|waitForTextPresent   |Changes saved successfully for ${ManagedAccount}                     |

!|scenario            |Uncheck Require Multi-Group checkbox            |
|Choose Account       |${ManagedAccount}                               |
|click                |id=Details                                      |
|waitForElementPresent|id=cbxPwdMultiApprovers                         |
|click                |id=cbxPwdMultiApprovers                         |
|pause                |500                                             |
|type;                |id=MinApprovers                |1               |
|pause                |500                                             |
|click                |id=SubmitChangesButton                          |
|waitForTextPresent   |Changes saved successfully for ${ManagedAccount}|

!|scenario            |Check Require Multi-Group checkbox and select groups for PSM          |
|Choose Account       |${ManagedAccount}                                                     |
|click                |id=PSMDetails                                                         |
|waitForElementPresent|id=cb_EnableFl                                                        |
|click                |id=cb_EnableFl                                                        |
|type;                |id=EgpMinApprovers                  |2                                |
|typeKeys;            |id=EgpMinApprovers                  |2                                |
|pause                |500                                                                   |
|click                |id=cbxSessMultiApprovers                                              |
|pause                |500                                                                   |
|addSelection;        |id=SessMultiApproverGroups          |label=${firstGroupName}          |
|click                |//select[@id='SessMultiApproverGroups']/option[.='${firstGroupName}'] |
|addSelection;        |id=SessMultiApproverGroups          |label=${secondGroupName}         |
|click                |//select[@id='SessMultiApproverGroups']/option[.='${secondGroupName}']|
|pause                |500                                                                   |
|click                |id=SubmitChangesButton                                                |
|waitForTextPresent   |PSM Details saved successfully                                        |

!|scenario            |Uncheck Require Multi-Group checkbox for PSM|
|Choose Account       |${ManagedAccount}                           |
|click                |id=PSMDetails                               |
|waitForElementPresent|id=cbxSessMultiApprovers                    |
|click                |id=cbxSessMultiApprovers                    |
|pause                |500                                         |
|type;                |id=EgpMinApprovers            |1            |
|pause                |500                                         |
|click                |id=cb_EnableFl                              |
|pause                |500                                         |
|click                |id=SubmitChangesButton                      |
|waitForTextPresent   |PSM Details saved successfully              |

!| scenario       |Approve Pwd by|cliuser                                                                            |
|$res=            |CLI           |-i @cliuser.ppk -C @cliuser@${TPAMHost} Approve --RequestID $RequestID --Comment OK|
|Verify_Contain_OR|$res;;submitted                                                                                   |

!| scenario       |Get Request Status|status                                                                                                                       |
|$res=            |CLI               |${CLIBatch} ListRequest --status all --RequestorName "User=Myself" --accountname ${ManagedAccount} --systemname ${SystemName}|
|Verify_Contain_OR|$res;;$RequestID.*@status                                                                                                                       |

!| scenario       |Get Session Request Status|status                                                                                                |
|$res=            |CLI                       |${CLIBatch} ListSessionRequest --status all --accountname ${ManagedAccount} --systemname ${SystemName}|
|Verify_Contain_OR|$res;;$RequestID.*@status                                                                                                        |

!| scenario       |Cancel Request                                                            |
|$res=            |CLI|${CLIBatch} Cancel --RequestID $RequestID --Comment "It was test only"|
|Verify_Contain_OR|$res;;successfully                                                        |

!| scenario        |Create Users |
|Add CLI User      |${CLI_user_3}|
|Generate Plink Key|${CLI_user_3}|
|Add CLI User      |${CLI_user_4}|
|Generate Plink Key|${CLI_user_4}|

!| scenario       |Create Group|groupName                                                |
|$res=            |CLI         |${CLIBatch} AddGroup @groupName,"MultiApprove Test Group"|
|Verify_Contain_OR|$res;;successful;;exists                                              |

!| scenario|Remove Group|groupName                                         |
|$res=     |CLI         |${CLIBatch} DropGroup @groupName,"TPAM Test Group"|
#|Verify_Contain_OR|$res;;successful                                               |

!| scenario  |Create Groups     |
|Create Group|${firstGroupName} |
|Create Group|${secondGroupName}|

!| scenario  |Try to Remove Groups|
|Remove Group|${firstGroupName}   |
|Remove Group|${secondGroupName}  |

!| scenario                         |Set Permissions for groups      |
|Set Group Permissions Account Level|${firstGroupName} ||\"Approver\"|
|Set Group Permissions Account Level|${secondGroupName}||\"Approver\"|

!| scenario |Remove Users                                        |
|Remove User|${CLI_user_3}                                       |
|runBatch   |DeleteFileByMask;${PathToKeys}${CLI_user_3}.ppk;fake|
|Remove User|${CLI_user_4}                                       |
|runBatch   |DeleteFileByMask;${PathToKeys}${CLI_user_4}.ppk;fake|

!|scenario            |Check Ignore System Policies checkbox           |
|Choose Account       |${ManagedAccount}                               |
|click                |id=Details                                      |
|waitForElementPresent|id=cb_IgnoreSystemPoliciesFl                    |
|click                |id=cb_IgnoreSystemPoliciesFl                    |
|pause                |500                                             |
|click                |id=SubmitChangesButton                          |
|waitForTextPresent   |Changes saved successfully for ${ManagedAccount}|

!|scenario|Unheck Ignore System Policies checkbox|
|Check Ignore System Policies checkbox           |

!|scenario        |Try Request Pwd with result|result                                                                                                  |
|$res=            |CLI                        |${CLIBatch} AddPwdRequest --SystemName ${SystemName} --AccountName ${ManagedAccount} --RequestNotes test|
|Verify_Contain_OR|$res;;@result                                                                                                                       |

!|scenario        |Approve Session by|cliuser                                                                                          |
|$res=            |CLI               |-i @cliuser.ppk -C @cliuser@${TPAMHost} ApproveSessionRequest --RequestID $RequestID --Comment OK|
|Verify_Contain_OR|$res;;submitted                                                                                                     |

!| scenario           |Change Allowed PAC Releases to       |num       |
|Choose Account       |${ManagedAccount}                               |
|click                |id=Details                                      |
|waitForElementPresent|id=cb_IgnoreSystemPoliciesFl                    |
|type;                |id=SimulPrivAccReleases              |@num      |
|pause                |500                                             |
|click                |id=SubmitChangesButton                          |
|waitForTextPresent   |Changes saved successfully for ${ManagedAccount}|

!| scenario       |Request Pwd by|cliuser                    |with result                    |result                    |                    |reqID                   |
|$res=            |CLI           |-i @cliuser.ppk -C @cliuser@${TPAMHost} AddPwdRequest --SystemName ${SystemName} --AccountName ${ManagedAccount} --RequestNotes test|
|Verify_Contain_OR|$res;;@result                                                                                                                                      |
|$@reqID=         |get_RequestID |$res                                                                                                                                |
|$RequestID=      |get_RequestID |$res                                                                                                                                |

!| scenario       |Cancel Request with ID|reqID                        |perfomed by                       |cliuser                       |
|$res=            |CLI                   |-i @cliuser.ppk -C @cliuser@${TPAMHost} Cancel --RequestID $@reqID --Comment "It was test only"|
|Verify_Contain_OR|$res;;successfully                                                                                                    |

!| scenario           |Check Override Accountability checkbox          |
|Choose Account       |${ManagedAccount}                               |
|click                |id=Details                                      |
|waitForElementPresent|id=cb_OverrideAccountabilityFl                  |
|click                |id=cb_OverrideAccountabilityFl                  |
|pause                |1500                                            |
|click                |id=SubmitChangesButton                          |
|waitForTextPresent   |Changes saved successfully for ${ManagedAccount}|

!| scenario|Uncheck Override Accountability checkbox|
|Check Override Accountability checkbox             |

!| scenario        |Get Connect button status|expectedRslt                                                             |
|$res=             |GroovyWebDriver          |checkConnectButtonState;${TPAMHost};${TPAMAdmin};${DefaultPwd};$RequestID|
|Verify_Contain_NOT|$res;;something went wrong                                                                         |
|Verify_Contain_OR |$res;;@expectedRslt                                                                                |
