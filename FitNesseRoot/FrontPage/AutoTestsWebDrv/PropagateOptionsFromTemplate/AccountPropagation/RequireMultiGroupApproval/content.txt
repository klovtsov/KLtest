!define ManagedAccount {minApprover}
!define testUser {${prefix}Apprvr}
!define firstGroupName {${prefix}Apprvrs}
!define secondGroupName {${prefix}ApprvrsToo}
!define groupDescription {Test}

!include -c <AutoTestsWebDrv.TicketSystemScenarios.ScenarioLibrary
!include -c <AutoTestsWebDrv.PowerShellNetApiScenarios.ScenarioLibrary
!include -c <PropagateOptionsFromTemplate.ScenarioLibrary

!* > Prepare
!|script                                            |
|Add User  |${testUser}                             |
|Add User  |${testUser}2                            |
|Add Group |${firstGroupName}                       |
|Add Group |${secondGroupName}                      |
|Add Member|${testUser} |to group|${firstGroupName} |
|Add Member|${testUser}2|to group|${secondGroupName}|
*!

!|script                                                                                                                                                                                                                                                                                   |
|Add account            |${ManagedAccount}                                                                                                                         |on system      |${TemplateName}                    |with options|-MinimumApprovers 2                                   |
|Open                   |${TPAMURL}                                                                                                                                |               |${TPAMAdmin}                       |            |${DefaultPwd}                                         |
|Check Require Multi-Group checkbox and select groups                                                                                                                                                                                                                                      |
|Try to Add system      |${newSystemName}                                                                                                                          |with parameters|-templateSystemName ${TemplateName}|with result |System changes for ${newSystemName} saved successfully|
|List Systems by        |-systemName ${newSystemName}                                                                                                              |output params  |SystemName                         |contain     |${newSystemName}                                      |
|List Accounts by filter|-systemName ${newSystemName} -AccountName ${ManagedAccount} -propsToList accountname,requireMultiGroupApprovalFlag,multiGroupApproverNames|contains       |${ManagedAccount}\s+Y\s+${firstGroupName};${secondGroupName}                                           |
|Delete System          |${newSystemName}                                                                                                                                                                                                                                                  |
|Logout Paradmin                                                                                                                                                                                                                                                                           |

!*> Clean user and groups
!|script                                                           |
|Delete User           |${testUser}                                |
|Delete Group          |${firstGroupName}                          |
|Delete User           |${testUser}2                               |
|Delete Group          |${secondGroupName}                         |
|Delete managed account|${ManagedAccount}|on system|${TemplateName}|
*!
