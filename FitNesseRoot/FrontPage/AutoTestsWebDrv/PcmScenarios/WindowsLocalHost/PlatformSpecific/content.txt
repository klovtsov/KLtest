!contents


!|scenario         |Create Command|commandName||commandText||workingDir|
|pause             |5000                                               |
|clickOnLink       |link=Command Management                            |
|click             |id=NewCmdButton                                    |
|pause             |1000                                               |
|type;             |id=CmdName    |@commandName                        |
|type;             |id=CmdText    |@commandText                        |
|type;             |id=WorkingDir |@workingDir                         |
|type;             |id=CmdDesc    |@commandName description            |
|click             |id=SaveChangesButton                               |
|waitForTextPresent|saved successfully                                 |
|click             |id=ProxyTypes                                      |
|click             |id=cb_PT_4                                         |
|pause             |1000                                               |
|click             |id=SaveChangesButton                               |
|waitForTextPresent|saved successfully                                 |


!|scenario   |Run Command                                   |
|Open Session|${Requestor}||${SystemName}||${ManagedAccount}|
|Check Command Results                                      |

!|scenario        |Check Command Results                                                                                                                                                  |
|$res=            |RunBatchGetOutput|CheckFileWindows;check;${SystemAddress};${FunctAcct};${FunctAcctPwd};${WorkingDir};${PCMTestFile};${ManagedAccount} ${ManagedAccountPwd} ${Requestor}|
|Verify_Contain_OR|$res;;${ManagedAccount} ${ManagedAccountPwd} ${Requestor}                                                                                                              |
|pause            |10000                                                                                                                                                                  |
|$res=            |RunBatchGetOutput|CheckFileWindows;delete;${SystemAddress};${FunctAcct};${FunctAcctPwd};${WorkingDir};${PCMTestFile}                                                   |
|Verify_Contain_OR|$res;;FileDeleted                                                                                                                                                      |


!|scenario        |Open Session         |requestorName                                |                                             |systemName                               |                               |accountName                               |
|$res=            |CLI                  |${CLIBatch} AddSessionRequest --SystemName @systemName --AccountName @accountName --ForUserName @requestorName --AccessPolicyName \"${PCMRequestorPolicyName}\" --CommandName ${CommandName} --RequestNotes test|
|Verify_Contain_OR|$res;;submitted                                                                                                                                                                                                                       |
|$RequestID=      |get_session_RequestID|$res                                                                                                                                                                                                            |
|$res=            |CLI                  |${CLIBatch2} ApproveSessionRequest --RequestID $RequestID --Comment test                                                                                                                                        |
|Verify_Contain_OR|$res;;submitted                                                                                                                                                                                                                       |
|Login            |${TPAMURL}           |                                             |@requestorName                               |                                         |${UserPwd}                                                                |
|pause            |5000                                                                                                                                                                                                                                  |
|click            |id=CurrentRequests                                                                                                                                                                                                                    |
|clickOnLink      |link=$RequestID                                                                                                                                                                                                                       |
|click            |id=StartSessionButton                                                                                                                                                                                                                 |
|pause            |60000                                                                                                                                                                                                                                 |
|selectWindow     |Quest Software PSM                                                                                                                                                                                                                    |
|stop                                                                                                                                                                                                                                                    |
|selectWindow     |Quest Software TPAM                                                                                                                                                                                                                   |
|type;            |id=ResponseComment   |cancel                                                                                                                                                                                                          |
|click            |id=SubmitChanges                                                                                                                                                                                                                      |
|pause            |10000                                                                                                                                                                                                                                 |
|Logout                                                                                                                                                                                                                                                  |



!|scenario         |Cancel Session                             |
|type;             |id=ResponseComment         |cancel         |
|click             |id=SubmitChanges                           |
|waitForTextPresent|*The response * was submitted successfully*|
#|Request Session      |@systemName          |                             |@accountName                 |                         |@requestorName                              |
#|$RequestID=          |get_session_RequestID|$res                                                                                                                              |


!|scenario               |Clear Objects                                                                                        |
|Login                   |${TPAMURL}               |          |${TPAMAdmin}     |         |${DefaultPwd}                       |
|Unassign Policy         |${PCMRequestorPolicyName}|To Account|${ManagedAccount}|On System|${SystemName}|And User|${CLI_user_1}|
|Rollback Access Policy  |${PCMRequestorPolicyName}                                                                            |
|Rollback Access Policy  |${PCMApproverPolicyName}                                                                             |
|Delete Command          |${CommandName}                                                                                       |
|pause                   |5000                                                                                                 |
|Remove system           |${SystemName}                                                                                        |
|Session Cleanup         |${ManagedAccount}                                                                                    |
|Delete Account on System|${ManagedAccount}        |on system |${SystemAddress}                                                |
|Remove User             |${Requestor}                                                                                         |
|Logout                                                                                                                        |
|Delete Notification Mailbox                                                                                                   |


!| scenario       |Add system|systemName                      |                     |systemAddress                     |                     |systemPlatform                     |                     |functAcct                     |                     |funcAccPwd                     |
|$res=            |CLI       |${CLIBatch} AddSystem --SystemName @systemName --NetworkAddress @systemAddress --PlatformName \"@systemPlatform\" --FunctionalAccount @functAcct --FuncAcctCred @funcAccPwd --DomainName ${DomainName} --NetBiosName ${NETBIOSDomainName} --ReleaseDuration 15|
|Verify_Contain_OR|$res;;successful                                                                                                                                                                                                                                                         |


!|scenario|Session Cleanup  |accountName                                                              |
|$res=    |RunBatchGetOutput|CleanupSession;${SystemAddress};${FunctAcct};${FunctAcctPwd};@accountName|
