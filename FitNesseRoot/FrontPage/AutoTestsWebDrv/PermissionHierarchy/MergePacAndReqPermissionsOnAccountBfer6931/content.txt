!* Test description
Bug explanation
If user is assigned to two different groups, and each group has different permissions to the same account (through System or Accounts collections) like following:
 "Group A": PAC and REQ and APR to Collections "Linux_srvs"
 "Group B": REQ to Collections "All_srvs"  
The effective permission is REQ. When the user is requesting for account he see two rows (because has different permissions) - when he select the row with PAC permission he has to wait for approver.
*!

!define FileName {${UserPrefix}TestFile}
!define FilePath {c:\}
!define FileDesc {${UserPrefix}FileDesc} 
!define FileEmailAddr {${UserPrefix}FileEmailAddr0@tpam.spb.qsft}

!define GroupName {${prefix}Croup1}
!define GroupName2 {${prefix}Croup2}
!define CollectionName {${prefix}Collection1}
!define CollectionName2 {${prefix}Collection2}

!define PwdPAQPolicy {${PasswordPacPolicy}}
!define PwdREQPolicy {${PasswordRequestorPolicy}}
!define FilePAQPolicy {${FilePacPolicy}}
!define FileREQPolicy {${FileRequestorPolicy}}
!define SessPAQPolicy {${SessionPacPolicy}}
!define SessREQPolicy {${SessionRequestorPolicy}}

!*> Include section
!include -c <AutoTestsWebDrv.ScenarioLibrary
!include -c <AutoTestsWebDrv.EmailScenarios.ScenarioLibrary
!include -c <AutoTestsWebDrv.CliScenarios.ScenarioLibrary
!include -c ScenarioLibrary
*!

!*> Create Environment
!|script                                                                                                                                                                                                         |
|Add Group               |${GroupName}                                                                                                                                                                           |
|Add Group               |${GroupName2}                                                                                                                                                                          |
|Add User To Group       |${Requestor}     |                                           |${GroupName}                                                                                                             |
|Add User To Group       |${Requestor}     |                                           |${GroupName2}                                                                                                            |
|Create File             |${FilePath}      |                                           |${FileName}                                                                                                              |
|Add system                                                                                                                                                                                                      |
|Add account             |${ManagedAccount}|with password                              |${ManagedAccountPwd}                             |                             |${NotFailed}                             |
|$res=                   |CLI              |${CLIBatch} UpdatePSMAccount --System ${SystemName} --Account ${ManagedAccount} --EnableFlag Y  --ProxyType \"SSH - Automatic Login Using Password\" --MinApprovers 1|
|Add File                                                                                                                                                                                                        |
|Add Collection          |${CollectionName}                                                                                                                                                                      |
|Add Collection          |${CollectionName2}                                                                                                                                                                     |
|Add System To Collection|${SystemName}    |                                           |${CollectionName}                                                                                                        |
|Add System To Collection|${SystemName}    |                                           |${CollectionName2}                                                                                                       |
#|Change User Type         |Basic            |for user     |${CLI_user_2}                           |
*!

!|script                                                                                                                                    |
|Set policy                |\"${PwdPAQPolicy}\"|on collection|${CollectionName} |for group           |${GroupName}                          |
|Set policy                |\"${PwdREQPolicy}\"|on collection|${CollectionName2}|for group           |${GroupName2}                         |
|pause                     |${ApplyNewPoliciesInterval}                                                                                     |
|UI Request Pwd With Policy|${PwdPAQPolicy}    |by User      |${Requestor}      |with expected result|The current status is Active/Approved |
|UI Cancel Password Request|${Requestor}                                                                                                    |
|UI Request Pwd With Policy|${PwdREQPolicy}    |by User      |${Requestor}      |with expected result|The current status is Pending Approval|
|UI Cancel Password Request|${Requestor}                                                                                                    |
#|Revoke policy             |\"${PwdPAQPolicy}\"    |on collection|${CollectionName} |for group           |${GroupName}                          |
#|Revoke policy             |\"${PwdREQPolicy}\"    |on collection|${CollectionName2}|for group           |${GroupName2}                         |

#!|script                                                                                                                     |
#|Set policy              |\"${FilePAQPolicy}\"|on collection|${CollectionName} |for group           |${GroupName}            |
#|Set policy              |\"${FileREQPolicy}\"|on collection|${CollectionName2}|for group           |${GroupName2}           |
#|pause                   |${ApplyNewPoliciesInterval}                                                                        |
#|Request File With Policy|${FilePAQPolicy}    |by User      |${Requestor}      |with expected result|Retrieve Button Enabled |
#|Request File With Policy|${FileREQPolicy}    |by User      |${Requestor}      |with expected result|Retrieve Button Disabled|
#|Revoke policy              |\"${FilePAQPolicy}\"    |on collection|${CollectionName} |for group           |${GroupName}            |
#|Revoke policy              |\"${FileREQPolicy}\"    |on collection|${CollectionName2}|for group           |${GroupName2}           |

!|script                                                                                                                                         |
|Set policy                    |\"${SessPAQPolicy}\"|on collection|${CollectionName} |for group           |${GroupName}                          |
|Set policy                    |\"${SessREQPolicy}\"|on collection|${CollectionName2}|for group           |${GroupName2}                         |
|pause                         |${ApplyNewPoliciesInterval}                                                                                      |
|UI Request Session With Policy|${SessPAQPolicy}    |by User      |${Requestor}      |with expected result|The current status is Active/Approved |
|UI Cancel Session Request     |${Requestor}                                                                                                     |
|UI Request Session With Policy|${SessREQPolicy}    |by User      |${Requestor}      |with expected result|The current status is Pending Approval|
|UI Cancel Session Request     |${Requestor}                                                                                                     |
#|Revoke policy                 |\"${SessPAQPolicy}\"    |on collection|${CollectionName} |for group           |${GroupName}                          |
#|Revoke policy                 |\"${SessREQPolicy}\"    |on collection|${CollectionName2}|for group           |${GroupName2}                         |


#|Request Pwd by       |${CLI_user_2}|using Access Policy|${REQPolicy}|with result|The current status is Pending Approval|
#|Cancel Pwd Request by|${CLI_user_2}                                                                                    |
#|Request Pwd by       |${CLI_user_2}|using Access Policy|${PAQPolicy}|with result|The current status is Active/Approved |
#|Cancel Pwd Request by|${CLI_user_2}                                                                                    |



!*> Clear Environment
!|script                                   |
|Delete File      |${FilePath}||${FileName}|
|Remove account   |${ManagedAccount}       |
|Remove system    |${SystemName}           |
|Delete Group     |${GroupName}            |
|Delete Group     |${GroupName2}           |
|Delete Collection|${CollectionName}       |
|Delete Collection|${CollectionName2}      |

*!
