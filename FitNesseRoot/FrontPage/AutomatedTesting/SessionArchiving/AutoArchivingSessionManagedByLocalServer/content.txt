!include -c <AutomatedTesting.PsmSmokeTest.ScenarioLibrary
!include -c ScenarioLibrary

!* Prepare Environment (Given)
!|script                                                                          |
|Set LocalServer to use archive server|${ArchiveServerName}|use for replay|n      |
|Set PSM Affinity                     |${SystemName}       |Local Server  |1|DPA|2|
*!

!* Make request and open session (When)
!|script                   |
|Request Session           |
|Open automatic ssh session|
|Cancel psm request        |
*!

!* Check session archive (Then)
!|script                                                                                                                               |
|Check Session Log for|$RequestID|ArchiveServer|${ArchiveServerName}     |Server Path     |./${ArchiveFolder}    |Duration    |0:00    |
|Get File Name from Archive Server Log                                                                                                 |
|Check DPA log for    |local     |contains     |RequestID: $RequestID automatically archived to ${ArchiveServerName}:./${ArchiveFolder}|
|Check files on server                                                                                                                 |
*!

!* Clean Up
!|script                                                       |
|Set LocalServer to use archive server|default|use for replay|Y|
*!