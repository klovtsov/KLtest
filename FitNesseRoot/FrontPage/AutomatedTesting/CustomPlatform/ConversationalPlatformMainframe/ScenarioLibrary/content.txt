!contents

!|scenario|Test UI Custom Platform|
|Prepare UI Test                  |
|PPM UI Regular Activity          |
|PSM Activity                     |
|Clear UI Test                    |
#

!|scenario           |Prepare UI Test                        |
|Create Password Rule|${MainframePasswordRule}               |
|Prepare TST10 Scripts                                       |
|Login               |${TPAMURL}||${TPAMAdmin}||${DefaultPwd}|
|Create Users                                                |
|Login               |${TPAMURL}||${TPAMAdmin}||${DefaultPwd}|
|Add UI System                                               |
|Add UI Account      |${ManagedAccount}                      |
|Change Account Password on System                           |


!|scenario            |Add UI System                                   |
|pause                |5000                                            |
|waitForElementPresent|link=Add System                                 |
|clickAndWait         |link=Add System                                 |
|waitForElementPresent|id=SystemName                                   |
|type;                |id=SystemName    |${SystemName}                 |
|type;                |id=NetworkAddress|${SystemAddress}              |
|select;              |id=PlatformID    |label=${CustomPlatformName}   |
|select;              |id=PwdRuleID     |label=${MainframePasswordRule}|
|click                |id=Connection    |                              |
|type;                |id=PARFuncAcct   |${FuncAcct}                   |
|type;                |id=pword         |${FuncAcctPassword}           |
|type;                |id=ConfPword     |${FuncAcctPassword}           |
|type;                |id=Timeout       |${SystemTimeout}              |
|click                |id=bt_Save       |                              |
|waitForTextPresent   |System changes for * saved successfully         |



!| scenario    |Managed UI System                |
|Test System   |successful                       |
|Choose Account|${FuncAcct}                      |
|Check Password|matches the managed system       |
|Choose Account|${ManagedAccount}                |
|Check Password|matches the managed system       |
|Choose Account|${FuncAcct}                      |
|Set password  |${FuncAcct}||${FunctAcctWrongPwd}|
|Test System   |failed                           |
|Choose Account|${FuncAcct}                      |
|Check Password|DOES NOT MATCH                   |


!| scenario             |Managed UI Account                                                                                          |
|Choose Account         |${ManagedAccount}                                                                                           |
|Reset Password         |error occurred changing the password                                                                        |
|Schedule Reset Password|Failed                                                                                                      |
|Prepare Scripts        |${ProjDir}\Scripts\Platforms\${SystemPlatform}|          |${ManagedAccountPassword}||${ManagedAccountPwdNew}|
|Change Account Password on System                                                                                                   |
|Choose Account         |${FuncAcct}                                                                                                 |
|Set password           |${FuncAcct}                                   |          |${FuncAcctPassword}                               |
|pause                  |20000                                                                                                       |
|Choose Account         |${ManagedAccount}                                                                                           |
|Check Password         |DOES NOT MATCH                                                                                              |
|pause                  |120000                                                                                                      |
|Check Status           |Success                                       |for reason|Mismatch                                          |
|Reset Password         |successful                                                                                                  |
|Choose Account         |${ManagedAccount}                                                                                           |
|Schedule Reset Password|Success                                                                                                     |
|Choose Account         |${ManagedAccount}                                                                                           |
|Check Password         |Running Ascii.*matches the managed system                                                                   |



!|scenario           |Clear UI Test                          |
|Login               |${TPAMURL}||${TPAMAdmin}||${DefaultPwd}|
|Remove Users                                                |
|Remove UI System                                            |
|Delete Password Rule|${MainframePasswordRule}               |



!|scenario         |Enable PSM on Custom Platform                                                  |
|Deactivate Platform Automation                                                                    |
|click             |id=PSMEnabledFl                                                                |
|pause |2000 |
|addSelection;     |id=ProxyTypes          |label=x3270 - Interactive Login Using Password         |
|click             |//select[@id='ProxyTypes']/option[.='x3270 - Interactive Login Using Password']|
|pause             |1000                                                                           |
|click             |id=btnSavePlatform                                                             |
|getConfirmation                                                                                   |
|waitForTextPresent|saved successfully                                                             |
|pause             |1000                                                                           |
|click             |id=AutomationActiveFl                                                          |
|pause             |1000                                                                           |
|click             |id=btnSavePlatform                                                             |
|waitForTextPresent|saved successfully                                                             |
|$res=             |getText                |//div[@id='ResultsDiv']                                |
|Verify_Contain_OR |$res;;saved successfully                                                       |
|pause             |60000                                                                          |


!| scenario                   |Enable PSM for Account                                                                                                                                                                                                                                             |
|Set Password Approvers Number|${ManagedAccount}|                                                                                                                        |0                                                                                                                       |
|$res=                        |CLI              |${CLIBatch} UpdateEGPAccount --System ${SystemName} --Account ${ManagedAccount}  --ProxyType \"x3270 - Interactive Login Using Password\" --DefaultSessionDuration 120 --EnableFlag Y  --MinApprovers 0 --RecordingRequiredFlag N --ReviewCount 0|
|Verify_Contain_OR            |$res;;successful                                                                                                                                                                                                                                                   |


!| scenario        |Request and Open Session                                                                    |
|Get DPA Name and IP Address                                                                                    |
|Set Affinity                                                                                                   |
|Login             |${TPAMURL}           |            |${Requestor}           |           |${UserPwd}           |
|pause             |20000                                                                                       |
|clickAndWait      |link=Add Session Request                                                                    |
|type;             |id=SystemNm          |${SystemName}                                                         |
|type;             |id=AccountNm         |${ManagedAccount}                                                     |
|click             |id=Accounts          |                                                                      |
|click             |//input[@type='checkbox']                                                                   |
|click             |id=Details                                                                                  |
|type;             |id=RequestReason     |session request reason                                                |
|typeKeys;         |id=RequestReason     |a                                                                     |
|pause             |1000                                                                                        |
|click             |id=SubmitChanges                                                                            |
|waitForTextPresent|submitted                                                                                   |
|$res=             |getText              |//div[@id='ResultsDiv']                                               |
|Verify_Contain_OR |$res;;submitted                                                                             |
|$SessionRequestID=|get_session_RequestID|$res                                                                  |
|$res=             |GroovyWebDriver      |openSessionX3270;${TPAMHost};${Requestor};${UserPwd};$SessionRequestID|
|Verify_Contain_OR |$res;;x3270 terminal logon succeeded                                                        |


!|scenario|Change Account Password on System                |
|$res=    |RunBatchGetOutput|${SystemPlatform};password;fake|
#|Verify_Contain_OR|$res;;1                                                             |


!|scenario        |Login Account to System|ManPwd                         |
|$res=            |RunBatchGetOutput      |${SystemPlatform};login;@ManPwd|
|Verify_Contain_OR|$res;;OUT.TXT: 1                                       |

!|scenario            |Get DPA Name and IP Address                                           |
|Login                |${TPAMURL}|        |${TPAMAdmin}        |        |${DefaultPwd}       |
|pause                |6000                                                                  |
|clickAndWait         |link=DPAs                                                             |
|pause                |3000                                                                  |
|waitForElementPresent|//table[@id='serversTable']//td[text()='Up']                          |
|$TPAMDPA=            |getText   |//table[@id='serversTable']//td[text()='Up']/../td[1]      |
|Verify_Contain_OR    |$TPAMDPA;;DPA                                                         |
|$DPAAddress=         |getText   |//table[@id='serversTable']//td[text()='$TPAMDPA']/../td[2]|


!|scenario            |Set Affinity                                                                                       |
|Login                |${TPAMURL}                                                            ||${TPAMAdmin}||${DefaultPwd}|
|pause                |10000                                                                                              |
|Choose system        |${SystemName}                                                                                      |
|click                |id=Affinity                                                                                        |
|waitForElementPresent|id=rbEGPAffinitySelected                                                                           |
|click                |id=rbEGPAffinitySelected                                                                           |
|type;                |//table[@id='tblEGPDPAAffinity']//td[text()='LocalServer']/../td/input|1                           |
|type;                |//table[@id='tblEGPDPAAffinity']//td[text()='$TPAMDPA']/../td/input   |10                          |
|waitForElementPresent|id=rbPARAffinitySelected                                                                           |
|click                |id=rbPARAffinitySelected                                                                           |
|type;                |//table[@id='tblPARDPAAffinity']//input                               |1                           |
|click                |id=bt_Save                                                                                         |
|waitForTextPresent   |System changes for * saved successfully                                                            |




!| scenario     |Prepare TST10 Scripts                                                                            |
|Prepare Scripts|${ProjDir}\Scripts\Platforms\${SystemPlatform}||IPADDRESSPLACEHOLDER  ||${SystemAddress}         |
|Prepare Scripts|${ProjDir}\Scripts\Platforms\${SystemPlatform}||PORTPLACEHOLDER       ||${SystemPort}            |
|Prepare Scripts|${ProjDir}\Scripts\Platforms\${SystemPlatform}||FUNCACCTPLACEHOLDER   ||${FuncAcct}              |
|Prepare Scripts|${ProjDir}\Scripts\Platforms\${SystemPlatform}||FUNCACCTPWDPLACEHOLDER||${FuncAcctPassword}      |
|Prepare Scripts|${ProjDir}\Scripts\Platforms\${SystemPlatform}||MANACCTPLACEHOLDER    ||${ManagedAccount}        |
|Prepare Scripts|${ProjDir}\Scripts\Platforms\${SystemPlatform}||MANACCTPWDPLACEHOLDER ||${ManagedAccountPassword}|
