!* Test description
A Denied access policy assignment at any level overrides all other permissions at that level.
This test that deny policy ovverides PPM Approver rights at level 8 (i.e. Group to Collection of Systems)
*!

!define GroupName2 {${prefix}grp2}
!define CollectionName {${prefix}AccntColtn}
!define CollectionName2 {${prefix}AccntSecColtn}


!*> Include section
!include -c <AutomatedTesting.ScenarioLibrary
!include -c <AutomatedTesting.EmailScenarios.ScenarioLibrary
!include -c <AutomatedTesting.CliScenarios.ScenarioLibrary
!include -c ScenarioLibrary
*!

!*> Create Environment
!|script                                                                                    |
|Add Group               |${GroupName}                                                      |
|Add User To Group       |${CLI_user_2}    |             |${GroupName}                      |
|Add Group               |${GroupName2}                                                     |
|Add User To Group       |${CLI_user_2}    |             |${GroupName2}                     |
|Add system                                                                                 |
|Add account             |${ManagedAccount}|with password|${ManagedAccountPwd}||${NotFailed}|
|Add Collection          |${CollectionName}                                                 |
|Add Collection          |${CollectionName2}                                                |
|Add System To Collection|${SystemName}    |             |${CollectionName}                 |
|Add System To Collection|${SystemName}    |             |${CollectionName2}                |
*!

!|script                                                                                                                    |
|Set policy           |Requestor    |on collection|${CollectionName}            |for group          |${GroupName}           |
|Set policy           |Approver     |on system    |${SystemName}                |for user           |${CLI_user_1}          |
|Request Pwd by       |${CLI_user_2}|with result  |submitted                                                                |
|Cancel Pwd Request by|${CLI_user_2}                                                                                        |
|Set policy           |Denied       |on collection|${CollectionName2}           |for group          |${GroupName2}          |
|pause                |${ApplyNewPoliciesInterval}                                                                          |
|Request Pwd by       |${CLI_user_2}|with result  |You do not have permissions to create a Password Request for this account|
|Revoke policy        |Denied       |on collection|${CollectionName2}           |for group          |${GroupName2}          |
|pause                |${ApplyNewPoliciesInterval}                                                                          |
|Request Pwd by       |${CLI_user_2}|with result  |submitted                                                                |
|Cancel Pwd Request by|${CLI_user_2}                                                                                        |
!*> Clear Environment
!|script                             |
|Remove account   |${ManagedAccount} |
|Remove system    |${SystemName}     |
|Delete Group     |${GroupName}      |
|Delete Group     |${GroupName2}     |
|Delete Collection|${CollectionName} |
|Delete Collection|${CollectionName2}|
*!