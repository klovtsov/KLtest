!* Test description
A Denied access policy assignment at any level overrides all other permissions at that level.
This test that deny policy ovverides PPM Approver rights at level 7 (i.e. Group to System)
*!

!define GroupName2 {${prefix}grp2}

!*> Include section
!include -c <AutomatedTesting.ScenarioLibrary
!include -c <AutomatedTesting.EmailScenarios.ScenarioLibrary
!include -c <AutomatedTesting.CliScenarios.ScenarioLibrary
!include -c ScenarioLibrary
*!

!*> Create Environment
!|script                                                                             |
|Add Group        |${GroupName}                                                      |
|Add User To Group|${CLI_user_2}    |             |${GroupName}                      |
|Add Group        |${GroupName2}                                                     |
|Add User To Group|${CLI_user_2}    |             |${GroupName2}                     |
|Add system                                                                          |
|Add account      |${ManagedAccount}|with password|${ManagedAccountPwd}||${NotFailed}|
*!

!|script                                                                                               |
|Set policy             |\"PPM Requestor\"|on account |${ManagedAccount}   |for user   |${CLI_user_1}  |
|Set policy             |\"PPM Approver\" |on system  |${SystemName}       |for group  |${GroupName}   |
|Request Pwd by         |${CLI_user_1}    |with result|submitted                                       |
|Set policy             |Denied           |on system  |${SystemName}       |for group  |${GroupName2}  |
|pause                  |${ApplyNewPoliciesInterval}                                                   |
|Approve Pwd request by |${CLI_user_2}    |with result|You are not authorized to perform this operation|
|Revoke policy          |Denied           |on system  |${SystemName}       |for group  |${GroupName2}  |
|pause                  |${ApplyNewPoliciesInterval}                                                   |
|Approve Pwd request by |${CLI_user_2}    |with result|submitted                                       |
|Retrieve Pwd request by|${CLI_user_1}                                                                 |

!*> Clear Environment
!|script                         |
|Remove account|${ManagedAccount}|
|Remove system |${SystemName}    |
|Delete Group  |${GroupName}     |
|Delete Group  |${GroupName2}    |
*!