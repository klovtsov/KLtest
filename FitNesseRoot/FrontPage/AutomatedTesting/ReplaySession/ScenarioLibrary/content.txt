!contents

#!|scenario|Replay Session                                                                 |
#|$res=    |GroovyWebDriver|ReplayLog;${TPAMHost};KLreviewer;grain41R;1-16805;KLBOOKMARK777|


!|scenario                        |Prepare Environment                                                                                                     |
|Add System                       |${SystemName}    |               |${SystemAddress}|             |${SystemPlatform}|         |${FunctAcct}||${FuncAccPwd}|
|Add User To Group                |${CLI_user_1}    |               |\"Global Requestor Group\"                                                            |
|Prepare Account                  |${ManagedAccount}|               |${SystemName}   |             |${SystemAddress}                                       |
|Prepare User                     |${Requestor}     |with first name|${Requestor}    |and last name|Smith            |with type|Basic                      |
|Prepare User                     |${Reviewer}      |with first name|${Reviewer}     |and last name|Smith            |with type|Basic                      |
|Update Access Policy             |${PolicyName}                                                                                                           |
|Set User Permissions System Level|${Reviewer}      |               |${PolicyName}                                                                         |
|Set User Permissions System Level|${Requestor}     |               |${PolicyName}                                                                         |



!|scenario      |Record Session                                    |
|Request Session|${SystemName}    ||${ManagedAccount}||${Requestor}|
|Open Sessions  |${Requestor}                                      |
|Cancel Sessions|${ManagedAccount}||${Requestor}                   |


!|scenario        |Replay Session and Add Bookmark                                                                      |
|$res=            |GroovyWebDriver|ReplayLogAndAddBookmark;${TPAMHost};${Reviewer};${UserPwd};$RequestID;${BookmarkName}|
|Verify_Contain_OR|$res;;Adding bookmark                                                                                |


!|scenario        |Replay Session and Jump to Bookmark                                                          |
|$res=            |GroovyWebDriver|ReplayLogAndManageBookmark;${TPAMHost};${Reviewer};${UserPwd};$RequestID;Jump|
|Verify_Contain_OR|$res;;Jumped to bookmark                                                                     |



!|scenario        |Replay Session and Delete Bookmark                                                             |
|$res=            |GroovyWebDriver|ReplayLogAndManageBookmark;${TPAMHost};${Reviewer};${UserPwd};$RequestID;Delete|
|Verify_Contain_OR|$res;;Bookmark deleted                                                                         |


!|scenario        |Replay Session And Complete Review                                                                                           |
|$res=            |GroovyWebDriver|ReplayLogAndCompleteReview;${TPAMHost};${Reviewer};${UserPwd};$RequestID;This review completed by ${Reviewer}|
|Verify_Contain_OR|$res;;Need to replay session log                                                                                             |
|Verify_Contain_OR|$res;;Review completed                                                                                                       |
|Verify_Contain_OR|$res;;This review completed by ${Reviewer}                                                                                   |

!|scenario        |Complete Review                                                                                                  |
|$res=            |GroovyWebDriver|CompleteReview;${TPAMHost};${Reviewer};${UserPwd};$RequestID;This review completed by ${Reviewer}|
|Verify_Contain_OR|$res;;Review completed                                                                                           |
|Verify_Contain_OR|$res;;This review completed by ${Reviewer}                                                                       |


!|scenario               |Clear Objects                             |
|Login                   |${TPAMURL}   ||${TPAMAdmin}||${DefaultPwd}|
|Remove User From Group  |${CLI_user_1}||\"Global Requestor Group\" |
|Remove System           |${SystemName}                             |
|Session Cleanup         |${ManagedAccount}                         |
|Delete Account on System|${ManagedAccount}                         |
|Hard-Delete System      |${SystemName}                             |
|Remove User             |${Requestor}                              |
|Remove User             |${Reviewer}                               |
|Rollback Access Policy  |${PolicyName}                             |



!|scenario        |Replay And Complete Review|reviewerName                              |                              |requestID                              |
|$res=            |GroovyWebDriver           |ReplayLogAndCompleteReview;${TPAMHost};@reviewerName;${UserPwd};@requestID;This review completed by @reviewerName|
|Verify_Contain_OR|$res;;Need to replay session log                                                                                                            |
|Verify_Contain_OR|$res;;Review completed                                                                                                                      |
|Verify_Contain_OR|$res;;Smith, @reviewerName.*Y.*This review completed by @reviewerName                                                                       |



!|scenario               |Prepare Account|accountName  |                         |systemName||systemAddress|
|Add Account             |@accountName                                                                     |
|pause                   |3000                                                                             |
|Update PSM Details      |@accountName                                                                     |
|Create Account on System|@accountName   |with password|${ManagedAccountPassword}|on system |@systemAddress|


!| scenario       |Add System|systemName                   |                   |systemAddress                   |                   |systemPlatform                   |                   |functAcct                   |                  |funcAccPwd                  |
|$res=            |CLI       |${CLIBatch} AddSystem --SystemName @systemName --NetworkAddress @systemAddress --PlatformName \"@systemPlatform\" --FunctionalAccount @functAcct --FuncAcctCred @funcAccPwd --DomainName ${DomainName} --NetBiosName ${NETBIOSDomainName}|
|Verify_Contain_OR|$res;;successful                                                                                                                                                                                                                                    |


!| scenario       |Add Account|accountName                                                                                                                                                                                            |
|$res=            |CLI        |${CLIBatch} AddAccount --SystemName ${SystemName} --AccountName @accountName --Password ${ManagedAccountPassword}  --Description \"@accountName description\" --MinimumApprovers 0 --ReleaseDuration 15|
|Verify_Contain_OR|$res;;successful                                                                                                                                                                                                   |



!| scenario       |Update PSM Details|accountName                                                                                                                                                                                                                                                              |
|$res=            |CLI               |${CLIBatch} UpdatePSMAccount --System ${SystemName} --Account @accountName  --ProxyType \"RDP - Automatic Login Using Password\" --ColorDepth 8 --DefaultSessionDuration 15 --EnableFlag Y  --MinApprovers 0 --RecordingRequiredFlag Y --ReviewCount 1 --ReviewerType Any|
|Verify_Contain_OR|$res;;successful                                                                                                                                                                                                                                                                            |
#--RecordingRequiredFlag Y


!|scenario        |Set User Permissions System Level|userName                                   |                                  |userPermission                                  |
|$res=            |CLI                              |${CLIBatch} SetAccessPolicy --AccessPolicyName \"@userPermission\" --Action ADD --SystemName ${SystemName} --UserName @userName|
|Verify_Contain_OR|$res;;successful                                                                                                                                                 |


!|scenario    |Create Account on System  |accountName  |with password  |pwd  |on system  |systemAddress  |
|accountAction|${SystemPlatform};;create;;@systemAddress;;${FunctAcct};;${FuncAccPwd};;@accountName;;@pwd|

!|scenario    |Delete Account on System                         |accountName                         |
|accountAction|${SystemPlatform};;delete;;${SystemAddress};;${FunctAcct};;${FuncAccPwd};;@accountName|


!|scenario |Prepare User|userName|with first name|firstName|and last name|lastName|with type|userType  |
|Add User  |@userName   |        |${DefaultPwd}  |         |@firstName   |        |@lastName||@userType|
|pause     |5000                                                                                       |
|Change Pwd|@userName   |        |${DefaultPwd}  |         |${UserPwd}                                 |



!|scenario        |Add User|userName         |         |password         |         |firstName         |        |lastName        |        |userType        |
|$res=            |CLI     |${CLIBatch} AddUser --UserName @userName --FirstName @firstName --LastName @lastName --Password @password --UserType @userType|
|Verify_Contain_OR|$res;;successful                                                                                                                       |


!|scenario        |Add User To Group|UserName          |         |GroupName         |
|$res=            |CLI              |${CLIBatch} AddGroupMember @UserName,@GroupName|
|Verify_Contain_OR|$res;;successful                                                 |


!|scenario        |Remove User From Group|UserName          |          |GroupName         |
|$res=            |CLI                   |${CLIBatch} DropGroupMember @UserName,@GroupName|
|Verify_Contain_OR|$res;;successful                                                       |


!| scenario       |Remove System|sysName                          |
|$res=            |CLI          |${CLIBatch} DeleteSystem @sysName|
|Verify_Contain_OR|$res;;successful                               |

!| scenario       |Remove User|userName                        |
|$res=            |CLI        |${CLIBatch} DeleteUser @userName|
|Verify_Contain_OR|$res;;successful                            |


!|scenario            |Update Access Policy                |policyName                  |
|Login                |${TPAMURL}                          ||${TPAMAdmin}||${DefaultPwd}|
|pause                |5000                                                             |
|clickAndWait         |link=Access Policies                                             |
|type;                |id=filtPolicyName                   |@policyName                 |
|click                |id=Listing                                                       |
|waitForElementPresent|//td[contains(text(),'@policyName')]|                            |
|mouseDown            |//td[contains(text(),'@policyName')]|                            |
|click                |//td[contains(text(),'@policyName')]|                            |
|click                |id=Details                                                       |
|waitForElementPresent|id=UseDefaultsFl                                                 |
|pause                |1000                                                             |
|click                |id=cbxISA                                                        |
|pause                |1000                                                             |
|click                |id=cbxReview                                                     |
|click                |id=UseDefaultsFl                                                 |
|pause                |1000                                                             |
|click                |id=RecordingRequiredFl                                           |
|pause                |1000                                                             |
|click                |id=RecordKeystrokesFl                                            |
|pause                |1000                                                             |
|click                |id=MonitorKeystrokeLogFl                                         |
|pause                |1000                                                             |
|click                |id=RecordEventsFl                                                |
|pause                |1000                                                             |
|select;              |id=MaxDurationDays                  |label=0                     |
|select;              |id=MaxDurationHrs                   |label=00                    |
|select;              |id=MaxDurationMins                  |label=15                    |
|pause                |1000                                                             |
|click                |id=SubmitChangesButton                                           |
|waitForTextPresent   |Access Policy saved successfully                                 |



!|scenario            |Rollback Access Policy              |policyName                  |
|Login                |${TPAMURL}                          ||${TPAMAdmin}||${DefaultPwd}|
|pause                |5000                                                             |
|clickAndWait         |link=Access Policies                                             |
|type;                |id=filtPolicyName                   |@policyName                 |
|click                |id=Listing                                                       |
|waitForElementPresent|//td[contains(text(),'@policyName')]|                            |
|mouseDown            |//td[contains(text(),'@policyName')]|                            |
|click                |//td[contains(text(),'@policyName')]|                            |
|click                |id=Details                                                       |
|waitForElementPresent|id=UseDefaultsFl                                                 |
|pause                |1000                                                             |
|click                |id=cbxISA                                                        |
|pause                |1000                                                             |
|click                |id=cbxReview                                                     |
|click                |id=UseDefaultsFl                                                 |
|click                |id=SubmitChangesButton                                           |
|waitForTextPresent   |Access Policy saved successfully                                 |


!|scenario        |Request Session      |systemName                   |                   |accountName                  |                  |requestorName                  |
|$res=            |CLI                  |${CLIBatch} AddSessionRequest --SystemName @systemName --AccountName @accountName --ForUserName @requestorName --RequestNotes test|
|Verify_Contain_OR|$res;;submitted                                                                                                                                         |
|$RequestID=      |get_session_RequestID|$res                                                                                                                              |


!|scenario            |Open Sessions      |requestorName                                      |
|Login                |${TPAMURL}         |      |@requestorName      |      |${UserPwd}      |
|pause                |20000                                                                  |
|click                |id=CurrentRequests                                                     |
|waitForElementPresent|link=$RequestID                                                        |
|clickAndWait         |link=$RequestID                                                        |
|waitForElementPresent|id=StartSessionButton                                                  |
|click                |id=StartSessionButton                                                  |
|pause                |20000                                                                  |
|selectWindow         |Quest Software PSM Session (${SystemName}/${ManagedAccount}/$RequestID)|
|pause                |5000                                                                   |
|windowMaximize                                                                               |
|windowFocus                                                                                  |
|pause                |10000                                                                  |
|SWait                |all_servers.png                                                        |
|pause                |10000                                                                  |
|SClick               |close_server_manager.png                                               |
|pause                |240000                                                                 |
#|SWait                |all_servers.png                                                        |
#|pause                |60000                                                                  |



!|scenario            |Cancel Sessions   |accountName|              |requestorName|
|Login                |${TPAMURL}        |           |@requestorName| |${UserPwd} |
|pause                |10000                                                      |
|click                |id=CurrentRequests                                         |
|waitForElementPresent|link=Sess(@accountName)                                    |
|clickAndWait         |link=Sess(@accountName)                                    |
|waitForElementPresent|//td[contains(text(),'@accountName')]                      |
|mouseDown            |//td[contains(text(),'@accountName')]                      |
|click                |//td[contains(text(),'@accountName')]                      |
|click                |id=Details                                                 |
|waitForElementPresent|id=ResponseComment                                         |
|type;                |id=ResponseComment|cancel                                  |
|typeKeys;            |id=ResponseComment|request                                 |
|click                |id=SubmitChanges                                           |
|waitForTextPresent   |*The response * was submitted successfully*                |
|Logout                                                                           |




!|scenario            |Hard-Delete System                  |systemName |
|pause                |5000                                            |
|clickAndWait         |link=Deleted Systems                            |
|type;                |id=SystemNm                         |@systemName|
|click                |id=Listing                          |           |
|waitForElementPresent|//td[contains(text(),'@systemName')]|           |
|mouseDown            |//td[contains(text(),'@systemName')]|           |
|click                |//td[contains(text(),'@systemName')]|           |
|pause                |1000                                            |
|click                |id=HardDeleteButton                 |           |
|getConfirmation                                                       |
|waitForTextPresent   |has been successfully deleted                   |

!|scenario|Session Cleanup  |accountName                                                            |
|$res=    |RunBatchGetOutput|CleanupSession;${SystemAddress};${FunctAcct};${FuncAccPwd};@accountName|
