!contents



!|scenario                      |Prepare Environment                                                                        |
|Login                          |${TPAMURL}          |             |${TPAMAdmin}         |          |${DefaultPwd}          |
|pause                          |15000                                                                                      |
|Add system                                                                                                                 |
|Enable System Ticket Validation|!Any                |             |${TicketNotifyEmail} |          |Y  | |N | |N | |N | |N |
|Create File                    |${FilePath}         |             |${FileName}                                             |
|Add File                       |${FileName}                                                                                |
|Prepare Account                |${ManagedAccount}   |with password|${ManagedAccountPwd} |with email|${ManagedAccountEmail} |
|Prepare Account                |${ManagedAccount2}  |with password|${ManagedAccount2Pwd}|with email|${ManagedAccount2Email}|
|Add Web User                   |${WebUser}          |             |${WebUserEmail}      |          |Basic                  |
|Set User File Permissions      |${WebUser}          |             |${FileName}                                             |
|Set User Permissions           |${CLI_user_1}       |             |${ManagedAccount}                                       |
|Set User Permissions           |${CLI_user_2}       |             |${ManagedAccount}                                       |
|Set User Permissions           |${WebUser}          |             |${ManagedAccount}                                       |
|Set User Permissions           |${CLI_user_1}       |             |${ManagedAccount2}                                      |
|Set User Permissions           |${CLI_user_2}       |             |${ManagedAccount2}                                      |
|Set User Permissions           |${WebUser}          |             |${ManagedAccount2}                                      |
|Create Mailbox                 |${TicketNotifyEmail}|             |${TPAMEMailPassword}                                    |
|Logout                                                                                                                     |
|Change Notification Body       |Session Start       |             |${SessionStartNotificationBodyNew}                      |


!| scenario              |Clear Environment                                |
|Remove System           |${SystemName}                                    |
|Remove User             |${WebUser}                                       |
|Delete Mailbox          |${TicketNotifyEmail}                             |
|Delete Mailbox          |${ManagedAccountEmail}                           |
|Delete Mailbox          |${ManagedAccount2Email}                          |
|Delete Mailbox          |${WebUserEmail}                                  |
|Delete Mailbox          |${SessionStartNotifyEmail}                       |
|Delete Account on System|${ManagedAccount}                                |
|Delete Account on System|${ManagedAccount2}                               |
|Delete File             |${FilePath}  ||${FileName}                       |
|Change Notification Body|Session Start||${SessionStartNotificationBodyOld}|




!| scenario              |Prepare Account           |acc                                     |with password                                     |pwd                                     |with email                                     |notifyEmail                                    |
|Create Account on System|@acc                                                                                                                                                                                                                                                           |
|$Months=                |getEval                   |var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+1); d.setUTCDate(d.getUTCDate()+1);var s = d.getUTCMonth()+1;if ((s + "").length == 1) { s = "0" + s } else { s = d.getUTCMonth()+1} ;return s;                                |
|$Days=                  |getEval                   |var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+1); d.setUTCDate(d.getUTCDate()+1);var s = d.getUTCDate(); if ((s + "").length == 1) { s = "0" + s } else { s = d.getUTCDate() };return s;                                     |
|$Years=                 |getEval                   |var d = new Date();d.setUTCMinutes(d.getUTCMinutes()+1); d.setUTCDate(d.getUTCDate()+1); var s = d.getUTCFullYear();return s;                                                                                                       |
|$res=                   |CLI                       |${CLIBatch} AddAccount --SystemName ${SystemName} --AccountName @acc --Password \"@pwd\" --Description \"${ManagedAccountDescription}\" --NextChangeDate $Months/$Days/$Years --MinimumApprovers 0 --ReleaseNotifyEmail @notifyEmail|
|Verify_Contain_OR       |$res;;successful                                                                                                                                                                                                                                               |
|Create Mailbox          |@notifyEmail              |                                        |${TPAMEMailPassword}                                                                                                                                                                       |
|$res=                   |CLI                       |${CLIBatch} UpdatePSMAccount --System ${SystemName} --Account @acc --EnableFlag Y --ProxyType \"SSH - Automatic Login Using Password\" --MinApprovers 0 --SessionStartNotifyEmail ${SessionStartNotifyEmail}                        |
|Verify_Contain_OR       |$res;;successful                                                                                                                                                                                                                                               |
|Create Mailbox          |${SessionStartNotifyEmail}|                                        |${TPAMEMailPassword}                                                                                                                                                                       |

!|scenario    |Create Account on System                                     |accountName                                     |
|accountAction|${SystemPlatform};;create;;${SystemAddress};;${FunctAcct};;${FunctAcctPwd};;@accountName;;${ManagedAccountPwd}|


!|scenario    |Delete Account on System                          |accountName                          |
|accountAction|${SystemPlatform};;delete;;${SystemAddress};;${FunctAcct};;${FunctAcctPwd};;@accountName|


############################# BFER 5375 (--TicketSystemName !Any is not accepted)###################################
!|scenario        |Enable System Ticket Validation|ticketSystem                |                |ticketEmail                |                |requirePassword                |                |requireIsa                |                |requireCli                |                |requireApi                |               |requirePsm               |
|$res=            |CLI                            |${CLIBatch} UpdateSystem --SystemName ${SystemName} --RequireTicketForRequest @requirePassword --RequireTicketForISA @requireIsa --RequireTicketForCLI @requireCli --RequireTicketForAPI @requireApi --RequireTicketForPSM @requirePsm --TicketSystemName @ticketSystem --TicketEmailNotify @ticketEmail|
|Verify_Contain_OR|$res;;successful                                                                                                                                                                                                                                                                                                                        |


#!|scenario        |Enable System Ticket Validation|ticketEmail                     |                     |requireIsa                     |                     |requireCli                     |                     |requireApi                    |                    |requirePsm                 |
#|$res=            |CLI                            |${CLIBatch} UpdateSystem --SystemName ${SystemName} --RequireTicketForRequest @requirePassword --RequireTicketForISA @requireIsa --RequireTicketForCLI @requireCli --RequireTicketForAPI --RequireTicketForPSM @requirePsm @requireApi --TicketEmailNotify @ticketEmail|
#|Verify_Contain_OR|$res;;successful                                                                                                                                                                                                                                      |


!|scenario        |Enable Account Ticket Validation|accountName               |               |ticketSystem               |               |ticketEmail               |               |requirePassword               |               |requireIsa               |               |requireCli               |               |requireApi               |               |requirePsm               |
|$res=            |CLI                             |${CLIBatch} UpdateAccount --SystemName ${SystemName} --AccountName @accountName --RequireTicketForRequest @requirePassword --RequireTicketForISA @requireIsa --RequireTicketForCLI @requireCli --RequireTicketForAPI @requireApi --RequireTicketForPSM @requirePsm --TicketSystemName \"@ticketSystem\" --TicketEmailNotify @ticketEmail|
|Verify_Contain_OR|$res;;successful                                                                                                                                                                                                                                                                                                                                                         |



!|scenario        |Add Web User|UserName                     |                                  |EMail                     |                      |UserType                    |
|$res=            |CLI         |${CLIBatch} AddUser --UserName @UserName --FirstName Testfirst --LastName Testlast --Password ${DefaultPwd} --Email @EMail --UserType @UserType|
|Verify_Contain_OR|$res;;successful                                                                                                                                            |
|Create Mailbox   |@EMail      |                             |${TPAMEMailPassword}                                                                                             |
|Change Pwd       |@UserName   |                             |${DefaultPwd}                     |                          |${UserPwd}                                         |


#!|scenario        |Delete Ticket System|systemName                                |
#|$res=            |GroovyWebDriver     |DeleteTicketSystem;${TPAMHost};@systemName|
#|Verify_Contain_OR|$res;;System deleted                                           |



!|scenario         |Delete Ticket System|systemName                  |
|Login             |${TPAMAdminURL}     ||${TPAMMaster}||${MasterPwd}|
|pause             |5000                                             |
|clickOnLink       |link=Ticket Systems |                            |
|click             |xpath=//td[contains(text(),'@systemName')]       |
|pause             |3000                                             |
|click             |id=Details                                       |
|pause             |3000                                             |
|click             |id=DeleteTicketSystem                            |
|getConfirmation                                                     |
|waitForTextPresent|Ticket System successfully deleted               |
|Logout                                                              |

#|waitForTextPresent   |Ticket System successfully deleted               |


!| scenario       |Add system                                                                                                                                                                                                                |
|$res=            |CLI|${CLIBatch} AddSystem --SystemName ${SystemName} --NetworkAddress ${SystemAddress} --PlatformName \"${SystemPlatform}\" --FunctionalAccount ${FunctAcct} --FuncAcctCred \"${FunctAcctPwd}\" --Timeout ${SystemTimeout}|
|Verify_Contain_OR|$res;;successful                                                                                                                                                                                                          |



!|scenario        |Set User Permissions|userName                                  |                                 |accountName                                 |                                 |
|$res=            |CLI                 |${CLIBatch} SetAccessPolicy --AccessPolicyName "Approver-Requestor" --Action ADD --SystemName ${SystemName} --AccountName @accountName --UserName @userName|
|Verify_Contain_OR|$res;;successful                                                                                                                                                                |

!|scenario        |Set ISA Permissions|userName                              |                              |accountName                             |                             |
|$res=            |CLI                |${CLIBatch} SetAccessPolicy --AccessPolicyName "ISA" --Action ADD --SystemName ${SystemName} --AccountName @accountName --UserName @userName|
|Verify_Contain_OR|$res;;successful                                                                                                                                                |


!|scenario        |Set User File Permissions|userName                                 |                                 |fileName                                |                                |
|$res=            |CLI                      |${CLIBatch} SetAccessPolicy --AccessPolicyName "Approver-Requestor" --Action ADD --SystemName ${SystemName} --FileName @fileName --UserName @userName|
|Verify_Contain_OR|$res;;successful                                                                                                                                                               |


!|scenario        |Revoke User Permissions|userName                                  |                                  |accountName                                 |                                 |
|$res=            |CLI                    |${CLIBatch} SetAccessPolicy --AccessPolicyName "Approver-Requestor" --Action DROP --SystemName ${SystemName} --AccountName @accountName --UserName @userName|
|Verify_Contain_OR|$res;;successful                                                                                                                                                                    |

!|scenario        |Revoke ISA Permissions|userName                              |                              |accountName                              |                             |
|$res=            |CLI                   |${CLIBatch} SetAccessPolicy --AccessPolicyName "ISA" --Action DROP --SystemName ${SystemName} --AccountName @accountName --UserName @userName|
|Verify_Contain_OR|$res;;successful                                                                                                                                                    |


!| scenario       |Remove system|sysName                          |
|$res=            |CLI          |${CLIBatch} DeleteSystem @sysName|
|Verify_Contain_OR|$res;;successful                               |

!| scenario       |Remove user|userName                        |
|$res=            |CLI        |${CLIBatch} DeleteUser @userName|
|Verify_Contain_OR|$res;;successful                            |
######################################################################

!|scenario                       |Ticket Required for CLI ISA Password Release                                                                                                                                                        |
|Enable Account Ticket Validation|${ManagedAccount}|         |${TicketSystemName}         |         |${TicketNotifyEmail}         |         |N         |         |Y         |         |N        |        |N        |        |N        |
|Set ISA Permissions             |${CLI_user_1}    |         |${ManagedAccount}                                                                                                                                                       |
|$res=                           |CLI              |${CLIBatch} Retrieve --SystemName ${SystemName} --AccountName ${ManagedAccount} --ReasonText Nado --TicketSystemName \"${TicketSystemName}\" --TicketNumber ${InvalidTicketNumber}|
|Verify_Contain_OR               |$res;;Ticket Number not found;;Ticket "${InvalidTicketNumber}" not found;;Ticket Number failed manual validation                                                                                    |
|$res=                           |CLI              |${CLIBatch} Retrieve --SystemName ${SystemName} --AccountName ${ManagedAccount} --ReasonText Nado --TicketSystemName \"${TicketSystemName}\" --TicketNumber ${ValidTicketNumber2} |
|$GeneratedPwd=                  |get_password     |$res                                                                                                                                                                              |
|Login Account to System         |$GeneratedPwd                                                                                                                                                                                       |
|Revoke ISA Permissions          |${CLI_user_1}    |         |${ManagedAccount}                                                                                                                                                       |
|Set User Permissions            |${CLI_user_1}    |         |${ManagedAccount}                                                                                                                                                       |


!|scenario                       |Ticket Required for UI ISA Password Release                                |
|Enable Account Ticket Validation|${ManagedAccount}||${TicketSystemName}||${TicketNotifyEmail}||N||Y||N||N||N|
|Set ISA Permissions             |${WebUser}       ||${ManagedAccount}                                       |
|ISA Password Release            |${WebUser}       ||${ManagedAccount}                                       |
|Set User Permissions            |${WebUser}       ||${ManagedAccount}                                       |



!|scenario              |ISA Password Release      |userName        |                 |accountName              |
|Login                  |${TPAMURL}                |                |@userName        |        |${UserPwd}      |
|pause                  |15000                                                                                  |
|Choose Account         |${SystemName}             |                |@accountName                               |
|click                  |id=Passwords                                                                           |
|pause                  |5000                                                                                   |
|select;                |id=Release_TSID           |label=${TicketSystemName}                                   |
|pause                  |1000                                                                                   |
|type;                  |id=TicketNbr              |${InvalidTicketNumber}                                      |
|pause                  |1000                                                                                   |
|click                  |id=Password                                                                            |
|waitForElementPresent  |xpath=//div[@id='passwordDisplay']                                                     |
|pause                  |14000                                                                                  |
|$res=                  |getText                   |xpath=//div[@id='passwordDisplay']                          |
|Verify_Contain_OR      |$res;;Ticket "${InvalidTicketNumber}" not found;;Ticket Number failed manual validation|
|pause                  |5000                                                                                   |
|click                  |id=CurrentPassword                                                                     |
|pause                  |5000                                                                                   |
|type;                  |id=TicketNbr              |${ValidTicketNumber2}                                       |
|pause                  |1000                                                                                   |
|click                  |id=Password                                                                            |
|pause                  |15000                                                                                  |
|waitForElementPresent  |xpath=//div[@class='displayPassword']                                                  |
|$res=                  |getText                   |xpath=//div[@class='displayPassword']                       |
|$GeneratedPwd=         |get_password              |$res                                                        |
|Login Account to System|$GeneratedPwd                                                                          |
|Logout                                                                                                         |





#!|scenario                       |Ticket Required for ISA Password Release                             |
#|Enable Account Ticket Validation|${ManagedAccount}||${TicketSystemName}||${TicketNotifyEmail}||Y||Y||N||N||N|
#|Set ISA Permissions             |${WebUser}       ||${ManagedAccount}                                 |
#|Login                           |${TPAMURL}       ||${WebUser}         ||${UserPwd}                   |
#|pause                           |20000                                                                |
#|Choose Account                  |${ManagedAccount}                                                    |
#|click                           |id=Passwords                                                         |
#|pause                           |5000                                                                 |
#|click                           |id=Password                                                          |
#|pause                           |5000                                                                 |
#|waitForElementPresent           |xpath=//div[@class='displayPassword']                                      |
#|$passwordstr=                   |getText          |xpath=//div[@class='displayPassword']                    |
#|$GeneratedPwd=                  |get_password     |$passwordstr                                       |
#|pause                           |5000                                                                 |
#|$res=                           |getText          |xpath=//div[@id='ResultsDiv']                            |
#|Verify_Contain_OR               |$res;;Ticket                                                         |
#|Revoke ISA Permissions          |${WebUser}       ||${ManagedAccount}                                 |
#|Set User Permissions            |${WebUser}       ||${ManagedAccount}                                 |




!|scenario                       |Ticket Required for CLI Password Release                                                                                                              |
|Enable Account Ticket Validation|${ManagedAccount}|      |${TicketSystemName}      |      |${TicketNotifyEmail}      |      |N     |     |N     |     |Y     |     |N     |     |N     |
|$res=                           |CLI              |${CLIBatch} AddPwdRequest --SystemName ${SystemName} --AccountName ${ManagedAccount} --ForUserName ${CLI_user_2} --RequestNotes test|
|Verify_Contain_OR               |$res;;success                                                                                                                                         |
|$RequestID=                     |get_RequestID    |$res                                                                                                                                |
|$res=                           |CLI              |${CLIBatch2} Retrieve --RequestID $RequestID                                                                                        |
|Verify_Contain_OR               |$res;;Ticket Number and Ticket System are required for the CLI retrieval                                                                              |
|Cancel Password Request                                                                                                                                                                |


!|scenario                       |Ticket Required for API Password Release                                   |
|Enable Account Ticket Validation|${ManagedAccount}||${TicketSystemName}||${TicketNotifyEmail}||N||N||N||Y||N|
|Set ISA Permissions             |${API_user_1}    ||${ManagedAccount}                                       |
|pause                           |${ApplyNewPoliciesInterval}                                                |
|$res=                           |PerlAPI          |${APIBatch} retrieveISA ${SystemName} ${ManagedAccount}  |
|Verify_Contain_OR               |$res;;Ticket Number and Ticket System are required for the API retrieval   |



######################################################################

!|scenario   |Request File with Invalid Ticket Failed                                                                  |
|Request File|${SystemName}||${FileName}||${WebUser}||${InvalidTicketNumber}||Ticket "${InvalidTicketNumber}" not found|


!|scenario   |Request File for Invalid System Failed                                                                       |
|Request File|${SystemName}||${FileName}||${WebUser}||${ValidTicketNumber1}||Ticket failed validation Rule "${NewRuleName}"|



!|scenario          |Request File with Valid Ticket Successful                                                                                              |
|Request File       |${SystemName}||${FileName}||${WebUser}||${ValidTicketNumber2}||has been submitted.*You should receive email confirmation of the request|
|Cancel File Request|${WebUser}                                                                                                                             |




!|scenario                       |Request File with Provisional Validation                                                                                     |
|Enable-Disable Ticket Validation|${TicketSystemName}                                                                                                          |
|Request File                    |${ManagedAccount2}||${InvalidTicketNumber}||*Request*has been submitted.*You should receive email confirmation of the request|
|Cancel File Request             |${WebUser}                                                                                                                   |
|Enable-Disable Ticket Validation|${TicketSystemName}                                                                                                          |

######################################################################

!|scenario                   |Request Password with Invalid Ticket Failed                                         |
|Request Password with Ticket|${ManagedAccount}||${InvalidTicketNumber}||Ticket "${InvalidTicketNumber}" not found|




!|scenario                   |Request Password for Invalid System Failed                                               |
|Request Password with Ticket|${ManagedAccount2}||${ValidTicketNumber1}||Ticket failed validation Rule "${NewRuleName}"|



!|scenario                   |Request Password with Valid Ticket Successful                                  |
|Request Password with Ticket|${ManagedAccount}||${ValidTicketNumber2}||The current status is Active/Approved|
|$RequestID=                 |get_RequestID    |$res                                                         |
|Cancel Password Request                                                                                     |


!|scenario                      |Request Password without Any Ticket Failed                                 |
|Request Password without Ticket|${ManagedAccount}||This account requires a Ticket for all Password Requests|


!|scenario                       |Request Password with Provisional Validation                                     |
|Enable-Disable Ticket Validation|${TicketSystemName}                                                              |
|Request Password with Ticket    |${ManagedAccount2}||${InvalidTicketNumber}||The current status is Active/Approved|
|$RequestID=                     |get_RequestID     |$res                                                          |
|Cancel Password Request                                                                                           |
|Enable-Disable Ticket Validation|${TicketSystemName}                                                              |

#################################################################################################################

!|scenario                  |Request Session with Invalid Ticket Failed                                          |
|Request Session with Ticket|${ManagedAccount}||${InvalidTicketNumber}||Ticket "${InvalidTicketNumber}" not found|




!|scenario                  |Request Session for Invalid System Failed                                                |
|Request Session with Ticket|${ManagedAccount2}||${ValidTicketNumber1}||Ticket failed validation Rule "${NewRuleName}"|



!|scenario                  |Request Session with Valid Ticket Successful                                   |
|Request Session with Ticket|${ManagedAccount}||${ValidTicketNumber2}||The current status is Active/Approved|
|$RequestID=                |get_RequestID    |$res                                                         |
|Open Session               |${WebUser}                                                                     |



!|scenario                       |Request Session without Any Ticket Failed                                  |
|Enable Account Ticket Validation|${ManagedAccount}||${TicketSystemName}||${TicketNotifyEmail}||N||N||N||N||Y|
|Request Session without Ticket  |${ManagedAccount}||This account requires a Ticket for all Session Requests |


!|scenario                       |Request Session with Provisional Validation                                      |
|Enable-Disable Ticket Validation|${TicketSystemName}                                                              |
|Request Session with Ticket     |${ManagedAccount2}||${InvalidTicketNumber}||The current status is Active/Approved|
|$RequestID=                     |get_RequestID     |$res                                                          |
|Open Session                    |${WebUser}                                                                       |
|Enable-Disable Ticket Validation|${TicketSystemName}                                                              |

#####################################################################################################



!|scenario            |Enable-Disable Ticket Validation|systemName                  |
|Login                |${TPAMAdminURL}                 ||${TPAMMaster}||${MasterPwd}|
|pause                |15000                                                        |
|clickOnLink          |link=Ticket Systems             |                            |
|click                |xpath=//td[contains(text(),'@systemName')]                   |
|click                |id=Details                                                   |
|waitForElementPresent|id=EnableFL                                                  |
|click                |id=EnableFL                                                  |
|pause                |2000                                                         |
|click                |id=SubmitChanges                                             |
|waitForTextPresent   |Ticket System saved successfully                             |
|stop                                                                               |
#|getConfirmation                                                        |


!| scenario        |Request File    |SystemName|          |FileName||Requestor||ticketNumber||result|
|Login             |${TPAMURL}      |          |@Requestor|        |${UserPwd}                      |
|pause             |10000                                                                           |
|clickOnLink       |link=Add File Request                                                           |
|type;             |id=SystemNm     |@SystemName                                                    |
|type;             |id=FileNm       |@FileName                                                      |
|click             |id=Files                                                                        |
|click             |xpath=//td[contains(text(),'@FileName')]                                        |
|click             |id=Details                                                                      |
|pause             |15000                                                                           |
|type;             |id=RequestReason|file request reason                                            |
|select;           |id=TSID         |label=${TicketSystemName}                                      |
|pause             |1000                                                                            |
|type;             |id=TicketNbr    |@ticketNumber                                                  |
|pause             |2000                                                                            |
|click             |id=SubmitChanges                                                                |
|waitForTextPresent|@result                                                                         |
|$res=             |getText         |xpath=//div[@id='ResultsDiv']                                  |
|Verify_Contain_OR |$res;;@result                                                                   |
|Logout                                                                                             |



!| scenario        |Cancel File Request|Requestor              |
|Login             |${TPAMURL}         ||@Requestor||${UserPwd}|
|pause             |5000                                       |
|click             |id=CurrentRequests                         |
|clickOnLink       |link=File(${FileName})                     |
|click             |xpath=//td[contains(text(),'${FileName}')] |
|click             |id=Details                                 |
|pause             |10000                                      |
|type;             |id=ResponseComment |cancel                 |
|click             |id=SubmitChanges                           |
|waitForTextPresent|*The response *was submitted successfully* |
|Logout                                                        |

!|scenario        |Request Password with Ticket|accountName                                |                               |ticketNumber                               |                               |requestResult                               |
|$res=            |CLI                         |${CLIBatch} AddPwdRequest --SystemName ${SystemName} --AccountName @accountName --ForUserName ${WebUser} --RequestNotes test --TicketNumber @ticketNumber --TicketSystemName \"${TicketSystemName}\"|
|Verify_Contain_OR|$res;;@requestResult                                                                                                                                                                                                             |



!|scenario        |Request Password without Ticket|accountName                                 |                                 |requestResult                                |
|$res=            |CLI                            |${CLIBatch} AddPwdRequest --SystemName ${SystemName} --AccountName @accountName --ForUserName ${WebUser} --RequestNotes test|
|Verify_Contain_OR|$res;;@requestResult                                                                                                                                        |


!| scenario       |Cancel Password Request                                       |
|$res=            |CLI|${CLIBatch} Cancel --RequestID $RequestID --Comment finish|
|Verify_Contain_OR|$res;;successful                                              |


###############################################################################################


!|scenario        |Request Session with Ticket|accountName                                |                                |ticketNumber                                |                                |requestResult                                |
|$res=            |CLI                        |${CLIBatch} AddSessionRequest --SystemName ${SystemName} --AccountName @accountName --ForUserName ${WebUser} --RequestNotes test --TicketNumber @ticketNumber --TicketSystemName \"${TicketSystemName}\"|
|Verify_Contain_OR|$res;;@requestResult                                                                                                                                                                                                                |



!|scenario        |Request Session without Ticket|accountName                                  |                                  |requestResult                                  |
|$res=            |CLI                           |${CLIBatch} AddSessionRequest --SystemName ${SystemName} --AccountName @accountName --ForUserName ${WebUser} --RequestNotes test|
|Verify_Contain_OR|$res;;@requestResult                                                                                                                                           |


!| scenario       |Cancel Session Request                                                      |
|$res=            |CLI|${CLIBatch} CancelSessionRequest --RequestID $RequestID --Comment finish|
|Verify_Contain_OR|$res;;successful;;Terminat;;terminat;;Active session can be forcibly removed|




###############################################################################################

!|scenario|Delete Ticket Database|
|Drop Database                   |




!|scenario         |Add File       |fileName                                                                                                              |
|$res =            |GroovyWebDriver|tryToCreateFile;${TPAMHost};${TPAMAdmin};${DefaultPwd};${SystemName};${FilePath}${FileName};@fileName;${FileEmailAddr}|
|Verify_Contain_NOT|$res;;something went wrong                                                                                                            |
|Verify_Contain_OR |$res;;File created successfully                                                                                                       |


!|scenario         |Remove File|FileName                    |
|Login             |${TPAMURL} ||${TPAMAdmin}||${DefaultPwd}|
|pause             |10000                                   |
|clickOnLink       |link=Manage Files                       |
|type;             |id=FileNm  |@FileName                   |
|click             |id=Listing                              |
|click             |xpath=//td[contains(text(),'@FileName')]|
|click             |id=Delete                               |
|getConfirmation                                            |
|waitForTextPresent|@FileName has been successfully deleted |
|Logout                                                     |

!|scenario     |Open Session              |Requestor                                                                                                                                            |
|Login         |${TPAMURL}                ||@Requestor                ||${UserPwd}                                                                                                              |
|pause         |20000                                                                                                                                                                           |
|click         |id=CurrentRequests                                                                                                                                                              |
|clickOnLink   |link=$RequestID                                                                                                                                                                 |
|click         |id=StartSessionButton                                                                                                                                                           |
|pause         |20000                                                                                                                                                                           |
|selectWindow  |Quest Software PSM Session (${SystemName}/${ManagedAccount}/$RequestID)                                                                                                         |
|pause         |15000                                                                                                                                                                           |
|SWaitMultiple |Accept2.png;Accept3.png                                                                                                                                                         |
|SClickMultiple|Accept2.png;Accept3.png                                                                                                                                                         |
|pause         |30000                                                                                                                                                                           |
|stop                                                                                                                                                                                           |
|selectWindow  |Quest Software TPAM                                                                                                                                                             |
|stop                                                                                                                                                                                           |
|Cancel Session Request                                                                                                                                                                         |
|pause         |150000                                                                                                                                                                          |
|Check Mail    |${SessionStartNotifyEmail}||Session Start Notification||A TPAM PSM session (request #$RequestID) for account ${ManagedAccount} on System ${SystemName} was started by @Requestor|
|Check Mail    |${SessionStartNotifyEmail}||Session Start Notification||Ticket System: ${TicketSystemName}, Ticket Number: ${ValidTicketNumber2}                                                |
|Delete Mails  |${SessionStartNotifyEmail}                                                                                                                                                      |


!| scenario             |Check Mail|user          |          |subject          |         |body         |
|$res=                  |CheckMail |${MailServer};@user;${TPAMEMailPassword};${FromMail};@subject;@body|
|Verify_Contain_OR_alnum|$res;;@body                                                                   |

!| scenario             |Check No Mail|user          |          |subject          |         |body         |
|$res=                  |CheckMail    |${MailServer};@user;${TPAMEMailPassword};${FromMail};@subject;@body|
|Verify_Contain_OR_alnum|$res;;no messages                                                                |

!| scenario             |Delete Mails|user                                    |
|$res=                  |ClearMailbox|${MailServer};@user;${TPAMEMailPassword}|
|Verify_Contain_OR_alnum|$res;;Messages deleted                               |


!|scenario|Create File |filepath||filename|
|runBatch |CreateFile2;@filepath;@filename|


!|scenario|Delete File |filepath||filename|
|runBatch |DeleteFile2;@filepath;@filename|


!|scenario  |Choose Account                                                |systemName||accountName|
|pause      |5000                                                                                  |
|clickOnLink|link=Manage Accounts                                          |                       |
|type;      |id=SystemNm                                                   |@systemName            |
|click      |id=Listing                                                    |                       |
|click      |xpath=//table[@id='AccountListing']//td[text()='@accountName']|                       |



!|scenario    |Login Account to System                    |ManPwd                    |
|accountAction|${SystemPlatform};;login;;${SystemAddress};;${ManagedAccount};;@ManPwd|


!|scenario    |Set Request Reason for ISA settings to|value                       |
|Login        |${TPAMAdminURL}                       ||${TPAMMaster}||${MasterPwd}|
|pause        |5000                                                               |
|clickOnLink  |link=Global Settings                                               |
|mouseMoveOver|xpath=//td[contains(text(),'Detailed Reason Text for ISA Release')]|
|select;      |id=T56                                |label=@value                |
|pause        |1000                                                               |
|click        |id=SubmitChanges                                                   |
|Logout                                                                           |


!|scenario         |Change Notification Body|notificationName|             |notificationBody|
|Login             |${TPAMAdminURL}         |                |${TPAMMaster}|  |${MasterPwd} |
|pause             |15000                                                                   |
|clickOnLink       |link=Email Config                                                       |
|select;           |id=EmailConfigID        |label=@notificationName                        |
|pause             |1000                                                                    |
|type;             |id=EmailBody            |@notificationBody                              |
|click             |id=SubmitChanges                                                        |
|waitForTextPresent|All Email changes saved successfully                                    |
|Logout                                                                                     |


!|scenario         |Duplicate Managed Ticket System|oldSystem|             |newSystem    |
|Login             |${TPAMAdminURL}                |         |${TPAMMaster}||${MasterPwd}|
|pause             |15000                                                                |
|clickOnLink       |link=Ticket Systems            |                                     |
|click             |xpath=//td[contains(text(),'@oldSystem')]                            |
|pause             |1000                                                                 |
|click             |id=Duplicate                                                         |
|pause             |1000                                                                 |
|click             |xpath=//td[contains(text(),'@newSystem')]                            |
|pause             |1000                                                                 |
|click             |id=Details                                                           |
|pause             |5000                                                                 |
|click             |id=EnableFL                                                          |
|pause             |1000                                                                 |
|click             |id=SubmitChanges                                                     |
|waitForTextPresent|Ticket System saved successfully                                     |
|pause             |5000                                                                 |
|clickOnLink       |link=Ticket Systems                                                  |
|pause             |5000                                                                 |
|click             |xpath=//td[contains(text(),'@newSystem')]                            |
|pause             |5000                                                                 |
|click             |id=Rules                                                             |
|pause             |2000                                                                 |
|click             |xpath=//td[contains(text(),'${NewRuleName}')]                        |
|pause             |2000                                                                 |
|click             |id=RuleDetails                                                       |
|pause             |2000                                                                 |
|click             |id=RuleEnableFL                                                      |
|pause             |2000                                                                 |
|click             |id=SubmitChanges                                                     |
|waitForTextPresent|Ticket System Rules saved successfully                               |
|Logout                                                                                  |














