!********> Test Description
This test checks that Dublicate button for user is working.
Check that new user has same gropmembership and permissions.
**************!
!include -c <AutoTestsWebDrv.PlatformsTesting.MacOsxSix
!define psConnectOptions {-tpamAddress ${TPAMHost} -keyFile ${API_user_1} -apiUser ${API_user_1}}

!define testUser {${prefix}tstUser}
!define newUserPwd {yHRa02HV}
!define duplUserName {${testUser}_Dupl}
!define testGroup {${prefix}listGroup}
!define test_policy {PPM Requestor}
!define SystemDescription {tst}
!define groupDescription {${SystemDescription}}

!include -c <AutoTestsWebDrv.ScenarioLibrary
!include -c <AutoTestsWebDrv.PowerShellNetApiScenarios.ScenarioLibrary
!include -c ScenarioLibrary

!* Create Envirinment
!|script                                                                             |
|Add system                                                                          |
|Add User       |${testUser}     |usertype |Basic        |with password|${newUserPwd}|
|Add Group      |${testGroup}                                                        |
|Add Member     |${testUser}     |to group |${testGroup}                             |
|Set Permissions|"${test_policy}"|on system|${SystemName}|for user     |${testUser}  |
|Change Pwd     |${testUser}     |         |${newUserPwd}|             |${UserPwd}   |

*!
!* Duplicate and check results
!|script                                                                                                                                    |
|Duplicate User                  |${testUser}                                         |to                 |${duplUserName}                  |
|pause                           |${ApplyNewPoliciesInterval}                                                                               |
|List Groups Membership by filter|-groupName ${testGroup}                             |and result contains|${testGroup}.*${duplUserName}    |
|List Policies by filter         |-systemName  ${SystemName} -userName ${duplUserName}|contains           |${duplUserName}.*${test_policy}.*|
|Change Pwd                      |${duplUserName}                                     |                   |${newUserPwd}   |   |${UserPwd}  |
*!
!* Delete All
!|script                      |
|Delete System|${SystemName}  |
|Delete User  |${testUser}    |
|Delete User  |${duplUserName}|
|Delete Group |${testGroup}   |
*!