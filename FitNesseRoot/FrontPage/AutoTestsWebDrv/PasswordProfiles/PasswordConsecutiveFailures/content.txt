!*> Variables list
!define CheckProfile {${prefix}CheckConsFail}
!define ChangeProfile {${prefix}ChangeConsFail}
!define CheckProfile2 {${prefix}CheckConsFail2}
!define ChangeProfile2 {${prefix}ChangeConsFail2}
!define CheckTimeout {10}
!define ChangeTimeout {10}
*!

''System''
!include -c <AutoTestsWebDrv.PlatformsTesting.WindowsLocalHost
''Libraries''
!include -c <AutoTestsWebDrv.UsersTests.UserTypes.ScenarioLibrary
!include -c <PasswordProfiles.ScenarioLibrary



!*> Prepare
!|script                                                                                                                                                                                                                                                                                                                                                             |
|Open                                       |${TPAMURL}      ||${TPAMAdmin}                                                                                                                                                                                                                                                                           ||${DefaultPwd}|
|Add System                                 |${CLIBatch}     ||--SystemName ${SystemName} --PlatformName ${SystemPlatform} --NetworkAddress ${SystemAddress} --FunctionalAccount ${FunctAcct} --FuncAcctCred \"${FunctAcctPwd}\" --PasswordCheckProfile ${PersistentPasswordCheckProfile1} --PasswordChangeProfile ${PersistentPasswordChangeProfile1}||successfully |
|Create Password Change Profile             |${ChangeProfile}||Do Nothing                                                                                                                                                                                                                                                                                            |
|Create Password Check Profile              |${CheckProfile} ||Do Nothing                                                                                                                                                                                                                                                                             ||Do Nothing   |
|Create Password Profile With Daily Schedule|Check           ||${CheckProfile2}                                                                                                                                                                                                                                                                       ||1||0:00-23:59|
|Create Password Profile With Daily Schedule|Change          ||${ChangeProfile2}                                                                                                                                                                                                                                                                      ||1||0:00-23:59|
  

*!

!|script                                                                                                                                                                                                                                                                                                  |
|Add Account                                                    |${CLIBatch}       ||--SystemName ${SystemName} --AccountName ${ManagedAccount} --Password \"${ManagedAccountPwd}\" --PasswordChangeProfile ${ChangeProfile} --PasswordCheckProfile ${CheckProfile}    ||successfully                     |
|Add Account                                                    |${CLIBatch}       ||--SystemName ${SystemName} --AccountName ${ManagedAccount}2 --Password \"${ManagedAccountPwd}\" --PasswordChangeProfile ${ChangeProfile} --PasswordCheckProfile ${CheckProfile}   ||successfully                     |
|Add Account                                                    |${CLIBatch}       ||--SystemName ${SystemName} --AccountName ${prefix}WithoutOpt --Password \"${ManagedAccountPwd}\" --PasswordChangeProfile ${ChangeProfile2} --PasswordCheckProfile ${CheckProfile2}||successfully                     |
|pause                                                          |120000                                                                                                                                                                                                                                   |
|Check Change Log                                               |${ManagedAccount} ||Scheduled Change Failed                                                                                                                                                                                              |
|Check Test Log                                                 |${ManagedAccount} ||Failed - Host Unreachable                                                                                                                                                                                            |
|Check Change Log                                               |${ManagedAccount}2||Scheduled Change Failed                                                                                                                                                                                              |
|Check Test Log                                                 |${ManagedAccount}2||Failed - Host Unreachable                                                                                                                                                                                            |
|Check Password Consecutive Failures Report (1 or more failures)|${SystemName}     ||${ManagedAccount}*                                                                                                                                                                ||${CheckProfile}||${ChangeProfile}|
|Check Password Consecutive Failures Report (Exactly)           |${SystemName}     ||${ManagedAccount}*                                                                                                                                                                ||${CheckProfile}||${ChangeProfile}|
|Check Password Consecutive Failures Report (Range)             |${SystemName}     ||${ManagedAccount}*                                                                                                                                                                ||${CheckProfile}||${ChangeProfile}|
|Management tab                                                 |${prefix}WithoutOpt                                                                                                                                                                                                                      |
|Check Consecutive Change Failures                              |1                                                                                                                                                                                                                                        |
|Check Consecutive Check Failures                               |1                                                                                                                                                                                                                                        |



!*> Cleanup
!|script                                                                                                                                                                                    |
|Update Account         |${CLIBatch}||--SystemName ${SystemName} --AccountName ${ManagedAccount} --AutoFlag N --PasswordCheckProfile "!NULL" --PasswordChangeProfile "!NULL"  ||successfully|
|Delete Account         |${CLIBatch}||--SystemName ${SystemName}  --AccountName ${ManagedAccount}                                                                             ||successfully|
|Update Account         |${CLIBatch}||--SystemName ${SystemName} --AccountName ${ManagedAccount}2 --AutoFlag N --PasswordCheckProfile "!NULL" --PasswordChangeProfile "!NULL" ||successfully|
|Delete Account         |${CLIBatch}||--SystemName ${SystemName}  --AccountName ${ManagedAccount}2                                                                            ||successfully|
|Update Account         |${CLIBatch}||--SystemName ${SystemName} --AccountName ${prefix}WithoutOpt --AutoFlag N --PasswordCheckProfile "!NULL" --PasswordChangeProfile "!NULL"||successfully|
|Delete Account         |${CLIBatch}||--SystemName ${SystemName}  --AccountName ${prefix}WithoutOpt                                                                           ||successfully|
|Delete Password Profile|Change     ||${ChangeProfile}                                                                                                                                      |
|Delete Password Profile|Check      ||${CheckProfile}                                                                                                                                       |
|Delete System          |${CLIBatch}||--SystemName ${SystemName}                                                                                                              ||successfully|
|Delete Password Profile|Change     ||${ChangeProfile2}                                                                                                                                     |
|Delete Password Profile|Check      ||${CheckProfile2}                                                                                                                                      |
|stop                                                                                                                                                                                       |
*!