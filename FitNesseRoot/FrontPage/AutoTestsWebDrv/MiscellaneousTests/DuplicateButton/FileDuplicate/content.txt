!********> Test Description
This test checks that Dublicate button for file is working.
Check that new file has same membership and permissions.
**************!
!include <AutoTestsWebDrv.PlatformsTesting.WindowsLocalHost
!define FileName {${UserPrefix}Origin}
!define dblFileName {${FileName}Double}
!define FilePath {c:\}
!define FileDesc {${UserPrefix}FileDesc} 
!define FileEmailAddr {${UserPrefix}FileEmailAddr0@tpam.spb.qsft}
!define psConnectOptions {-tpamAddress ${TPAMHost} -keyFile ${API_user_1} -apiUser ${API_user_1}}
!define numOfApprs {3}
!define ticketSystem {abFakeWebSystem}

!define CollectionName {${prefix}FileColtn}

!include -c <AutoTestsWebDrv.TicketSystemScenarios.ScenarioLibrary
!include -c <AutoTestsWebDrv.PowerShellNetApiScenarios.ScenarioLibrary
!include -c <AutoTestsWebDrv.EmailScenarios.ScenarioLibrary
!include -c <AutoTestsWebDrv.EmailScenarios.FilesNotifications.ScenarioLibrary
!include -c <AutoTestsWebDrv.CliScenarios.ScenarioLibrary
!include -c <AutoTestsWebDrv.PermissionHierarchy.ScenarioLibrary
!include -c <AutoTestsWebDrv.TicketSystemScenarios.Test04ManualTicketSystem.ScenarioLibrary
!include -c ScenarioLibrary

!* Create Envirinment
!|script                                                                                     |
|Create Manual Ticket System|${ticketSystem}                                                 |
|Add system                                                                                  |
|Add Collection             |${CollectionName}                                               |
|Create File                |${FilePath}    |        |${FileName}                            |
|Add File                                                                                    |
|Add File To Collection     |${SystemName}  |        |${FileName} |        |${CollectionName}|
|Set policy                 |Approver       |on file |${FileName} |for user|${CLI_user_2}    |
|Open                       |${TPAMURL}     |        |${TPAMAdmin}|        |${DefaultPwd}    |
|Set number of approvals    |${numOfApprs}  |on file |${FileName}                            |
|Set Ticket System tab      |${ticketSystem}|for file|${FileName}                            |
|pause                      |${ApplyNewPoliciesInterval}                                     |
*!
!* Duplicate and check results
!|script                                                                                                                                              |
|Duplicate  File                     |${FileName}                                                       |to                 |${dblFileName}           |
|pause                               |${ApplyNewPoliciesInterval}                                                                                     |
|List Collection Membership by filter|-collection ${CollectionName} -propsToList collectionName,fileName|and result contains|${dblFileName}           |
|List Policies by filter             |-FileName  ${dblFileName}                                         |contains           |${CLI_user_2}.*Approver.*|
|Check number of approvals  on file  |${dblFileName}                                                    |is                 |${numOfApprs}            |
|Check Ticket System tab for file    |${dblFileName}                                                                                                  |
|Logout Paradmin                                                                                                                                      |
*!
!*> Clear Environment
!|script                                         |
|Delete File         |${FilePath}||${FileName}   |
|Delete File         |${FilePath}||${dblFileName}|
|Remove system       |${SystemName}              |
|Delete Collection   |${CollectionName}          |
|Delete Ticket System|${ticketSystem}            |
*!